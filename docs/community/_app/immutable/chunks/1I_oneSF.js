import{s as X,n as q,d as m,i as U,b as r,l as h,c as p,e as D,o as W,g as A,h as _,j as P,p as Z,a as F,f as M,t as N,r as yt,q as at,z as nt,w as st,x as it,k as kt}from"./CwRy9Tox.js";import{S as $,i as tt}from"./D-vqeeah.js";import{ndk as rt,isConnected as ot}from"./ofNpoJHj.js";import{p as O}from"./CF7zP8uE.js";import{e as Q}from"./BFk-VQ8S.js";import{g as lt}from"./9tEgXtNp.js";import{a as Et}from"./BVL4R8vY.js";import{g as Dt}from"./BZgxvzt3.js";import{b as It}from"./CEc-lP5l.js";function wt(n){let t,s,e,l="Total Posts",o,a,i=et(n[0])+"",d,u,v,c,g="Members",I,f,V=et(n[1])+"",k,y,w,b,T="Newest Member",E,C,H=(n[2]||"None yet")+"",B,j,L=n[3]>0&&ct(n);return{c(){t=_("div"),s=_("div"),e=_("div"),e.textContent=l,o=P(),a=_("div"),d=N(i),u=P(),v=_("div"),c=_("div"),c.textContent=g,I=P(),f=_("div"),k=N(V),y=P(),w=_("div"),b=_("div"),b.textContent=T,E=P(),C=_("div"),B=N(H),j=P(),L&&L.c(),this.h()},l(S){t=p(S,"DIV",{class:!0});var x=D(t);s=p(x,"DIV",{class:!0});var z=D(s);e=p(z,"DIV",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-12cksw8"&&(e.textContent=l),o=A(z),a=p(z,"DIV",{class:!0});var G=D(a);d=M(G,i),G.forEach(m),z.forEach(m),u=A(x),v=p(x,"DIV",{class:!0});var K=D(v);c=p(K,"DIV",{class:!0,"data-svelte-h":!0}),W(c)!=="svelte-lc38ry"&&(c.textContent=g),I=A(K),f=p(K,"DIV",{class:!0});var R=D(f);k=M(R,V),R.forEach(m),K.forEach(m),y=A(x),w=p(x,"DIV",{class:!0});var Y=D(w);b=p(Y,"DIV",{class:!0,"data-svelte-h":!0}),W(b)!=="svelte-i7oi9r"&&(b.textContent=T),E=A(Y),C=p(Y,"DIV",{class:!0});var J=D(C);B=M(J,H),J.forEach(m),Y.forEach(m),j=A(x),L&&L.l(x),x.forEach(m),this.h()},h(){h(e,"class","text-base-content/60"),h(a,"class","text-xl font-bold text-primary"),h(s,"class","stat-item svelte-1yyv5sc"),h(c,"class","text-base-content/60"),h(f,"class","text-xl font-bold text-secondary"),h(v,"class","stat-item svelte-1yyv5sc"),h(b,"class","text-base-content/60"),h(C,"class","font-mono text-sm text-accent"),h(w,"class","stat-item col-span-2 svelte-1yyv5sc"),h(t,"class","grid grid-cols-2 gap-4 text-sm")},m(S,x){U(S,t,x),r(t,s),r(s,e),r(s,o),r(s,a),r(a,d),r(t,u),r(t,v),r(v,c),r(v,I),r(v,f),r(f,k),r(t,y),r(t,w),r(w,b),r(w,E),r(w,C),r(C,B),r(t,j),L&&L.m(t,null)},p(S,x){x&1&&i!==(i=et(S[0])+"")&&F(d,i),x&2&&V!==(V=et(S[1])+"")&&F(k,V),x&4&&H!==(H=(S[2]||"None yet")+"")&&F(B,H),S[3]>0?L?L.p(S,x):(L=ct(S),L.c(),L.m(t,null)):L&&(L.d(1),L=null)},d(S){S&&m(t),L&&L.d()}}}function Tt(n){let t,s='<span class="loading loading-spinner loading-sm"></span>';return{c(){t=_("div"),t.innerHTML=s,this.h()},l(e){t=p(e,"DIV",{class:!0,"data-svelte-h":!0}),W(t)!=="svelte-3o626j"&&(t.innerHTML=s),this.h()},h(){h(t,"class","flex justify-center py-4")},m(e,l){U(e,t,l)},p:q,d(e){e&&m(t)}}}function ct(n){let t,s,e,l,o,a,i,d=n[3]!==1?"s":"",u,v;return{c(){t=_("div"),s=_("div"),e=_("span"),l=P(),o=_("span"),a=N(n[3]),i=N(" user"),u=N(d),v=N(" active now"),this.h()},l(c){t=p(c,"DIV",{class:!0});var g=D(t);s=p(g,"DIV",{class:!0});var I=D(s);e=p(I,"SPAN",{class:!0}),D(e).forEach(m),l=A(I),o=p(I,"SPAN",{class:!0});var f=D(o);a=M(f,n[3]),i=M(f," user"),u=M(f,d),v=M(f," active now"),f.forEach(m),I.forEach(m),g.forEach(m),this.h()},h(){h(e,"class","w-2 h-2 bg-success rounded-full animate-pulse"),h(o,"class","text-success font-medium"),h(s,"class","flex items-center gap-2"),h(t,"class","stat-item col-span-2 bg-success/10 rounded-lg p-2 -mx-2 svelte-1yyv5sc")},m(c,g){U(c,t,g),r(t,s),r(s,e),r(s,l),r(s,o),r(o,a),r(o,i),r(o,u),r(o,v)},p(c,g){g&8&&F(a,c[3]),g&8&&d!==(d=c[3]!==1?"s":"")&&F(u,d)},d(c){c&&m(t)}}}function Ct(n){let t,s,e,l="Board Statistics",o;function a(u,v){return u[4]?Tt:wt}let i=a(n),d=i(n);return{c(){t=_("div"),s=_("div"),e=_("h3"),e.textContent=l,o=P(),d.c(),this.h()},l(u){t=p(u,"DIV",{class:!0});var v=D(t);s=p(v,"DIV",{class:!0});var c=D(s);e=p(c,"H3",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-1uuk4yr"&&(e.textContent=l),o=A(c),d.l(c),c.forEach(m),v.forEach(m),this.h()},h(){h(e,"class","card-title text-lg text-primary mb-3"),h(s,"class","card-body p-4"),h(t,"class","card bg-base-200 shadow-lg")},m(u,v){U(u,t,v),r(t,s),r(s,e),r(s,o),d.m(s,null)},p(u,[v]){i===(i=a(u))&&d?d.p(u,v):(d.d(1),d=i(u),d&&(d.c(),d.m(s,null)))},i:q,o:q,d(u){u&&m(t),d.d()}}}function et(n){return n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":n.toString()}function Vt(n,t,s){let{totalPosts:e=0}=t,{totalMembers:l=0}=t,{newestMember:o=""}=t,{activeUsers:a=0}=t,i=!0,d="";return Z(async()=>{const u=setTimeout(()=>{i&&(s(4,i=!1),console.warn("BoardStats: Fetch timeout, showing empty state"))},1e4);try{const v=rt();if(!v||!ot()){s(4,i=!1),console.warn("BoardStats: NDK not available or not connected");return}const c=await v.fetchEvents({kinds:[42],limit:1e3});s(0,e=c.size);const g=new Set;for(const y of c)g.add(y.pubkey);s(1,l=g.size);const I=Array.from(c).sort((y,w)=>(w.created_at||0)-(y.created_at||0)),f=new Set;for(const y of I)if(!f.has(y.pubkey)&&(f.add(y.pubkey),f.size===g.size)){d=y.pubkey,O.getProfile(y.pubkey).then(()=>{const w=O.getCachedSync(y.pubkey);s(2,o=w?.displayName||y.pubkey.substring(0,8)+"...")}),s(2,o=y.pubkey.substring(0,8)+"...");break}const V=Math.floor(Date.now()/1e3)-15*60,k=new Set;for(const y of c)(y.created_at||0)>V&&k.add(y.pubkey);s(3,a=k.size)}catch(v){console.error("Failed to fetch board stats:",v)}finally{clearTimeout(u),s(4,i=!1)}}),n.$$set=u=>{"totalPosts"in u&&s(0,e=u.totalPosts),"totalMembers"in u&&s(1,l=u.totalMembers),"newestMember"in u&&s(2,o=u.newestMember),"activeUsers"in u&&s(3,a=u.activeUsers)},[e,l,o,a,i]}class te extends ${constructor(t){super(),tt(this,t,Vt,Ct,X,{totalPosts:0,totalMembers:1,newestMember:2,activeUsers:3})}}function dt(n,t,s){const e=n.slice();return e[7]=t[s],e[9]=s,e}function xt(n){let t,s=Q(n[2]),e=[];for(let l=0;l<s.length;l+=1)e[l]=ut(dt(n,s,l));return{c(){t=_("div");for(let l=0;l<e.length;l+=1)e[l].c();this.h()},l(l){t=p(l,"DIV",{class:!0});var o=D(t);for(let a=0;a<e.length;a+=1)e[a].l(o);o.forEach(m),this.h()},h(){h(t,"class","space-y-2")},m(l,o){U(l,t,o);for(let a=0;a<e.length;a+=1)e[a]&&e[a].m(t,null)},p(l,o){if(o&4){s=Q(l[2]);let a;for(a=0;a<s.length;a+=1){const i=dt(l,s,a);e[a]?e[a].p(i,o):(e[a]=ut(i),e[a].c(),e[a].m(t,null))}for(;a<e.length;a+=1)e[a].d(1);e.length=s.length}},d(l){l&&m(t),nt(e,l)}}}function Mt(n){let t,s,e=n[0]==="today"?"today":"",l,o;return{c(){t=_("p"),s=N("No posts "),l=N(e),o=N(" yet"),this.h()},l(a){t=p(a,"P",{class:!0});var i=D(t);s=M(i,"No posts "),l=M(i,e),o=M(i," yet"),i.forEach(m),this.h()},h(){h(t,"class","text-base-content/60 text-sm text-center py-2")},m(a,i){U(a,t,i),r(t,s),r(t,l),r(t,o)},p(a,i){i&1&&e!==(e=a[0]==="today"?"today":"")&&F(l,e)},d(a){a&&m(t)}}}function Nt(n){let t,s='<span class="loading loading-spinner loading-sm"></span>';return{c(){t=_("div"),t.innerHTML=s,this.h()},l(e){t=p(e,"DIV",{class:!0,"data-svelte-h":!0}),W(t)!=="svelte-3o626j"&&(t.innerHTML=s),this.h()},h(){h(t,"class","flex justify-center py-4")},m(e,l){U(e,t,l)},p:q,d(e){e&&m(t)}}}function ut(n){let t,s,e=n[9]+1+"",l,o,a,i,d,u,v,c=n[7].displayName+"",g,I,f,V=n[7].postCount+"",k,y;return{c(){t=_("div"),s=_("span"),l=N(e),o=N("."),a=P(),i=_("img"),u=P(),v=_("span"),g=N(c),I=P(),f=_("span"),k=N(V),y=P(),this.h()},l(w){t=p(w,"DIV",{class:!0});var b=D(t);s=p(b,"SPAN",{class:!0});var T=D(s);l=M(T,e),o=M(T,"."),T.forEach(m),a=A(b),i=p(b,"IMG",{src:!0,alt:!0,class:!0}),u=A(b),v=p(b,"SPAN",{class:!0});var E=D(v);g=M(E,c),E.forEach(m),I=A(b),f=p(b,"SPAN",{class:!0});var C=D(f);k=M(C,V),C.forEach(m),y=A(b),b.forEach(m),this.h()},h(){h(s,"class","w-5 text-base-content/60 font-mono"),st(i.src,d=n[7].avatar)||h(i,"src",d),h(i,"alt",""),h(i,"class","w-6 h-6 rounded-full"),h(v,"class","flex-1 truncate font-mono text-xs"),h(f,"class","badge badge-sm badge-primary"),h(t,"class","flex items-center gap-2 text-sm")},m(w,b){U(w,t,b),r(t,s),r(s,l),r(s,o),r(t,a),r(t,i),r(t,u),r(t,v),r(v,g),r(t,I),r(t,f),r(f,k),r(t,y)},p(w,b){b&4&&!st(i.src,d=w[7].avatar)&&h(i,"src",d),b&4&&c!==(c=w[7].displayName+"")&&F(g,c),b&4&&V!==(V=w[7].postCount+"")&&F(k,V)},d(w){w&&m(t)}}}function At(n){let t,s,e,l="Top 10 Posters",o,a,i,d,u,v,c,g,I,f,V,k;function y(T,E){return T[1]?Nt:T[2].length===0?Mt:xt}let w=y(n),b=w(n);return{c(){t=_("div"),s=_("div"),e=_("h3"),e.textContent=l,o=P(),a=_("div"),i=_("button"),d=N("Today"),v=P(),c=_("button"),g=N("All Time"),f=P(),b.c(),this.h()},l(T){t=p(T,"DIV",{class:!0});var E=D(t);s=p(E,"DIV",{class:!0});var C=D(s);e=p(C,"H3",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-satlyh"&&(e.textContent=l),o=A(C),a=p(C,"DIV",{class:!0});var H=D(a);i=p(H,"BUTTON",{class:!0});var B=D(i);d=M(B,"Today"),B.forEach(m),v=A(H),c=p(H,"BUTTON",{class:!0});var j=D(c);g=M(j,"All Time"),j.forEach(m),H.forEach(m),f=A(C),b.l(C),C.forEach(m),E.forEach(m),this.h()},h(){h(e,"class","card-title text-lg text-primary mb-2"),h(i,"class",u="tab tab-sm "+(n[0]==="today"?"tab-active":"")),h(c,"class",I="tab tab-sm "+(n[0]==="alltime"?"tab-active":"")),h(a,"class","tabs tabs-boxed bg-base-300 mb-3"),h(s,"class","card-body p-4"),h(t,"class","card bg-base-200 shadow-lg")},m(T,E){U(T,t,E),r(t,s),r(s,e),r(s,o),r(s,a),r(a,i),r(i,d),r(a,v),r(a,c),r(c,g),r(s,f),b.m(s,null),V||(k=[at(i,"click",n[5]),at(c,"click",n[6])],V=!0)},p(T,[E]){E&1&&u!==(u="tab tab-sm "+(T[0]==="today"?"tab-active":""))&&h(i,"class",u),E&1&&I!==(I="tab tab-sm "+(T[0]==="alltime"?"tab-active":""))&&h(c,"class",I),w===(w=y(T))&&b?b.p(T,E):(b.d(1),b=w(T),b&&(b.c(),b.m(s,null)))},i:q,o:q,d(T){T&&m(t),b.d(),V=!1,yt(k)}}}function Pt(n,t,s){let e,l=[],o=[],a="today",i=!0;Z(async()=>{const v=setTimeout(()=>{i&&(s(1,i=!1),console.warn("TopPosters: Fetch timeout, showing empty state"))},1e4);try{const c=rt();if(!c||!ot()){s(1,i=!1);return}const g=await c.fetchEvents({kinds:[42],limit:2e3}),I=Math.floor(Date.now()/1e3)-24*60*60,f=new Map,V=new Map;for(const y of g)V.set(y.pubkey,(V.get(y.pubkey)||0)+1),(y.created_at||0)>I&&f.set(y.pubkey,(f.get(y.pubkey)||0)+1);const k=async y=>{const w=Array.from(y.entries()).sort((b,T)=>T[1]-b[1]).slice(0,10);return await O.prefetchProfiles(w.map(([b])=>b)),w.map(([b,T])=>{const E=O.getCachedSync(b);return{pubkey:b,displayName:E?.displayName||b.substring(0,8)+"...",postCount:T,avatar:E?.avatar||lt(b,48)}})};s(3,l=await k(f)),s(4,o=await k(V))}catch(c){console.error("Failed to fetch top posters:",c)}finally{clearTimeout(v),s(1,i=!1)}});const d=()=>s(0,a="today"),u=()=>s(0,a="alltime");return n.$$.update=()=>{n.$$.dirty&25&&s(2,e=a==="today"?l:o)},[a,i,e,l,o,d,u]}class ee extends ${constructor(t){super(),tt(this,t,Pt,At,X,{})}}function ft(n){let t,s,e,l,o,a,i=(n[3]||n[2]).charAt(0).toUpperCase()+"",d,u,v,c,g,I,f=(n[3]||n[2])+"",V,k,y;function w(E,C){return E[1]?Lt:St}let b=w(n),T=b(n);return{c(){t=_("div"),s=_("div"),e=_("div"),l=_("div"),o=_("div"),a=_("span"),d=N(i),u=P(),v=_("div"),c=_("p"),g=N("Welcome back, "),I=_("span"),V=N(f),k=N("!"),y=P(),T.c(),this.h()},l(E){t=p(E,"DIV",{class:!0});var C=D(t);s=p(C,"DIV",{class:!0});var H=D(s);e=p(H,"DIV",{class:!0});var B=D(e);l=p(B,"DIV",{class:!0});var j=D(l);o=p(j,"DIV",{class:!0});var L=D(o);a=p(L,"SPAN",{class:!0});var S=D(a);d=M(S,i),S.forEach(m),L.forEach(m),j.forEach(m),u=A(B),v=p(B,"DIV",{});var x=D(v);c=p(x,"P",{class:!0});var z=D(c);g=M(z,"Welcome back, "),I=p(z,"SPAN",{class:!0});var G=D(I);V=M(G,f),G.forEach(m),k=M(z,"!"),z.forEach(m),y=A(x),T.l(x),x.forEach(m),B.forEach(m),H.forEach(m),C.forEach(m),this.h()},h(){h(a,"class","text-lg"),h(o,"class","w-10 rounded-full bg-primary text-primary-content"),h(l,"class","avatar placeholder"),h(I,"class","text-primary"),h(c,"class","font-medium"),h(e,"class","flex items-center gap-3"),h(s,"class","card-body p-4"),h(t,"class","card bg-gradient-to-r from-primary/10 to-secondary/10 border border-primary/20")},m(E,C){U(E,t,C),r(t,s),r(s,e),r(e,l),r(l,o),r(o,a),r(a,d),r(e,u),r(e,v),r(v,c),r(c,g),r(c,I),r(I,V),r(c,k),r(v,y),T.m(v,null)},p(E,C){C&12&&i!==(i=(E[3]||E[2]).charAt(0).toUpperCase()+"")&&F(d,i),C&12&&f!==(f=(E[3]||E[2])+"")&&F(V,f),b===(b=w(E))&&T?T.p(E,C):(T.d(1),T=b(E),T&&(T.c(),T.m(v,null)))},d(E){E&&m(t),T.d()}}}function St(n){let t,s="First time here? Welcome to the community!";return{c(){t=_("p"),t.textContent=s,this.h()},l(e){t=p(e,"P",{class:!0,"data-svelte-h":!0}),W(t)!=="svelte-1l6qmqn"&&(t.textContent=s),this.h()},h(){h(t,"class","text-sm text-base-content/60")},m(e,l){U(e,t,l)},p:q,d(e){e&&m(t)}}}function Lt(n){let t,s,e=vt(n[1])+"",l;return{c(){t=_("p"),s=N("Last visit: "),l=N(e),this.h()},l(o){t=p(o,"P",{class:!0});var a=D(t);s=M(a,"Last visit: "),l=M(a,e),a.forEach(m),this.h()},h(){h(t,"class","text-sm text-base-content/60")},m(o,a){U(o,t,a),r(t,s),r(t,l)},p(o,a){a&2&&e!==(e=vt(o[1])+"")&&F(l,e)},d(o){o&&m(t)}}}function Ht(n){let t,s=n[0].isAuthenticated&&ft(n);return{c(){s&&s.c(),t=it()},l(e){s&&s.l(e),t=it()},m(e,l){s&&s.m(e,l),U(e,t,l)},p(e,[l]){e[0].isAuthenticated?s?s.p(e,l):(s=ft(e),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},i:q,o:q,d(e){e&&m(t),s&&s.d(e)}}}const ht="nostr_bbs_last_visit";function vt(n){const s=new Date().getTime()-n.getTime(),e=Math.floor(s/6e4),l=Math.floor(s/36e5),o=Math.floor(s/864e5);return e<1?"just now":e<60?`${e} minute${e!==1?"s":""} ago`:l<24?`${l} hour${l!==1?"s":""} ago`:o<7?`${o} day${o!==1?"s":""} ago`:n.toLocaleDateString()}function Ut(n,t,s){let e,l,o;kt(n,Et,i=>s(0,o=i));let a=null;return Z(()=>{const i=localStorage.getItem(ht);i&&s(1,a=new Date(parseInt(i))),localStorage.setItem(ht,Date.now().toString())}),n.$$.update=()=>{n.$$.dirty&1&&s(3,e=o.nickname||""),n.$$.dirty&1&&s(2,l=o.publicKey?.substring(0,8)+"..."||"")},[o,a,l,e]}class se extends ${constructor(t){super(),tt(this,t,Ut,Ht,X,{})}}function mt(n,t,s){const e=n.slice();return e[5]=t[s],e}function Bt(n){let t,s=Q(n[0]),e=[];for(let l=0;l<s.length;l+=1)e[l]=pt(mt(n,s,l));return{c(){t=_("div");for(let l=0;l<e.length;l+=1)e[l].c();this.h()},l(l){t=p(l,"DIV",{class:!0});var o=D(t);for(let a=0;a<e.length;a+=1)e[a].l(o);o.forEach(m),this.h()},h(){h(t,"class","space-y-3")},m(l,o){U(l,t,o);for(let a=0;a<e.length;a+=1)e[a]&&e[a].m(t,null)},p(l,o){if(o&13){s=Q(l[0]);let a;for(a=0;a<s.length;a+=1){const i=mt(l,s,a);e[a]?e[a].p(i,o):(e[a]=pt(i),e[a].c(),e[a].m(t,null))}for(;a<e.length;a+=1)e[a].d(1);e.length=s.length}},d(l){l&&m(t),nt(e,l)}}}function Ft(n){let t,s="No activity today yet";return{c(){t=_("p"),t.textContent=s,this.h()},l(e){t=p(e,"P",{class:!0,"data-svelte-h":!0}),W(t)!=="svelte-qh4er7"&&(t.textContent=s),this.h()},h(){h(t,"class","text-base-content/60 text-sm text-center py-2")},m(e,l){U(e,t,l)},p:q,d(e){e&&m(t)}}}function jt(n){let t,s='<span class="loading loading-spinner loading-sm"></span>';return{c(){t=_("div"),t.innerHTML=s,this.h()},l(e){t=p(e,"DIV",{class:!0,"data-svelte-h":!0}),W(t)!=="svelte-3o626j"&&(t.innerHTML=s),this.h()},h(){h(t,"class","flex justify-center py-4")},m(e,l){U(e,t,l)},p:q,d(e){e&&m(t)}}}function pt(n){let t,s,e,l=n[5].messageCount+"",o,a,i,d,u=n[5].channelName+"",v,c,g,I=n[5].lastMessage+"",f,V,k,y,w=n[2](n[5].lastAuthorPubkey)+"",b,T,E=_t(n[5].lastTimestamp)+"",C,H,B,j;function L(){return n[4](n[5])}return{c(){t=_("button"),s=_("div"),e=_("div"),o=N(l),a=P(),i=_("div"),d=_("div"),v=N(u),c=P(),g=_("div"),f=N(I),V=P(),k=_("div"),y=N("by "),b=N(w),T=N(" at "),C=N(E),H=P(),this.h()},l(S){t=p(S,"BUTTON",{class:!0});var x=D(t);s=p(x,"DIV",{class:!0});var z=D(s);e=p(z,"DIV",{class:!0});var G=D(e);o=M(G,l),G.forEach(m),a=A(z),i=p(z,"DIV",{class:!0});var K=D(i);d=p(K,"DIV",{class:!0});var R=D(d);v=M(R,u),R.forEach(m),c=A(K),g=p(K,"DIV",{class:!0});var Y=D(g);f=M(Y,I),Y.forEach(m),V=A(K),k=p(K,"DIV",{class:!0});var J=D(k);y=M(J,"by "),b=M(J,w),T=M(J," at "),C=M(J,E),J.forEach(m),K.forEach(m),z.forEach(m),H=A(x),x.forEach(m),this.h()},h(){h(e,"class","badge badge-primary badge-sm mt-1"),h(d,"class","font-medium text-sm truncate"),h(g,"class","text-xs text-base-content/60 truncate"),h(k,"class","text-xs text-base-content/40 mt-1"),h(i,"class","flex-1 min-w-0"),h(s,"class","flex items-start gap-2"),h(t,"class","w-full text-left hover:bg-base-300 rounded-lg p-2 -mx-2 transition-colors")},m(S,x){U(S,t,x),r(t,s),r(s,e),r(e,o),r(s,a),r(s,i),r(i,d),r(d,v),r(i,c),r(i,g),r(g,f),r(i,V),r(i,k),r(k,y),r(k,b),r(k,T),r(k,C),r(t,H),B||(j=at(t,"click",L),B=!0)},p(S,x){n=S,x&1&&l!==(l=n[5].messageCount+"")&&F(o,l),x&1&&u!==(u=n[5].channelName+"")&&F(v,u),x&1&&I!==(I=n[5].lastMessage+"")&&F(f,I),x&1&&w!==(w=n[2](n[5].lastAuthorPubkey)+"")&&F(b,w),x&1&&E!==(E=_t(n[5].lastTimestamp)+"")&&F(C,E)},d(S){S&&m(t),B=!1,j()}}}function qt(n){let t,s,e,l="Today's Active Topics",o;function a(u,v){return u[1]?jt:u[0].length===0?Ft:Bt}let i=a(n),d=i(n);return{c(){t=_("div"),s=_("div"),e=_("h3"),e.textContent=l,o=P(),d.c(),this.h()},l(u){t=p(u,"DIV",{class:!0});var v=D(t);s=p(v,"DIV",{class:!0});var c=D(s);e=p(c,"H3",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-14dz6bk"&&(e.textContent=l),o=A(c),d.l(c),c.forEach(m),v.forEach(m),this.h()},h(){h(e,"class","card-title text-lg text-primary mb-2"),h(s,"class","card-body p-4"),h(t,"class","card bg-base-200 shadow-lg")},m(u,v){U(u,t,v),r(t,s),r(s,e),r(s,o),d.m(s,null)},p(u,[v]){i===(i=a(u))&&d?d.p(u,v):(d.d(1),d=i(u),d&&(d.c(),d.m(s,null)))},i:q,o:q,d(u){u&&m(t),d.d()}}}function _t(n){return new Date(n*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function zt(n,t,s){let e=[],l=!0;Z(async()=>{const d=setTimeout(()=>{l&&(s(1,l=!1),console.warn("TodaysActivity: Fetch timeout, showing empty state"))},1e4);try{const u=rt();if(!u||!ot()){s(1,l=!1);return}const v=Math.floor(Date.now()/1e3)-24*60*60,c=await u.fetchEvents({kinds:[42],since:v,limit:500}),g=await u.fetchEvents({kinds:[40],limit:100}),I=new Map;for(const k of g)try{const y=JSON.parse(k.content);I.set(k.id,y.name||"Unnamed")}catch{I.set(k.id,"Unnamed")}const f=new Map;for(const k of c){const y=k.tags.find(b=>b[0]==="e"&&b[3]==="root");if(!y)continue;const w=y[1];f.has(w)||f.set(w,{messages:[]}),f.get(w).messages.push({content:k.content,pubkey:k.pubkey,timestamp:k.created_at||0})}s(0,e=Array.from(f.entries()).map(([k,y])=>{const b=y.messages.sort((T,E)=>E.timestamp-T.timestamp)[0];return{channelId:k,channelName:I.get(k)||k.substring(0,8)+"...",lastMessage:b.content.substring(0,50)+(b.content.length>50?"...":""),lastAuthor:b.pubkey.substring(0,8)+"...",lastAuthorPubkey:b.pubkey,lastTimestamp:b.timestamp,messageCount:y.messages.length}}).sort((k,y)=>y.messageCount-k.messageCount).slice(0,5));const V=e.map(k=>k.lastAuthorPubkey);V.length>0&&O.prefetchProfiles([...new Set(V)])}catch(u){console.error("Failed to fetch today's activity:",u)}finally{clearTimeout(d),s(1,l=!1)}});function o(d){return O.getCachedSync(d)?.displayName||d.substring(0,8)+"..."}function a(d){Dt(`${It}/chat/${d}`)}return[e,l,o,a,d=>a(d.channelId)]}class ae extends ${constructor(t){super(),tt(this,t,zt,qt,X,{})}}function bt(n,t,s){const e=n.slice();return e[3]=t[s],e}function gt(n){let t,s,e,l,o,a,i,d,u,v=n[3].displayName+"",c,g,I,f=n[3].role+"",V,k,y,w=n[3].role.charAt(0)+"",b,T;return{c(){t=_("div"),s=_("div"),e=_("div"),l=_("img"),i=P(),d=_("div"),u=_("div"),c=N(v),g=P(),I=_("div"),V=N(f),k=P(),y=_("div"),b=N(w),T=P(),this.h()},l(E){t=p(E,"DIV",{class:!0});var C=D(t);s=p(C,"DIV",{class:!0});var H=D(s);e=p(H,"DIV",{class:!0});var B=D(e);l=p(B,"IMG",{src:!0,alt:!0}),B.forEach(m),H.forEach(m),i=A(C),d=p(C,"DIV",{class:!0});var j=D(d);u=p(j,"DIV",{class:!0});var L=D(u);c=M(L,v),L.forEach(m),g=A(j),I=p(j,"DIV",{class:!0});var S=D(I);V=M(S,f),S.forEach(m),j.forEach(m),k=A(C),y=p(C,"DIV",{class:!0});var x=D(y);b=M(x,w),x.forEach(m),T=A(C),C.forEach(m),this.h()},h(){st(l.src,o=n[3].avatar)||h(l,"src",o),h(l,"alt",a=n[3].displayName),h(e,"class","w-10 rounded-full"),h(s,"class","avatar"),h(u,"class","font-medium text-sm"),h(I,"class","text-xs text-base-content/60"),h(d,"class","flex-1"),h(y,"class","badge badge-primary badge-sm"),h(t,"class","flex items-center gap-3")},m(E,C){U(E,t,C),r(t,s),r(s,e),r(e,l),r(t,i),r(t,d),r(d,u),r(u,c),r(d,g),r(d,I),r(I,V),r(t,k),r(t,y),r(y,b),r(t,T)},p(E,C){C&1&&!st(l.src,o=E[3].avatar)&&h(l,"src",o),C&1&&a!==(a=E[3].displayName)&&h(l,"alt",a),C&1&&v!==(v=E[3].displayName+"")&&F(c,v),C&1&&f!==(f=E[3].role+"")&&F(V,f),C&1&&w!==(w=E[3].role.charAt(0)+"")&&F(b,w)},d(E){E&&m(t)}}}function Wt(n){let t,s,e,l="Moderating Team",o,a,i,d,u='<p class="text-xs text-base-content/50 text-center">Contact a moderator for help</p>',v=Q(n[0]),c=[];for(let g=0;g<v.length;g+=1)c[g]=gt(bt(n,v,g));return{c(){t=_("div"),s=_("div"),e=_("h3"),e.textContent=l,o=P(),a=_("div");for(let g=0;g<c.length;g+=1)c[g].c();i=P(),d=_("div"),d.innerHTML=u,this.h()},l(g){t=p(g,"DIV",{class:!0});var I=D(t);s=p(I,"DIV",{class:!0});var f=D(s);e=p(f,"H3",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-pfy2lf"&&(e.textContent=l),o=A(f),a=p(f,"DIV",{class:!0});var V=D(a);for(let k=0;k<c.length;k+=1)c[k].l(V);V.forEach(m),i=A(f),d=p(f,"DIV",{class:!0,"data-svelte-h":!0}),W(d)!=="svelte-3kbqla"&&(d.innerHTML=u),f.forEach(m),I.forEach(m),this.h()},h(){h(e,"class","card-title text-lg text-primary mb-3"),h(a,"class","space-y-3"),h(d,"class","mt-3 pt-3 border-t border-base-300"),h(s,"class","card-body p-4"),h(t,"class","card bg-base-200 shadow-lg")},m(g,I){U(g,t,I),r(t,s),r(s,e),r(s,o),r(s,a);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(a,null);r(s,i),r(s,d)},p(g,[I]){if(I&1){v=Q(g[0]);let f;for(f=0;f<v.length;f+=1){const V=bt(g,v,f);c[f]?c[f].p(V,I):(c[f]=gt(V),c[f].c(),c[f].m(a,null))}for(;f<c.length;f+=1)c[f].d(1);c.length=v.length}},i:q,o:q,d(g){g&&m(t),nt(c,g)}}}function Kt(n,t,s){let{moderators:e=[]}=t;const l="11ed64225dd5e2c5e18f61ad43d5ad9272d08739d3a20dd25886197b0738663c";let o=[];return Z(async()=>{if(e.length>0)await O.prefetchProfiles(e.map(a=>a.pubkey)),s(0,o=e.map(a=>{const i=O.getCachedSync(a.pubkey);return{...a,displayName:i?.displayName||a.displayName,avatar:i?.avatar||lt(a.pubkey,80)}}));else{const a=await O.getProfile(l);s(0,o=[{pubkey:l,displayName:a?.displayName||"Admin",role:"Administrator",avatar:a?.avatar||lt(l,80)}])}}),n.$$set=a=>{"moderators"in a&&s(1,e=a.moderators)},[o,e]}class le extends ${constructor(t){super(),tt(this,t,Kt,Wt,X,{moderators:1})}}export{te as B,le as M,ae as T,se as W,ee as a};
