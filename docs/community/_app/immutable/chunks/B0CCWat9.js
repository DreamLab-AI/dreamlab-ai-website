import{d as r,w as d}from"./CEc-lP5l.js";import{a as u}from"./BVL4R8vY.js";import{a as c}from"./BnIToiQU.js";import{p as m}from"./CF7zP8uE.js";const o=d(null);function b(e){return{pubkey:e,name:null,displayName:null,avatar:null,about:null,cohorts:[],isAdmin:!1,isApproved:!1,nip05:null,lud16:null,website:null,banner:null,birthday:null,createdAt:null,updatedAt:null}}const t=r(u,(e,n)=>{if(e.state!=="authenticated"||!e.pubkey){n({profile:null,isLoading:!1,error:null});return}const s=b(e.pubkey);n({profile:s,isLoading:!0,error:null}),(async()=>{if(!e.pubkey){n({profile:s,isLoading:!1,error:null});return}let i;try{i=await c(e.pubkey),o.set(i),console.log("[User] Whitelist status verified:",{pubkey:e.pubkey?e.pubkey.slice(0,8)+"...":"unknown",isAdmin:i.isAdmin,source:i.source})}catch(a){console.warn("[User] Whitelist verification failed:",a),i={isWhitelisted:!1,isAdmin:!1,cohorts:[],verifiedAt:Date.now(),source:"fallback"},o.set(i)}const f=i.cohorts.map(a=>({freshman:"freshman",sophomore:"sophomore",junior:"junior",senior:"senior",graduate:"graduate",faculty:"faculty",staff:"staff",alumni:"alumni"})[a]||"freshman");let l=null;try{l=await m.getProfile(e.pubkey)}catch(a){console.warn("[User] Profile fetch failed (non-fatal):",a)}const p={...s,name:l?.profile?.name??null,displayName:l?.displayName??null,avatar:l?.avatar??null,about:l?.about??null,nip05:l?.nip05??null,lud16:l?.profile?.lud16??null,website:l?.profile?.website??null,banner:l?.profile?.banner??null,birthday:l?.profile?.birthday??null,isAdmin:i.isAdmin,isApproved:i.isWhitelisted,cohorts:f,createdAt:Date.now(),updatedAt:Date.now()};n({profile:p,isLoading:!1,error:null})})()},{profile:null,isLoading:!1,error:null});r(u,e=>e.state==="authenticated"&&e.pubkey!==null);const g=r(t,e=>e.profile?.isAdmin??!1),P=r(o,e=>e?.isAdmin??!1);r(o,e=>e?.source??null);const S=r(t,e=>e.profile?.isApproved??!1),L=r(u,e=>e.pubkey);r(t,e=>e.profile?.cohorts??[]);r(t,e=>e.profile?.displayName??e.profile?.name??null);export{S as a,g as b,L as c,P as i,t as u,o as w};
