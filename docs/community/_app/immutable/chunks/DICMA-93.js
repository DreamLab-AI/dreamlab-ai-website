import{ndk as u}from"./Cne-Q8lD.js";import{v as d}from"./31tQ-Gc1.js";async function h(a){const e=u();if(!e)return console.error("NDK not initialized"),[];try{const t={kinds:[0],limit:500},n=await e.fetchEvents(t),i=[];for(const s of n)try{const r=JSON.parse(s.content),o=r.birthday;o&&b(o)&&await d(s.pubkey,a)&&i.push({pubkey:s.pubkey,name:r.display_name||r.name||null,avatar:r.picture||null,birthday:o,dayMonth:o.slice(5)})}catch{}return i}catch(t){return console.error("Failed to fetch cohort birthdays:",t),[]}}function c(a,e=new Date().getFullYear()){return a.map(t=>{const[n,i]=t.dayMonth.split("-").map(Number),s=new Date(e,n-1,i),r=Math.floor(s.getTime()/1e3),o=r+86400-1;return{id:`birthday-${t.pubkey}-${e}`,title:`${t.name||"Member"}'s Birthday`,description:`Happy birthday to ${t.name||"a tribe member"}!`,start:r,end:o,channelId:"birthdays",createdBy:t.pubkey,tags:["birthday"]}})}async function y(a){const e="moomaa-tribe";if(!await d(a,e))return[];const n=await h(e),i=new Date().getFullYear(),s=c(n,i),r=c(n,i+1);return[...s,...r]}function b(a){if(!/^\d{4}-\d{2}-\d{2}$/.test(a))return!1;const[e,t,n]=a.split("-").map(Number);return!(t<1||t>12||n<1||n>31||e<1900||e>new Date().getFullYear())}export{y as f};
