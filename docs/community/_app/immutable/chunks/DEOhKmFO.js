import{ndk as l}from"./DRx8R66N.js";import{N as h}from"./I2mpdA09.js";import{c as u}from"./BZVWDyrL.js";const d=31923,m=31925;async function k(n){const t={title:n.title,description:n.description,start:Math.floor(n.start.getTime()/1e3),end:Math.floor(n.end.getTime()/1e3),location:n.location,channelId:n.channelId,maxAttendees:n.maxAttendees,tags:n.tags},a=l();if(!a?.signer)return console.error("NDK not connected or no signer available"),null;try{let e;if(n.createChatRoom)try{e=(await u({name:`${t.title} - Chat`,description:`Discussion room for event: ${t.title}`,visibility:"cohort",cohorts:[t.channelId]})).id,console.log("Created linked chatroom:",e)}catch(c){console.error("Failed to create linked chatroom:",c)}const o=new h(a);o.kind=d;const i=JSON.stringify({title:t.title,description:t.description,location:t.location,maxAttendees:t.maxAttendees,chatRoomId:e});return o.content=i,o.tags=[["d",`${t.start}-${t.channelId}`],["name",t.title],["start",t.start.toString()],["end",t.end.toString()],["e",t.channelId,"","channel"]],e&&o.tags.push(["e",e,"","chatroom"]),t.location&&o.tags.push(["location",t.location]),t.tags&&t.tags.forEach(c=>o.tags.push(["t",c])),await o.sign(),await o.publish(),{id:o.id,title:t.title,description:t.description,start:t.start,end:t.end,location:t.location,channelId:t.channelId,chatRoomId:e,createdBy:o.pubkey,maxAttendees:t.maxAttendees,tags:t.tags}}catch(e){return console.error("Failed to create calendar event:",e),null}}async function E(){const n=l();if(!n)return console.error("NDK not initialized"),[];try{const t={kinds:[d],limit:500},a=await n.fetchEvents(t);return Array.from(a).map(f).filter(Boolean).sort((e,o)=>e.start-o.start)}catch(t){return console.error("Failed to fetch all events:",t),[]}}async function v(n=7){const t=l();if(!t)return console.error("NDK not initialized"),[];const a=Math.floor(Date.now()/1e3),e=a+n*24*60*60;try{const o={kinds:[d],since:a-86400,limit:100},i=await t.fetchEvents(o);return Array.from(i).map(f).filter(c=>c!==null&&c.start<=e&&c.end>=a).sort((c,s)=>c.start-s.start)}catch(o){return console.error("Failed to fetch upcoming events:",o),[]}}async function A(n,t){const a=l();if(!a?.signer)return console.error("NDK not connected or no signer available"),!1;try{const e=new h(a);return e.kind=m,e.content="",e.tags=[["e",n,"","event"],["status",t],["d",n]],await e.sign(),await e.publish(),!0}catch(e){return console.error("Failed to RSVP to event:",e),!1}}function f(n){try{const t=n.tags.find(r=>r[0]==="name"),a=n.tags.find(r=>r[0]==="start"),e=n.tags.find(r=>r[0]==="end"),o=n.tags.find(r=>r[0]==="e"&&r[3]==="channel"),i=n.tags.find(r=>r[0]==="location"),c=n.tags.find(r=>r[0]==="e"&&r[3]==="chatroom");if(!t||!a)return null;let s={};try{s=JSON.parse(n.content)}catch{s={description:n.content}}const g=c?.[1]||s.chatRoomId;return{id:n.id,title:t[1],description:s.description||"",start:parseInt(a[1],10),end:parseInt(e?e[1]:a[1],10),location:i?.[1],channelId:o?.[1]||"",chatRoomId:g,createdBy:n.pubkey,maxAttendees:s.maxAttendees,tags:n.tags.filter(r=>r[0]==="t").map(r=>r[1])}}catch(t){return console.error("Failed to parse calendar event:",t),null}}export{v as a,k as c,E as f,A as r};
