import{s as be,n as E,d as c,i as C,x as K,z as se,b as d,l as u,c as m,e as T,g as I,h as p,j as B,y as z,q as oe,D as ne,a as N,f as A,t as U,o as ae}from"./CwRy9Tox.js";import{e as O}from"./BFk-VQ8S.js";import{S as de,i as he}from"./D-vqeeah.js";import{c as G,h as ve,a as re}from"./D5Zb0hft.js";import{e as _e,s as ke,l as me}from"./I2mpdA09.js";function ce(t){if(!t.visibility)return null;if("visibleTo"in t.visibility&&"detailsVisibleTo"in t.visibility)return t.visibility;const e=t.visibility;return{visibleTo:{sections:e.visibleToSections||[],cohorts:e.visibleToCohorts||[],roles:e.visibleToRoles||[],specificUsers:e.specificUsers||[]},detailsVisibleTo:{sections:e.detailsVisibleToSections||[],cohorts:e.detailsVisibleToCohorts||[],roles:[],specificUsers:e.specificUsers||[]},rsvpAllowedFor:{cohorts:e.visibleToCohorts||[],roles:e.visibleToRoles||[]}}}function fe(t){if(t.sectionId)return t.sectionId;if(t.linkedResources?.channelId)return t.linkedResources.channelId.split("/")[0]}function pe(t,e){if(e.globalRole==="admin")return"full";const o=ce(t),s=fe(t);if(!o||o.detailsVisibleTo.specificUsers.includes(e.pubkey))return"full";const l=o.visibleTo.specificUsers.includes(e.pubkey),i=o.detailsVisibleTo.cohorts.some(b=>e.cohorts.includes(b)),n=o.detailsVisibleTo.roles.some(b=>b===e.globalRole||e.sectionRoles.some(w=>w.role===b)),a=o.detailsVisibleTo.sections.some(b=>G(e,b)?s?b===s:!0:!1);if(i||n||a||l)return"full";const r=o.visibleTo.cohorts.some(b=>e.cohorts.includes(b)),y=o.visibleTo.roles.some(b=>b===e.globalRole||e.sectionRoles.some(w=>w.role===b)),V=o.visibleTo.sections.some(b=>G(e,b));return r||y||V?"type":s&&G(e,s)?"busy":"hidden"}function Me(t,e){if(t.status&&t.status!=="published")return!1;const o=pe(t,e);if(o==="hidden"||o==="busy")return!1;if(t.attendance?.maxCapacity!==void 0&&t.attendance.currentCount>=t.attendance.maxCapacity)return t.attendance.waitlistEnabled??!1;const s=ce(t);if(!s)return!0;const l=s.rsvpAllowedFor.cohorts.some(a=>e.cohorts.includes(a)),i=s.rsvpAllowedFor.roles.some(a=>a===e.globalRole||e.sectionRoles.some(r=>r.role===a));return s.rsvpAllowedFor.cohorts.length===0&&s.rsvpAllowedFor.roles.length===0||l||i}function ye(t){if(t)return typeof t=="string"?t:t.primary}function je(t){const e=ye(t);return e&&{workshop:"ðŸ”§",seminar:"ðŸ“š",social:"ðŸ¥³",ceremony:"ðŸŒ¸",retreat:"ðŸ§˜","work-session":"ðŸ’¼",work_session:"ðŸ’¼",maintenance:"ðŸ› ï¸",accommodation:"ðŸ›ï¸","club-night":"ðŸŽµ",club_night:"ðŸŽµ",festival:"ðŸŽª",market:"ðŸ›ï¸",nature:"ðŸŒ²",exhibition:"ðŸŽ¨",meetup:"ðŸ¤",webinar:"ðŸŽ“",call:"ðŸ“ž",stream:"ðŸ“º",planning:"ðŸ“‹"}[e]||"ðŸ“…"}function He(t){return t&&{fairfield:"ðŸ ",offsite:"ðŸ“",online:"ðŸ’»",external:"ðŸŒ"}[t]||"ðŸ“"}const J={"fairfield-family":"#991b1b",dreamlab:"#c2410c",minimoonoir:"#6366f1",default:"#6b7280"};function ge(t){switch(t){case"fairfield-family":return"hard";case"dreamlab":return"soft";case"minimoonoir":return"tentative";default:return"soft"}}function Te(t,e){return e?.[t]?e[t]:J[t]||J.default}function Ce(t){const e=me(t);return e?.branding?.displayName||e?.name||t}function Ve(t,e,o){const s=ge(e),l=Te(e,o.zoneColours);return{id:`block-${e}-${t.id}`,start:t.start,end:t.end,sourceZone:e,blockType:s,displayColour:l,label:o.showSourceZone?Ce(e):void 0,reason:o.showReason?t.title||t.name:void 0}}function we(t,e){const o=ke(e),s=new Set(o.map(l=>l.id));return t.filter(l=>{const i=fe(l);return i?s.has(i):!1})}function Ke(t,e,o){const s=_e(t);if(!s?.calendar?.showBlocksFrom?.length)return[];const l=[],i=s.calendar.blockDisplay||{};for(const n of s.calendar.showBlocksFrom){if(!re(o,n))continue;const a=we(e,n);for(const r of a){if(r.status&&r.status!=="published")continue;const y=Ve(r,n,{showSourceZone:i.showSourceZone,showReason:i.showReason,zoneColours:i.zoneColours});l.push(y)}}return l.sort((n,a)=>n.start-a.start)}function Re(t){if(t.length===0)return null;for(const e of t)if(e.blockType==="hard")return"hard";for(const e of t)if(e.blockType==="soft")return"soft";return"tentative"}function Se(t,e){return ve(t)?!0:re(t,e.sourceZone)}function De(t,e){const o=Se(e,t);return{id:t.id,start:t.start,end:t.end,blockType:t.blockType,displayColour:t.displayColour,label:o?t.label:void 0,reason:o?t.reason:void 0,sourceZone:o?t.sourceZone:void 0}}function Q(t,e,o){const s=t.slice();return s[11]=e[o],s}function W(t,e,o){const s=t.slice();return s[11]=e[o],s}function Ie(t){let e,o=O(t[5]),s=[];for(let l=0;l<o.length;l+=1)s[l]=$(Q(t,o,l));return{c(){e=p("div");for(let l=0;l<s.length;l+=1)s[l].c();this.h()},l(l){e=m(l,"DIV",{class:!0});var i=T(e);for(let n=0;n<s.length;n+=1)s[n].l(i);i.forEach(c),this.h()},h(){u(e,"class","block-list svelte-1bct2tv")},m(l,i){C(l,e,i);for(let n=0;n<s.length;n+=1)s[n]&&s[n].m(e,null)},p(l,i){if(i&96){o=O(l[5]);let n;for(n=0;n<o.length;n+=1){const a=Q(l,o,n);s[n]?s[n].p(a,i):(s[n]=$(a),s[n].c(),s[n].m(e,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=o.length}},d(l){l&&c(e),se(s,l)}}}function Be(t){let e,o,s,l,i=t[2]&&x(t);return{c(){e=p("div"),o=p("div"),s=B(),i&&i.c(),this.h()},l(n){e=m(n,"DIV",{class:!0});var a=T(e);o=m(a,"DIV",{class:!0,style:!0}),T(o).forEach(c),s=I(a),i&&i.l(a),a.forEach(c),this.h()},h(){u(o,"class","block-bar-fill svelte-1bct2tv"),z(o,"background-color",t[0][0]?.displayColour||"#6b7280"),u(e,"class",l="block-bar "+Z(t[4])+" svelte-1bct2tv")},m(n,a){C(n,e,a),d(e,o),d(e,s),i&&i.m(e,null)},p(n,a){a&1&&z(o,"background-color",n[0][0]?.displayColour||"#6b7280"),n[2]?i?i.p(n,a):(i=x(n),i.c(),i.m(e,null)):i&&(i.d(1),i=null),a&16&&l!==(l="block-bar "+Z(n[4])+" svelte-1bct2tv")&&u(e,"class",l)},d(n){n&&c(e),i&&i.d()}}}function Ee(t){let e,o,s=O(t[5].slice(0,t[3])),l=[];for(let n=0;n<s.length;n+=1)l[n]=ee(W(t,s,n));let i=t[0].length>t[3]&&te(t);return{c(){e=p("div");for(let n=0;n<l.length;n+=1)l[n].c();o=B(),i&&i.c(),this.h()},l(n){e=m(n,"DIV",{class:!0});var a=T(e);for(let r=0;r<l.length;r+=1)l[r].l(a);o=I(a),i&&i.l(a),a.forEach(c),this.h()},h(){u(e,"class","block-dots svelte-1bct2tv")},m(n,a){C(n,e,a);for(let r=0;r<l.length;r+=1)l[r]&&l[r].m(e,null);d(e,o),i&&i.m(e,null)},p(n,a){if(a&104){s=O(n[5].slice(0,n[3]));let r;for(r=0;r<s.length;r+=1){const y=W(n,s,r);l[r]?l[r].p(y,a):(l[r]=ee(y),l[r].c(),l[r].m(e,o))}for(;r<l.length;r+=1)l[r].d(1);l.length=s.length}n[0].length>n[3]?i?i.p(n,a):(i=te(n),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(n){n&&c(e),se(l,n),i&&i.d()}}}function Ae(t){return{c:E,l:E,m:E,p:E,d:E}}function X(t){let e,o=t[11].label+"",s;return{c(){e=p("div"),s=U(o),this.h()},l(l){e=m(l,"DIV",{class:!0});var i=T(e);s=A(i,o),i.forEach(c),this.h()},h(){u(e,"class","block-label svelte-1bct2tv")},m(l,i){C(l,e,i),d(e,s)},p(l,i){i&32&&o!==(o=l[11].label+"")&&N(s,o)},d(l){l&&c(e)}}}function Y(t){let e,o=t[11].reason+"",s;return{c(){e=p("div"),s=U(o),this.h()},l(l){e=m(l,"DIV",{class:!0});var i=T(e);s=A(i,o),i.forEach(c),this.h()},h(){u(e,"class","block-reason svelte-1bct2tv")},m(l,i){C(l,e,i),d(e,s)},p(l,i){i&32&&o!==(o=l[11].reason+"")&&N(s,o)},d(l){l&&c(e)}}}function P(t){let e,o=S(t[11].blockType)+"",s;return{c(){e=p("div"),s=U(o),this.h()},l(l){e=m(l,"DIV",{class:!0});var i=T(e);s=A(i,o),i.forEach(c),this.h()},h(){u(e,"class","block-status svelte-1bct2tv")},m(l,i){C(l,e,i),d(e,s)},p(l,i){i&32&&o!==(o=S(l[11].blockType)+"")&&N(s,o)},d(l){l&&c(e)}}}function Ue(t){let e,o="Reduced";return{c(){e=p("div"),e.textContent=o,this.h()},l(s){e=m(s,"DIV",{class:!0,"data-svelte-h":!0}),ae(e)!=="svelte-3mib6m"&&(e.textContent=o),this.h()},h(){u(e,"class","block-badge reduced svelte-1bct2tv")},m(s,l){C(s,e,l)},d(s){s&&c(e)}}}function Fe(t){let e,o="Unavailable";return{c(){e=p("div"),e.textContent=o,this.h()},l(s){e=m(s,"DIV",{class:!0,"data-svelte-h":!0}),ae(e)!=="svelte-sog7sm"&&(e.textContent=o),this.h()},h(){u(e,"class","block-badge unavailable svelte-1bct2tv")},m(s,l){C(s,e,l)},d(s){s&&c(e)}}}function $(t){let e,o,s,l,i,n=ie(t[11].start,t[11].end)+"",a,r,y,V,b,w,F,f,q,M,v=t[11].label&&X(t),_=t[11].reason&&Y(t),k=!t[11].label&&!t[11].reason&&P(t);function j(R,h){if(R[11].blockType==="hard")return Fe;if(R[11].blockType==="soft")return Ue}let L=j(t),g=L&&L(t);function ue(){return t[10](t[11])}return{c(){e=p("button"),o=p("div"),s=B(),l=p("div"),i=p("div"),a=U(n),r=B(),v&&v.c(),y=B(),_&&_.c(),V=B(),k&&k.c(),b=B(),g&&g.c(),w=B(),this.h()},l(R){e=m(R,"BUTTON",{class:!0,style:!0,"aria-label":!0});var h=T(e);o=m(h,"DIV",{class:!0}),T(o).forEach(c),s=I(h),l=m(h,"DIV",{class:!0});var D=T(l);i=m(D,"DIV",{class:!0});var H=T(i);a=A(H,n),H.forEach(c),r=I(D),v&&v.l(D),y=I(D),_&&_.l(D),V=I(D),k&&k.l(D),D.forEach(c),b=I(h),g&&g.l(h),w=I(h),h.forEach(c),this.h()},h(){u(o,"class","block-indicator svelte-1bct2tv"),u(i,"class","block-time svelte-1bct2tv"),u(l,"class","block-content svelte-1bct2tv"),u(e,"class",F="block-card "+Z(t[11].blockType)+" svelte-1bct2tv"),z(e,"--block-color",t[11].displayColour),u(e,"aria-label",f=t[11].label||S(t[11].blockType))},m(R,h){C(R,e,h),d(e,o),d(e,s),d(e,l),d(l,i),d(i,a),d(l,r),v&&v.m(l,null),d(l,y),_&&_.m(l,null),d(l,V),k&&k.m(l,null),d(e,b),g&&g.m(e,null),d(e,w),q||(M=oe(e,"click",ne(ue)),q=!0)},p(R,h){t=R,h&32&&n!==(n=ie(t[11].start,t[11].end)+"")&&N(a,n),t[11].label?v?v.p(t,h):(v=X(t),v.c(),v.m(l,y)):v&&(v.d(1),v=null),t[11].reason?_?_.p(t,h):(_=Y(t),_.c(),_.m(l,V)):_&&(_.d(1),_=null),!t[11].label&&!t[11].reason?k?k.p(t,h):(k=P(t),k.c(),k.m(l,null)):k&&(k.d(1),k=null),L!==(L=j(t))&&(g&&g.d(1),g=L&&L(t),g&&(g.c(),g.m(e,w))),h&32&&F!==(F="block-card "+Z(t[11].blockType)+" svelte-1bct2tv")&&u(e,"class",F),h&32&&z(e,"--block-color",t[11].displayColour),h&32&&f!==(f=t[11].label||S(t[11].blockType))&&u(e,"aria-label",f)},d(R){R&&c(e),v&&v.d(),_&&_.d(),k&&k.d(),g&&g.d(),q=!1,M()}}}function x(t){let e,o=S(t[4])+"",s;return{c(){e=p("span"),s=U(o),this.h()},l(l){e=m(l,"SPAN",{class:!0});var i=T(e);s=A(i,o),i.forEach(c),this.h()},h(){u(e,"class","block-bar-label svelte-1bct2tv")},m(l,i){C(l,e,i),d(e,s)},p(l,i){i&16&&o!==(o=S(l[4])+"")&&N(s,o)},d(l){l&&c(e)}}}function ee(t){let e,o,s,l,i;function n(){return t[9](t[11])}return{c(){e=p("button"),this.h()},l(a){e=m(a,"BUTTON",{class:!0,style:!0,title:!0,"aria-label":!0}),T(e).forEach(c),this.h()},h(){u(e,"class","block-dot svelte-1bct2tv"),z(e,"--block-color",t[11].displayColour),u(e,"title",o=t[11].label||S(t[11].blockType)),u(e,"aria-label",s=t[11].label||S(t[11].blockType))},m(a,r){C(a,e,r),l||(i=oe(e,"click",ne(n)),l=!0)},p(a,r){t=a,r&40&&z(e,"--block-color",t[11].displayColour),r&40&&o!==(o=t[11].label||S(t[11].blockType))&&u(e,"title",o),r&40&&s!==(s=t[11].label||S(t[11].blockType))&&u(e,"aria-label",s)},d(a){a&&c(e),l=!1,i()}}}function te(t){let e,o,s=t[0].length-t[3]+"",l;return{c(){e=p("span"),o=U("+"),l=U(s),this.h()},l(i){e=m(i,"SPAN",{class:!0});var n=T(e);o=A(n,"+"),l=A(n,s),n.forEach(c),this.h()},h(){u(e,"class","block-overflow svelte-1bct2tv")},m(i,n){C(i,e,n),d(e,o),d(e,l)},p(i,n){n&9&&s!==(s=i[0].length-i[3]+"")&&N(l,s)},d(i){i&&c(e)}}}function Le(t){let e;function o(i,n){if(i[0].length===0)return Ae;if(i[1]==="dot")return Ee;if(i[1]==="bar")return Be;if(i[1]==="full")return Ie}let s=o(t),l=s&&s(t);return{c(){l&&l.c(),e=K()},l(i){l&&l.l(i),e=K()},m(i,n){l&&l.m(i,n),C(i,e,n)},p(i,[n]){s===(s=o(i))&&l?l.p(i,n):(l&&l.d(1),l=s&&s(i),l&&(l.c(),l.m(e.parentNode,e)))},i:E,o:E,d(i){i&&c(e),l&&l.d(i)}}}function S(t){switch(t){case"hard":return"House unavailable";case"soft":return"Reduced capacity";case"tentative":return"Guests may be present";default:return"Available"}}function Z(t){switch(t){case"hard":return"status-unavailable";case"soft":return"status-reduced";case"tentative":return"status-tentative";default:return"status-available"}}function le(t){return new Date(t).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",hour12:!1})}function ie(t,e){return`${le(t)} - ${le(e)}`}function ze(t,e,o){let s,l,{blocks:i=[]}=e,{userPermissions:n=void 0}=e,{variant:a="dot"}=e,{showLabel:r=!1}=e,{maxBlocks:y=3}=e,{onClick:V=void 0}=e;function b(f){V&&V(f)}const w=f=>b(f),F=f=>b(f);return t.$$set=f=>{"blocks"in f&&o(0,i=f.blocks),"userPermissions"in f&&o(7,n=f.userPermissions),"variant"in f&&o(1,a=f.variant),"showLabel"in f&&o(2,r=f.showLabel),"maxBlocks"in f&&o(3,y=f.maxBlocks),"onClick"in f&&o(8,V=f.onClick)},t.$$.update=()=>{t.$$.dirty&129&&o(5,s=i.map(f=>n?De(f,n):f)),t.$$.dirty&1&&o(4,l=Re(i))},[i,a,r,y,l,s,b,n,V,w,F]}class Je extends de{constructor(e){super(),he(this,e,ze,Le,be,{blocks:0,userPermissions:7,variant:1,showLabel:2,maxBlocks:3,onClick:8})}}export{Je as A,pe as a,je as b,Me as c,He as d,Ke as g};
