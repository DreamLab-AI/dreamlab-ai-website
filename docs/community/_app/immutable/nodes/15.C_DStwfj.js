import{s as pe,n as q,d as h,i as E,b as u,l as _,m as me,g as T,c as m,e as k,o as z,j as C,h as v,k as J,p as ve,E as _e,a as x,q as fe,f as L,t as j}from"../chunks/CwRy9Tox.js";import{e as ae,u as be,d as ge}from"../chunks/BFk-VQ8S.js";import{S as ye,i as ke}from"../chunks/D-vqeeah.js";import{g as ne}from"../chunks/CQ8JIY5d.js";import{b as le}from"../chunks/Box6chXe.js";import{g as De,a as re,u as Te}from"../chunks/CHLmt3N8.js";import{d as U,s as Ce}from"../chunks/C3X3li_Y.js";const Ee=!0,Me=async()=>({conversations:[]}),Oe=Object.freeze(Object.defineProperty({__proto__:null,load:Me,prerender:Ee},Symbol.toStringTag,{value:"Module"}));function ie(i,e,t){const s=i.slice();return s[11]=e[t],s}function oe(i){let e,t,s,a,o,l="Dismiss",r,n;return{c(){e=v("div"),t=v("span"),s=j(i[0]),a=C(),o=v("button"),o.textContent=l,this.h()},l(b){e=m(b,"DIV",{class:!0});var p=k(e);t=m(p,"SPAN",{});var f=k(t);s=L(f,i[0]),f.forEach(h),a=T(p),o=m(p,"BUTTON",{class:!0,"data-svelte-h":!0}),z(o)!=="svelte-1t1ajzw"&&(o.textContent=l),p.forEach(h),this.h()},h(){_(o,"class","btn btn-sm"),_(e,"class","alert alert-error mb-4")},m(b,p){E(b,e,p),u(e,t),u(t,s),u(e,a),u(e,o),r||(n=fe(o,"click",i[7]),r=!0)},p(b,p){p&1&&x(s,b[0])},d(b){b&&h(e),r=!1,n()}}}function we(i){let e,t=[],s=new Map,a=ae(i[2]);const o=l=>l[11].pubkey;for(let l=0;l<a.length;l+=1){let r=ie(i,a,l),n=o(r);s.set(n,t[l]=de(n,r))}return{c(){e=v("div");for(let l=0;l<t.length;l+=1)t[l].c();this.h()},l(l){e=m(l,"DIV",{class:!0});var r=k(e);for(let n=0;n<t.length;n+=1)t[n].l(r);r.forEach(h),this.h()},h(){_(e,"class","space-y-2")},m(l,r){E(l,e,r);for(let n=0;n<t.length;n+=1)t[n]&&t[n].m(e,null)},p(l,r){r&20&&(a=ae(l[2]),t=be(t,r,o,1,l,a,s,e,ge,de,null,ie))},d(l){l&&h(e);for(let r=0;r<t.length;r+=1)t[r].d()}}}function Ie(i){let e,t='<div class="card-body items-center text-center"><p class="text-base-content/70">No conversations yet. Start chatting!</p> <p class="text-sm text-base-content/50 mt-2">To start a conversation, you need someone else&#39;s public key</p></div>';return{c(){e=v("div"),e.innerHTML=t,this.h()},l(s){e=m(s,"DIV",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-1n7d76a"&&(e.innerHTML=t),this.h()},h(){_(e,"class","card bg-base-200")},m(s,a){E(s,e,a)},p:q,d(s){s&&h(e)}}}function Se(i){let e,t='<div class="loading loading-spinner loading-lg text-primary"></div>';return{c(){e=v("div"),e.innerHTML=t,this.h()},l(s){e=m(s,"DIV",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-hu9n30"&&(e.innerHTML=t),this.h()},h(){_(e,"class","flex justify-center items-center min-h-[400px]")},m(s,a){E(s,e,a)},p:q,d(s){s&&h(e)}}}function ce(i){let e,t=i[11].unreadCount+"",s;return{c(){e=v("div"),s=j(t),this.h()},l(a){e=m(a,"DIV",{class:!0});var o=k(e);s=L(o,t),o.forEach(h),this.h()},h(){_(e,"class","badge badge-primary badge-sm")},m(a,o){E(a,e,o),u(e,s)},p(a,o){o&4&&t!==(t=a[11].unreadCount+"")&&x(s,t)},d(a){a&&h(e)}}}function de(i,e){let t,s,a,o,l,r,n=e[11].name.charAt(0).toUpperCase()+"",b,p,f,c,g,d=e[11].name+"",w,F,I,A=ue(e[11].lastMessageTimestamp)+"",P,K,S,H=e[11].lastMessage+"",N,R,Y,G,Q,y=e[11].unreadCount>0&&ce(e);function he(){return e[8](e[11])}return{key:i,first:null,c(){t=v("button"),s=v("div"),a=v("div"),o=v("div"),l=v("div"),r=v("span"),b=j(n),p=C(),f=v("div"),c=v("div"),g=v("h3"),w=j(d),F=C(),I=v("span"),P=j(A),K=C(),S=v("p"),N=j(H),R=C(),y&&y.c(),Y=C(),this.h()},l(M){t=m(M,"BUTTON",{class:!0});var D=k(t);s=m(D,"DIV",{class:!0});var W=k(s);a=m(W,"DIV",{class:!0});var V=k(a);o=m(V,"DIV",{class:!0});var X=k(o);l=m(X,"DIV",{class:!0});var Z=k(l);r=m(Z,"SPAN",{class:!0});var $=k(r);b=L($,n),$.forEach(h),Z.forEach(h),X.forEach(h),p=T(V),f=m(V,"DIV",{class:!0});var B=k(f);c=m(B,"DIV",{class:!0});var O=k(c);g=m(O,"H3",{class:!0});var ee=k(g);w=L(ee,d),ee.forEach(h),F=T(O),I=m(O,"SPAN",{class:!0});var te=k(I);P=L(te,A),te.forEach(h),O.forEach(h),K=T(B),S=m(B,"P",{class:!0});var se=k(S);N=L(se,H),se.forEach(h),B.forEach(h),R=T(V),y&&y.l(V),V.forEach(h),W.forEach(h),Y=T(D),D.forEach(h),this.h()},h(){_(r,"class","text-xl"),_(l,"class","bg-primary text-primary-content rounded-full w-12"),_(o,"class","avatar placeholder"),_(g,"class","font-semibold"),_(I,"class","text-xs text-base-content/60"),_(c,"class","flex justify-between items-start mb-1"),_(S,"class","text-sm text-base-content/70 truncate"),_(f,"class","flex-1 min-w-0"),_(a,"class","flex items-center gap-3"),_(s,"class","card-body p-4"),_(t,"class","card bg-base-200 hover:bg-base-300 transition-base cursor-pointer w-full text-left"),this.first=t},m(M,D){E(M,t,D),u(t,s),u(s,a),u(a,o),u(o,l),u(l,r),u(r,b),u(a,p),u(a,f),u(f,c),u(c,g),u(g,w),u(c,F),u(c,I),u(I,P),u(f,K),u(f,S),u(S,N),u(a,R),y&&y.m(a,null),u(t,Y),G||(Q=fe(t,"click",he),G=!0)},p(M,D){e=M,D&4&&n!==(n=e[11].name.charAt(0).toUpperCase()+"")&&x(b,n),D&4&&d!==(d=e[11].name+"")&&x(w,d),D&4&&A!==(A=ue(e[11].lastMessageTimestamp)+"")&&x(P,A),D&4&&H!==(H=e[11].lastMessage+"")&&x(N,H),e[11].unreadCount>0?y?y.p(e,D):(y=ce(e),y.c(),y.m(a,null)):y&&(y.d(1),y=null)},d(M){M&&h(t),y&&y.d(),G=!1,Q()}}}function Ve(i){let e,t,s,a,o='<h1 class="text-4xl font-bold gradient-text mb-2">Direct Messages</h1> <p class="text-base-content/70">Private encrypted conversations</p>',l,r;document.title=e="Direct Messages - "+i[3].name;let n=i[0]&&oe(i);function b(c,g){return c[1]?Se:c[2].length===0?Ie:we}let p=b(i),f=p(i);return{c(){t=C(),s=v("div"),a=v("div"),a.innerHTML=o,l=C(),n&&n.c(),r=C(),f.c(),this.h()},l(c){me("svelte-91guuv",document.head).forEach(h),t=T(c),s=m(c,"DIV",{class:!0});var d=k(s);a=m(d,"DIV",{class:!0,"data-svelte-h":!0}),z(a)!=="svelte-14jg3ur"&&(a.innerHTML=o),l=T(d),n&&n.l(d),r=T(d),f.l(d),d.forEach(h),this.h()},h(){_(a,"class","mb-6"),_(s,"class","container mx-auto p-4 max-w-2xl")},m(c,g){E(c,t,g),E(c,s,g),u(s,a),u(s,l),n&&n.m(s,null),u(s,r),f.m(s,null)},p(c,[g]){g&8&&e!==(e="Direct Messages - "+c[3].name)&&(document.title=e),c[0]?n?n.p(c,g):(n=oe(c),n.c(),n.m(s,r)):n&&(n.d(1),n=null),p===(p=b(c))&&f?f.p(c,g):(f.d(1),f=p(c),f&&(f.c(),f.m(s,null)))},i:q,o:q,d(c){c&&(h(t),h(s)),n&&n.d(),f.d()}}}function ue(i){const e=new Date(i*1e3),a=(new Date().getTime()-e.getTime())/(1e3*60*60);return a<24?e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):a<48?"Yesterday":e.toLocaleDateString()}function xe(i,e,t){let s,a,o,l,r,n;J(i,re,d=>t(10,l=d)),J(i,U,d=>t(5,r=d)),J(i,Ce,d=>t(6,n=d));const b=De();let p=null;ve(async()=>{if(await re.waitForReady(),!l.isAuthenticated||!l.privateKey){ne(`${le}/`);return}try{const d=Te.hexToBytes(l.privateKey),w={publish:async()=>{}};await U.fetchConversations(w,d),p=await U.subscribeToIncoming(d)}catch(d){console.error("Failed to load conversations:",d)}}),_e(()=>{p&&p()});function f(d){ne(`${le}/dm/${d}`)}const c=()=>U.clearError(),g=d=>f(d.pubkey);return i.$$.update=()=>{i.$$.dirty&64&&t(2,s=n),i.$$.dirty&32&&t(1,a=r.isLoading),i.$$.dirty&32&&t(0,o=r.error)},[o,a,s,b,f,r,n,c,g]}class Ue extends ye{constructor(e){super(),ke(this,e,xe,Ve,pe,{})}}export{Ue as component,Oe as universal};
