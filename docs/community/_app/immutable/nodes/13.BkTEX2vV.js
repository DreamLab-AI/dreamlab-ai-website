import{s as ke,n as Q,d as f,a as K,i as A,b as u,q as ne,l as d,c as _,e as w,f as j,g as V,h as p,t as U,j as N,p as Le,o as x,x as Te,w as $e,C as Dt,u as Pe,v as Ve,z as At,G as Be,R as ve,H as Re,I as Oe,J as je,k as ze,E as Lt,y as Ne,ad as Bt,ae as Rt,r as Ot,P as Xe,m as jt,B as Ut}from"../chunks/CwRy9Tox.js";import{S as ye,i as we,t as z,a as O,h as ge,g as he,c as me,d as le,m as re,b as ae,e as oe}from"../chunks/D-vqeeah.js";import{e as be,u as zt,o as qt}from"../chunks/BFk-VQ8S.js";import{g as qe}from"../chunks/BVYH3h24.js";import{b as Me}from"../chunks/DjSB8mDa.js";import{p as Ht}from"../chunks/BMPJZPAg.js";import{g as Yt,a as Ze,e as Kt}from"../chunks/Do1Y_WLx.js";import"../chunks/D6bkDPCY.js";import{w as Jt}from"../chunks/CfA8cFIx.js";import{isConnected as Tt,ndk as Qt,connectRelay as Wt}from"../chunks/BTawUe4R.js";import{R as Gt}from"../chunks/C_zicc2g.js";import{f as $t}from"../chunks/GPTLThIR.js";import{W as Xt,B as Zt,T as xt,a as en,M as tn}from"../chunks/BjkYpxfk.js";import{g as nn}from"../chunks/9tEgXtNp.js";import{l as sn}from"../chunks/CPZcgTj3.js";import{p as He}from"../chunks/Da8Ipvaz.js";/* empty css                *//* empty css                */import"../chunks/DDymQvxb.js";import{f as Ye,a as ln,s as Pt}from"../chunks/BvU0z6gS.js";import{s as rn}from"../chunks/C1Qt_vN7.js";import{d as Vt}from"../chunks/BxB7wYhR.js";function xe(r){return r===0?"":r>99?"99+":r.toString()}function an(r){const e=r.slice(),t=He.getCachedSync(e[2].authorPubkey);e[9]=t;const n=e[9]?.displayName||e[2].authorPubkey.substring(0,8)+"...";e[10]=n;const s=e[9]?.avatar||nn(e[2].authorPubkey,32);return e[11]=s,e}function et(r){let e,t="Open";return{c(){e=p("span"),e.textContent=t,this.h()},l(n){e=_(n,"SPAN",{class:!0,title:!0,"data-svelte-h":!0}),x(e)!=="svelte-st15ms"&&(e.textContent=t),this.h()},h(){d(e,"class","badge badge-success badge-xs"),d(e,"title","Open - anyone can post")},m(n,s){A(n,e,s)},d(n){n&&f(e)}}}function tt(r){let e,t=xe(r[4])+"",n;return{c(){e=p("span"),n=U(t),this.h()},l(s){e=_(s,"SPAN",{class:!0});var l=w(e);n=j(l,t),l.forEach(f),this.h()},h(){d(e,"class","badge badge-primary badge-sm rounded-full")},m(s,l){A(s,e,l),u(e,n)},p(s,l){l&16&&t!==(t=xe(s[4])+"")&&K(n,t)},d(s){s&&f(e)}}}function nt(r){let e,t=r[0].description+"",n;return{c(){e=p("p"),n=U(t),this.h()},l(s){e=_(s,"P",{class:!0});var l=w(e);n=j(l,t),l.forEach(f),this.h()},h(){d(e,"class","text-sm text-base-content/70 line-clamp-1 mt-0.5")},m(s,l){A(s,e,l),u(e,n)},p(s,l){l&1&&t!==(t=s[0].description+"")&&K(n,t)},d(s){s&&f(e)}}}function on(r){let e,t,n,s,l,o=r[0].encrypted&&st();return{c(){e=p("div"),t=U(r[1]),n=U(" posts"),s=N(),o&&o.c(),l=Te(),this.h()},l(a){e=_(a,"DIV",{class:!0});var i=w(e);t=j(i,r[1]),n=j(i," posts"),i.forEach(f),s=V(a),o&&o.l(a),l=Te(),this.h()},h(){d(e,"class","badge badge-primary badge-sm")},m(a,i){A(a,e,i),u(e,t),u(e,n),A(a,s,i),o&&o.m(a,i),A(a,l,i)},p(a,i){i&2&&K(t,a[1]),a[0].encrypted?o||(o=st(),o.c(),o.m(l.parentNode,l)):o&&(o.d(1),o=null)},d(a){a&&(f(e),f(s),f(l)),o&&o.d(a)}}}function cn(r){let e;return{c(){e=p("span"),this.h()},l(t){e=_(t,"SPAN",{class:!0}),w(e).forEach(f),this.h()},h(){d(e,"class","loading loading-spinner loading-xs")},m(t,n){A(t,e,n)},p:Q,d(t){t&&f(e)}}}function st(r){let e,t="ðŸ”’ Encrypted";return{c(){e=p("div"),e.textContent=t,this.h()},l(n){e=_(n,"DIV",{class:!0,"data-svelte-h":!0}),x(e)!=="svelte-85okh"&&(e.textContent=t),this.h()},h(){d(e,"class","badge badge-secondary badge-sm")},m(n,s){A(n,e,s)},d(n){n&&f(e)}}}function fn(r){let e,t="No messages yet - be the first to post!";return{c(){e=p("div"),e.textContent=t,this.h()},l(n){e=_(n,"DIV",{class:!0,"data-svelte-h":!0}),x(e)!=="svelte-1wrkyee"&&(e.textContent=t),this.h()},h(){d(e,"class","mt-2 pt-2 border-t border-base-300 text-xs text-base-content/40 italic")},m(n,s){A(n,e,s)},p:Q,d(n){n&&f(e)}}}function lt(r){let e,t,n,s,l,o,a,i=r[10]+"",c,m,I,g,C=r[2].content+"",k,y,v,S=rt(r[2].timestamp)+"",b;return{c(){e=p("div"),t=p("div"),n=p("img"),o=N(),a=p("span"),c=U(i),m=U(":"),I=N(),g=p("span"),k=U(C),y=N(),v=p("span"),b=U(S),this.h()},l(h){e=_(h,"DIV",{class:!0});var E=w(e);t=_(E,"DIV",{class:!0});var D=w(t);n=_(D,"IMG",{src:!0,alt:!0,class:!0}),o=V(D),a=_(D,"SPAN",{class:!0});var M=w(a);c=j(M,i),m=j(M,":"),M.forEach(f),I=V(D),g=_(D,"SPAN",{class:!0});var F=w(g);k=j(F,C),F.forEach(f),y=V(D),v=_(D,"SPAN",{class:!0});var T=w(v);b=j(T,S),T.forEach(f),D.forEach(f),E.forEach(f),this.h()},h(){$e(n.src,s=r[11])||d(n,"src",s),d(n,"alt",l=r[10]),d(n,"class","w-4 h-4 rounded-full"),d(a,"class","font-medium"),d(g,"class","truncate flex-1"),d(v,"class","flex-shrink-0"),d(t,"class","flex items-center gap-2"),d(e,"class","mt-2 pt-2 border-t border-base-300 text-xs text-base-content/60")},m(h,E){A(h,e,E),u(e,t),u(t,n),u(t,o),u(t,a),u(a,c),u(a,m),u(t,I),u(t,g),u(g,k),u(t,y),u(t,v),u(v,b)},p(h,E){E&4&&!$e(n.src,s=h[11])&&d(n,"src",s),E&4&&l!==(l=h[10])&&d(n,"alt",l),E&4&&i!==(i=h[10]+"")&&K(c,i),E&4&&C!==(C=h[2].content+"")&&K(k,C),E&4&&S!==(S=rt(h[2].timestamp)+"")&&K(b,S)},d(h){h&&f(e)}}}function un(r){let e,t,n,s,l,o=r[5](r[0].name)+"",a,i,c,m,I,g,C,k=r[0].name+"",y,v,S,b,h,E,D,M,F,T=r[0].accessType==="open"&&et(),B=!r[3]&&r[4]>0&&tt(r),R=r[0].description&&nt(r);function ie(L,H){return L[3]?cn:on}let W=ie(r),J=W(r);function _e(L,H){if(L[2])return lt;if(!L[3])return fn}function ee(L,H){return H===lt?an(L):L}let $=_e(r),q=$&&$(ee(r,$));return{c(){e=p("button"),t=p("div"),n=p("div"),s=p("div"),l=p("div"),a=U(o),i=N(),c=p("div"),m=p("div"),I=p("div"),g=p("div"),C=p("h3"),y=U(k),v=N(),T&&T.c(),S=N(),B&&B.c(),b=N(),R&&R.c(),h=N(),E=p("div"),J.c(),D=N(),q&&q.c(),this.h()},l(L){e=_(L,"BUTTON",{class:!0});var H=w(e);t=_(H,"DIV",{class:!0});var se=w(t);n=_(se,"DIV",{class:!0});var ce=w(n);s=_(ce,"DIV",{class:!0});var Ee=w(s);l=_(Ee,"DIV",{class:!0});var Y=w(l);a=j(Y,o),Y.forEach(f),Ee.forEach(f),i=V(ce),c=_(ce,"DIV",{class:!0});var ue=w(c);m=_(ue,"DIV",{class:!0});var X=w(m);I=_(X,"DIV",{class:!0});var de=w(I);g=_(de,"DIV",{class:!0});var P=w(g);C=_(P,"H3",{class:!0});var G=w(C);y=j(G,k),G.forEach(f),v=V(P),T&&T.l(P),S=V(P),B&&B.l(P),P.forEach(f),b=V(de),R&&R.l(de),de.forEach(f),h=V(X),E=_(X,"DIV",{class:!0});var te=w(E);J.l(te),te.forEach(f),X.forEach(f),D=V(ue),q&&q.l(ue),ue.forEach(f),ce.forEach(f),se.forEach(f),H.forEach(f),this.h()},h(){d(l,"class","w-12 h-12 rounded-lg bg-primary/20 flex items-center justify-center text-2xl"),d(s,"class","flex-shrink-0"),d(C,"class","font-bold text-base truncate"),d(g,"class","flex items-center gap-2 flex-wrap"),d(I,"class","flex-1"),d(E,"class","flex flex-col items-end gap-1 flex-shrink-0"),d(m,"class","flex items-start justify-between gap-2"),d(c,"class","flex-1 min-w-0"),d(n,"class","flex gap-4"),d(t,"class","card-body p-4"),d(e,"class","card bg-base-200 hover:bg-base-300 transition-all cursor-pointer text-left w-full border border-transparent hover:border-primary/30")},m(L,H){A(L,e,H),u(e,t),u(t,n),u(n,s),u(s,l),u(l,a),u(n,i),u(n,c),u(c,m),u(m,I),u(I,g),u(g,C),u(C,y),u(g,v),T&&T.m(g,null),u(g,S),B&&B.m(g,null),u(I,b),R&&R.m(I,null),u(m,h),u(m,E),J.m(E,null),u(c,D),q&&q.m(c,null),M||(F=ne(e,"click",r[6]),M=!0)},p(L,[H]){H&1&&o!==(o=L[5](L[0].name)+"")&&K(a,o),H&1&&k!==(k=L[0].name+"")&&K(y,k),L[0].accessType==="open"?T||(T=et(),T.c(),T.m(g,S)):T&&(T.d(1),T=null),!L[3]&&L[4]>0?B?B.p(L,H):(B=tt(L),B.c(),B.m(g,null)):B&&(B.d(1),B=null),L[0].description?R?R.p(L,H):(R=nt(L),R.c(),R.m(I,null)):R&&(R.d(1),R=null),W===(W=ie(L))&&J?J.p(L,H):(J.d(1),J=W(L),J&&(J.c(),J.m(E,null))),$===($=_e(L))&&q?q.p(ee(L,$),H):(q&&q.d(1),q=$&&$(ee(L,$)),q&&(q.c(),q.m(c,null)))},i:Q,o:Q,d(L){L&&f(e),T&&T.d(),B&&B.d(),R&&R.d(),J.d(),q&&q.d(),M=!1,F()}}}function rt(r){const t=Math.floor(Date.now()/1e3)-r;return t<60?"just now":t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:t<604800?`${Math.floor(t/86400)}d ago`:new Date(r*1e3).toLocaleDateString()}function dn(r,e,t){let{channel:n}=e,s=0,l=null,o=!0,a=[],i=0;const c={general:"ðŸ’¬",music:"ðŸŽµ",tuneage:"ðŸŽµ",events:"ðŸ“…",calendar:"ðŸ“…",help:"â“",support:"ðŸ†˜",announcements:"ðŸ“¢",news:"ðŸ“°",random:"ðŸŽ²",offtopic:"ðŸ’­",tech:"ðŸ’»",gaming:"ðŸŽ®",art:"ðŸŽ¨",photos:"ðŸ“·",video:"ðŸŽ¬",food:"ðŸ•",sports:"âš½",fitness:"ðŸ’ª",books:"ðŸ“š",movies:"ðŸŽ¬",pets:"ðŸ•",travel:"âœˆï¸",memes:"ðŸ˜‚",default:"ðŸ’­"};function m(g){const C=g.toLowerCase();for(const[k,y]of Object.entries(c))if(C.includes(k))return y;return c.default}Le(async()=>{try{if(!Tt()){console.warn("NDK not connected"),t(3,o=!1);return}const g=Qt();if(!g){console.warn("NDK instance not available"),t(3,o=!1);return}const C=await g.fetchEvents({kinds:[42],"#e":[n.id],limit:100});t(1,s=C.size),a=Array.from(C).map(y=>({id:y.id,channelId:n.id,authorPubkey:y.pubkey,content:y.content,createdAt:y.created_at||0,isEncrypted:!1})),t(4,i=sn.getUnreadCount(n.id,a));let k=null;for(const y of C)(!k||(y.created_at||0)>k.created_at)&&(k={content:y.content,pubkey:y.pubkey,created_at:y.created_at||0});if(k){He.getProfile(k.pubkey);const y=He.getCachedSync(k.pubkey);t(2,l={content:k.content.substring(0,60)+(k.content.length>60?"...":""),author:y?.displayName||k.pubkey.substring(0,8)+"...",authorPubkey:k.pubkey,timestamp:k.created_at})}}catch(g){console.error("Failed to fetch channel stats:",g)}finally{t(3,o=!1)}});function I(){qe(`${Me}/chat/${n.id}`)}return r.$$set=g=>{"channel"in g&&t(0,n=g.channel)},[n,s,l,o,i,m,I]}class hn extends ye{constructor(e){super(),we(this,e,dn,un,ke,{channel:0})}}const mn=!0,_n=async()=>({channels:[]}),Ps=Object.freeze(Object.defineProperty({__proto__:null,load:_n,prerender:mn},Symbol.toStringTag,{value:"Module"}));function pn(r){let e,t,n;return{c(){e=Ve("svg"),t=Ve("path"),n=U(`
    Mark All as Read`),this.h()},l(s){e=Pe(s,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var l=w(e);t=Pe(l,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),w(t).forEach(f),l.forEach(f),n=j(s,`
    Mark All as Read`),this.h()},h(){d(t,"stroke-linecap","round"),d(t,"stroke-linejoin","round"),d(t,"stroke-width","2"),d(t,"d","M5 13l4 4L19 7"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"class","h-4 w-4"),d(e,"fill","none"),d(e,"viewBox","0 0 24 24"),d(e,"stroke","currentColor")},m(s,l){A(s,e,l),u(e,t),A(s,n,l)},d(s){s&&(f(e),f(n))}}}function vn(r){let e,t,n;return{c(){e=Ve("svg"),t=Ve("path"),n=U(`
    Marked!`),this.h()},l(s){e=Pe(s,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var l=w(e);t=Pe(l,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),w(t).forEach(f),l.forEach(f),n=j(s,`
    Marked!`),this.h()},h(){d(t,"stroke-linecap","round"),d(t,"stroke-linejoin","round"),d(t,"stroke-width","2"),d(t,"d","M5 13l4 4L19 7"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"class","h-4 w-4"),d(e,"fill","none"),d(e,"viewBox","0 0 24 24"),d(e,"stroke","currentColor")},m(s,l){A(s,e,l),u(e,t),A(s,n,l)},d(s){s&&(f(e),f(n))}}}function gn(r){let e;return{c(){e=p("span"),this.h()},l(t){e=_(t,"SPAN",{class:!0}),w(e).forEach(f),this.h()},h(){d(e,"class","loading loading-spinner loading-xs")},m(t,n){A(t,e,n)},d(t){t&&f(e)}}}function bn(r){let e,t,n,s;function l(i,c){return i[0]?gn:i[1]?vn:pn}let o=l(r),a=o(r);return{c(){e=p("button"),a.c(),this.h()},l(i){e=_(i,"BUTTON",{class:!0});var c=w(e);a.l(c),c.forEach(f),this.h()},h(){d(e,"class",t="btn btn-sm "+(r[1]?"btn-success":"btn-ghost")+" gap-2"),e.disabled=r[0]},m(i,c){A(i,e,c),a.m(e,null),n||(s=ne(e,"click",r[2]),n=!0)},p(i,[c]){o!==(o=l(i))&&(a.d(1),a=o(i),a&&(a.c(),a.m(e,null))),c&2&&t!==(t="btn btn-sm "+(i[1]?"btn-success":"btn-ghost")+" gap-2")&&d(e,"class",t),c&1&&(e.disabled=i[0])},i:Q,o:Q,d(i){i&&f(e),a.d(),n=!1,s()}}}const at="nostr_bbs_read_posts";function kn(r,e,t){const n=Dt();let s=!1,l=!1;function o(){t(0,s=!0);const c=Math.floor(Date.now()/1e3);localStorage.setItem(at,c.toString()),setTimeout(()=>{t(0,s=!1),t(1,l=!0),n("marked"),setTimeout(()=>{t(1,l=!1)},2e3)},500)}function a(){const c=localStorage.getItem(at);return c?parseInt(c):0}function i(c){return c<=a()}return[s,l,o,a,i]}class yn extends ye{constructor(e){super(),we(this,e,kn,bn,ke,{getLastReadTime:3,isPostRead:4})}get getLastReadTime(){return this.$$.ctx[3]}get isPostRead(){return this.$$.ctx[4]}}function ot(r,e,t){const n=r.slice();return n[4]=e[t],n[6]=t,n}function it(r){let e,t,n;return{c(){e=p("div"),this.h()},l(s){e=_(s,"DIV",{class:!0,style:!0}),w(e).forEach(f),this.h()},h(){d(e,"class",t="skeleton bg-base-300 animate-pulse "+r[3][r[0]]+" svelte-94zcau"),d(e,"style",n=r[0]==="text"&&r[6]%3===2?"width: 60%":"")},m(s,l){A(s,e,l)},p(s,l){l&1&&t!==(t="skeleton bg-base-300 animate-pulse "+s[3][s[0]]+" svelte-94zcau")&&d(e,"class",t),l&1&&n!==(n=s[0]==="text"&&s[6]%3===2?"width: 60%":"")&&d(e,"style",n)},d(s){s&&f(e)}}}function wn(r){let e,t,n=be(Array(r[1])),s=[];for(let l=0;l<n.length;l+=1)s[l]=it(ot(r,n,l));return{c(){e=p("div");for(let l=0;l<s.length;l+=1)s[l].c();this.h()},l(l){e=_(l,"DIV",{class:!0,style:!0});var o=w(e);for(let a=0;a<s.length;a+=1)s[a].l(o);o.forEach(f),this.h()},h(){d(e,"class","space-y-2"),d(e,"style",t=r[2]?`width: ${r[2]}`:"")},m(l,o){A(l,e,o);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null)},p(l,[o]){if(o&11){n=be(Array(l[1]));let a;for(a=0;a<n.length;a+=1){const i=ot(l,n,a);s[a]?s[a].p(i,o):(s[a]=it(i),s[a].c(),s[a].m(e,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=n.length}o&4&&t!==(t=l[2]?`width: ${l[2]}`:"")&&d(e,"style",t)},i:Q,o:Q,d(l){l&&f(e),At(s,l)}}}function En(r,e,t){let{variant:n="text"}=e,{count:s=1}=e,{width:l=""}=e;const o={text:"h-4 w-full rounded",avatar:"w-10 h-10 rounded-full",card:"h-24 w-full rounded-lg",message:"h-16 w-full rounded-lg",channel:"h-20 w-full rounded-lg"};return r.$$set=a=>{"variant"in a&&t(0,n=a.variant),"count"in a&&t(1,s=a.count),"width"in a&&t(2,l=a.width)},[n,s,l,o]}class Cn extends ye{constructor(e){super(),we(this,e,En,wn,ke,{variant:0,count:1,width:2})}}const Sn=r=>({}),ct=r=>({}),In=r=>({}),ft=r=>({}),Dn=r=>({}),ut=r=>({});function An(r){let e;const t=r[11].illustration,n=Be(t,r,r[10],ut);return{c(){n&&n.c()},l(s){n&&n.l(s)},m(s,l){n&&n.m(s,l),e=!0},p(s,l){n&&n.p&&(!e||l&1024)&&Re(n,t,s,s[10],e?je(t,s[10],l,Dn):Oe(s[10]),ut)},i(s){e||(O(n,s),e=!0)},o(s){z(n,s),e=!1},d(s){n&&n.d(s)}}}function Tn(r){let e,t,n;return{c(){e=p("div"),t=U(r[0]),this.h()},l(s){e=_(s,"DIV",{class:!0,style:!0,"aria-hidden":!0});var l=w(e);t=j(l,r[0]),l.forEach(f),this.h()},h(){d(e,"class","text-6xl mb-6 opacity-60"),Ne(e,"transform","translateY("+r[6]+"px)"),d(e,"aria-hidden","true")},m(s,l){A(s,e,l),u(e,t)},p(s,l){l&1&&K(t,s[0]),l&64&&Ne(e,"transform","translateY("+s[6]+"px)")},i(s){s&&(n||ve(()=>{n=ge(e,Pt,{duration:400,delay:100,start:.8}),n.start()}))},o:Q,d(s){s&&f(e)}}}function Pn(r){let e,t,n=r[9][r[5]]+"",s;return{c(){e=p("div"),t=new Rt(!1),this.h()},l(l){e=_(l,"DIV",{class:!0,style:!0});var o=w(e);t=Bt(o,!1),o.forEach(f),this.h()},h(){t.a=null,d(e,"class","mb-6 opacity-80"),Ne(e,"transform","translateY("+r[6]+"px)")},m(l,o){A(l,e,o),t.m(n,e)},p(l,o){o&32&&n!==(n=l[9][l[5]]+"")&&t.p(n),o&64&&Ne(e,"transform","translateY("+l[6]+"px)")},i(l){l&&(s||ve(()=>{s=ge(e,Pt,{duration:400,delay:100,start:.8}),s.start()}))},o:Q,d(l){l&&f(e)}}}function dt(r){let e,t,n;return{c(){e=p("p"),t=U(r[2]),this.h()},l(s){e=_(s,"P",{class:!0});var l=w(e);t=j(l,r[2]),l.forEach(f),this.h()},h(){d(e,"class","text-base-content/60 mb-8 max-w-md leading-relaxed")},m(s,l){A(s,e,l),u(e,t)},p(s,l){l&4&&K(t,s[2])},i(s){s&&(n||ve(()=>{n=ge(e,Ye,{y:10,duration:300,delay:200}),n.start()}))},o:Q,d(s){s&&f(e)}}}function ht(r){let e,t,n,s,l=r[3]&&mt(r),o=r[4]&&_t(r);return{c(){e=p("div"),l&&l.c(),t=N(),o&&o.c(),this.h()},l(a){e=_(a,"DIV",{class:!0});var i=w(e);l&&l.l(i),t=V(i),o&&o.l(i),i.forEach(f),this.h()},h(){d(e,"class","flex flex-wrap gap-3 justify-center")},m(a,i){A(a,e,i),l&&l.m(e,null),u(e,t),o&&o.m(e,null),s=!0},p(a,i){a[3]?l?(l.p(a,i),i&8&&O(l,1)):(l=mt(a),l.c(),O(l,1),l.m(e,t)):l&&(he(),z(l,1,1,()=>{l=null}),me()),a[4]?o?(o.p(a,i),i&16&&O(o,1)):(o=_t(a),o.c(),O(o,1),o.m(e,null)):o&&(he(),z(o,1,1,()=>{o=null}),me())},i(a){s||(O(l),O(o),a&&(n||ve(()=>{n=ge(e,Ye,{y:10,duration:300,delay:250}),n.start()})),s=!0)},o(a){z(l),z(o),s=!1},d(a){a&&f(e),l&&l.d(),o&&o.d()}}}function mt(r){let e,t,n,s,l,o;const a=r[11]["action-icon"],i=Be(a,r,r[10],ft);return{c(){e=p("button"),i&&i.c(),t=N(),n=U(r[3]),this.h()},l(c){e=_(c,"BUTTON",{class:!0});var m=w(e);i&&i.l(m),t=V(m),n=j(m,r[3]),m.forEach(f),this.h()},h(){d(e,"class","btn btn-primary gap-2 focus-ring")},m(c,m){A(c,e,m),i&&i.m(e,null),u(e,t),u(e,n),s=!0,l||(o=ne(e,"click",r[12]),l=!0)},p(c,m){i&&i.p&&(!s||m&1024)&&Re(i,a,c,c[10],s?je(a,c[10],m,In):Oe(c[10]),ft),(!s||m&8)&&K(n,c[3])},i(c){s||(O(i,c),s=!0)},o(c){z(i,c),s=!1},d(c){c&&f(e),i&&i.d(c),l=!1,o()}}}function _t(r){let e,t,n,s,l,o;const a=r[11]["secondary-icon"],i=Be(a,r,r[10],ct);return{c(){e=p("button"),i&&i.c(),t=N(),n=U(r[4]),this.h()},l(c){e=_(c,"BUTTON",{class:!0});var m=w(e);i&&i.l(m),t=V(m),n=j(m,r[4]),m.forEach(f),this.h()},h(){d(e,"class","btn btn-ghost gap-2 focus-ring")},m(c,m){A(c,e,m),i&&i.m(e,null),u(e,t),u(e,n),s=!0,l||(o=ne(e,"click",r[13]),l=!0)},p(c,m){i&&i.p&&(!s||m&1024)&&Re(i,a,c,c[10],s?je(a,c[10],m,Sn):Oe(c[10]),ct),(!s||m&16)&&K(n,c[4])},i(c){s||(O(i,c),s=!0)},o(c){z(i,c),s=!1},d(c){c&&f(e),i&&i.d(c),l=!1,o()}}}function Vn(r){let e,t,n,s,l,o,a,i,c,m,I,g;const C=[Pn,Tn,An],k=[];function y(E,D){return E[5]!=="none"&&E[5]!=="custom"?0:E[0]?1:2}t=y(r),n=k[t]=C[t](r);let v=r[2]&&dt(r),S=(r[3]||r[4])&&ht(r);const b=r[11].default,h=Be(b,r,r[10],null);return{c(){e=p("div"),n.c(),s=N(),l=p("h3"),o=U(r[1]),i=N(),v&&v.c(),c=N(),S&&S.c(),m=N(),h&&h.c(),this.h()},l(E){e=_(E,"DIV",{class:!0,role:!0,"aria-live":!0});var D=w(e);n.l(D),s=V(D),l=_(D,"H3",{class:!0});var M=w(l);o=j(M,r[1]),M.forEach(f),i=V(D),v&&v.l(D),c=V(D),S&&S.l(D),m=V(D),h&&h.l(D),D.forEach(f),this.h()},h(){d(l,"class","text-xl font-semibold text-base-content mb-3"),d(e,"class","flex flex-col items-center justify-center py-16 px-6 text-center"),d(e,"role","status"),d(e,"aria-live","polite")},m(E,D){A(E,e,D),k[t].m(e,null),u(e,s),u(e,l),u(l,o),u(e,i),v&&v.m(e,null),u(e,c),S&&S.m(e,null),u(e,m),h&&h.m(e,null),g=!0},p(E,[D]){let M=t;t=y(E),t===M?k[t].p(E,D):(he(),z(k[M],1,1,()=>{k[M]=null}),me(),n=k[t],n?n.p(E,D):(n=k[t]=C[t](E),n.c()),O(n,1),n.m(e,s)),(!g||D&2)&&K(o,E[1]),E[2]?v?(v.p(E,D),D&4&&O(v,1)):(v=dt(E),v.c(),O(v,1),v.m(e,c)):v&&(v.d(1),v=null),E[3]||E[4]?S?(S.p(E,D),D&24&&O(S,1)):(S=ht(E),S.c(),O(S,1),S.m(e,m)):S&&(he(),z(S,1,1,()=>{S=null}),me()),h&&h.p&&(!g||D&1024)&&Re(h,b,E,E[10],g?je(b,E[10],D,null):Oe(E[10]),null)},i(E){g||(O(n),E&&(a||ve(()=>{a=ge(l,Ye,{y:10,duration:300,delay:150}),a.start()})),O(v),O(S),O(h,E),E&&(I||ve(()=>{I=ge(e,ln,{duration:300}),I.start()})),g=!0)},o(E){z(n),z(S),z(h,E),g=!1},d(E){E&&f(e),k[t].d(),v&&v.d(),S&&S.d(),h&&h.d(E)}}}function Nn(r,e,t){let n,{$$slots:s={},$$scope:l}=e,{icon:o=""}=e,{title:a="Nothing here yet"}=e,{description:i=""}=e,{actionLabel:c=""}=e,{secondaryActionLabel:m=""}=e,{illustration:I="none"}=e;const g=Dt(),C=rn(0,{stiffness:.02,damping:.3});ze(r,C,b=>t(6,n=b));let k=null;Le(()=>{k=setInterval(()=>{C.set(Math.sin(Date.now()/1e3)*4)},50)}),Lt(()=>{k&&clearInterval(k)});const y={"empty-inbox":`<svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-32 h-32 text-base-content/20">
      <rect x="40" y="60" width="120" height="100" rx="8" stroke="currentColor" stroke-width="2" fill="none"/>
      <path d="M40 80 L100 120 L160 80" stroke="currentColor" stroke-width="2" fill="none"/>
      <circle cx="100" cy="50" r="20" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
    </svg>`,"no-results":`<svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-32 h-32 text-base-content/20">
      <circle cx="85" cy="85" r="45" stroke="currentColor" stroke-width="2" fill="none"/>
      <line x1="120" y1="120" x2="160" y2="160" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
      <line x1="70" y1="85" x2="100" y2="85" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>`,error:`<svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-32 h-32 text-error/40">
      <circle cx="100" cy="100" r="60" stroke="currentColor" stroke-width="2" fill="none"/>
      <line x1="75" y1="75" x2="125" y2="125" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
      <line x1="125" y1="75" x2="75" y2="125" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
    </svg>`,offline:`<svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-32 h-32 text-warning/40">
      <path d="M50 120 Q100 80 150 120" stroke="currentColor" stroke-width="2" fill="none"/>
      <path d="M65 135 Q100 105 135 135" stroke="currentColor" stroke-width="2" fill="none"/>
      <path d="M80 150 Q100 130 120 150" stroke="currentColor" stroke-width="2" fill="none"/>
      <line x1="60" y1="60" x2="140" y2="140" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
    </svg>`,custom:"",none:""},v=()=>g("action"),S=()=>g("secondaryAction");return r.$$set=b=>{"icon"in b&&t(0,o=b.icon),"title"in b&&t(1,a=b.title),"description"in b&&t(2,i=b.description),"actionLabel"in b&&t(3,c=b.actionLabel),"secondaryActionLabel"in b&&t(4,m=b.secondaryActionLabel),"illustration"in b&&t(5,I=b.illustration),"$$scope"in b&&t(10,l=b.$$scope)},[o,a,i,c,m,I,n,g,C,y,l,s,v,S]}class Mn extends ye{constructor(e){super(),we(this,e,Nn,Vn,ke,{icon:0,title:1,description:2,actionLabel:3,secondaryActionLabel:4,illustration:5})}}const Fn="embedding_sync_preference";function Ln(){if(typeof navigator>"u")return!1;const r=navigator.userAgent;return/Safari/.test(r)&&!/Chrome|CriOS|Edg/.test(r)}function Bn(){return typeof navigator>"u"?!1:/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}function Rn(){return typeof localStorage>"u"?null:localStorage.getItem(Fn)}function Nt(){if(typeof navigator>"u")return!1;const r=Rn();if(r==="always")return!0;if(r==="manual")return!1;const e=navigator.connection;if(!e)return Bn()?!1:(Ln(),!0);const t=e.type;return t==="wifi"||t==="ethernet"||e.effectiveType==="4g"&&!e.saveData||e.metered===!1}const Ke="https://embedding-api-617806532906.us-central1.run.app",Mt="nostr-bbs/semantic";let Z=new Map,Ce=!1,Fe=0;function On(r,e){if(r.length!==e.length)return 0;let t=0,n=0,s=0;for(let o=0;o<r.length;o++)t+=r[o]*e[o],n+=r[o]*r[o],s+=e[o]*e[o];const l=Math.sqrt(n)*Math.sqrt(s);return l===0?0:t/l}async function jn(r){try{const e=await fetch(`${Ke}/embed`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:r})});if(!e.ok)throw new Error(`Embedding API error: ${e.status}`);const t=await e.json();if(!t.embeddings||t.embeddings.length===0)throw new Error("No embedding returned from API");return t.embeddings[0]}catch(e){return console.error("Embedding API call failed:",e),Un(r)}}function Un(r){const t=new Array(384).fill(0);for(let s=0;s<r.length;s++){const l=r.charCodeAt(s),o=l*(s+1)%384;t[o]+=l/255}const n=Math.sqrt(t.reduce((s,l)=>s+l*l,0))||1;return t.map(s=>s/n)}async function Ft(){try{const r=await fetch(`${Ke}/api/embeddings/list`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:Mt,limit:1e4})});if(!r.ok)return console.warn("RuVector API not available, trying local cache"),Ue();const e=await r.json();if(!e.embeddings||e.embeddings.length===0)return console.log("No embeddings in RuVector, trying local cache"),Ue();Z.clear();for(const t of e.embeddings){const n=t.metadata?.noteId||t.key;Z.set(n,{noteId:n,embedding:t.embedding,content:t.metadata?.content,timestamp:Date.now()})}return await zn(),Ce=!0,Fe=Date.now(),console.log(`Loaded ${Z.size} embeddings from RuVector`),!0}catch(r){return console.error("Failed to load from RuVector:",r),Ue()}}async function Ue(){try{const r=await Vt.table("embeddings").get("ruvector_cache");if(!r?.data)return!1;const e=JSON.parse(r.data);Z.clear();for(const t of e)Z.set(t.noteId,t);return Ce=Z.size>0,Fe=r.timestamp||Date.now(),console.log(`Loaded ${Z.size} embeddings from IndexedDB cache`),Ce}catch(r){return console.error("Failed to load from IndexedDB:",r),!1}}async function zn(){try{const r=Array.from(Z.values());await Vt.table("embeddings").put({key:"ruvector_cache",data:JSON.stringify(r),timestamp:Date.now(),count:r.length})}catch(r){console.error("Failed to save to IndexedDB:",r)}}async function qn(r,e=10,t=.5){const n=await jn(r);try{const s=await Hn(n,e,t);if(s.length>0)return s}catch{console.log("Server search unavailable, using local cache")}return Yn(n,e,t)}async function Hn(r,e,t){const n=await fetch(`${Ke}/api/embeddings/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({embedding:r,namespace:Mt,k:e,minScore:t})});if(!n.ok)throw new Error(`Search API error: ${n.status}`);return(await n.json()).results.map(l=>({noteId:l.metadata?.noteId||l.key,score:l.score,distance:1-l.score}))}function Yn(r,e,t){if(!Ce||Z.size===0)throw new Error("Local cache not loaded");const n=[];for(const[s,l]of Z){const o=On(r,l.embedding);o>=t&&n.push({noteId:s,score:o,distance:1-o})}return n.sort((s,l)=>l.score-s.score),n.slice(0,e)}function pt(){return Ce?{vectorCount:Z.size,dimensions:384,lastUpdated:Fe?new Date(Fe).toISOString():null,searchMode:navigator.onLine?"hybrid":"cached"}:null}async function Kn(r=!1){return!navigator.onLine&&!r?{synced:!1,count:Z.size}:{synced:await Ft(),count:Z.size}}const Jn=Ft;function vt(r,e,t){const n=r.slice();return n[16]=e[t],n}function gt(r){let e,t="...";return{c(){e=p("span"),e.textContent=t,this.h()},l(n){e=_(n,"SPAN",{class:!0,"data-svelte-h":!0}),x(e)!=="svelte-1nvyc9z"&&(e.textContent=t),this.h()},h(){d(e,"class","loading-indicator svelte-8oktfb")},m(n,s){A(n,e,s)},d(n){n&&f(e)}}}function bt(r){let e,t;return{c(){e=p("div"),t=U(r[4]),this.h()},l(n){e=_(n,"DIV",{class:!0});var s=w(e);t=j(s,r[4]),s.forEach(f),this.h()},h(){d(e,"class","error-message svelte-8oktfb")},m(n,s){A(n,e,s),u(e,t)},p(n,s){s&16&&K(t,n[4])},d(n){n&&f(e)}}}function Qn(r){let e,t,n=r[5].vectorCount.toLocaleString()+"",s,l,o,a,i=wt(r[7])+"",c,m,I=yt(r[5].lastUpdated)+"",g;return{c(){e=p("div"),t=p("span"),s=U(n),l=U(" messages indexed"),o=N(),a=p("span"),c=U(i),m=U(" â€¢ "),g=U(I),this.h()},l(C){e=_(C,"DIV",{class:!0});var k=w(e);t=_(k,"SPAN",{});var y=w(t);s=j(y,n),l=j(y," messages indexed"),y.forEach(f),o=V(k),a=_(k,"SPAN",{});var v=w(a);c=j(v,i),m=j(v," â€¢ "),g=j(v,I),v.forEach(f),k.forEach(f),this.h()},h(){d(e,"class","stats svelte-8oktfb")},m(C,k){A(C,e,k),u(e,t),u(t,s),u(t,l),u(e,o),u(e,a),u(a,c),u(a,m),u(a,g)},p(C,k){k&32&&n!==(n=C[5].vectorCount.toLocaleString()+"")&&K(s,n),k&128&&i!==(i=wt(C[7])+"")&&K(c,i),k&32&&I!==(I=yt(C[5].lastUpdated)+"")&&K(g,I)},d(C){C&&f(e)}}}function Wn(r){let e,t,n="Semantic search requires downloading the search index.",s;function l(i,c){return Nt()?$n:Gn}let a=l()(r);return{c(){e=p("div"),t=p("p"),t.textContent=n,s=N(),a.c(),this.h()},l(i){e=_(i,"DIV",{class:!0});var c=w(e);t=_(c,"P",{class:!0,"data-svelte-h":!0}),x(t)!=="svelte-y7h9br"&&(t.textContent=n),s=V(c),a.l(c),c.forEach(f),this.h()},h(){d(t,"class","svelte-8oktfb"),d(e,"class","info-message svelte-8oktfb")},m(i,c){A(i,e,c),u(e,t),u(e,s),a.m(e,null)},p(i,c){a.p(i,c)},d(i){i&&f(e),a.d()}}}function Gn(r){let e,t="Connect to WiFi to download.";return{c(){e=p("p"),e.textContent=t,this.h()},l(n){e=_(n,"P",{class:!0,"data-svelte-h":!0}),x(e)!=="svelte-1vvgh80"&&(e.textContent=t),this.h()},h(){d(e,"class","wifi-notice svelte-8oktfb")},m(n,s){A(n,e,s)},p:Q,d(n){n&&f(e)}}}function $n(r){let e,t,n,s;return{c(){e=p("button"),t=U("Download Index"),this.h()},l(l){e=_(l,"BUTTON",{class:!0});var o=w(e);t=j(o,"Download Index"),o.forEach(f),this.h()},h(){e.disabled=r[3],d(e,"class","svelte-8oktfb")},m(l,o){A(l,e,o),u(e,t),n||(s=ne(e,"click",r[9]),n=!0)},p(l,o){o&8&&(e.disabled=l[3])},d(l){l&&f(e),n=!1,s()}}}function Xn(r){let e,t="No matching messages found";return{c(){e=p("div"),e.textContent=t,this.h()},l(n){e=_(n,"DIV",{class:!0,"data-svelte-h":!0}),x(e)!=="svelte-ig5svh"&&(e.textContent=t),this.h()},h(){d(e,"class","no-results svelte-8oktfb")},m(n,s){A(n,e,s)},p:Q,d(n){n&&f(e)}}}function Zn(r){let e,t=be(r[2]),n=[];for(let s=0;s<t.length;s+=1)n[s]=kt(vt(r,t,s));return{c(){e=p("div");for(let s=0;s<n.length;s+=1)n[s].c();this.h()},l(s){e=_(s,"DIV",{class:!0});var l=w(e);for(let o=0;o<n.length;o+=1)n[o].l(l);l.forEach(f),this.h()},h(){d(e,"class","results svelte-8oktfb")},m(s,l){A(s,e,l);for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(e,null)},p(s,l){if(l&1028){t=be(s[2]);let o;for(o=0;o<t.length;o+=1){const a=vt(s,t,o);n[o]?n[o].p(a,l):(n[o]=kt(a),n[o].c(),n[o].m(e,null))}for(;o<n.length;o+=1)n[o].d(1);n.length=t.length}},d(s){s&&f(e),At(n,s)}}}function kt(r){let e,t,n=r[16].noteId.slice(0,8)+"",s,l,o,a,i=(r[16].score*100).toFixed(0)+"",c,m,I,g,C;function k(){return r[13](r[16])}return{c(){e=p("button"),t=p("span"),s=U(n),l=U("..."),o=N(),a=p("span"),c=U(i),m=U("% match"),I=N(),this.h()},l(y){e=_(y,"BUTTON",{class:!0});var v=w(e);t=_(v,"SPAN",{class:!0});var S=w(t);s=j(S,n),l=j(S,"..."),S.forEach(f),o=V(v),a=_(v,"SPAN",{class:!0});var b=w(a);c=j(b,i),m=j(b,"% match"),b.forEach(f),I=V(v),v.forEach(f),this.h()},h(){d(t,"class","note-id svelte-8oktfb"),d(a,"class","score svelte-8oktfb"),d(e,"class","result-item svelte-8oktfb")},m(y,v){A(y,e,v),u(e,t),u(t,s),u(t,l),u(e,o),u(e,a),u(a,c),u(a,m),u(e,I),g||(C=ne(e,"click",k),g=!0)},p(y,v){r=y,v&4&&n!==(n=r[16].noteId.slice(0,8)+"")&&K(s,n),v&4&&i!==(i=(r[16].score*100).toFixed(0)+"")&&K(c,i)},d(y){y&&f(e),g=!1,C()}}}function xn(r){let e,t,n,s,l,o,a,i,c,m,I,g,C,k,y=r[3]&&gt(),v=r[4]&&bt(r);function S(F,T){if(!F[6])return Wn;if(F[5])return Qn}let b=S(r),h=b&&b(r);function E(F,T){if(F[2].length>0)return Zn;if(F[1]&&!F[3]&&F[6])return Xn}let D=E(r),M=D&&D(r);return{c(){e=p("div"),t=p("div"),n=p("div"),s=p("input"),o=N(),y&&y.c(),a=N(),i=p("button"),c=U("â†»"),m=N(),v&&v.c(),I=N(),h&&h.c(),g=N(),M&&M.c(),this.h()},l(F){e=_(F,"DIV",{class:!0});var T=w(e);t=_(T,"DIV",{class:!0});var B=w(t);n=_(B,"DIV",{class:!0});var R=w(n);s=_(R,"INPUT",{type:!0,placeholder:!0,class:!0}),o=V(R),y&&y.l(R),R.forEach(f),a=V(B),i=_(B,"BUTTON",{class:!0,title:!0});var ie=w(i);c=j(ie,"â†»"),ie.forEach(f),B.forEach(f),m=V(T),v&&v.l(T),I=V(T),h&&h.l(T),g=V(T),M&&M.l(T),T.forEach(f),this.h()},h(){d(s,"type","text"),d(s,"placeholder",r[0]),d(s,"class","search-input svelte-8oktfb"),s.disabled=l=!r[6],d(n,"class","search-input-wrapper svelte-8oktfb"),d(i,"class","sync-btn svelte-8oktfb"),i.disabled=r[3],d(i,"title","Sync embeddings"),d(t,"class","search-header svelte-8oktfb"),d(e,"class","semantic-search svelte-8oktfb")},m(F,T){A(F,e,T),u(e,t),u(t,n),u(n,s),Xe(s,r[1]),u(n,o),y&&y.m(n,null),u(t,a),u(t,i),u(i,c),u(e,m),v&&v.m(e,null),u(e,I),h&&h.m(e,null),u(e,g),M&&M.m(e,null),C||(k=[ne(s,"input",r[12]),ne(s,"input",r[8]),ne(i,"click",r[9])],C=!0)},p(F,[T]){T&1&&d(s,"placeholder",F[0]),T&64&&l!==(l=!F[6])&&(s.disabled=l),T&2&&s.value!==F[1]&&Xe(s,F[1]),F[3]?y||(y=gt(),y.c(),y.m(n,null)):y&&(y.d(1),y=null),T&8&&(i.disabled=F[3]),F[4]?v?v.p(F,T):(v=bt(F),v.c(),v.m(e,I)):v&&(v.d(1),v=null),b===(b=S(F))&&h?h.p(F,T):(h&&h.d(1),h=b&&b(F),h&&(h.c(),h.m(e,g))),D===(D=E(F))&&M?M.p(F,T):(M&&M.d(1),M=D&&D(F),M&&(M.c(),M.m(e,null)))},i:Q,o:Q,d(F){F&&f(e),y&&y.d(),v&&v.d(),h&&h.d(),M&&M.d(),C=!1,Ot(k)}}}function yt(r){return r?new Date(r).toLocaleDateString():"Never"}function wt(r){switch(r){case"server":return"RuVector (server)";case"cached":return"Offline cache";case"hybrid":return"RuVector + cache";default:return r}}function es(r,e,t){let{onSelect:n=()=>{}}=e,{placeholder:s="Search by meaning..."}=e,l="",o=[],a=!1,i=null,c=null,m=!1,I="hybrid",g;Le(async()=>{try{t(6,m=await Jn()),m&&(t(5,c=pt()),t(7,I=c?.searchMode||"hybrid"))}catch(h){console.warn("Failed to load search index:",h)}});async function C(){if(!l.trim()){t(2,o=[]);return}if(!m){t(4,i="Search index not loaded. Sync embeddings first.");return}t(3,a=!0),t(4,i=null);try{t(2,o=await qn(l,10,.3))}catch(h){t(4,i=h instanceof Error?h.message:"Search failed"),t(2,o=[])}finally{t(3,a=!1)}}function k(){clearTimeout(g),g=setTimeout(C,300)}async function y(){if(!Nt()&&!navigator.onLine){t(4,i="Please connect to sync embeddings");return}t(3,a=!0),t(4,i=null);try{(await Kn(!0)).synced&&(t(6,m=!0),t(5,c=pt()),t(7,I=c?.searchMode||"hybrid"))}catch(h){t(4,i=h instanceof Error?h.message:"Sync failed")}finally{t(3,a=!1)}}function v(h){n(h)}function S(){l=this.value,t(1,l)}const b=h=>v(h.noteId);return r.$$set=h=>{"onSelect"in h&&t(11,n=h.onSelect),"placeholder"in h&&t(0,s=h.placeholder)},[s,l,o,a,i,c,m,I,k,y,v,n,S,b]}class ts extends ye{constructor(e){super(),we(this,e,es,xn,ke,{onSelect:11,placeholder:0})}}function Et(r,e,t){const n=r.slice();return n[15]=e[t],n}function Ct(r){let e,t,n,s,l="Semantic Search",o,a,i='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',c,m,I="Search by meaning, not just keywords. Find messages that are semantically similar to your query.",g,C,k,y,v;return C=new ts({props:{onSelect:r[8],placeholder:"Search messages by meaning..."}}),{c(){e=p("div"),t=p("div"),n=p("div"),s=p("h3"),s.textContent=l,o=N(),a=p("button"),a.innerHTML=i,c=N(),m=p("p"),m.textContent=I,g=N(),oe(C.$$.fragment),this.h()},l(S){e=_(S,"DIV",{class:!0});var b=w(e);t=_(b,"DIV",{class:!0});var h=w(t);n=_(h,"DIV",{class:!0});var E=w(n);s=_(E,"H3",{class:!0,"data-svelte-h":!0}),x(s)!=="svelte-kr88ev"&&(s.textContent=l),o=V(E),a=_(E,"BUTTON",{class:!0,"data-svelte-h":!0}),x(a)!=="svelte-v6flfe"&&(a.innerHTML=i),E.forEach(f),c=V(h),m=_(h,"P",{class:!0,"data-svelte-h":!0}),x(m)!=="svelte-1qiiq15"&&(m.textContent=I),g=V(h),ae(C.$$.fragment,h),h.forEach(f),b.forEach(f),this.h()},h(){d(s,"class","text-lg font-semibold"),d(a,"class","btn btn-ghost btn-sm btn-circle"),d(n,"class","flex items-center justify-between mb-2"),d(m,"class","text-sm text-base-content/70 mb-3"),d(t,"class","card-body p-4"),d(e,"class","card bg-base-200 shadow-lg mb-6")},m(S,b){A(S,e,b),u(e,t),u(t,n),u(n,s),u(n,o),u(n,a),u(t,c),u(t,m),u(t,g),re(C,t,null),k=!0,y||(v=ne(a,"click",r[13]),y=!0)},p:Q,i(S){k||(O(C.$$.fragment,S),k=!0)},o(S){z(C.$$.fragment,S),k=!1},d(S){S&&f(e),le(C),y=!1,v()}}}function ns(r){let e,t=[],n=new Map,s,l=be(r[4]);const o=a=>a[15].id;for(let a=0;a<l.length;a+=1){let i=Et(r,l,a),c=o(i);n.set(c,t[a]=St(c,i))}return{c(){e=p("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=_(a,"DIV",{class:!0});var i=w(e);for(let c=0;c<t.length;c+=1)t[c].l(i);i.forEach(f),this.h()},h(){d(e,"class","space-y-3")},m(a,i){A(a,e,i);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);s=!0},p(a,i){i&16&&(l=be(a[4]),he(),t=zt(t,i,o,1,a,l,n,e,qt,St,null,Et),me())},i(a){if(!s){for(let i=0;i<l.length;i+=1)O(t[i]);s=!0}},o(a){for(let i=0;i<t.length;i+=1)z(t[i]);s=!1},d(a){a&&f(e);for(let i=0;i<t.length;i+=1)t[i].d()}}}function ss(r){let e,t,n,s;t=new Mn({props:{icon:"ðŸ’¬",title:r[0]?`No channels in ${r[6]}`:"No channels yet",description:r[0]?"This board doesn't have any channels yet. Check back later or browse all channels.":"Create or join a channel to start chatting with the community"}});let l=r[0]&&It();return{c(){e=p("div"),oe(t.$$.fragment),n=N(),l&&l.c(),this.h()},l(o){e=_(o,"DIV",{class:!0});var a=w(e);ae(t.$$.fragment,a),n=V(a),l&&l.l(a),a.forEach(f),this.h()},h(){d(e,"class","text-center")},m(o,a){A(o,e,a),re(t,e,null),u(e,n),l&&l.m(e,null),s=!0},p(o,a){const i={};a&65&&(i.title=o[0]?`No channels in ${o[6]}`:"No channels yet"),a&1&&(i.description=o[0]?"This board doesn't have any channels yet. Check back later or browse all channels.":"Create or join a channel to start chatting with the community"),t.$set(i),o[0]?l||(l=It(),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i(o){s||(O(t.$$.fragment,o),s=!0)},o(o){z(t.$$.fragment,o),s=!1},d(o){o&&f(e),le(t),l&&l.d()}}}function ls(r){let e,t,n;return{c(){e=p("div"),t=p("span"),n=U(r[2]),this.h()},l(s){e=_(s,"DIV",{class:!0});var l=w(e);t=_(l,"SPAN",{});var o=w(t);n=j(o,r[2]),o.forEach(f),l.forEach(f),this.h()},h(){d(e,"class","alert alert-error")},m(s,l){A(s,e,l),u(e,t),u(t,n)},p(s,l){l&4&&K(n,s[2])},i:Q,o:Q,d(s){s&&f(e)}}}function rs(r){let e,t,n;return t=new Cn({props:{variant:"channel",count:5}}),{c(){e=p("div"),oe(t.$$.fragment),this.h()},l(s){e=_(s,"DIV",{class:!0});var l=w(e);ae(t.$$.fragment,l),l.forEach(f),this.h()},h(){d(e,"class","space-y-3")},m(s,l){A(s,e,l),re(t,e,null),n=!0},p:Q,i(s){n||(O(t.$$.fragment,s),n=!0)},o(s){z(t.$$.fragment,s),n=!1},d(s){s&&f(e),le(t)}}}function St(r,e){let t,n,s;return n=new hn({props:{channel:e[15]}}),{key:r,first:null,c(){t=Te(),oe(n.$$.fragment),this.h()},l(l){t=Te(),ae(n.$$.fragment,l),this.h()},h(){this.first=t},m(l,o){A(l,t,o),re(n,l,o),s=!0},p(l,o){e=l;const a={};o&16&&(a.channel=e[15]),n.$set(a)},i(l){s||(O(n.$$.fragment,l),s=!0)},o(l){z(n.$$.fragment,l),s=!1},d(l){l&&f(t),le(n,l)}}}function It(r){let e,t="View All Channels";return{c(){e=p("a"),e.textContent=t,this.h()},l(n){e=_(n,"A",{href:!0,class:!0,"data-svelte-h":!0}),x(e)!=="svelte-10n5lvv"&&(e.textContent=t),this.h()},h(){d(e,"href",Me+"/chat"),d(e,"class","btn btn-primary btn-sm")},m(n,s){A(n,e,s)},d(n){n&&f(e)}}}function as(r){let e,t,n,s,l,o,a,i,c,m,I,g,C,k,y,v,S,b,h,E='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <span class="hidden sm:inline">Search</span>',D,M,F,T,B,R,ie,W,J,_e,ee,$,q,L,H,se,ce,Ee;document.title=e=r[6]+" - "+r[7].name,l=new Xt({}),M=new yn({});let Y=r[3]&&Ct(r);const ue=[rs,ls,ss,ns],X=[];function de(P,G){return P[1]?0:P[2]?1:P[4].length===0?2:3}return B=de(r),R=X[B]=ue[B](r),J=new Zt({}),ee=new xt({}),q=new en({}),H=new tn({}),{c(){t=N(),n=p("div"),s=p("div"),oe(l.$$.fragment),o=N(),a=p("div"),i=p("div"),c=p("div"),m=p("div"),I=p("div"),g=p("h1"),C=U(r[6]),k=N(),y=p("p"),v=U(r[5]),S=N(),b=p("div"),h=p("button"),h.innerHTML=E,D=N(),oe(M.$$.fragment),F=N(),Y&&Y.c(),T=N(),R.c(),ie=N(),W=p("div"),oe(J.$$.fragment),_e=N(),oe(ee.$$.fragment),$=N(),oe(q.$$.fragment),L=N(),oe(H.$$.fragment),this.h()},l(P){jt("svelte-4a1mv3",document.head).forEach(f),t=V(P),n=_(P,"DIV",{class:!0});var te=w(n);s=_(te,"DIV",{class:!0});var Je=w(s);ae(l.$$.fragment,Je),Je.forEach(f),o=V(te),a=_(te,"DIV",{class:!0});var Se=w(a);i=_(Se,"DIV",{class:!0});var pe=w(i);c=_(pe,"DIV",{class:!0});var Qe=w(c);m=_(Qe,"DIV",{class:!0});var Ie=w(m);I=_(Ie,"DIV",{});var De=w(I);g=_(De,"H1",{class:!0});var We=w(g);C=j(We,r[6]),We.forEach(f),k=V(De),y=_(De,"P",{class:!0});var Ge=w(y);v=j(Ge,r[5]),Ge.forEach(f),De.forEach(f),S=V(Ie),b=_(Ie,"DIV",{class:!0});var Ae=w(b);h=_(Ae,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),x(h)!=="svelte-1oclgr5"&&(h.innerHTML=E),D=V(Ae),ae(M.$$.fragment,Ae),Ae.forEach(f),Ie.forEach(f),Qe.forEach(f),F=V(pe),Y&&Y.l(pe),T=V(pe),R.l(pe),pe.forEach(f),ie=V(Se),W=_(Se,"DIV",{class:!0});var fe=w(W);ae(J.$$.fragment,fe),_e=V(fe),ae(ee.$$.fragment,fe),$=V(fe),ae(q.$$.fragment,fe),L=V(fe),ae(H.$$.fragment,fe),fe.forEach(f),Se.forEach(f),te.forEach(f),this.h()},h(){d(s,"class","mb-4"),d(g,"class","text-4xl font-bold gradient-text mb-2"),d(y,"class","text-base-content/70"),d(h,"class","btn btn-ghost btn-sm"),d(h,"title","Semantic Search"),d(b,"class","flex items-center gap-2"),d(m,"class","flex items-start justify-between gap-4"),d(c,"class","mb-6"),d(i,"class","flex-1"),d(W,"class","lg:w-80 space-y-4"),d(a,"class","flex flex-col lg:flex-row gap-6"),d(n,"class","container mx-auto p-4 max-w-6xl")},m(P,G){A(P,t,G),A(P,n,G),u(n,s),re(l,s,null),u(n,o),u(n,a),u(a,i),u(i,c),u(c,m),u(m,I),u(I,g),u(g,C),u(I,k),u(I,y),u(y,v),u(m,S),u(m,b),u(b,h),u(b,D),re(M,b,null),u(i,F),Y&&Y.m(i,null),u(i,T),X[B].m(i,null),u(a,ie),u(a,W),re(J,W,null),u(W,_e),re(ee,W,null),u(W,$),re(q,W,null),u(W,L),re(H,W,null),se=!0,ce||(Ee=ne(h,"click",r[12]),ce=!0)},p(P,[G]){(!se||G&192)&&e!==(e=P[6]+" - "+P[7].name)&&(document.title=e),(!se||G&64)&&K(C,P[6]),(!se||G&32)&&K(v,P[5]),P[3]?Y?(Y.p(P,G),G&8&&O(Y,1)):(Y=Ct(P),Y.c(),O(Y,1),Y.m(i,T)):Y&&(he(),z(Y,1,1,()=>{Y=null}),me());let te=B;B=de(P),B===te?X[B].p(P,G):(he(),z(X[te],1,1,()=>{X[te]=null}),me(),R=X[B],R?R.p(P,G):(R=X[B]=ue[B](P),R.c()),O(R,1),R.m(i,null))},i(P){se||(O(l.$$.fragment,P),O(M.$$.fragment,P),O(Y),O(R),O(J.$$.fragment,P),O(ee.$$.fragment,P),O(q.$$.fragment,P),O(H.$$.fragment,P),se=!0)},o(P){z(l.$$.fragment,P),z(M.$$.fragment,P),z(Y),z(R),z(J.$$.fragment,P),z(ee.$$.fragment,P),z(q.$$.fragment,P),z(H.$$.fragment,P),se=!1},d(P){P&&(f(t),f(n)),le(l),le(M),Y&&Y.d(),X[B].d(),le(J),le(ee),le(q),le(H),ce=!1,Ee()}}}function os(r,e,t){let n,s,l,o,a,i,c;ze(r,Ze,b=>t(14,i=b)),ze(r,Ht,b=>t(11,c=b));const m=Yt();let I=[],g=!0,C=null,k=!1;async function y(b){t(3,k=!1);for(const h of l)if(h.id){qe(`${Me}/chat/${h.id}?highlight=${b}`);return}console.warn("Message not found in loaded channels:",b)}Le(async()=>{if(await Ze.waitForReady(),!i.isAuthenticated||!i.publicKey){qe(`${Me}/`);return}try{i.privateKey&&!Tt()&&await Wt(Gt,i.privateKey);const b=Ut(Jt),h=b?.cohorts??[],E=b?.isAdmin??!1;t(9,I=await $t({userCohorts:h,userPubkey:i.publicKey??void 0,isAdmin:E}))}catch(b){console.error("Failed to load channels:",b),t(2,C=b instanceof Error?b.message:"Failed to load channels")}finally{t(1,g=!1)}});const v=()=>t(3,k=!k),S=()=>t(3,k=!1);return r.$$.update=()=>{r.$$.dirty&2048&&t(0,n=c.url.searchParams.get("section")),r.$$.dirty&1&&t(10,s=n?Kt(n):null),r.$$.dirty&513&&t(4,l=n?I.filter(b=>b.section===n):I),r.$$.dirty&1024&&t(6,o=s?s.name:"Channels"),r.$$.dirty&1024&&t(5,a=s?s.description:"Join conversations in public channels")},[n,g,C,k,l,a,o,m,y,I,s,c,v,S]}class Vs extends ye{constructor(e){super(),we(this,e,os,as,ke,{})}}export{Vs as component,Ps as universal};
