import{B as Ye,s as Rt,n as ne,d as h,i as S,x as Be,k as Mt,C as An,a as me,A as It,b as d,q as oe,l as o,c as b,e as v,g as D,u as j,f as Q,h as y,j as L,v as K,t as $,V as _n,r as St,o as re,D as gn,z as en,y as bn,w as Ge,T as Tr,p as Mn,ag as Fn,K as fn,E as ur,m as Ar,P as $n,U as Mr}from"../chunks/CwRy9Tox.js";import{S as Nt,i as Pt,t as _e,a as ae,g as pt,c as mt,d as vt,m as _t,b as gt,e as bt}from"../chunks/D-vqeeah.js";import{g as Ir}from"../chunks/D0QH3NT1.js";import{e as nt,u as fr,d as Sr,o as Cr}from"../chunks/BFk-VQ8S.js";import{g as Cn}from"../chunks/BVYH3h24.js";import{p as Dr}from"../chunks/BMPJZPAg.js";import{w as dn,d as hn,b as Dn}from"../chunks/DjSB8mDa.js";import{N as qn,a as Lt,u as Lr,q as Rr,f as Nr,g as Pr,F as Or}from"../chunks/Do1Y_WLx.js";import{b as yn,w as es}from"../chunks/CfA8cFIx.js";import{ndk as In,isConnected as Jn,subscribe as ts,publishEvent as dr,connectRelay as xr}from"../chunks/BTawUe4R.js";import{R as Ur}from"../chunks/C_zicc2g.js";import{f as Br,a as Hr,s as Vr,b as zr}from"../chunks/GPTLThIR.js";import{l as ns}from"../chunks/CPZcgTj3.js";import{p as qt}from"../chunks/Da8Ipvaz.js";import{c as Ln,A as hr}from"../chunks/Dcpztsvs.js";import{u as Fr,U as pr,c as Gr}from"../chunks/Blzy4VFC.js";import{t as Kt}from"../chunks/DDymQvxb.js";import{KIND_DELETE_EVENT as jr}from"../chunks/CZb6OUdE.js";import{d as Kr}from"../chunks/C4dVuRBh.js";const kn={METADATA:0,SHORT_TEXT_NOTE:1,TEXT_NOTE:1,RECOMMEND_RELAY:2,CONTACTS:3,ENCRYPTED_DM:4,DELETION:5,REPOST:6,REACTION:7,BADGE_AWARD:8,CHANNEL_CREATE:40,CHANNEL_METADATA:41,CHANNEL_MESSAGE:42,CHANNEL_HIDE:43,CHANNEL_MUTE:44,REPORT:1984,ZAP_REQUEST:9734,ZAP_RECEIPT:9735,MUTE_LIST:1e4,RELAY_LIST:10002,AUTH:22242,GIFT_WRAP:1059,SEALED:13},Wr=!1,Yr=async({params:r})=>({channelId:r.channelId,channel:null,messages:[]}),Yo=Object.freeze(Object.defineProperty({__proto__:null,load:Yr,prerender:Wr},Symbol.toStringTag,{value:"Module"})),mr="Nostr-BBS-pinned-messages",Rn=5,vr=30001;function Xr(){if(typeof window>"u")return{};try{const r=localStorage.getItem(mr);return r?JSON.parse(r):{}}catch(r){return console.error("Failed to load pinned messages from storage:",r),{}}}function Nn(r){if(!(typeof window>"u"))try{localStorage.setItem(mr,JSON.stringify(r))}catch(e){console.error("Failed to save pinned messages to storage:",e)}}function qr(){const{subscribe:r,set:e,update:n}=dn(Xr());return{subscribe:r,init:async()=>{},fetchPinnedMessages:async t=>{const s=In();if(s)try{const l={kinds:[vr],"#d":[`pinned:${t}`],limit:1},i=await s.fetchEvents(l);if(i.size>0){const u=Array.from(i).sort((f,c)=>c.created_at-f.created_at)[0].tags.filter(f=>f[0]==="e").map(f=>f[1]);n(f=>{const c={...f,[t]:u};return Nn(c),c})}}catch(l){console.error(`Failed to fetch pinned messages for ${t}:`,l)}},pinMessage:async(t,s)=>{if(!Ye(yn))return console.warn("Only admins can pin messages"),!1;const a=Ye({subscribe:r})[t]||[];if(a.includes(s))return console.warn("Message is already pinned"),!0;if(a.length>=Rn)return console.warn(`Cannot pin more than ${Rn} messages per channel`),!1;const u=[...a,s];return await ss(t,u)?(n(c=>{const p={...c,[t]:u};return Nn(p),p}),!0):(console.error("Failed to publish pin to relay"),!1)},unpinMessage:async(t,s)=>{if(!Ye(yn))return console.warn("Only admins can unpin messages"),!1;const a=Ye({subscribe:r})[t]||[];if(!a.includes(s))return console.warn("Message is not pinned"),!0;const u=a.filter(c=>c!==s);return await ss(t,u)?(n(c=>{const p={...c,[t]:u};return Nn(p),p}),!0):(console.error("Failed to publish unpin to relay"),!1)},isPinned:(t,s)=>(Ye({subscribe:r})[t]||[]).includes(s),getPinnedMessages:t=>Ye({subscribe:r})[t]||[],canPinMore:t=>(Ye({subscribe:r})[t]||[]).length<Rn}}async function ss(r,e){if(!Jn())return console.error("Cannot publish pins: Not connected to relay"),!1;const n=In();if(!n||!n.signer)return console.error("Cannot publish pins: NDK not initialized or no signer"),!1;try{const t=new qn(n);return t.kind=vr,t.tags=[["d",`pinned:${r}`],["h",r],...e.map(s=>["e",s])],await t.publish(),!0}catch(t){return console.error("Failed to publish pinned messages list:",t),!1}}const Yt=qr();function Jr(r){return setTimeout(()=>Yt.fetchPinnedMessages(r),0),hn(Yt,e=>e[r]||[])}function Zr(r,e){return hn(Yt,n=>(n[r]||[]).includes(e))}function rs(r,e,n){const t=r.slice();return t[17]=e[n],t}function ls(r){let e,n,t,s,l,i,a,u,f,c,p,_=r[0].length+"",g,k,w,E,T,M=[],R=new Map,x,z,I=nt(r[0]);const A=H=>H[17].id;for(let H=0;H<I.length;H+=1){let O=rs(r,I,H),Z=A(O);R.set(Z,M[H]=os(Z,O))}return{c(){e=y("div"),n=y("div"),t=y("div"),s=y("input"),l=L(),i=y("div"),a=K("svg"),u=K("path"),f=L(),c=y("span"),p=$("Pinned Messages ("),g=$(_),k=$(")"),w=L(),E=y("div"),T=y("div");for(let H=0;H<M.length;H+=1)M[H].c();this.h()},l(H){e=b(H,"DIV",{class:!0});var O=v(e);n=b(O,"DIV",{class:!0});var Z=v(n);t=b(Z,"DIV",{class:!0});var G=v(t);s=b(G,"INPUT",{type:!0,class:!0}),l=D(G),i=b(G,"DIV",{class:!0});var B=v(i);a=j(B,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var W=v(a);u=j(W,"path",{d:!0}),v(u).forEach(h),W.forEach(h),f=D(B),c=b(B,"SPAN",{class:!0});var U=v(c);p=Q(U,"Pinned Messages ("),g=Q(U,_),k=Q(U,")"),U.forEach(h),B.forEach(h),w=D(G),E=b(G,"DIV",{class:!0});var le=v(E);T=b(le,"DIV",{class:!0});var te=v(T);for(let Ne=0;Ne<M.length;Ne+=1)M[Ne].l(te);te.forEach(h),le.forEach(h),G.forEach(h),Z.forEach(h),O.forEach(h),this.h()},h(){o(s,"type","checkbox"),o(s,"class","min-h-0"),o(u,"d","M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z"),o(a,"xmlns","http://www.w3.org/2000/svg"),o(a,"class","h-5 w-5 text-warning"),o(a,"viewBox","0 0 20 20"),o(a,"fill","currentColor"),o(c,"class","font-semibold text-sm"),o(i,"class","collapse-title min-h-0 py-3 px-4 flex items-center gap-2 svelte-e5oa2s"),o(T,"class","space-y-2"),o(E,"class","collapse-content px-4 pb-3 pt-0"),o(t,"class","collapse collapse-arrow"),It(t,"collapse-open",r[1]),It(t,"collapse-close",!r[1]),o(n,"class","container mx-auto max-w-4xl"),o(e,"class","bg-base-200 border-b border-base-300")},m(H,O){S(H,e,O),d(e,n),d(n,t),d(t,s),s.checked=r[1],d(t,l),d(t,i),d(i,a),d(a,u),d(i,f),d(i,c),d(c,p),d(c,g),d(c,k),d(t,w),d(t,E),d(E,T);for(let Z=0;Z<M.length;Z+=1)M[Z]&&M[Z].m(T,null);x||(z=oe(s,"change",r[12]),x=!0)},p(H,O){O&2&&(s.checked=H[1]),O&1&&_!==(_=H[0].length+"")&&me(g,_),O&241&&(I=nt(H[0]),M=fr(M,O,A,1,H,I,R,T,Sr,os,null,rs)),O&2&&It(t,"collapse-open",H[1]),O&2&&It(t,"collapse-close",!H[1])},d(H){H&&h(e);for(let O=0;O<M.length;O+=1)M[O].d();x=!1,z()}}}function Qr(r){let e,n="Encrypted message";return{c(){e=y("span"),e.textContent=n,this.h()},l(t){e=b(t,"SPAN",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-1apnv1n"&&(e.textContent=n),this.h()},h(){o(e,"class","italic opacity-70")},m(t,s){S(t,e,s)},p:ne,d(t){t&&h(e)}}}function $r(r){let e=En(r[17].content)+"",n;return{c(){n=$(e)},l(t){n=Q(t,e)},m(t,s){S(t,n,s)},p(t,s){s&1&&e!==(e=En(t[17].content)+"")&&me(n,e)},d(t){t&&h(n)}}}function el(r){let e=En(r[17].decryptedContent)+"",n;return{c(){n=$(e)},l(t){n=Q(t,e)},m(t,s){S(t,n,s)},p(t,s){s&1&&e!==(e=En(t[17].decryptedContent)+"")&&me(n,e)},d(t){t&&h(n)}}}function is(r){let e,n='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>',t,s;function l(){return r[13](r[17])}return{c(){e=y("button"),e.innerHTML=n,this.h()},l(i){e=b(i,"BUTTON",{class:!0,"aria-label":!0,title:!0,"data-svelte-h":!0}),re(e)!=="svelte-78sxea"&&(e.innerHTML=n),this.h()},h(){o(e,"class","btn btn-ghost btn-xs opacity-30 group-hover:opacity-100 transition-opacity flex-shrink-0"),o(e,"aria-label","Unpin message"),o(e,"title","Unpin message")},m(i,a){S(i,e,a),t||(s=oe(e,"click",gn(l)),t=!0)},p(i,a){r=i},d(i){i&&h(e),t=!1,s()}}}function os(r,e){let n,t,s,l='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-warning" viewBox="0 0 20 20" fill="currentColor"><path d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z"></path></svg>',i,a,u,f,c=e[7](e[17].authorPubkey)+"",p,_,g,k=as(e[17].createdAt)+"",w,E,T,M,R,x,z;function I(B,W){return B[17].isEncrypted&&B[17].decryptedContent?el:B[17].isEncrypted?Qr:$r}let A=I(e),H=A(e),O=e[4]&&is(e);function Z(){return e[14](e[17])}function G(...B){return e[15](e[17],...B)}return{key:r,first:null,c(){n=y("div"),t=y("div"),s=y("div"),s.innerHTML=l,i=L(),a=y("div"),u=y("div"),f=y("span"),p=$(c),_=L(),g=y("span"),w=$(k),E=L(),T=y("p"),H.c(),M=L(),O&&O.c(),R=L(),this.h()},l(B){n=b(B,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0});var W=v(n);t=b(W,"DIV",{class:!0});var U=v(t);s=b(U,"DIV",{class:!0,"data-svelte-h":!0}),re(s)!=="svelte-r1jnbg"&&(s.innerHTML=l),i=D(U),a=b(U,"DIV",{class:!0});var le=v(a);u=b(le,"DIV",{class:!0});var te=v(u);f=b(te,"SPAN",{class:!0});var Ne=v(f);p=Q(Ne,c),Ne.forEach(h),_=D(te),g=b(te,"SPAN",{class:!0});var ue=v(g);w=Q(ue,k),ue.forEach(h),te.forEach(h),E=D(le),T=b(le,"P",{class:!0});var Y=v(T);H.l(Y),Y.forEach(h),le.forEach(h),M=D(U),O&&O.l(U),U.forEach(h),R=D(W),W.forEach(h),this.h()},h(){o(s,"class","flex-shrink-0"),o(f,"class","font-semibold text-sm"),o(g,"class","text-xs text-base-content/60"),o(u,"class","flex items-baseline gap-2 mb-1"),o(T,"class","text-sm text-base-content/80 break-words"),o(a,"class","flex-1 min-w-0"),o(t,"class","flex items-start gap-3"),o(n,"class","bg-base-100 rounded-lg p-3 border border-warning/20 hover:border-warning/40 transition-colors cursor-pointer group"),o(n,"role","button"),o(n,"tabindex","0"),o(n,"aria-label","Jump to pinned message"),this.first=n},m(B,W){S(B,n,W),d(n,t),d(t,s),d(t,i),d(t,a),d(a,u),d(u,f),d(f,p),d(u,_),d(u,g),d(g,w),d(a,E),d(a,T),H.m(T,null),d(t,M),O&&O.m(t,null),d(n,R),x||(z=[oe(n,"click",Z),oe(n,"keydown",G)],x=!0)},p(B,W){e=B,W&1&&c!==(c=e[7](e[17].authorPubkey)+"")&&me(p,c),W&1&&k!==(k=as(e[17].createdAt)+"")&&me(w,k),A===(A=I(e))&&H?H.p(e,W):(H.d(1),H=A(e),H&&(H.c(),H.m(T,null))),e[4]?O?O.p(e,W):(O=is(e),O.c(),O.m(t,null)):O&&(O.d(1),O=null)},d(B){B&&h(n),H.d(),O&&O.d(),x=!1,St(z)}}}function tl(r){let e,n=r[2]&&ls(r);return{c(){n&&n.c(),e=Be()},l(t){n&&n.l(t),e=Be()},m(t,s){n&&n.m(t,s),S(t,e,s)},p(t,[s]){t[2]?n?n.p(t,s):(n=ls(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ne,o:ne,d(t){t&&h(e),n&&n.d(t)}}}function En(r,e=80){return r.length<=e?r:r.slice(0,e)+"..."}function as(r){return new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function nl(r,e,n){let t,s,l,i,a,u=ne,f=()=>(u(),u=_n(t,I=>n(11,a=I)),t),c;Mt(r,Lt,I=>n(10,i=I)),Mt(r,yn,I=>n(4,c=I)),r.$$.on_destroy.push(()=>u());let{channelId:p}=e,{messages:_}=e;const g=An();let k=!0;async function w(I){await Yt.unpinMessage(p,I)&&g("unpin",{messageId:I})}function E(I){g("scrollTo",{messageId:I})}function T(I){return i.publicKey===I?"You":qt.getCachedSync(I)?.displayName||I.slice(0,8)+"..."+I.slice(-4)}function M(){k=this.checked,n(1,k)}const R=I=>w(I.id),x=I=>E(I.id),z=(I,A)=>(A.key==="Enter"||A.key===" ")&&(A.preventDefault(),E(I.id));return r.$$set=I=>{"channelId"in I&&n(8,p=I.channelId),"messages"in I&&n(9,_=I.messages)},r.$$.update=()=>{if(r.$$.dirty&256&&f(n(3,t=Jr(p))),r.$$.dirty&2560&&n(0,s=_.filter(I=>a.includes(I.id))),r.$$.dirty&1&&n(2,l=s.length>0),r.$$.dirty&1025&&s.length>0){const I=s.map(A=>A.authorPubkey).filter(A=>A!==i.publicKey);I.length>0&&qt.prefetchProfiles(I)}},[s,k,l,t,c,w,E,T,p,_,i,a,M,R,x,z]}class sl extends Nt{constructor(e){super(),Pt(this,e,nl,tl,Rt,{channelId:8,messages:9})}}function cs(r,e,n){const t=r.slice();t[7]=e[n];const s=Math.max(...t[1].activityByHour.map(i=>i.count));t[8]=s;const l=t[8]>0?t[7].count/t[8]*100:0;return t[9]=l,t}function us(r,e,n){const t=r.slice();t[12]=e[n],t[17]=n;const s=qt.getCachedSync(t[12].pubkey);t[13]=s;const l=t[13]?.displayName||t[12].name||`${t[12].pubkey.slice(0,8)}...`;t[14]=l;const i=t[13]?.avatar||t[12].avatar;return t[15]=i,t}function fs(r){let e,n,t,s;const l=[il,ll,rl],i=[];function a(u,f){return u[2]?0:u[3]?1:u[1]?2:-1}return~(n=a(r))&&(t=i[n]=l[n](r)),{c(){e=y("div"),t&&t.c(),this.h()},l(u){e=b(u,"DIV",{class:!0});var f=v(e);t&&t.l(f),f.forEach(h),this.h()},h(){o(e,"class","channel-stats svelte-1p16fog")},m(u,f){S(u,e,f),~n&&i[n].m(e,null),s=!0},p(u,f){let c=n;n=a(u),n===c?~n&&i[n].p(u,f):(t&&(pt(),_e(i[c],1,1,()=>{i[c]=null}),mt()),~n?(t=i[n],t?t.p(u,f):(t=i[n]=l[n](u),t.c()),ae(t,1),t.m(e,null)):t=null)},i(u){s||(ae(t),s=!0)},o(u){_e(t),s=!1},d(u){u&&h(e),~n&&i[n].d()}}}function rl(r){let e,n,t,s="Channel Statistics",l,i,a='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>',u,f,c,p,_='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>',g,k,w,E=vs(r[1].messageCount)+"",T,M,R,x="Total Messages",z,I,A,H='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>',O,Z,G,B=r[1].uniquePosters+"",W,U,le,te="Active Members",Ne,ue,Y,we='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>',J,Te,N,ee=r[1].avgMessagesPerDay.toFixed(1)+"",de,Qe,ce,je="Messages/Day",Pe,Ce,Ie,ke='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>',Ke,Le,He,he=wn(r[1].peakHour)+"",ge,Se,Ee,De="Peak Hour",be,Ae,P,se="Activity Trend (Last 7 Days)",ie,V,q,Oe,ye,Ve,ze="Activity by Hour",Ct,$e,it,We,Xe,ot,Et,wt=new Date(r[1].lastUpdated).toLocaleString()+"",at,Je,tn,Ot;V=new hr({props:{data:r[1].activityByDay,days:7}});let qe=r[1].topPosters.length>0&&ds(r),xt=nt(r[1].activityByHour),pe=[];for(let ve=0;ve<xt.length;ve+=1)pe[ve]=ps(cs(r,xt,ve));let Re=r[1].memberGrowth.length>0&&ms(r);return{c(){e=y("div"),n=y("div"),t=y("h3"),t.textContent=s,l=L(),i=y("button"),i.innerHTML=a,u=L(),f=y("div"),c=y("div"),p=y("div"),p.innerHTML=_,g=L(),k=y("div"),w=y("div"),T=$(E),M=L(),R=y("div"),R.textContent=x,z=L(),I=y("div"),A=y("div"),A.innerHTML=H,O=L(),Z=y("div"),G=y("div"),W=$(B),U=L(),le=y("div"),le.textContent=te,Ne=L(),ue=y("div"),Y=y("div"),Y.innerHTML=we,J=L(),Te=y("div"),N=y("div"),de=$(ee),Qe=L(),ce=y("div"),ce.textContent=je,Pe=L(),Ce=y("div"),Ie=y("div"),Ie.innerHTML=ke,Ke=L(),Le=y("div"),He=y("div"),ge=$(he),Se=L(),Ee=y("div"),Ee.textContent=De,be=L(),Ae=y("div"),P=y("h4"),P.textContent=se,ie=L(),bt(V.$$.fragment),q=L(),qe&&qe.c(),Oe=L(),ye=y("div"),Ve=y("h4"),Ve.textContent=ze,Ct=L(),$e=y("div");for(let ve=0;ve<pe.length;ve+=1)pe[ve].c();it=L(),Re&&Re.c(),We=L(),Xe=y("div"),ot=y("span"),Et=$("Last updated: "),at=$(wt),this.h()},l(ve){e=b(ve,"DIV",{class:!0});var Me=v(e);n=b(Me,"DIV",{class:!0});var et=v(n);t=b(et,"H3",{class:!0,"data-svelte-h":!0}),re(t)!=="svelte-wjtcmm"&&(t.textContent=s),l=D(et),i=b(et,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),re(i)!=="svelte-1i0imug"&&(i.innerHTML=a),et.forEach(h),u=D(Me),f=b(Me,"DIV",{class:!0});var xe=v(f);c=b(xe,"DIV",{class:!0});var Tt=v(c);p=b(Tt,"DIV",{class:!0,"data-svelte-h":!0}),re(p)!=="svelte-1tvwkz8"&&(p.innerHTML=_),g=D(Tt),k=b(Tt,"DIV",{class:!0});var Jt=v(k);w=b(Jt,"DIV",{class:!0});var ut=v(w);T=Q(ut,E),ut.forEach(h),M=D(Jt),R=b(Jt,"DIV",{class:!0,"data-svelte-h":!0}),re(R)!=="svelte-1h50s8y"&&(R.textContent=x),Jt.forEach(h),Tt.forEach(h),z=D(xe),I=b(xe,"DIV",{class:!0});var ft=v(I);A=b(ft,"DIV",{class:!0,"data-svelte-h":!0}),re(A)!=="svelte-5no1ux"&&(A.innerHTML=H),O=D(ft),Z=b(ft,"DIV",{class:!0});var Vt=v(Z);G=b(Vt,"DIV",{class:!0});var nn=v(G);W=Q(nn,B),nn.forEach(h),U=D(Vt),le=b(Vt,"DIV",{class:!0,"data-svelte-h":!0}),re(le)!=="svelte-d85fa1"&&(le.textContent=te),Vt.forEach(h),ft.forEach(h),Ne=D(xe),ue=b(xe,"DIV",{class:!0});var Ut=v(ue);Y=b(Ut,"DIV",{class:!0,"data-svelte-h":!0}),re(Y)!=="svelte-1svbi9h"&&(Y.innerHTML=we),J=D(Ut),Te=b(Ut,"DIV",{class:!0});var zt=v(Te);N=b(zt,"DIV",{class:!0});var dt=v(N);de=Q(dt,ee),dt.forEach(h),Qe=D(zt),ce=b(zt,"DIV",{class:!0,"data-svelte-h":!0}),re(ce)!=="svelte-1fdzrrl"&&(ce.textContent=je),zt.forEach(h),Ut.forEach(h),Pe=D(xe),Ce=b(xe,"DIV",{class:!0});var Ft=v(Ce);Ie=b(Ft,"DIV",{class:!0,"data-svelte-h":!0}),re(Ie)!=="svelte-agj8wc"&&(Ie.innerHTML=ke),Ke=D(Ft),Le=b(Ft,"DIV",{class:!0});var Gt=v(Le);He=b(Gt,"DIV",{class:!0});var sn=v(He);ge=Q(sn,he),sn.forEach(h),Se=D(Gt),Ee=b(Gt,"DIV",{class:!0,"data-svelte-h":!0}),re(Ee)!=="svelte-1sn6ndz"&&(Ee.textContent=De),Gt.forEach(h),Ft.forEach(h),xe.forEach(h),be=D(Me),Ae=b(Me,"DIV",{class:!0});var jt=v(Ae);P=b(jt,"H4",{class:!0,"data-svelte-h":!0}),re(P)!=="svelte-vuppev"&&(P.textContent=se),ie=D(jt),gt(V.$$.fragment,jt),jt.forEach(h),q=D(Me),qe&&qe.l(Me),Oe=D(Me),ye=b(Me,"DIV",{class:!0});var Zt=v(ye);Ve=b(Zt,"H4",{class:!0,"data-svelte-h":!0}),re(Ve)!=="svelte-1gud1x2"&&(Ve.textContent=ze),Ct=D(Zt),$e=b(Zt,"DIV",{class:!0});var X=v($e);for(let F=0;F<pe.length;F+=1)pe[F].l(X);X.forEach(h),Zt.forEach(h),it=D(Me),Re&&Re.l(Me),We=D(Me),Xe=b(Me,"DIV",{class:!0});var m=v(Xe);ot=b(m,"SPAN",{class:!0});var C=v(ot);Et=Q(C,"Last updated: "),at=Q(C,wt),C.forEach(h),m.forEach(h),Me.forEach(h),this.h()},h(){o(t,"class","svelte-1p16fog"),o(i,"class","refresh-button svelte-1p16fog"),o(i,"title","Refresh statistics"),o(n,"class","stats-header svelte-1p16fog"),o(p,"class","metric-icon messages svelte-1p16fog"),o(w,"class","metric-value svelte-1p16fog"),o(R,"class","metric-label svelte-1p16fog"),o(k,"class","metric-content svelte-1p16fog"),o(c,"class","metric-card svelte-1p16fog"),o(A,"class","metric-icon members svelte-1p16fog"),o(G,"class","metric-value svelte-1p16fog"),o(le,"class","metric-label svelte-1p16fog"),o(Z,"class","metric-content svelte-1p16fog"),o(I,"class","metric-card svelte-1p16fog"),o(Y,"class","metric-icon activity svelte-1p16fog"),o(N,"class","metric-value svelte-1p16fog"),o(ce,"class","metric-label svelte-1p16fog"),o(Te,"class","metric-content svelte-1p16fog"),o(ue,"class","metric-card svelte-1p16fog"),o(Ie,"class","metric-icon peak svelte-1p16fog"),o(He,"class","metric-value svelte-1p16fog"),o(Ee,"class","metric-label svelte-1p16fog"),o(Le,"class","metric-content svelte-1p16fog"),o(Ce,"class","metric-card svelte-1p16fog"),o(f,"class","metrics-grid svelte-1p16fog"),o(P,"class","svelte-1p16fog"),o(Ae,"class","section svelte-1p16fog"),o(Ve,"class","svelte-1p16fog"),o($e,"class","heatmap svelte-1p16fog"),o(ye,"class","section svelte-1p16fog"),o(ot,"class","last-updated svelte-1p16fog"),o(Xe,"class","stats-footer svelte-1p16fog"),o(e,"class","stats-container svelte-1p16fog")},m(ve,Me){S(ve,e,Me),d(e,n),d(n,t),d(n,l),d(n,i),d(e,u),d(e,f),d(f,c),d(c,p),d(c,g),d(c,k),d(k,w),d(w,T),d(k,M),d(k,R),d(f,z),d(f,I),d(I,A),d(I,O),d(I,Z),d(Z,G),d(G,W),d(Z,U),d(Z,le),d(f,Ne),d(f,ue),d(ue,Y),d(ue,J),d(ue,Te),d(Te,N),d(N,de),d(Te,Qe),d(Te,ce),d(f,Pe),d(f,Ce),d(Ce,Ie),d(Ce,Ke),d(Ce,Le),d(Le,He),d(He,ge),d(Le,Se),d(Le,Ee),d(e,be),d(e,Ae),d(Ae,P),d(Ae,ie),_t(V,Ae,null),d(e,q),qe&&qe.m(e,null),d(e,Oe),d(e,ye),d(ye,Ve),d(ye,Ct),d(ye,$e);for(let et=0;et<pe.length;et+=1)pe[et]&&pe[et].m($e,null);d(e,it),Re&&Re.m(e,null),d(e,We),d(e,Xe),d(Xe,ot),d(ot,Et),d(ot,at),Je=!0,tn||(Ot=oe(i,"click",r[4]),tn=!0)},p(ve,Me){(!Je||Me&2)&&E!==(E=vs(ve[1].messageCount)+"")&&me(T,E),(!Je||Me&2)&&B!==(B=ve[1].uniquePosters+"")&&me(W,B),(!Je||Me&2)&&ee!==(ee=ve[1].avgMessagesPerDay.toFixed(1)+"")&&me(de,ee),(!Je||Me&2)&&he!==(he=wn(ve[1].peakHour)+"")&&me(ge,he);const et={};if(Me&2&&(et.data=ve[1].activityByDay),V.$set(et),ve[1].topPosters.length>0?qe?qe.p(ve,Me):(qe=ds(ve),qe.c(),qe.m(e,Oe)):qe&&(qe.d(1),qe=null),Me&2){xt=nt(ve[1].activityByHour);let xe;for(xe=0;xe<xt.length;xe+=1){const Tt=cs(ve,xt,xe);pe[xe]?pe[xe].p(Tt,Me):(pe[xe]=ps(Tt),pe[xe].c(),pe[xe].m($e,null))}for(;xe<pe.length;xe+=1)pe[xe].d(1);pe.length=xt.length}ve[1].memberGrowth.length>0?Re?(Re.p(ve,Me),Me&2&&ae(Re,1)):(Re=ms(ve),Re.c(),ae(Re,1),Re.m(e,We)):Re&&(pt(),_e(Re,1,1,()=>{Re=null}),mt()),(!Je||Me&2)&&wt!==(wt=new Date(ve[1].lastUpdated).toLocaleString()+"")&&me(at,wt)},i(ve){Je||(ae(V.$$.fragment,ve),ae(Re),Je=!0)},o(ve){_e(V.$$.fragment,ve),_e(Re),Je=!1},d(ve){ve&&h(e),vt(V),qe&&qe.d(),en(pe,ve),Re&&Re.d(),tn=!1,Ot()}}}function ll(r){let e,n,t,s,l,i="Retry",a,u;return{c(){e=y("div"),n=y("p"),t=$(r[3]),s=L(),l=y("button"),l.textContent=i,this.h()},l(f){e=b(f,"DIV",{class:!0});var c=v(e);n=b(c,"P",{class:!0});var p=v(n);t=Q(p,r[3]),p.forEach(h),s=D(c),l=b(c,"BUTTON",{class:!0,"data-svelte-h":!0}),re(l)!=="svelte-794okw"&&(l.textContent=i),c.forEach(h),this.h()},h(){o(n,"class","error-message svelte-1p16fog"),o(l,"class","retry-button svelte-1p16fog"),o(e,"class","error-state svelte-1p16fog")},m(f,c){S(f,e,c),d(e,n),d(n,t),d(e,s),d(e,l),a||(u=oe(l,"click",r[4]),a=!0)},p(f,c){c&8&&me(t,f[3])},i:ne,o:ne,d(f){f&&h(e),a=!1,u()}}}function il(r){let e,n='<div class="spinner svelte-1p16fog"></div> <p>Loading statistics...</p>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-13n5rrw"&&(e.innerHTML=n),this.h()},h(){o(e,"class","loading-state svelte-1p16fog")},m(t,s){S(t,e,s)},p:ne,i:ne,o:ne,d(t){t&&h(e)}}}function ds(r){let e,n,t="Top Contributors",s,l,i=nt(r[1].topPosters),a=[];for(let u=0;u<i.length;u+=1)a[u]=hs(us(r,i,u));return{c(){e=y("div"),n=y("h4"),n.textContent=t,s=L(),l=y("div");for(let u=0;u<a.length;u+=1)a[u].c();this.h()},l(u){e=b(u,"DIV",{class:!0});var f=v(e);n=b(f,"H4",{class:!0,"data-svelte-h":!0}),re(n)!=="svelte-7zv2lh"&&(n.textContent=t),s=D(f),l=b(f,"DIV",{class:!0});var c=v(l);for(let p=0;p<a.length;p+=1)a[p].l(c);c.forEach(h),f.forEach(h),this.h()},h(){o(n,"class","svelte-1p16fog"),o(l,"class","top-posters svelte-1p16fog"),o(e,"class","section svelte-1p16fog")},m(u,f){S(u,e,f),d(e,n),d(e,s),d(e,l);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(l,null)},p(u,f){if(f&2){i=nt(u[1].topPosters);let c;for(c=0;c<i.length;c+=1){const p=us(u,i,c);a[c]?a[c].p(p,f):(a[c]=hs(p),a[c].c(),a[c].m(l,null))}for(;c<a.length;c+=1)a[c].d(1);a.length=i.length}},d(u){u&&h(e),en(a,u)}}}function ol(r){let e,n=r[14].charAt(0).toUpperCase()+"",t;return{c(){e=y("div"),t=$(n),this.h()},l(s){e=b(s,"DIV",{class:!0});var l=v(e);t=Q(l,n),l.forEach(h),this.h()},h(){o(e,"class","avatar-placeholder svelte-1p16fog")},m(s,l){S(s,e,l),d(e,t)},p(s,l){l&2&&n!==(n=s[14].charAt(0).toUpperCase()+"")&&me(t,n)},d(s){s&&h(e)}}}function al(r){let e,n,t;return{c(){e=y("img"),this.h()},l(s){e=b(s,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Ge(e.src,n=r[15])||o(e,"src",n),o(e,"alt",t=r[14]),o(e,"class","svelte-1p16fog")},m(s,l){S(s,e,l)},p(s,l){l&2&&!Ge(e.src,n=s[15])&&o(e,"src",n),l&2&&t!==(t=s[14])&&o(e,"alt",t)},d(s){s&&h(e)}}}function hs(r){let e,n,t,s=r[17]+1+"",l,i,a,u,f,c,p=r[14]+"",_,g,k,w=r[12].messageCount+"",E,T,M=r[12].percentage.toFixed(1)+"",R,x,z,I,A,H;function O(B,W){return B[15]?al:ol}let Z=O(r),G=Z(r);return{c(){e=y("div"),n=y("div"),t=$("#"),l=$(s),i=L(),a=y("div"),G.c(),u=L(),f=y("div"),c=y("div"),_=$(p),g=L(),k=y("div"),E=$(w),T=$(" messages • "),R=$(M),x=$("%"),z=L(),I=y("div"),A=y("div"),H=L(),this.h()},l(B){e=b(B,"DIV",{class:!0});var W=v(e);n=b(W,"DIV",{class:!0});var U=v(n);t=Q(U,"#"),l=Q(U,s),U.forEach(h),i=D(W),a=b(W,"DIV",{class:!0});var le=v(a);G.l(le),le.forEach(h),u=D(W),f=b(W,"DIV",{class:!0});var te=v(f);c=b(te,"DIV",{class:!0});var Ne=v(c);_=Q(Ne,p),Ne.forEach(h),g=D(te),k=b(te,"DIV",{class:!0});var ue=v(k);E=Q(ue,w),T=Q(ue," messages • "),R=Q(ue,M),x=Q(ue,"%"),ue.forEach(h),te.forEach(h),z=D(W),I=b(W,"DIV",{class:!0});var Y=v(I);A=b(Y,"DIV",{class:!0,style:!0}),v(A).forEach(h),Y.forEach(h),H=D(W),W.forEach(h),this.h()},h(){o(n,"class","poster-rank svelte-1p16fog"),o(a,"class","poster-avatar svelte-1p16fog"),o(c,"class","poster-name svelte-1p16fog"),o(k,"class","poster-stats svelte-1p16fog"),o(f,"class","poster-info svelte-1p16fog"),o(A,"class","poster-bar-fill svelte-1p16fog"),bn(A,"width",r[12].percentage+"%"),o(I,"class","poster-bar svelte-1p16fog"),o(e,"class","poster-item svelte-1p16fog")},m(B,W){S(B,e,W),d(e,n),d(n,t),d(n,l),d(e,i),d(e,a),G.m(a,null),d(e,u),d(e,f),d(f,c),d(c,_),d(f,g),d(f,k),d(k,E),d(k,T),d(k,R),d(k,x),d(e,z),d(e,I),d(I,A),d(e,H)},p(B,W){Z===(Z=O(B))&&G?G.p(B,W):(G.d(1),G=Z(B),G&&(G.c(),G.m(a,null))),W&2&&p!==(p=B[14]+"")&&me(_,p),W&2&&w!==(w=B[12].messageCount+"")&&me(E,w),W&2&&M!==(M=B[12].percentage.toFixed(1)+"")&&me(R,M),W&2&&bn(A,"width",B[12].percentage+"%")},d(B){B&&h(e),G.d()}}}function ps(r){let e,n,t,s,l=_s(r[7].hour)+"",i,a,u;return{c(){e=y("div"),n=y("div"),t=L(),s=y("div"),i=$(l),a=L(),this.h()},l(f){e=b(f,"DIV",{class:!0,title:!0});var c=v(e);n=b(c,"DIV",{class:!0,style:!0}),v(n).forEach(h),t=D(c),s=b(c,"DIV",{class:!0});var p=v(s);i=Q(p,l),p.forEach(h),a=D(c),c.forEach(h),this.h()},h(){o(n,"class","heatmap-bar svelte-1p16fog"),bn(n,"height",r[9]+"%"),o(s,"class","heatmap-label svelte-1p16fog"),o(e,"class","heatmap-cell svelte-1p16fog"),o(e,"title",u=wn(r[7].hour)+": "+r[7].count+" messages")},m(f,c){S(f,e,c),d(e,n),d(e,t),d(e,s),d(s,i),d(e,a)},p(f,c){c&2&&bn(n,"height",f[9]+"%"),c&2&&l!==(l=_s(f[7].hour)+"")&&me(i,l),c&2&&u!==(u=wn(f[7].hour)+": "+f[7].count+" messages")&&o(e,"title",u)},d(f){f&&h(e)}}}function ms(r){let e,n,t="Member Growth (Last 30 Days)",s,l,i;return l=new hr({props:{data:r[1].memberGrowth.map(gs),days:30}}),{c(){e=y("div"),n=y("h4"),n.textContent=t,s=L(),bt(l.$$.fragment),this.h()},l(a){e=b(a,"DIV",{class:!0});var u=v(e);n=b(u,"H4",{class:!0,"data-svelte-h":!0}),re(n)!=="svelte-1c0tez4"&&(n.textContent=t),s=D(u),gt(l.$$.fragment,u),u.forEach(h),this.h()},h(){o(n,"class","svelte-1p16fog"),o(e,"class","section svelte-1p16fog")},m(a,u){S(a,e,u),d(e,n),d(e,s),_t(l,e,null),i=!0},p(a,u){const f={};u&2&&(f.data=a[1].memberGrowth.map(gs)),l.$set(f)},i(a){i||(ae(l.$$.fragment,a),i=!0)},o(a){_e(l.$$.fragment,a),i=!1},d(a){a&&h(e),vt(l)}}}function cl(r){let e,n,t=r[0]&&fs(r);return{c(){t&&t.c(),e=Be()},l(s){t&&t.l(s),e=Be()},m(s,l){t&&t.m(s,l),S(s,e,l),n=!0},p(s,[l]){s[0]?t?(t.p(s,l),l&1&&ae(t,1)):(t=fs(s),t.c(),ae(t,1),t.m(e.parentNode,e)):t&&(pt(),_e(t,1,1,()=>{t=null}),mt())},i(s){n||(ae(t),n=!0)},o(s){_e(t),n=!1},d(s){s&&h(e),t&&t.d(s)}}}function vs(r){return r>=1e6?(r/1e6).toFixed(1)+"M":r>=1e3?(r/1e3).toFixed(1)+"K":r.toString()}function wn(r){return r===0?"12 AM":r===12?"12 PM":r<12?`${r} AM`:`${r-12} PM`}function _s(r){return r===0?"12a":r===12?"12p":r<12?`${r}a`:`${r-12}p`}const gs=r=>({date:r.date,count:r.memberCount,timestamp:r.timestamp});function ul(r,e,n){let{channelId:t}=e,{isExpanded:s=!1}=e,l=null,i=!1,a=null;async function u(){n(2,i=!0),n(3,a=null);try{if(n(1,l=await Ln.getStats(t)),l?.topPosters?.length){const c=l.topPosters.map(p=>p.pubkey);qt.prefetchProfiles(c)}}catch(c){n(3,a=c instanceof Error?c.message:"Failed to load statistics"),console.error("Failed to load stats:",c)}finally{n(2,i=!1)}}async function f(){n(2,i=!0),n(3,a=null);try{await Ln.refreshStats(t),n(1,l=await Ln.getStats(t))}catch(c){n(3,a=c instanceof Error?c.message:"Failed to refresh statistics"),console.error("Failed to refresh stats:",c)}finally{n(2,i=!1)}}return r.$$set=c=>{"channelId"in c&&n(5,t=c.channelId),"isExpanded"in c&&n(0,s=c.isExpanded)},r.$$.update=()=>{r.$$.dirty&3&&s&&!l&&u()},[s,l,i,a,f,t]}class fl extends Nt{constructor(e){super(),Pt(this,e,ul,cl,Rt,{channelId:5,isExpanded:0})}}const _r="Nostr-BBS-bookmarks";function dl(){if(typeof window>"u")return{};try{const r=localStorage.getItem(_r);if(r)return JSON.parse(r)}catch(r){console.error("Failed to load bookmarks from localStorage:",r)}return{}}function Pn(r){if(!(typeof window>"u"))try{localStorage.setItem(_r,JSON.stringify(r))}catch(e){console.error("Failed to save bookmarks to localStorage:",e)}}const hl={bookmarks:dl()},Ht=dn(hl),Gn={subscribe:Ht.subscribe,addBookmark:(r,e,n,t,s,l)=>{Ht.update(i=>{const a={messageId:r,channelId:e,content:n,authorPubkey:t,timestamp:s,channelName:l,createdAt:Date.now()},u={...i.bookmarks,[r]:a};return Pn(u),{...i,bookmarks:u}})},removeBookmark:r=>{Ht.update(e=>{const n={...e.bookmarks};return delete n[r],Pn(n),{...e,bookmarks:n}})},toggleBookmark:(r,e,n,t,s,l)=>{Ye(Ht).bookmarks[r]?Gn.removeBookmark(r):Gn.addBookmark(r,e,n,t,s,l)},getBookmarks:()=>{const r=Ye(Ht);return Object.values(r.bookmarks).sort((e,n)=>n.createdAt-e.createdAt)},clearAll:()=>{Ht.set({bookmarks:{}}),Pn({})}};function pl(r){return hn(Ht,e=>!!e.bookmarks[r])}hn(Ht,r=>Object.keys(r.bookmarks).length);const ml=/(https?:\/\/[^\s<>"']+)/gi,vl=/\.(jpg|jpeg|png|gif|webp|svg|bmp)(\?.*)?$/i,_l=/\.(mp4|webm|ogg|mov|avi)(\?.*)?$/i,gl=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i;function bl(r){const e=r.match(ml);return e?[...new Set(e)].filter(t=>{try{return new URL(t),!0}catch{return!1}}):[]}function yl(r){try{const n=new URL(r).pathname;return vl.test(n)}catch{return!1}}function kl(r){try{const n=new URL(r).pathname;return _l.test(n)}catch{return!1}}function El(r){const e=r.match(gl);return e?e[1]:null}function jn(r){try{return new URL(r).hostname.replace(/^www\./,"")}catch{return""}}function wl(r){try{return`https://www.google.com/s2/favicons?domain=${new URL(r).hostname}&sz=32`}catch{return""}}function Tl(r){if(yl(r))return{type:"image",url:r};if(kl(r))return{type:"video",url:r};const e=El(r);return e?{type:"youtube",url:r,youtubeId:e}:{type:"link",url:r}}function Al(r){const e=[],n=r.filter(c=>c[0]==="image"&&c.length>=4&&c[3]==="encrypted");if(n.length===0)return[];const t=r.find(c=>c[0]==="image-iv"),s=r.find(c=>c[0]==="image-salt"),l=r.find(c=>c[0]==="image-sender");if(!t||!s||!l)return console.warn("Missing encryption metadata tags for encrypted image"),[];const i=t[1],a=s[1],u=l[1],f=new Map;for(const c of r)c[0]==="image-key"&&c.length>=3&&f.set(c[1],c[2]);for(const c of n)e.push({url:c[1],contentType:c[2]||"application/octet-stream",iv:i,salt:a,senderPubkey:u,recipientKeys:f});return e}function Ml(r,e){return r.recipientKeys.get(e)||null}function Il(r,e){const n=Ml(r,e);if(!n)return null;const t={encrypted:!0,encryptedKey:n,senderPubkey:r.senderPubkey};return{type:"image",url:r.url,encryption:t}}function Sl(r,e,n,t,s){const l=[],i=new Set,a=Al(e);for(const f of a)if(n){const c=Il(f,n);c&&(l.push(c),i.add(f.url))}const u=t(r);for(const f of u)i.has(f)||(l.push(s(f)),i.add(f));return l.slice(0,5)}/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:gr,setPrototypeOf:bs,isFrozen:Cl,getPrototypeOf:Dl,getOwnPropertyDescriptor:Ll}=Object;let{freeze:rt,seal:yt,create:Kn}=Object,{apply:Wn,construct:Yn}=typeof Reflect<"u"&&Reflect;rt||(rt=function(e){return e});yt||(yt=function(e){return e});Wn||(Wn=function(e,n){for(var t=arguments.length,s=new Array(t>2?t-2:0),l=2;l<t;l++)s[l-2]=arguments[l];return e.apply(n,s)});Yn||(Yn=function(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),s=1;s<n;s++)t[s-1]=arguments[s];return new e(...t)});const pn=lt(Array.prototype.forEach),Rl=lt(Array.prototype.lastIndexOf),ys=lt(Array.prototype.pop),rn=lt(Array.prototype.push),Nl=lt(Array.prototype.splice),vn=lt(String.prototype.toLowerCase),On=lt(String.prototype.toString),xn=lt(String.prototype.match),ln=lt(String.prototype.replace),Pl=lt(String.prototype.indexOf),Ol=lt(String.prototype.trim),kt=lt(Object.prototype.hasOwnProperty),st=lt(RegExp.prototype.test),on=xl(TypeError);function lt(r){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,t=new Array(n>1?n-1:0),s=1;s<n;s++)t[s-1]=arguments[s];return Wn(r,e,t)}}function xl(r){return function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return Yn(r,n)}}function fe(r,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vn;bs&&bs(r,null);let t=e.length;for(;t--;){let s=e[t];if(typeof s=="string"){const l=n(s);l!==s&&(Cl(e)||(e[t]=l),s=l)}r[s]=!0}return r}function Ul(r){for(let e=0;e<r.length;e++)kt(r,e)||(r[e]=null);return r}function At(r){const e=Kn(null);for(const[n,t]of gr(r))kt(r,n)&&(Array.isArray(t)?e[n]=Ul(t):t&&typeof t=="object"&&t.constructor===Object?e[n]=At(t):e[n]=t);return e}function an(r,e){for(;r!==null;){const t=Ll(r,e);if(t){if(t.get)return lt(t.get);if(typeof t.value=="function")return lt(t.value)}r=Dl(r)}function n(){return null}return n}const ks=rt(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Un=rt(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Bn=rt(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Bl=rt(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Hn=rt(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Hl=rt(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Es=rt(["#text"]),ws=rt(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Vn=rt(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ts=rt(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),mn=rt(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Vl=yt(/\{\{[\w\W]*|[\w\W]*\}\}/gm),zl=yt(/<%[\w\W]*|[\w\W]*%>/gm),Fl=yt(/\$\{[\w\W]*/gm),Gl=yt(/^data-[\-\w.\u00B7-\uFFFF]+$/),jl=yt(/^aria-[\-\w]+$/),br=yt(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Kl=yt(/^(?:\w+script|data):/i),Wl=yt(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),yr=yt(/^html$/i),Yl=yt(/^[a-z][.\w]*(-[.\w]+)+$/i);var As=Object.freeze({__proto__:null,ARIA_ATTR:jl,ATTR_WHITESPACE:Wl,CUSTOM_ELEMENT:Yl,DATA_ATTR:Gl,DOCTYPE_NAME:yr,ERB_EXPR:zl,IS_ALLOWED_URI:br,IS_SCRIPT_OR_DATA:Kl,MUSTACHE_EXPR:Vl,TMPLIT_EXPR:Fl});const cn={element:1,text:3,progressingInstruction:7,comment:8,document:9},Xl=function(){return typeof window>"u"?null:window},ql=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let t=null;const s="data-tt-policy-suffix";n&&n.hasAttribute(s)&&(t=n.getAttribute(s));const l="dompurify"+(t?"#"+t:"");try{return e.createPolicy(l,{createHTML(i){return i},createScriptURL(i){return i}})}catch{return console.warn("TrustedTypes policy "+l+" could not be created."),null}},Ms=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function kr(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Xl();const e=X=>kr(X);if(e.version="3.3.1",e.removed=[],!r||!r.document||r.document.nodeType!==cn.document||!r.Element)return e.isSupported=!1,e;let{document:n}=r;const t=n,s=t.currentScript,{DocumentFragment:l,HTMLTemplateElement:i,Node:a,Element:u,NodeFilter:f,NamedNodeMap:c=r.NamedNodeMap||r.MozNamedAttrMap,HTMLFormElement:p,DOMParser:_,trustedTypes:g}=r,k=u.prototype,w=an(k,"cloneNode"),E=an(k,"remove"),T=an(k,"nextSibling"),M=an(k,"childNodes"),R=an(k,"parentNode");if(typeof i=="function"){const X=n.createElement("template");X.content&&X.content.ownerDocument&&(n=X.content.ownerDocument)}let x,z="";const{implementation:I,createNodeIterator:A,createDocumentFragment:H,getElementsByTagName:O}=n,{importNode:Z}=t;let G=Ms();e.isSupported=typeof gr=="function"&&typeof R=="function"&&I&&I.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:B,ERB_EXPR:W,TMPLIT_EXPR:U,DATA_ATTR:le,ARIA_ATTR:te,IS_SCRIPT_OR_DATA:Ne,ATTR_WHITESPACE:ue,CUSTOM_ELEMENT:Y}=As;let{IS_ALLOWED_URI:we}=As,J=null;const Te=fe({},[...ks,...Un,...Bn,...Hn,...Es]);let N=null;const ee=fe({},[...ws,...Vn,...Ts,...mn]);let de=Object.seal(Kn(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Qe=null,ce=null;const je=Object.seal(Kn(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Pe=!0,Ce=!0,Ie=!1,ke=!0,Ke=!1,Le=!0,He=!1,he=!1,ge=!1,Se=!1,Ee=!1,De=!1,be=!0,Ae=!1;const P="user-content-";let se=!0,ie=!1,V={},q=null;const Oe=fe({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ye=null;const Ve=fe({},["audio","video","img","source","image","track"]);let ze=null;const Ct=fe({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),$e="http://www.w3.org/1998/Math/MathML",it="http://www.w3.org/2000/svg",We="http://www.w3.org/1999/xhtml";let Xe=We,ot=!1,Et=null;const wt=fe({},[$e,it,We],On);let at=fe({},["mi","mo","mn","ms","mtext"]),Je=fe({},["annotation-xml"]);const tn=fe({},["title","style","font","a","script"]);let Ot=null;const qe=["application/xhtml+xml","text/html"],xt="text/html";let pe=null,Re=null;const ve=n.createElement("form"),Me=function(m){return m instanceof RegExp||m instanceof Function},et=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Re&&Re===m)){if((!m||typeof m!="object")&&(m={}),m=At(m),Ot=qe.indexOf(m.PARSER_MEDIA_TYPE)===-1?xt:m.PARSER_MEDIA_TYPE,pe=Ot==="application/xhtml+xml"?On:vn,J=kt(m,"ALLOWED_TAGS")?fe({},m.ALLOWED_TAGS,pe):Te,N=kt(m,"ALLOWED_ATTR")?fe({},m.ALLOWED_ATTR,pe):ee,Et=kt(m,"ALLOWED_NAMESPACES")?fe({},m.ALLOWED_NAMESPACES,On):wt,ze=kt(m,"ADD_URI_SAFE_ATTR")?fe(At(Ct),m.ADD_URI_SAFE_ATTR,pe):Ct,ye=kt(m,"ADD_DATA_URI_TAGS")?fe(At(Ve),m.ADD_DATA_URI_TAGS,pe):Ve,q=kt(m,"FORBID_CONTENTS")?fe({},m.FORBID_CONTENTS,pe):Oe,Qe=kt(m,"FORBID_TAGS")?fe({},m.FORBID_TAGS,pe):At({}),ce=kt(m,"FORBID_ATTR")?fe({},m.FORBID_ATTR,pe):At({}),V=kt(m,"USE_PROFILES")?m.USE_PROFILES:!1,Pe=m.ALLOW_ARIA_ATTR!==!1,Ce=m.ALLOW_DATA_ATTR!==!1,Ie=m.ALLOW_UNKNOWN_PROTOCOLS||!1,ke=m.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Ke=m.SAFE_FOR_TEMPLATES||!1,Le=m.SAFE_FOR_XML!==!1,He=m.WHOLE_DOCUMENT||!1,Se=m.RETURN_DOM||!1,Ee=m.RETURN_DOM_FRAGMENT||!1,De=m.RETURN_TRUSTED_TYPE||!1,ge=m.FORCE_BODY||!1,be=m.SANITIZE_DOM!==!1,Ae=m.SANITIZE_NAMED_PROPS||!1,se=m.KEEP_CONTENT!==!1,ie=m.IN_PLACE||!1,we=m.ALLOWED_URI_REGEXP||br,Xe=m.NAMESPACE||We,at=m.MATHML_TEXT_INTEGRATION_POINTS||at,Je=m.HTML_INTEGRATION_POINTS||Je,de=m.CUSTOM_ELEMENT_HANDLING||{},m.CUSTOM_ELEMENT_HANDLING&&Me(m.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(de.tagNameCheck=m.CUSTOM_ELEMENT_HANDLING.tagNameCheck),m.CUSTOM_ELEMENT_HANDLING&&Me(m.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(de.attributeNameCheck=m.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),m.CUSTOM_ELEMENT_HANDLING&&typeof m.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(de.allowCustomizedBuiltInElements=m.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ke&&(Ce=!1),Ee&&(Se=!0),V&&(J=fe({},Es),N=[],V.html===!0&&(fe(J,ks),fe(N,ws)),V.svg===!0&&(fe(J,Un),fe(N,Vn),fe(N,mn)),V.svgFilters===!0&&(fe(J,Bn),fe(N,Vn),fe(N,mn)),V.mathMl===!0&&(fe(J,Hn),fe(N,Ts),fe(N,mn))),m.ADD_TAGS&&(typeof m.ADD_TAGS=="function"?je.tagCheck=m.ADD_TAGS:(J===Te&&(J=At(J)),fe(J,m.ADD_TAGS,pe))),m.ADD_ATTR&&(typeof m.ADD_ATTR=="function"?je.attributeCheck=m.ADD_ATTR:(N===ee&&(N=At(N)),fe(N,m.ADD_ATTR,pe))),m.ADD_URI_SAFE_ATTR&&fe(ze,m.ADD_URI_SAFE_ATTR,pe),m.FORBID_CONTENTS&&(q===Oe&&(q=At(q)),fe(q,m.FORBID_CONTENTS,pe)),m.ADD_FORBID_CONTENTS&&(q===Oe&&(q=At(q)),fe(q,m.ADD_FORBID_CONTENTS,pe)),se&&(J["#text"]=!0),He&&fe(J,["html","head","body"]),J.table&&(fe(J,["tbody"]),delete Qe.tbody),m.TRUSTED_TYPES_POLICY){if(typeof m.TRUSTED_TYPES_POLICY.createHTML!="function")throw on('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof m.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw on('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');x=m.TRUSTED_TYPES_POLICY,z=x.createHTML("")}else x===void 0&&(x=ql(g,s)),x!==null&&typeof z=="string"&&(z=x.createHTML(""));rt&&rt(m),Re=m}},xe=fe({},[...Un,...Bn,...Bl]),Tt=fe({},[...Hn,...Hl]),Jt=function(m){let C=R(m);(!C||!C.tagName)&&(C={namespaceURI:Xe,tagName:"template"});const F=vn(m.tagName),Ue=vn(C.tagName);return Et[m.namespaceURI]?m.namespaceURI===it?C.namespaceURI===We?F==="svg":C.namespaceURI===$e?F==="svg"&&(Ue==="annotation-xml"||at[Ue]):!!xe[F]:m.namespaceURI===$e?C.namespaceURI===We?F==="math":C.namespaceURI===it?F==="math"&&Je[Ue]:!!Tt[F]:m.namespaceURI===We?C.namespaceURI===it&&!Je[Ue]||C.namespaceURI===$e&&!at[Ue]?!1:!Tt[F]&&(tn[F]||!xe[F]):!!(Ot==="application/xhtml+xml"&&Et[m.namespaceURI]):!1},ut=function(m){rn(e.removed,{element:m});try{R(m).removeChild(m)}catch{E(m)}},ft=function(m,C){try{rn(e.removed,{attribute:C.getAttributeNode(m),from:C})}catch{rn(e.removed,{attribute:null,from:C})}if(C.removeAttribute(m),m==="is")if(Se||Ee)try{ut(C)}catch{}else try{C.setAttribute(m,"")}catch{}},Vt=function(m){let C=null,F=null;if(ge)m="<remove></remove>"+m;else{const Fe=xn(m,/^[\r\n\t ]+/);F=Fe&&Fe[0]}Ot==="application/xhtml+xml"&&Xe===We&&(m='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+m+"</body></html>");const Ue=x?x.createHTML(m):m;if(Xe===We)try{C=new _().parseFromString(Ue,Ot)}catch{}if(!C||!C.documentElement){C=I.createDocument(Xe,"template",null);try{C.documentElement.innerHTML=ot?z:Ue}catch{}}const tt=C.body||C.documentElement;return m&&F&&tt.insertBefore(n.createTextNode(F),tt.childNodes[0]||null),Xe===We?O.call(C,He?"html":"body")[0]:He?C.documentElement:tt},nn=function(m){return A.call(m.ownerDocument||m,m,f.SHOW_ELEMENT|f.SHOW_COMMENT|f.SHOW_TEXT|f.SHOW_PROCESSING_INSTRUCTION|f.SHOW_CDATA_SECTION,null)},Ut=function(m){return m instanceof p&&(typeof m.nodeName!="string"||typeof m.textContent!="string"||typeof m.removeChild!="function"||!(m.attributes instanceof c)||typeof m.removeAttribute!="function"||typeof m.setAttribute!="function"||typeof m.namespaceURI!="string"||typeof m.insertBefore!="function"||typeof m.hasChildNodes!="function")},zt=function(m){return typeof a=="function"&&m instanceof a};function dt(X,m,C){pn(X,F=>{F.call(e,m,C,Re)})}const Ft=function(m){let C=null;if(dt(G.beforeSanitizeElements,m,null),Ut(m))return ut(m),!0;const F=pe(m.nodeName);if(dt(G.uponSanitizeElement,m,{tagName:F,allowedTags:J}),Le&&m.hasChildNodes()&&!zt(m.firstElementChild)&&st(/<[/\w!]/g,m.innerHTML)&&st(/<[/\w!]/g,m.textContent)||m.nodeType===cn.progressingInstruction||Le&&m.nodeType===cn.comment&&st(/<[/\w]/g,m.data))return ut(m),!0;if(!(je.tagCheck instanceof Function&&je.tagCheck(F))&&(!J[F]||Qe[F])){if(!Qe[F]&&sn(F)&&(de.tagNameCheck instanceof RegExp&&st(de.tagNameCheck,F)||de.tagNameCheck instanceof Function&&de.tagNameCheck(F)))return!1;if(se&&!q[F]){const Ue=R(m)||m.parentNode,tt=M(m)||m.childNodes;if(tt&&Ue){const Fe=tt.length;for(let ct=Fe-1;ct>=0;--ct){const Dt=w(tt[ct],!0);Dt.__removalCount=(m.__removalCount||0)+1,Ue.insertBefore(Dt,T(m))}}}return ut(m),!0}return m instanceof u&&!Jt(m)||(F==="noscript"||F==="noembed"||F==="noframes")&&st(/<\/no(script|embed|frames)/i,m.innerHTML)?(ut(m),!0):(Ke&&m.nodeType===cn.text&&(C=m.textContent,pn([B,W,U],Ue=>{C=ln(C,Ue," ")}),m.textContent!==C&&(rn(e.removed,{element:m.cloneNode()}),m.textContent=C)),dt(G.afterSanitizeElements,m,null),!1)},Gt=function(m,C,F){if(be&&(C==="id"||C==="name")&&(F in n||F in ve))return!1;if(!(Ce&&!ce[C]&&st(le,C))){if(!(Pe&&st(te,C))){if(!(je.attributeCheck instanceof Function&&je.attributeCheck(C,m))){if(!N[C]||ce[C]){if(!(sn(m)&&(de.tagNameCheck instanceof RegExp&&st(de.tagNameCheck,m)||de.tagNameCheck instanceof Function&&de.tagNameCheck(m))&&(de.attributeNameCheck instanceof RegExp&&st(de.attributeNameCheck,C)||de.attributeNameCheck instanceof Function&&de.attributeNameCheck(C,m))||C==="is"&&de.allowCustomizedBuiltInElements&&(de.tagNameCheck instanceof RegExp&&st(de.tagNameCheck,F)||de.tagNameCheck instanceof Function&&de.tagNameCheck(F))))return!1}else if(!ze[C]){if(!st(we,ln(F,ue,""))){if(!((C==="src"||C==="xlink:href"||C==="href")&&m!=="script"&&Pl(F,"data:")===0&&ye[m])){if(!(Ie&&!st(Ne,ln(F,ue,"")))){if(F)return!1}}}}}}}return!0},sn=function(m){return m!=="annotation-xml"&&xn(m,Y)},jt=function(m){dt(G.beforeSanitizeAttributes,m,null);const{attributes:C}=m;if(!C||Ut(m))return;const F={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:N,forceKeepAttr:void 0};let Ue=C.length;for(;Ue--;){const tt=C[Ue],{name:Fe,namespaceURI:ct,value:Dt}=tt,Qt=pe(Fe),Sn=Dt;let Ze=Fe==="value"?Sn:Ol(Sn);if(F.attrName=Qt,F.attrValue=Ze,F.keepAttr=!0,F.forceKeepAttr=void 0,dt(G.uponSanitizeAttribute,m,F),Ze=F.attrValue,Ae&&(Qt==="id"||Qt==="name")&&(ft(Fe,m),Ze=P+Ze),Le&&st(/((--!?|])>)|<\/(style|title|textarea)/i,Ze)){ft(Fe,m);continue}if(Qt==="attributename"&&xn(Ze,"href")){ft(Fe,m);continue}if(F.forceKeepAttr)continue;if(!F.keepAttr){ft(Fe,m);continue}if(!ke&&st(/\/>/i,Ze)){ft(Fe,m);continue}Ke&&pn([B,W,U],Qn=>{Ze=ln(Ze,Qn," ")});const Zn=pe(m.nodeName);if(!Gt(Zn,Qt,Ze)){ft(Fe,m);continue}if(x&&typeof g=="object"&&typeof g.getAttributeType=="function"&&!ct)switch(g.getAttributeType(Zn,Qt)){case"TrustedHTML":{Ze=x.createHTML(Ze);break}case"TrustedScriptURL":{Ze=x.createScriptURL(Ze);break}}if(Ze!==Sn)try{ct?m.setAttributeNS(ct,Fe,Ze):m.setAttribute(Fe,Ze),Ut(m)?ut(m):ys(e.removed)}catch{ft(Fe,m)}}dt(G.afterSanitizeAttributes,m,null)},Zt=function X(m){let C=null;const F=nn(m);for(dt(G.beforeSanitizeShadowDOM,m,null);C=F.nextNode();)dt(G.uponSanitizeShadowNode,C,null),Ft(C),jt(C),C.content instanceof l&&X(C.content);dt(G.afterSanitizeShadowDOM,m,null)};return e.sanitize=function(X){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},C=null,F=null,Ue=null,tt=null;if(ot=!X,ot&&(X="<!-->"),typeof X!="string"&&!zt(X))if(typeof X.toString=="function"){if(X=X.toString(),typeof X!="string")throw on("dirty is not a string, aborting")}else throw on("toString is not a function");if(!e.isSupported)return X;if(he||et(m),e.removed=[],typeof X=="string"&&(ie=!1),ie){if(X.nodeName){const Dt=pe(X.nodeName);if(!J[Dt]||Qe[Dt])throw on("root node is forbidden and cannot be sanitized in-place")}}else if(X instanceof a)C=Vt("<!---->"),F=C.ownerDocument.importNode(X,!0),F.nodeType===cn.element&&F.nodeName==="BODY"||F.nodeName==="HTML"?C=F:C.appendChild(F);else{if(!Se&&!Ke&&!He&&X.indexOf("<")===-1)return x&&De?x.createHTML(X):X;if(C=Vt(X),!C)return Se?null:De?z:""}C&&ge&&ut(C.firstChild);const Fe=nn(ie?X:C);for(;Ue=Fe.nextNode();)Ft(Ue),jt(Ue),Ue.content instanceof l&&Zt(Ue.content);if(ie)return X;if(Se){if(Ee)for(tt=H.call(C.ownerDocument);C.firstChild;)tt.appendChild(C.firstChild);else tt=C;return(N.shadowroot||N.shadowrootmode)&&(tt=Z.call(t,tt,!0)),tt}let ct=He?C.outerHTML:C.innerHTML;return He&&J["!doctype"]&&C.ownerDocument&&C.ownerDocument.doctype&&C.ownerDocument.doctype.name&&st(yr,C.ownerDocument.doctype.name)&&(ct="<!DOCTYPE "+C.ownerDocument.doctype.name+`>
`+ct),Ke&&pn([B,W,U],Dt=>{ct=ln(ct,Dt," ")}),x&&De?x.createHTML(ct):ct},e.setConfig=function(){let X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};et(X),he=!0},e.clearConfig=function(){Re=null,he=!1},e.isValidAttribute=function(X,m,C){Re||et({});const F=pe(X),Ue=pe(m);return Gt(F,Ue,C)},e.addHook=function(X,m){typeof m=="function"&&rn(G[X],m)},e.removeHook=function(X,m){if(m!==void 0){const C=Rl(G[X],m);return C===-1?void 0:Nl(G[X],C,1)[0]}return ys(G[X])},e.removeHooks=function(X){G[X]=[]},e.removeAllHooks=function(){G=Ms()},e}var Jl=kr();const Is="/api/proxy",Er="nostr_bbs_link_previews",Zl=10*24*60*60*1e3,Ss=100;function Ql(){try{const r=localStorage.getItem(Er);if(!r)return{};const e=JSON.parse(r),n=Date.now(),t={};for(const[s,l]of Object.entries(e)){const i=l;n-i.timestamp<Zl&&(t[s]=i)}return t}catch{return{}}}function $l(r){try{const e=Object.entries(r);e.length>Ss&&(e.sort((n,t)=>t[1].timestamp-n[1].timestamp),r=Object.fromEntries(e.slice(0,Ss))),localStorage.setItem(Er,JSON.stringify(r))}catch(e){console.warn("Failed to save link preview cache:",e)}}const Wt=dn(Ql());Wt.subscribe(r=>{$l(r)});async function ei(r){const e=Ye(Wt);if(e[r])return e[r].data;const n=new URL(r).hostname.replace(/^www\./,""),t=`https://www.google.com/s2/favicons?domain=${n}&sz=32`;try{const s=`${Is}${Is.includes("/api/proxy")?"?":"/preview?"}url=${encodeURIComponent(r)}`,l=await fetch(s,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(15e3)});if(!l.ok)throw new Error(`Proxy returned ${l.status}`);const i=await l.json();if(i.type==="twitter"){const u={url:r,domain:n,favicon:"https://abs.twimg.com/favicons/twitter.3.ico",type:"twitter",html:i.html,title:i.author_name?`Post by ${i.author_name}`:"X Post",authorName:i.author_name,authorUrl:i.author_url,siteName:i.provider_name||"X"};return Wt.update(f=>(f[r]={data:u,timestamp:Date.now()},f)),u}const a={url:i.url||r,domain:i.domain||n,favicon:i.favicon||t,title:i.title,description:i.description,image:i.image,siteName:i.siteName,type:"opengraph"};return Wt.update(u=>(u[r]={data:a,timestamp:Date.now()},u)),a}catch(s){console.warn("Failed to fetch preview for",r,s);try{const i=await fetch(r,{method:"GET",headers:{Accept:"text/html"},signal:AbortSignal.timeout(5e3)});if(i.ok){const a=await i.text(),u=ti(a,r);return u.type="opengraph",Wt.update(f=>(f[r]={data:u,timestamp:Date.now()},f)),u}}catch{}const l={url:r,domain:n,favicon:t,error:!0};return Wt.update(i=>(i[r]={data:l,timestamp:Date.now()},i)),l}}function ti(r,e){const n=new URL(e).hostname.replace(/^www\./,""),t=`https://www.google.com/s2/favicons?domain=${n}&sz=32`,s={url:e,domain:n,favicon:t},l=r.match(/<meta\s+property=["']og:title["']\s+content=["']([^"']+)["']/i);if(l&&(s.title=un(l[1])),!s.title){const f=r.match(/<title>([^<]+)<\/title>/i);f&&(s.title=un(f[1]))}const i=r.match(/<meta\s+property=["']og:description["']\s+content=["']([^"']+)["']/i);if(i&&(s.description=un(i[1])),!s.description){const f=r.match(/<meta\s+name=["']description["']\s+content=["']([^"']+)["']/i);f&&(s.description=un(f[1]))}const a=r.match(/<meta\s+property=["']og:image["']\s+content=["']([^"']+)["']/i);a&&(s.image=ni(a[1],e));const u=r.match(/<meta\s+property=["']og:site_name["']\s+content=["']([^"']+)["']/i);return u&&(s.siteName=un(u[1])),s}function un(r){const e={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&apos;":"'","&nbsp;":" ","&copy;":"©","&reg;":"®","&trade;":"™","&mdash;":"—","&ndash;":"–","&hellip;":"…","&lsquo;":"‘","&rsquo;":"’","&ldquo;":"“","&rdquo;":"”"};let n=r;for(const[t,s]of Object.entries(e))n=n.replace(new RegExp(t,"gi"),s);return n=n.replace(/&#(\d+);/g,(t,s)=>{const l=parseInt(s,10);return l>0&&l<1114111?String.fromCodePoint(l):""}),n=n.replace(/&#x([0-9a-fA-F]+);/g,(t,s)=>{const l=parseInt(s,16);return l>0&&l<1114111?String.fromCodePoint(l):""}),n}function ni(r,e){try{return new URL(r,e).href}catch{return r}}function si(r){return Ye(Wt)[r]?.data||null}function ri(r){let e,n,t,s,l,i,a=(r[1].siteName||r[1].domain)+"",u,f,c,p=r[1].title+"",_,g,k,w,E,T,M,R=r[1].image&&Cs(r),x=r[1].favicon&&Ds(r),z=r[1].description&&Ls(r);return{c(){e=y("div"),R&&R.c(),n=L(),t=y("div"),s=y("div"),x&&x.c(),l=L(),i=y("span"),u=$(a),f=L(),c=y("h4"),_=$(p),g=L(),z&&z.c(),k=L(),w=K("svg"),E=K("path"),T=K("polyline"),M=K("line"),this.h()},l(I){e=b(I,"DIV",{class:!0});var A=v(e);R&&R.l(A),n=D(A),t=b(A,"DIV",{class:!0});var H=v(t);s=b(H,"DIV",{class:!0});var O=v(s);x&&x.l(O),l=D(O),i=b(O,"SPAN",{class:!0});var Z=v(i);u=Q(Z,a),Z.forEach(h),O.forEach(h),f=D(H),c=b(H,"H4",{class:!0});var G=v(c);_=Q(G,p),G.forEach(h),g=D(H),z&&z.l(H),H.forEach(h),k=D(A),w=j(A,"svg",{class:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var B=v(w);E=j(B,"path",{d:!0}),v(E).forEach(h),T=j(B,"polyline",{points:!0}),v(T).forEach(h),M=j(B,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(M).forEach(h),B.forEach(h),A.forEach(h),this.h()},h(){o(i,"class","domain svelte-1padtbd"),o(s,"class","preview-header svelte-1padtbd"),o(c,"class","preview-title svelte-1padtbd"),o(t,"class","preview-content svelte-1padtbd"),o(E,"d","M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"),o(T,"points","15 3 21 3 21 9"),o(M,"x1","10"),o(M,"y1","14"),o(M,"x2","21"),o(M,"y2","3"),o(w,"class","external-icon svelte-1padtbd"),o(w,"viewBox","0 0 24 24"),o(w,"fill","none"),o(w,"stroke","currentColor"),o(w,"stroke-width","2"),o(e,"class","preview-card svelte-1padtbd")},m(I,A){S(I,e,A),R&&R.m(e,null),d(e,n),d(e,t),d(t,s),x&&x.m(s,null),d(s,l),d(s,i),d(i,u),d(t,f),d(t,c),d(c,_),d(t,g),z&&z.m(t,null),d(e,k),d(e,w),d(w,E),d(w,T),d(w,M)},p(I,A){I[1].image?R?R.p(I,A):(R=Cs(I),R.c(),R.m(e,n)):R&&(R.d(1),R=null),I[1].favicon?x?x.p(I,A):(x=Ds(I),x.c(),x.m(s,l)):x&&(x.d(1),x=null),A&2&&a!==(a=(I[1].siteName||I[1].domain)+"")&&me(u,a),A&2&&p!==(p=I[1].title+"")&&me(_,p),I[1].description?z?z.p(I,A):(z=Ls(I),z.c(),z.m(t,null)):z&&(z.d(1),z=null)},d(I){I&&h(e),R&&R.d(),x&&x.d(),z&&z.d()}}}function li(r){let e,n,t,s,l=(r[1]?.domain||jn(r[0]))+"",i,a,u,f,c,p,_,g,k,w=r[1]?.favicon&&Rs(r);return{c(){e=y("div"),w&&w.c(),n=L(),t=y("div"),s=y("div"),i=$(l),a=L(),u=y("div"),f=$(r[0]),c=L(),p=K("svg"),_=K("path"),g=K("polyline"),k=K("line"),this.h()},l(E){e=b(E,"DIV",{class:!0});var T=v(e);w&&w.l(T),n=D(T),t=b(T,"DIV",{class:!0});var M=v(t);s=b(M,"DIV",{class:!0});var R=v(s);i=Q(R,l),R.forEach(h),a=D(M),u=b(M,"DIV",{class:!0,title:!0});var x=v(u);f=Q(x,r[0]),x.forEach(h),M.forEach(h),c=D(T),p=j(T,"svg",{class:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var z=v(p);_=j(z,"path",{d:!0}),v(_).forEach(h),g=j(z,"polyline",{points:!0}),v(g).forEach(h),k=j(z,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(k).forEach(h),z.forEach(h),T.forEach(h),this.h()},h(){o(s,"class","domain svelte-1padtbd"),o(u,"class","url svelte-1padtbd"),o(u,"title",r[0]),o(t,"class","link-text svelte-1padtbd"),o(_,"d","M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"),o(g,"points","15 3 21 3 21 9"),o(k,"x1","10"),o(k,"y1","14"),o(k,"x2","21"),o(k,"y2","3"),o(p,"class","external-icon svelte-1padtbd"),o(p,"viewBox","0 0 24 24"),o(p,"fill","none"),o(p,"stroke","currentColor"),o(p,"stroke-width","2"),o(e,"class","preview-minimal svelte-1padtbd")},m(E,T){S(E,e,T),w&&w.m(e,null),d(e,n),d(e,t),d(t,s),d(s,i),d(t,a),d(t,u),d(u,f),d(e,c),d(e,p),d(p,_),d(p,g),d(p,k)},p(E,T){E[1]?.favicon?w?w.p(E,T):(w=Rs(E),w.c(),w.m(e,n)):w&&(w.d(1),w=null),T&3&&l!==(l=(E[1]?.domain||jn(E[0]))+"")&&me(i,l),T&1&&me(f,E[0]),T&1&&o(u,"title",E[0])},d(E){E&&h(e),w&&w.d()}}}function ii(r){let e,n="",t,s;return{c(){e=y("div"),e.innerHTML=n,this.h()},l(l){e=b(l,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-fc4hww"&&(e.innerHTML=n),this.h()},h(){o(e,"class","twitter-embed svelte-1padtbd")},m(l,i){S(l,e,i),r[9](e),t||(s=[oe(e,"click",gn(r[7])),oe(e,"keydown",gn(r[8]))],t=!0)},p:ne,d(l){l&&h(e),r[9](null),t=!1,St(s)}}}function oi(r){let e,n='<div class="skeleton-image svelte-1padtbd"></div> <div class="skeleton-content svelte-1padtbd"><div class="skeleton-title svelte-1padtbd"></div> <div class="skeleton-description svelte-1padtbd"></div> <div class="skeleton-domain svelte-1padtbd"></div></div>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-ywu8x8"&&(e.innerHTML=n),this.h()},h(){o(e,"class","preview-skeleton svelte-1padtbd")},m(t,s){S(t,e,s)},p:ne,d(t){t&&h(e)}}}function Cs(r){let e,n,t,s;return{c(){e=y("div"),n=y("img"),this.h()},l(l){e=b(l,"DIV",{class:!0});var i=v(e);n=b(i,"IMG",{src:!0,alt:!0,class:!0,loading:!0}),i.forEach(h),this.h()},h(){Ge(n.src,t=r[1].image)||o(n,"src",t),o(n,"alt",s=r[1].title||""),o(n,"class","preview-image svelte-1padtbd"),o(n,"loading","lazy"),o(e,"class","preview-image-container svelte-1padtbd")},m(l,i){S(l,e,i),d(e,n)},p(l,i){i&2&&!Ge(n.src,t=l[1].image)&&o(n,"src",t),i&2&&s!==(s=l[1].title||"")&&o(n,"alt",s)},d(l){l&&h(e)}}}function Ds(r){let e,n;return{c(){e=y("img"),this.h()},l(t){e=b(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Ge(e.src,n=r[1].favicon)||o(e,"src",n),o(e,"alt",""),o(e,"class","favicon svelte-1padtbd")},m(t,s){S(t,e,s)},p(t,s){s&2&&!Ge(e.src,n=t[1].favicon)&&o(e,"src",n)},d(t){t&&h(e)}}}function Ls(r){let e,n=r[1].description+"",t;return{c(){e=y("p"),t=$(n),this.h()},l(s){e=b(s,"P",{class:!0});var l=v(e);t=Q(l,n),l.forEach(h),this.h()},h(){o(e,"class","preview-description svelte-1padtbd")},m(s,l){S(s,e,l),d(e,t)},p(s,l){l&2&&n!==(n=s[1].description+"")&&me(t,n)},d(s){s&&h(e)}}}function Rs(r){let e,n;return{c(){e=y("img"),this.h()},l(t){e=b(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Ge(e.src,n=r[1].favicon)||o(e,"src",n),o(e,"alt",""),o(e,"class","favicon svelte-1padtbd")},m(t,s){S(t,e,s)},p(t,s){s&2&&!Ge(e.src,n=t[1].favicon)&&o(e,"src",n)},d(t){t&&h(e)}}}function ai(r){let e,n,t;function s(a,u){return a[2]?oi:a[1]?.type==="twitter"&&a[1].html?ii:a[3]||!a[1]?.title?li:ri}let l=s(r),i=l(r);return{c(){e=y("div"),i.c(),this.h()},l(a){e=b(a,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0});var u=v(e);i.l(u),u.forEach(h),this.h()},h(){o(e,"class","link-preview svelte-1padtbd"),o(e,"role","button"),o(e,"tabindex","0"),o(e,"aria-label","Open link in new tab")},m(a,u){S(a,e,u),i.m(e,null),r[10](e),n||(t=[oe(e,"click",r[6]),oe(e,"keydown",r[11])],n=!0)},p(a,[u]){l===(l=s(a))&&i?i.p(a,u):(i.d(1),i=l(a),i&&(i.c(),i.m(e,null)))},i:ne,o:ne,d(a){a&&h(e),i.d(),r[10](null),n=!1,St(t)}}}function ci(){if(typeof window<"u"&&!window.twttr){const r=document.createElement("script");r.src="https://platform.twitter.com/widgets.js",r.async=!0,r.charset="utf-8",document.head.appendChild(r)}}function ui(r,e,n){let{url:t}=e,s=null,l=!0,i=!1,a,u=!1,f;function c(){if(s?.type==="twitter"&&s.html&&f){const M=Jl.sanitize(s.html,{ALLOWED_TAGS:["blockquote","a","p","br","script"],ALLOWED_ATTR:["class","href","data-*"],FORCE_BODY:!1,KEEP_CONTENT:!0});if(n(5,f.innerHTML=M,f),typeof window<"u"){const R=window.twttr;R?.widgets?.load&&R.widgets.load(f)}}}Tr(()=>{s?.type==="twitter"&&s.html&&(ci(),c())}),Mn(()=>{const M=new IntersectionObserver(R=>{R.forEach(x=>{x.isIntersecting&&!u&&(u=!0,p())})},{rootMargin:"100px"});return M.observe(a),()=>{M.disconnect()}});async function p(){const M=si(t);if(M){n(1,s=M),n(2,l=!1),n(3,i=M.error||!1);return}try{n(1,s=await ei(t)),n(3,i=s.error||!1)}catch(R){console.error("Failed to load preview:",R),n(3,i=!0),n(1,s={url:t,domain:jn(t),favicon:wl(t),error:!0})}finally{n(2,l=!1)}}function _(){window.open(t,"_blank","noopener,noreferrer")}function g(M){Fn.call(this,r,M)}function k(M){Fn.call(this,r,M)}function w(M){fn[M?"unshift":"push"](()=>{f=M,n(5,f)})}function E(M){fn[M?"unshift":"push"](()=>{a=M,n(4,a)})}const T=M=>(M.key==="Enter"||M.key===" ")&&(M.preventDefault(),_());return r.$$set=M=>{"url"in M&&n(0,t=M.url)},[t,s,l,i,a,f,_,g,k,w,E,T]}class fi extends Nt{constructor(e){super(),Pt(this,e,ui,ai,Rt,{url:0})}}function di(r){let e,n,t,s,l,i;function a(g,k){return g[8]?mi:vi}let u=a(r),f=u(r);function c(g,k){return g[6]?yi:bi}let p=c(r),_=p(r);return{c(){e=y("div"),f.c(),n=L(),t=y("button"),_.c(),this.h()},l(g){e=b(g,"DIV",{class:!0});var k=v(e);f.l(k),n=D(k),t=b(k,"BUTTON",{class:!0,title:!0});var w=v(t);_.l(w),w.forEach(h),k.forEach(h),this.h()},h(){o(t,"class","expand-button svelte-19422hk"),o(t,"title",s=r[6]?"Collapse":"Expand"),o(e,"class","youtube-container svelte-19422hk"),It(e,"expanded",r[6])},m(g,k){S(g,e,k),f.m(e,null),d(e,n),d(e,t),_.m(t,null),l||(i=oe(t,"click",r[11]),l=!0)},p(g,k){u===(u=a(g))&&f?f.p(g,k):(f.d(1),f=u(g),f&&(f.c(),f.m(e,n))),p!==(p=c(g))&&(_.d(1),_=p(g),_&&(_.c(),_.m(t,null))),k&64&&s!==(s=g[6]?"Collapse":"Expand")&&o(t,"title",s),k&64&&It(e,"expanded",g[6])},d(g){g&&h(e),f.d(),_.d(),l=!1,i()}}}function hi(r){let e,n,t,s,l,i;function a(g,k){return g[1]?Ei:ki}let u=a(r),f=u(r);function c(g,k){return g[6]?Ti:wi}let p=c(r),_=p(r);return{c(){e=y("div"),f.c(),n=L(),t=y("button"),_.c(),this.h()},l(g){e=b(g,"DIV",{class:!0});var k=v(e);f.l(k),n=D(k),t=b(k,"BUTTON",{class:!0,title:!0});var w=v(t);_.l(w),w.forEach(h),k.forEach(h),this.h()},h(){o(t,"class","expand-button svelte-19422hk"),o(t,"title",s=r[6]?"Collapse":"Expand"),o(e,"class","video-container svelte-19422hk"),It(e,"expanded",r[6])},m(g,k){S(g,e,k),f.m(e,null),d(e,n),d(e,t),_.m(t,null),l||(i=oe(t,"click",r[11]),l=!0)},p(g,k){u===(u=a(g))&&f?f.p(g,k):(f.d(1),f=u(g),f&&(f.c(),f.m(e,n))),p!==(p=c(g))&&(_.d(1),_=p(g),_&&(_.c(),_.m(t,null))),k&64&&s!==(s=g[6]?"Collapse":"Expand")&&o(t,"title",s),k&64&&It(e,"expanded",g[6])},d(g){g&&h(e),f.d(),_.d(),l=!1,i()}}}function pi(r){let e,n,t,s,l,i,a,u;function f(E,T){return E[1]?Mi:Ai}let c=f(r),p=c(r);function _(E,T){return E[6]?Ni:Ri}let g=_(r),k=g(r),w=r[2]&&r[10]&&Ps(r);return{c(){e=y("div"),p.c(),n=L(),t=y("button"),k.c(),l=L(),w&&w.c(),i=Be(),this.h()},l(E){e=b(E,"DIV",{class:!0});var T=v(e);p.l(T),n=D(T),t=b(T,"BUTTON",{class:!0,title:!0});var M=v(t);k.l(M),M.forEach(h),T.forEach(h),l=D(E),w&&w.l(E),i=Be(),this.h()},h(){o(t,"class","expand-button svelte-19422hk"),o(t,"title",s=r[6]?"Collapse":"Expand"),o(e,"class","image-container svelte-19422hk"),It(e,"expanded",r[6])},m(E,T){S(E,e,T),p.m(e,null),d(e,n),d(e,t),k.m(t,null),S(E,l,T),w&&w.m(E,T),S(E,i,T),a||(u=oe(t,"click",r[11]),a=!0)},p(E,T){c===(c=f(E))&&p?p.p(E,T):(p.d(1),p=c(E),p&&(p.c(),p.m(e,n))),g!==(g=_(E))&&(k.d(1),k=g(E),k&&(k.c(),k.m(t,null))),T&64&&s!==(s=E[6]?"Collapse":"Expand")&&o(t,"title",s),T&64&&It(e,"expanded",E[6]),E[2]&&E[10]?w?w.p(E,T):(w=Ps(E),w.c(),w.m(i.parentNode,i)):w&&(w.d(1),w=null)},d(E){E&&(h(e),h(l),h(i)),p.d(),k.d(),w&&w.d(E),a=!1,u()}}}function mi(r){let e,n;return{c(){e=y("iframe"),this.h()},l(t){e=b(t,"IFRAME",{src:!0,title:!0,frameborder:!0,allow:!0,class:!0}),v(e).forEach(h),this.h()},h(){Ge(e.src,n=`https://www.youtube-nocookie.com/embed/${r[0].youtubeId}?autoplay=1`)||o(e,"src",n),o(e,"title","YouTube video player"),o(e,"frameborder","0"),o(e,"allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"),e.allowFullscreen=!0,o(e,"class","youtube-iframe svelte-19422hk")},m(t,s){S(t,e,s)},p(t,s){s&1&&!Ge(e.src,n=`https://www.youtube-nocookie.com/embed/${t[0].youtubeId}?autoplay=1`)&&o(e,"src",n)},d(t){t&&h(e)}}}function vi(r){let e,n,t,s='<svg viewBox="0 0 68 48" fill="currentColor"><path d="M66.52,7.74c-0.78-2.93-2.49-5.41-5.42-6.19C55.79,.13,34,0,34,0S12.21,.13,6.9,1.55 C3.97,2.33,2.27,4.81,1.48,7.74C0.06,13.05,0,24,0,24s0.06,10.95,1.48,16.26c0.78,2.93,2.49,5.41,5.42,6.19 C12.21,47.87,34,48,34,48s21.79-0.13,27.1-1.55c2.93-0.78,4.64-3.26,5.42-6.19C67.94,34.95,68,24,68,24S67.94,13.05,66.52,7.74z" fill="#f00"></path><path d="M 45,24 27,14 27,34" fill="#fff"></path></svg>',l,i;function a(c,p){return c[1]?gi:_i}let u=a(r),f=u(r);return{c(){e=y("button"),f.c(),n=L(),t=y("div"),t.innerHTML=s,this.h()},l(c){e=b(c,"BUTTON",{class:!0});var p=v(e);f.l(p),n=D(p),t=b(p,"DIV",{class:!0,"data-svelte-h":!0}),re(t)!=="svelte-pjh3rm"&&(t.innerHTML=s),p.forEach(h),this.h()},h(){o(t,"class","youtube-play-button svelte-19422hk"),o(e,"class","youtube-preview svelte-19422hk")},m(c,p){S(c,e,p),f.m(e,null),d(e,n),d(e,t),l||(i=oe(e,"click",r[14]),l=!0)},p(c,p){u===(u=a(c))&&f?f.p(c,p):(f.d(1),f=u(c),f&&(f.c(),f.m(e,n)))},d(c){c&&h(e),f.d(),l=!1,i()}}}function _i(r){let e,n='<svg viewBox="0 0 24 24" fill="currentColor" class="svelte-19422hk"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"></path></svg>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-s8oytu"&&(e.innerHTML=n),this.h()},h(){o(e,"class","media-placeholder svelte-19422hk")},m(t,s){S(t,e,s)},p:ne,d(t){t&&h(e)}}}function gi(r){let e,n;return{c(){e=y("img"),this.h()},l(t){e=b(t,"IMG",{src:!0,alt:!0,class:!0,loading:!0}),this.h()},h(){Ge(e.src,n=`https://i.ytimg.com/vi/${r[0].youtubeId}/hqdefault.jpg`)||o(e,"src",n),o(e,"alt","YouTube video thumbnail"),o(e,"class","youtube-thumbnail svelte-19422hk"),o(e,"loading","lazy")},m(t,s){S(t,e,s)},p(t,s){s&1&&!Ge(e.src,n=`https://i.ytimg.com/vi/${t[0].youtubeId}/hqdefault.jpg`)&&o(e,"src",n)},d(t){t&&h(e)}}}function bi(r){let e,n,t,s,l;return{c(){e=K("svg"),n=K("polyline"),t=K("polyline"),s=K("line"),l=K("line"),this.h()},l(i){e=j(i,"svg",{viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0});var a=v(e);n=j(a,"polyline",{points:!0}),v(n).forEach(h),t=j(a,"polyline",{points:!0}),v(t).forEach(h),s=j(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(s).forEach(h),l=j(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(l).forEach(h),a.forEach(h),this.h()},h(){o(n,"points","15 3 21 3 21 9"),o(t,"points","9 21 3 21 3 15"),o(s,"x1","21"),o(s,"y1","3"),o(s,"x2","14"),o(s,"y2","10"),o(l,"x1","3"),o(l,"y1","21"),o(l,"x2","10"),o(l,"y2","14"),o(e,"viewBox","0 0 24 24"),o(e,"fill","none"),o(e,"stroke","currentColor"),o(e,"stroke-width","2"),o(e,"class","svelte-19422hk")},m(i,a){S(i,e,a),d(e,n),d(e,t),d(e,s),d(e,l)},d(i){i&&h(e)}}}function yi(r){let e,n,t,s,l;return{c(){e=K("svg"),n=K("polyline"),t=K("polyline"),s=K("line"),l=K("line"),this.h()},l(i){e=j(i,"svg",{viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0});var a=v(e);n=j(a,"polyline",{points:!0}),v(n).forEach(h),t=j(a,"polyline",{points:!0}),v(t).forEach(h),s=j(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(s).forEach(h),l=j(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(l).forEach(h),a.forEach(h),this.h()},h(){o(n,"points","4 14 10 14 10 20"),o(t,"points","20 10 14 10 14 4"),o(s,"x1","14"),o(s,"y1","10"),o(s,"x2","21"),o(s,"y2","3"),o(l,"x1","3"),o(l,"y1","21"),o(l,"x2","10"),o(l,"y2","14"),o(e,"viewBox","0 0 24 24"),o(e,"fill","none"),o(e,"stroke","currentColor"),o(e,"stroke-width","2"),o(e,"class","svelte-19422hk")},m(i,a){S(i,e,a),d(e,n),d(e,t),d(e,s),d(e,l)},d(i){i&&h(e)}}}function ki(r){let e,n='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-19422hk"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg> <span class="svelte-19422hk">Video</span>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-1eb7tkd"&&(e.innerHTML=n),this.h()},h(){o(e,"class","media-placeholder svelte-19422hk")},m(t,s){S(t,e,s)},p:ne,d(t){t&&h(e)}}}function Ei(r){let e,n,t,s,l,i;return{c(){e=y("video"),n=y("track"),t=$(`
					Your browser does not support the video tag.`),this.h()},l(a){e=b(a,"VIDEO",{src:!0,preload:!0,class:!0});var u=v(e);n=b(u,"TRACK",{kind:!0}),t=Q(u,`
					Your browser does not support the video tag.`),u.forEach(h),this.h()},h(){o(n,"kind","captions"),Ge(e.src,s=r[0].url)||o(e,"src",s),e.controls=!0,o(e,"preload","metadata"),o(e,"class","embedded-video svelte-19422hk")},m(a,u){S(a,e,u),d(e,n),d(e,t),l||(i=[oe(e,"play",r[20]),oe(e,"pause",r[21])],l=!0)},p(a,u){u&1&&!Ge(e.src,s=a[0].url)&&o(e,"src",s)},d(a){a&&h(e),l=!1,St(i)}}}function wi(r){let e,n,t,s,l;return{c(){e=K("svg"),n=K("polyline"),t=K("polyline"),s=K("line"),l=K("line"),this.h()},l(i){e=j(i,"svg",{viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0});var a=v(e);n=j(a,"polyline",{points:!0}),v(n).forEach(h),t=j(a,"polyline",{points:!0}),v(t).forEach(h),s=j(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(s).forEach(h),l=j(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(l).forEach(h),a.forEach(h),this.h()},h(){o(n,"points","15 3 21 3 21 9"),o(t,"points","9 21 3 21 3 15"),o(s,"x1","21"),o(s,"y1","3"),o(s,"x2","14"),o(s,"y2","10"),o(l,"x1","3"),o(l,"y1","21"),o(l,"x2","10"),o(l,"y2","14"),o(e,"viewBox","0 0 24 24"),o(e,"fill","none"),o(e,"stroke","currentColor"),o(e,"stroke-width","2"),o(e,"class","svelte-19422hk")},m(i,a){S(i,e,a),d(e,n),d(e,t),d(e,s),d(e,l)},d(i){i&&h(e)}}}function Ti(r){let e,n,t,s,l;return{c(){e=K("svg"),n=K("polyline"),t=K("polyline"),s=K("line"),l=K("line"),this.h()},l(i){e=j(i,"svg",{viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0});var a=v(e);n=j(a,"polyline",{points:!0}),v(n).forEach(h),t=j(a,"polyline",{points:!0}),v(t).forEach(h),s=j(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(s).forEach(h),l=j(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(l).forEach(h),a.forEach(h),this.h()},h(){o(n,"points","4 14 10 14 10 20"),o(t,"points","20 10 14 10 14 4"),o(s,"x1","14"),o(s,"y1","10"),o(s,"x2","21"),o(s,"y2","3"),o(l,"x1","3"),o(l,"y1","21"),o(l,"x2","10"),o(l,"y2","14"),o(e,"viewBox","0 0 24 24"),o(e,"fill","none"),o(e,"stroke","currentColor"),o(e,"stroke-width","2"),o(e,"class","svelte-19422hk")},m(i,a){S(i,e,a),d(e,n),d(e,t),d(e,s),d(e,l)},d(i){i&&h(e)}}}function Ai(r){let e,n,t,s,l,i,a,u=r[4]?"Encrypted image":"Image",f;return{c(){e=y("div"),n=K("svg"),t=K("rect"),s=K("circle"),l=K("polyline"),i=L(),a=y("span"),f=$(u),this.h()},l(c){e=b(c,"DIV",{class:!0});var p=v(e);n=j(p,"svg",{viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0});var _=v(n);t=j(_,"rect",{x:!0,y:!0,width:!0,height:!0,rx:!0,ry:!0}),v(t).forEach(h),s=j(_,"circle",{cx:!0,cy:!0,r:!0}),v(s).forEach(h),l=j(_,"polyline",{points:!0}),v(l).forEach(h),_.forEach(h),i=D(p),a=b(p,"SPAN",{class:!0});var g=v(a);f=Q(g,u),g.forEach(h),p.forEach(h),this.h()},h(){o(t,"x","3"),o(t,"y","3"),o(t,"width","18"),o(t,"height","18"),o(t,"rx","2"),o(t,"ry","2"),o(s,"cx","8.5"),o(s,"cy","8.5"),o(s,"r","1.5"),o(l,"points","21 15 16 10 5 21"),o(n,"viewBox","0 0 24 24"),o(n,"fill","none"),o(n,"stroke","currentColor"),o(n,"stroke-width","2"),o(n,"class","svelte-19422hk"),o(a,"class","svelte-19422hk"),o(e,"class","media-placeholder svelte-19422hk")},m(c,p){S(c,e,p),d(e,n),d(n,t),d(n,s),d(n,l),d(e,i),d(e,a),d(a,f)},p(c,p){p&16&&u!==(u=c[4]?"Encrypted image":"Image")&&me(f,u)},d(c){c&&h(e)}}}function Mi(r){let e;function n(l,i){return l[4]&&l[3]?Li:l[4]&&l[9]?Di:l[4]&&!l[10]?Ci:l[10]?Si:Ii}let t=n(r),s=t(r);return{c(){s.c(),e=Be()},l(l){s.l(l),e=Be()},m(l,i){s.m(l,i),S(l,e,i)},p(l,i){t===(t=n(l))&&s?s.p(l,i):(s.d(1),s=t(l),s&&(s.c(),s.m(e.parentNode,e)))},d(l){l&&h(e),s.d(l)}}}function Ii(r){let e,n,t,s;return{c(){e=y("img"),this.h()},l(l){e=b(l,"IMG",{src:!0,alt:!0,class:!0,loading:!0,role:!0,tabindex:!0,"aria-label":!0}),this.h()},h(){Ge(e.src,n=r[0].url)||o(e,"src",n),o(e,"alt","Embedded image"),o(e,"class","embedded-image svelte-19422hk"),o(e,"loading","lazy"),o(e,"role","button"),o(e,"tabindex","0"),o(e,"aria-label","View image in lightbox")},m(l,i){S(l,e,i),t||(s=[oe(e,"click",r[12]),oe(e,"keydown",r[18])],t=!0)},p(l,i){i&1&&!Ge(e.src,n=l[0].url)&&o(e,"src",n)},d(l){l&&h(e),t=!1,St(s)}}}function Si(r){let e,n,t,s,l,i,a=r[4]&&Ns();return{c(){e=y("img"),t=L(),a&&a.c(),s=Be(),this.h()},l(u){e=b(u,"IMG",{src:!0,alt:!0,class:!0,loading:!0,role:!0,tabindex:!0,"aria-label":!0}),t=D(u),a&&a.l(u),s=Be(),this.h()},h(){Ge(e.src,n=r[10])||o(e,"src",n),o(e,"alt","Embedded image"),o(e,"class","embedded-image svelte-19422hk"),o(e,"loading","lazy"),o(e,"role","button"),o(e,"tabindex","0"),o(e,"aria-label","View image in lightbox")},m(u,f){S(u,e,f),S(u,t,f),a&&a.m(u,f),S(u,s,f),l||(i=[oe(e,"click",r[12]),oe(e,"keydown",r[17])],l=!0)},p(u,f){f&1024&&!Ge(e.src,n=u[10])&&o(e,"src",n),u[4]?a||(a=Ns(),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null)},d(u){u&&(h(e),h(t),h(s)),a&&a.d(u),l=!1,St(i)}}}function Ci(r){let e,n='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-19422hk"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg> <span class="svelte-19422hk">Encrypted image</span>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-dtdjvy"&&(e.innerHTML=n),this.h()},h(){o(e,"class","media-placeholder encrypted svelte-19422hk")},m(t,s){S(t,e,s)},p:ne,d(t){t&&h(e)}}}function Di(r){let e,n,t,s,l,i,a,u="Cannot decrypt",f,c,p;return{c(){e=y("div"),n=K("svg"),t=K("rect"),s=K("path"),l=K("line"),i=L(),a=y("span"),a.textContent=u,f=L(),c=y("span"),p=$(r[9]),this.h()},l(_){e=b(_,"DIV",{class:!0});var g=v(e);n=j(g,"svg",{viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0});var k=v(n);t=j(k,"rect",{x:!0,y:!0,width:!0,height:!0,rx:!0,ry:!0}),v(t).forEach(h),s=j(k,"path",{d:!0}),v(s).forEach(h),l=j(k,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(l).forEach(h),k.forEach(h),i=D(g),a=b(g,"SPAN",{class:!0,"data-svelte-h":!0}),re(a)!=="svelte-1c1d6ns"&&(a.textContent=u),f=D(g),c=b(g,"SPAN",{class:!0});var w=v(c);p=Q(w,r[9]),w.forEach(h),g.forEach(h),this.h()},h(){o(t,"x","3"),o(t,"y","11"),o(t,"width","18"),o(t,"height","11"),o(t,"rx","2"),o(t,"ry","2"),o(s,"d","M7 11V7a5 5 0 0 1 10 0v4"),o(l,"x1","12"),o(l,"y1","15"),o(l,"x2","12"),o(l,"y2","17"),o(n,"viewBox","0 0 24 24"),o(n,"fill","none"),o(n,"stroke","currentColor"),o(n,"stroke-width","2"),o(n,"class","svelte-19422hk"),o(a,"class","svelte-19422hk"),o(c,"class","error-detail svelte-19422hk"),o(e,"class","media-placeholder error svelte-19422hk")},m(_,g){S(_,e,g),d(e,n),d(n,t),d(n,s),d(n,l),d(e,i),d(e,a),d(e,f),d(e,c),d(c,p)},p(_,g){g&512&&me(p,_[9])},d(_){_&&h(e)}}}function Li(r){let e,n='<svg class="spinner svelte-19422hk" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10" opacity="0.25"></circle><path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round"></path></svg> <span class="svelte-19422hk">Decrypting...</span>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-anar6u"&&(e.innerHTML=n),this.h()},h(){o(e,"class","media-placeholder decrypting svelte-19422hk")},m(t,s){S(t,e,s)},p:ne,d(t){t&&h(e)}}}function Ns(r){let e,n='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-19422hk"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,title:!0,"data-svelte-h":!0}),re(e)!=="svelte-1y7j6n3"&&(e.innerHTML=n),this.h()},h(){o(e,"class","encrypted-badge svelte-19422hk"),o(e,"title","End-to-end encrypted")},m(t,s){S(t,e,s)},d(t){t&&h(e)}}}function Ri(r){let e,n,t,s,l;return{c(){e=K("svg"),n=K("polyline"),t=K("polyline"),s=K("line"),l=K("line"),this.h()},l(i){e=j(i,"svg",{viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0});var a=v(e);n=j(a,"polyline",{points:!0}),v(n).forEach(h),t=j(a,"polyline",{points:!0}),v(t).forEach(h),s=j(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(s).forEach(h),l=j(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(l).forEach(h),a.forEach(h),this.h()},h(){o(n,"points","15 3 21 3 21 9"),o(t,"points","9 21 3 21 3 15"),o(s,"x1","21"),o(s,"y1","3"),o(s,"x2","14"),o(s,"y2","10"),o(l,"x1","3"),o(l,"y1","21"),o(l,"x2","10"),o(l,"y2","14"),o(e,"viewBox","0 0 24 24"),o(e,"fill","none"),o(e,"stroke","currentColor"),o(e,"stroke-width","2"),o(e,"class","svelte-19422hk")},m(i,a){S(i,e,a),d(e,n),d(e,t),d(e,s),d(e,l)},d(i){i&&h(e)}}}function Ni(r){let e,n,t,s,l;return{c(){e=K("svg"),n=K("polyline"),t=K("polyline"),s=K("line"),l=K("line"),this.h()},l(i){e=j(i,"svg",{viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0});var a=v(e);n=j(a,"polyline",{points:!0}),v(n).forEach(h),t=j(a,"polyline",{points:!0}),v(t).forEach(h),s=j(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(s).forEach(h),l=j(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(l).forEach(h),a.forEach(h),this.h()},h(){o(n,"points","4 14 10 14 10 20"),o(t,"points","20 10 14 10 14 4"),o(s,"x1","14"),o(s,"y1","10"),o(s,"x2","21"),o(s,"y2","3"),o(l,"x1","3"),o(l,"y1","21"),o(l,"x2","10"),o(l,"y2","14"),o(e,"viewBox","0 0 24 24"),o(e,"fill","none"),o(e,"stroke","currentColor"),o(e,"stroke-width","2"),o(e,"class","svelte-19422hk")},m(i,a){S(i,e,a),d(e,n),d(e,t),d(e,s),d(e,l)},d(i){i&&h(e)}}}function Ps(r){let e,n,t='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-19422hk"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',s,l,i,a,u,f,c=r[4]&&Os();return{c(){e=y("div"),n=y("button"),n.innerHTML=t,s=L(),l=y("img"),a=L(),c&&c.c(),this.h()},l(p){e=b(p,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0});var _=v(e);n=b(_,"BUTTON",{class:!0,"data-svelte-h":!0}),re(n)!=="svelte-1kciqcd"&&(n.innerHTML=t),s=D(_),l=b(_,"IMG",{src:!0,alt:!0,class:!0}),a=D(_),c&&c.l(_),_.forEach(h),this.h()},h(){o(n,"class","lightbox-close svelte-19422hk"),Ge(l.src,i=r[10])||o(l,"src",i),o(l,"alt","Full size image"),o(l,"class","lightbox-image svelte-19422hk"),o(e,"class","lightbox svelte-19422hk"),o(e,"role","button"),o(e,"tabindex","0"),o(e,"aria-label","Close lightbox")},m(p,_){S(p,e,_),d(e,n),d(e,s),d(e,l),d(e,a),c&&c.m(e,null),u||(f=[oe(n,"click",r[13]),oe(l,"click",gn(r[16])),oe(e,"click",r[13]),oe(e,"keydown",r[19])],u=!0)},p(p,_){_&1024&&!Ge(l.src,i=p[10])&&o(l,"src",i),p[4]?c||(c=Os(),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},d(p){p&&h(e),c&&c.d(),u=!1,St(f)}}}function Os(r){let e,n='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-19422hk"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg> <span>End-to-end encrypted</span>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-hai5t4"&&(e.innerHTML=n),this.h()},h(){o(e,"class","lightbox-encrypted-badge svelte-19422hk")},m(t,s){S(t,e,s)},d(t){t&&h(e)}}}function Pi(r){let e;function n(l,i){if(l[0].type==="image")return pi;if(l[0].type==="video")return hi;if(l[0].type==="youtube"&&l[0].youtubeId)return di}let t=n(r),s=t&&t(r);return{c(){e=y("div"),s&&s.c(),this.h()},l(l){e=b(l,"DIV",{class:!0});var i=v(e);s&&s.l(i),i.forEach(h),this.h()},h(){o(e,"class","media-embed svelte-19422hk")},m(l,i){S(l,e,i),s&&s.m(e,null),r[22](e)},p(l,[i]){t===(t=n(l))&&s?s.p(l,i):(s&&s.d(1),s=t&&t(l),s&&(s.c(),s.m(e,null)))},i:ne,o:ne,d(l){l&&h(e),s&&s.d(),r[22](null)}}}function Oi(r,e,n){let t,s,l;Mt(r,Lt,U=>n(24,l=U));let{media:i}=e,a,u=!1,f=!1,c=!1,p=!1,_=!1,g=null,k=null,w=!1;async function E(){if(!(!t||g||w||!i.encryption)){if(!l.privateKey){n(9,k="Private key required for decryption");return}n(3,w=!0),n(9,k=null);try{const U=await fetch(i.url);if(!U.ok)throw new Error(`Failed to fetch encrypted image: ${U.status}`);const le=await U.arrayBuffer(),te=await Kr(le,i.encryption.encryptedKey,i.encryption.senderPubkey,l.privateKey);n(15,g=URL.createObjectURL(te))}catch(U){console.error("Failed to decrypt image:",U),n(9,k=U instanceof Error?U.message:"Decryption failed")}finally{n(3,w=!1)}}}ur(()=>{g&&URL.revokeObjectURL(g)}),Mn(()=>{const U=new IntersectionObserver(le=>{le.forEach(te=>{te.isIntersecting&&!u&&n(1,u=!0)})},{rootMargin:"100px"});return U.observe(a),()=>{U.disconnect()}});function T(){n(6,f=!f)}let M="";function R(){i.type==="image"&&(n(2,c=!0),M=document.body.style.overflow,document.body.style.overflow="hidden")}function x(){n(2,c=!1),document.body.style.overflow=M}function z(){n(8,_=!0)}function I(U){U.key==="Escape"&&c&&x()}function A(U){Fn.call(this,r,U)}const H=U=>(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),R()),O=U=>(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),R()),Z=U=>(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),x()),G=()=>n(7,p=!0),B=()=>n(7,p=!1);function W(U){fn[U?"unshift":"push"](()=>{a=U,n(5,a)})}return r.$$set=U=>{"media"in U&&n(0,i=U.media)},r.$$.update=()=>{r.$$.dirty&1&&n(4,t=i.type==="image"&&i.encryption?.encrypted===!0),r.$$.dirty&32785&&n(10,s=t?g:i.url),r.$$.dirty&32794&&u&&t&&!g&&!w&&E(),r.$$.dirty&4&&(c?window.addEventListener("keydown",I):window.removeEventListener("keydown",I))},[i,u,c,w,t,a,f,p,_,k,s,T,R,x,z,g,A,H,O,Z,G,B,W]}class xi extends Nt{constructor(e){super(),Pt(this,e,Oi,Pi,Rt,{media:0})}}const $t={linkPreviewsEnabled:!0,mediaAutoPlay:!1,theme:"auto",notificationsEnabled:!0,soundEnabled:!0},wr="Nostr-BBS-user-preferences";function Ui(){try{const r=localStorage.getItem(wr);if(!r)return $t;const e=JSON.parse(r);return{...$t,...e}}catch{return $t}}function Bt(r){try{localStorage.setItem(wr,JSON.stringify(r))}catch(e){console.warn("Failed to save preferences:",e)}}function Bi(){const{subscribe:r,set:e,update:n}=dn($t);return typeof window<"u"&&e(Ui()),{subscribe:r,update:t=>{n(s=>{const l=t(s);return Bt(l),l})},set:t=>{Bt(t),e(t)},toggleLinkPreviews:()=>{n(t=>{const s={...t,linkPreviewsEnabled:!t.linkPreviewsEnabled};return Bt(s),s})},toggleMediaAutoPlay:()=>{n(t=>{const s={...t,mediaAutoPlay:!t.mediaAutoPlay};return Bt(s),s})},setTheme:t=>{n(s=>{const l={...s,theme:t};return Bt(l),l})},toggleNotifications:()=>{n(t=>{const s={...t,notificationsEnabled:!t.notificationsEnabled};return Bt(s),s})},toggleSound:()=>{n(t=>{const s={...t,soundEnabled:!t.soundEnabled};return Bt(s),s})},reset:()=>{Bt($t),e($t)}}}const Hi=Bi(),ht={LIKE:"+",DISLIKE:"-",LOVE:"❤️",LAUGH:"😂",SURPRISED:"😮",SAD:"😢",THUMBS_UP:"👍",FIRE:"🔥",PARTY:"🎉"};function Vi(r,e,n,t){const s=[["e",r]];t&&s.push(["p",t]);const l={kind:kn.REACTION,created_at:Math.floor(Date.now()/1e3),tags:s,content:e},i=Lr.hexToBytes(n);return Rr(l,i)}function xs(r){if(r.kind!==kn.REACTION||!r.tags||!r.id)return null;const e=r.tags.find(t=>t[0]==="e");if(!e||!e[1])return null;const n=r.tags.find(t=>t[0]==="p");return{eventId:e[1],authorPubkey:n?.[1]||"",content:r.content,reactorPubkey:r.pubkey,timestamp:r.created_at,reactionEventId:r.id}}function Tn(r){const e=r.trim();return e==="+"||e==="👍"||e.toLowerCase()==="like"?ht.LIKE:e==="-"||e==="👎"||e.toLowerCase()==="dislike"?ht.DISLIKE:e}function Us(r){const e=Tn(r);return{[ht.LIKE]:"👍",[ht.DISLIKE]:"👎"}[e]||e}function zi(r){const e=new Map;for(const n of r){const t=Tn(n.content),s=e.get(t)||[];s.includes(n.reactorPubkey)||(s.push(n.reactorPubkey),e.set(t,s))}return e}function Fi(r,e){return r.find(n=>n.reactorPubkey===e)||null}const Bs={reactionsByMessage:new Map,optimisticReactions:new Map,loading:!1,error:null,activeSubscriptions:new Map};function Gi(){const{subscribe:r,set:e,update:n}=dn(Bs);function t(l){const i=In();if(!i)return console.debug("[Reactions] NDK not initialized, skipping event conversion"),null;if(!l.id||!l.tags)return console.debug("[Reactions] Event missing required id or tags"),null;const a=new qn(i);return a.id=l.id,a.pubkey=l.pubkey,a.created_at=l.created_at,a.kind=l.kind,a.tags=l.tags,a.content=l.content,a.sig=l.sig,a}function s(l){return{id:l.id,pubkey:l.pubkey,created_at:l.created_at||Math.floor(Date.now()/1e3),kind:l.kind||0,tags:l.tags,content:l.content,sig:l.sig||""}}return{subscribe:r,async fetchReactions(l,i){if(l.length!==0){n(a=>({...a,loading:!0,error:null}));try{const a={kinds:[kn.REACTION],"#e":l};ts(a,{closeOnEose:!1}).on("event",f=>{const c=s(f),p=xs(c);p&&n(_=>{const g=_.reactionsByMessage.get(p.eventId)||[];if(!g.some(w=>w.reactionEventId===p.reactionEventId)){const w=[...g,p],E=new Map(_.reactionsByMessage);return E.set(p.eventId,w),{..._,reactionsByMessage:E,loading:!1}}return{..._,loading:!1}})})}catch(a){const u=a instanceof Error?a.message:"Failed to fetch reactions";n(f=>({...f,error:u,loading:!1}))}}},async addReaction(l,i,a,u){const f=Ye(Lt);if(!f.privateKey)throw new Error("No private key available");const c=Tn(i),p=`optimistic-${Date.now()}`,_={eventId:l,authorPubkey:u||"",content:c,reactorPubkey:f.publicKey||"",timestamp:Math.floor(Date.now()/1e3),reactionEventId:p};n(g=>{const w=(g.reactionsByMessage.get(l)||[]).filter(M=>M.reactorPubkey!==_.reactorPubkey),E=new Map(g.reactionsByMessage);E.set(l,[...w,_]);const T=new Map(g.optimisticReactions);return T.set(p,_),{...g,reactionsByMessage:E,optimisticReactions:T}});try{const g=Vi(l,c,f.privateKey,u),k=t(g);if(!k)throw new Error("NDK not connected");await dr(k);const w={..._,reactionEventId:g.id||p};n(E=>{const M=(E.reactionsByMessage.get(l)||[]).filter(z=>z.reactionEventId!==p),R=new Map(E.reactionsByMessage);R.set(l,[...M,w]);const x=new Map(E.optimisticReactions);return x.delete(p),{...E,reactionsByMessage:R,optimisticReactions:x}})}catch(g){throw n(k=>{const E=(k.reactionsByMessage.get(l)||[]).filter(R=>R.reactionEventId!==p),T=new Map(k.reactionsByMessage);T.set(l,E);const M=new Map(k.optimisticReactions);return M.delete(p),{...k,reactionsByMessage:T,optimisticReactions:M,error:g instanceof Error?g.message:"Failed to add reaction"}}),g}},async removeReaction(l,i){const a=Ye(Lt);if(!a.publicKey)throw new Error("Not authenticated");n(u=>{const c=(u.reactionsByMessage.get(l)||[]).filter(_=>_.reactorPubkey!==a.publicKey),p=new Map(u.reactionsByMessage);return p.set(l,c),{...u,reactionsByMessage:p}})},async subscribeToReactions(l,i){if(l.length===0)return;const a={kinds:[kn.REACTION],"#e":l,since:Math.floor(Date.now()/1e3)},u=`reactions_${Date.now()}_${Math.random().toString(36).slice(2)}`,f=ts(a,{closeOnEose:!1,subId:u});f.on("event",c=>{const p=s(c),_=xs(p);_&&n(g=>{const k=g.reactionsByMessage.get(_.eventId)||[];if(!k.some(E=>E.reactionEventId===_.reactionEventId)){const E=[...k,_],T=new Map(g.reactionsByMessage);return T.set(_.eventId,E),{...g,reactionsByMessage:T}}return{...g}})}),n(c=>{const p=c.activeSubscriptions.get(i)||[],_=new Map(c.activeSubscriptions);return _.set(i,[...p,{subId:u,subscription:f}]),{...c,activeSubscriptions:_}})},unsubscribe(l){const a=Ye({subscribe:r}).activeSubscriptions.get(l);a&&(a.forEach(({subscription:u})=>{u.stop()}),n(u=>{const f=new Map(u.activeSubscriptions);return f.delete(l),{...u,activeSubscriptions:f}}))},getReactionSummary(l){const a=Ye({subscribe:r}).reactionsByMessage.get(l)||[],u=Ye(Lt),f=zi(a),c=new Map;for(const[_,g]of f.entries())c.set(_,{content:_,count:g.length,reactors:g,userReacted:u.publicKey?g.includes(u.publicKey):!1});const p=u.publicKey&&Fi(a,u.publicKey)?.content||null;return{messageId:l,reactions:c,totalCount:a.length,userReaction:p?Tn(p):null}},clearError(){n(l=>({...l,error:null}))},clear(){e(Bs)},disconnectAll(){Ye({subscribe:r}).activeSubscriptions.forEach(i=>{i.forEach(({subscription:a})=>{a.stop()})}),n(i=>({...i,activeSubscriptions:new Map}))}}}const Xt=Gi();function ji(r){return hn(Xt,e=>Xt.getReactionSummary(r))}typeof window<"u"&&window.addEventListener("beforeunload",()=>{Xt.disconnectAll()});function Hs(r,e,n){const t=r.slice();return t[11]=e[n],t}function Vs(r){let e,n=nt(Array.from(r[2].reactions.values())),t=[];for(let s=0;s<n.length;s+=1)t[s]=zs(Hs(r,n,s));return{c(){e=y("div");for(let s=0;s<t.length;s+=1)t[s].c();this.h()},l(s){e=b(s,"DIV",{class:!0});var l=v(e);for(let i=0;i<t.length;i+=1)t[i].l(l);l.forEach(h),this.h()},h(){o(e,"class","flex flex-wrap gap-1 mt-2")},m(s,l){S(s,e,l);for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(e,null)},p(s,l){if(l&29){n=nt(Array.from(s[2].reactions.values()));let i;for(i=0;i<n.length;i+=1){const a=Hs(s,n,i);t[i]?t[i].p(a,l):(t[i]=zs(a),t[i].c(),t[i].m(e,null))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}},d(s){s&&h(e),en(t,s)}}}function zs(r){let e,n,t=Us(r[11].content)+"",s,l,i,a=r[11].count+"",u,f,c,p,_,g,k;function w(){return r[9](r[11])}return{c(){e=y("button"),n=y("span"),s=$(t),l=L(),i=y("span"),u=$(a),f=L(),this.h()},l(E){e=b(E,"BUTTON",{class:!0,title:!0});var T=v(e);n=b(T,"SPAN",{class:!0});var M=v(n);s=Q(M,t),M.forEach(h),l=D(T),i=b(T,"SPAN",{class:!0});var R=v(i);u=Q(R,a),R.forEach(h),f=D(T),T.forEach(h),this.h()},h(){o(n,"class","text-base leading-none"),o(i,"class","text-xs font-medium"),o(e,"class",c="btn btn-xs "+(r[11].userReacted?"btn-primary":"btn-ghost")+" gap-1 hover:scale-105 transition-transform svelte-gm3cxn"),e.disabled=p=!r[0],o(e,"title",_=r[4](r[11].reactors))},m(E,T){S(E,e,T),d(e,n),d(n,s),d(e,l),d(e,i),d(i,u),d(e,f),g||(k=oe(e,"click",w),g=!0)},p(E,T){r=E,T&4&&t!==(t=Us(r[11].content)+"")&&me(s,t),T&4&&a!==(a=r[11].count+"")&&me(u,a),T&4&&c!==(c="btn btn-xs "+(r[11].userReacted?"btn-primary":"btn-ghost")+" gap-1 hover:scale-105 transition-transform svelte-gm3cxn")&&o(e,"class",c),T&1&&p!==(p=!r[0])&&(e.disabled=p),T&4&&_!==(_=r[4](r[11].reactors))&&o(e,"title",_)},d(E){E&&h(e),g=!1,k()}}}function Ki(r){let e,n=r[2].totalCount>0&&Vs(r);return{c(){n&&n.c(),e=Be()},l(t){n&&n.l(t),e=Be()},m(t,s){n&&n.m(t,s),S(t,e,s)},p(t,[s]){t[2].totalCount>0?n?n.p(t,s):(n=Vs(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ne,o:ne,d(t){t&&h(e),n&&n.d(t)}}}function Wi(r,e,n){let t,s,l,i,a=ne,u=()=>(a(),a=_n(t,E=>n(2,i=E)),t);Mt(r,Lt,E=>n(8,l=E)),r.$$.on_destroy.push(()=>a());let{messageId:f}=e,{relayUrl:c=""}=e,{authorPubkey:p=""}=e;const _=An();async function g(E){if(s)try{Xt.getReactionSummary(f).userReaction===E?(await Xt.removeReaction(f,c),_("unreact")):(await Xt.addReaction(f,E,c,p),_("react",{emoji:E}))}catch(T){console.error("Failed to toggle reaction:",T)}}function k(E){const T=l.publicKey,M=E.map(R=>R===T?"You":qt.getCachedSync(R)?.displayName||`${R.slice(0,8)}...${R.slice(-4)}`);return M.length===0?"":M.length===1?M[0]:M.length===2?`${M[0]} and ${M[1]}`:`${M[0]}, ${M[1]} and ${M.length-2} other${M.length-2>1?"s":""}`}Mn(()=>{const E=Array.from(i.reactions.values()).flatMap(T=>T.reactors).filter(T=>T!==l.publicKey);E.length>0&&qt.prefetchProfiles(E)});const w=E=>g(E.content);return r.$$set=E=>{"messageId"in E&&n(5,f=E.messageId),"relayUrl"in E&&n(6,c=E.relayUrl),"authorPubkey"in E&&n(7,p=E.authorPubkey)},r.$$.update=()=>{r.$$.dirty&32&&u(n(1,t=ji(f))),r.$$.dirty&256&&n(0,s=l.isAuthenticated)},[s,t,i,g,k,f,c,p,l,w]}class Yi extends Nt{constructor(e){super(),Pt(this,e,Wi,Ki,Rt,{messageId:5,relayUrl:6,authorPubkey:7})}}function Fs(r,e,n){const t=r.slice();return t[7]=e[n].emoji,t[8]=e[n].label,t}function Gs(r){let e,n,t,s,l,i,a,u=nt(r[1]),f=[];for(let c=0;c<u.length;c+=1)f[c]=js(Fs(r,u,c));return{c(){e=y("div"),n=y("div"),t=y("div");for(let c=0;c<f.length;c+=1)f[c].c();s=L(),l=y("div"),this.h()},l(c){e=b(c,"DIV",{class:!0,role:!0,"aria-label":!0});var p=v(e);n=b(p,"DIV",{class:!0});var _=v(n);t=b(_,"DIV",{class:!0});var g=v(t);for(let k=0;k<f.length;k+=1)f[k].l(g);g.forEach(h),_.forEach(h),p.forEach(h),s=D(c),l=b(c,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0}),v(l).forEach(h),this.h()},h(){o(t,"class","grid grid-cols-4 gap-1"),o(n,"class","bg-base-100 rounded-lg shadow-lg border border-base-300 p-2"),o(e,"class","reaction-picker absolute bottom-full left-0 mb-2 z-50 svelte-17d5r88"),o(e,"role","dialog"),o(e,"aria-label","Reaction picker"),o(l,"class","fixed inset-0 z-40 lg:hidden"),o(l,"role","button"),o(l,"tabindex","-1"),o(l,"aria-label","Close reaction picker")},m(c,p){S(c,e,p),d(e,n),d(n,t);for(let _=0;_<f.length;_+=1)f[_]&&f[_].m(t,null);S(c,s,p),S(c,l,p),i||(a=[oe(l,"click",r[3]),oe(l,"keydown",r[4])],i=!0)},p(c,p){if(p&6){u=nt(c[1]);let _;for(_=0;_<u.length;_+=1){const g=Fs(c,u,_);f[_]?f[_].p(g,p):(f[_]=js(g),f[_].c(),f[_].m(t,null))}for(;_<f.length;_+=1)f[_].d(1);f.length=u.length}},d(c){c&&(h(e),h(s),h(l)),en(f,c),i=!1,St(a)}}}function js(r){let e,n,t=r[7]+"",s,l,i,a;function u(){return r[5](r[7])}return{c(){e=y("button"),n=y("span"),s=$(t),l=L(),this.h()},l(f){e=b(f,"BUTTON",{class:!0,title:!0,"aria-label":!0});var c=v(e);n=b(c,"SPAN",{class:!0});var p=v(n);s=Q(p,t),p.forEach(h),l=D(c),c.forEach(h),this.h()},h(){o(n,"class","text-2xl leading-none"),o(e,"class","btn btn-ghost btn-sm hover:btn-primary aspect-square p-2 flex items-center justify-center svelte-17d5r88"),o(e,"title",r[8]),o(e,"aria-label",r[8])},m(f,c){S(f,e,c),d(e,n),d(n,s),d(e,l),i||(a=oe(e,"click",u),i=!0)},p(f,c){r=f},d(f){f&&h(e),i=!1,a()}}}function Xi(r){let e,n=r[0]&&Gs(r);return{c(){n&&n.c(),e=Be()},l(t){n&&n.l(t),e=Be()},m(t,s){n&&n.m(t,s),S(t,e,s)},p(t,[s]){t[0]?n?n.p(t,s):(n=Gs(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ne,o:ne,d(t){t&&h(e),n&&n.d(t)}}}function qi(r,e,n){let{show:t=!1}=e;const s=An(),l=[{emoji:ht.LIKE,label:"Like"},{emoji:ht.LOVE,label:"Love"},{emoji:ht.LAUGH,label:"Laugh"},{emoji:ht.SURPRISED,label:"Surprised"},{emoji:ht.SAD,label:"Sad"},{emoji:ht.FIRE,label:"Fire"},{emoji:ht.PARTY,label:"Party"},{emoji:ht.THUMBS_UP,label:"Thumbs Up"}];function i(c){s("select",{emoji:c}),n(0,t=!1)}function a(c){c.target.closest(".reaction-picker")||(s("close"),n(0,t=!1))}function u(c){c.key==="Escape"&&(s("close"),n(0,t=!1))}const f=c=>i(c);return r.$$set=c=>{"show"in c&&n(0,t=c.show)},[t,l,i,a,u,f]}class Ji extends Nt{constructor(e){super(),Pt(this,e,qi,Xi,Rt,{show:0})}}const Ks=/@(npub1[a-z0-9]{58}|[a-f0-9]{64}|[\w-]{1,30})/gi;function Zi(r){return/^(npub1[a-z0-9]{58}|[a-f0-9]{64})$/i.test(r)}function Qi(r,e){const n=[];let t;for(Ks.lastIndex=0;(t=Ks.exec(r))!==null;){const s=t[1];let l;if(Zi(s))l=s.startsWith("npub1")?$i(s):s;else if(e){const i=e(s);if(!i)continue;l=i}else continue;n.push({pubkey:l,startIndex:t.index,endIndex:t.index+t[0].length,originalText:s})}return n}function Xn(r){return r?r.startsWith("npub1")?r.slice(0,12)+"..."+r.slice(-4):r.slice(0,8)+"..."+r.slice(-4):""}function $i(r){if(!r.startsWith("npub1"))return r;try{const e=Nr.decode(r);return e.type==="npub"?e.data:r}catch(e){return console.error("Failed to decode npub to hex:",e),r}}function Ws(r,e,n){const t=r.slice();return t[4]=e[n],t}function eo(r){let e=r[4].content+"",n;return{c(){n=$(e)},l(t){n=Q(t,e)},m(t,s){S(t,n,s)},p(t,s){s&1&&e!==(e=t[4].content+"")&&me(n,e)},d(t){t&&h(n)}}}function to(r){let e,n,t=r[4].displayName+"",s,l;return{c(){e=y("span"),n=$("@"),s=$(t),this.h()},l(i){e=b(i,"SPAN",{class:!0,title:!0});var a=v(e);n=Q(a,"@"),s=Q(a,t),a.forEach(h),this.h()},h(){o(e,"class","mention-tag svelte-1i5qaz1"),o(e,"title",l=r[4].pubkey?`Pubkey: ${Xn(r[4].pubkey)}`:"")},m(i,a){S(i,e,a),d(e,n),d(e,s)},p(i,a){a&1&&t!==(t=i[4].displayName+"")&&me(s,t),a&1&&l!==(l=i[4].pubkey?`Pubkey: ${Xn(i[4].pubkey)}`:"")&&o(e,"title",l)},d(i){i&&h(e)}}}function Ys(r){let e;function n(l,i){return l[4].type==="mention"?to:eo}let t=n(r),s=t(r);return{c(){s.c(),e=Be()},l(l){s.l(l),e=Be()},m(l,i){s.m(l,i),S(l,e,i)},p(l,i){t===(t=n(l))&&s?s.p(l,i):(s.d(1),s=t(l),s&&(s.c(),s.m(e.parentNode,e)))},d(l){l&&h(e),s.d(l)}}}function no(r){let e,n=nt(r[0]),t=[];for(let s=0;s<n.length;s+=1)t[s]=Ys(Ws(r,n,s));return{c(){for(let s=0;s<t.length;s+=1)t[s].c();e=Be()},l(s){for(let l=0;l<t.length;l+=1)t[l].l(s);e=Be()},m(s,l){for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(s,l);S(s,e,l)},p(s,[l]){if(l&1){n=nt(s[0]);let i;for(i=0;i<n.length;i+=1){const a=Ws(s,n,i);t[i]?t[i].p(a,l):(t[i]=Ys(a),t[i].c(),t[i].m(e.parentNode,e))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}},i:ne,o:ne,d(s){s&&h(e),en(t,s)}}}function so(r,e,n){let t,{content:s}=e,{resolver:l=void 0}=e;function i(a){const u=Qi(a,l);if(u.length===0)return[{type:"text",content:a}];const f=[];let c=0;for(const p of u){p.startIndex>c&&f.push({type:"text",content:a.slice(c,p.startIndex)});let _=p.originalText||Xn(p.pubkey);const g=qt.getCachedSync(p.pubkey);g&&(_=g.displayName||_),f.push({type:"mention",content:a.slice(p.startIndex,p.endIndex),pubkey:p.pubkey,displayName:_}),c=p.endIndex}return c<a.length&&f.push({type:"text",content:a.slice(c)}),f}return r.$$set=a=>{"content"in a&&n(1,s=a.content),"resolver"in a&&n(2,l=a.resolver)},r.$$.update=()=>{r.$$.dirty&2&&n(0,t=i(s))},[t,s,l]}class ro extends Nt{constructor(e){super(),Pt(this,e,so,no,Rt,{content:1,resolver:2})}}function Xs(r,e,n){const t=r.slice();return t[32]=e[n],t}function qs(r){let e,n,t;return n=new pr({props:{pubkey:r[1].authorPubkey,showAvatar:!0,showName:!1,avatarSize:"sm",clickable:!1}}),{c(){e=y("div"),bt(n.$$.fragment),this.h()},l(s){e=b(s,"DIV",{class:!0});var l=v(e);gt(n.$$.fragment,l),l.forEach(h),this.h()},h(){o(e,"class","flex-shrink-0")},m(s,l){S(s,e,l),_t(n,e,null),t=!0},p(s,l){const i={};l[0]&2&&(i.pubkey=s[1].authorPubkey),n.$set(i)},i(s){t||(ae(n.$$.fragment,s),t=!0)},o(s){_e(n.$$.fragment,s),t=!1},d(s){s&&h(e),vt(n)}}}function lo(r){let e,n;return e=new pr({props:{pubkey:r[1].authorPubkey,showAvatar:!1,showName:!0,showFullName:!0,clickable:!1,maxNameLength:20}}),{c(){bt(e.$$.fragment)},l(t){gt(e.$$.fragment,t)},m(t,s){_t(e,t,s),n=!0},p(t,s){const l={};s[0]&2&&(l.pubkey=t[1].authorPubkey),e.$set(l)},i(t){n||(ae(e.$$.fragment,t),n=!0)},o(t){_e(e.$$.fragment,t),n=!1},d(t){vt(e,t)}}}function io(r){let e,n="You";return{c(){e=y("span"),e.textContent=n,this.h()},l(t){e=b(t,"SPAN",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-ubs0rj"&&(e.textContent=n),this.h()},h(){o(e,"class","font-semibold text-sm truncate")},m(t,s){S(t,e,s)},p:ne,i:ne,o:ne,d(t){t&&h(e)}}}function Js(r){let e,n='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-warning" viewBox="0 0 20 20" fill="currentColor"><path d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z"></path></svg>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-tip":!0,"data-svelte-h":!0}),re(e)!=="svelte-17i1c2g"&&(e.innerHTML=n),this.h()},h(){o(e,"class","tooltip tooltip-top"),o(e,"data-tip","Pinned message")},m(t,s){S(t,e,s)},d(t){t&&h(e)}}}function Zs(r){let e,n;function t(i,a){if(i[1].sendStatus==="sending")return co;if(i[1].sendStatus==="sent")return ao;if(i[1].sendStatus==="delivered")return oo}let s=t(r),l=s&&s(r);return{c(){e=y("span"),l&&l.c(),this.h()},l(i){e=b(i,"SPAN",{class:!0,title:!0});var a=v(e);l&&l.l(a),a.forEach(h),this.h()},h(){o(e,"class","send-status"),o(e,"title",n=r[1].sendStatus==="sent"?"Sent to relay":r[1].sendStatus==="delivered"?"Delivered":"Sending...")},m(i,a){S(i,e,a),l&&l.m(e,null)},p(i,a){s!==(s=t(i))&&(l&&l.d(1),l=s&&s(i),l&&(l.c(),l.m(e,null))),a[0]&2&&n!==(n=i[1].sendStatus==="sent"?"Sent to relay":i[1].sendStatus==="delivered"?"Delivered":"Sending...")&&o(e,"title",n)},d(i){i&&h(e),l&&l.d()}}}function oo(r){let e,n;return{c(){e=K("svg"),n=K("path"),this.h()},l(t){e=j(t,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var s=v(e);n=j(s,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),v(n).forEach(h),s.forEach(h),this.h()},h(){o(n,"fill-rule","evenodd"),o(n,"d","M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"),o(n,"clip-rule","evenodd"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"class","h-3 w-3 text-success"),o(e,"viewBox","0 0 20 20"),o(e,"fill","currentColor")},m(t,s){S(t,e,s),d(e,n)},d(t){t&&h(e)}}}function ao(r){let e,n;return{c(){e=K("svg"),n=K("path"),this.h()},l(t){e=j(t,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var s=v(e);n=j(s,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),v(n).forEach(h),s.forEach(h),this.h()},h(){o(n,"fill-rule","evenodd"),o(n,"d","M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"),o(n,"clip-rule","evenodd"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"class","h-3 w-3 text-success"),o(e,"viewBox","0 0 20 20"),o(e,"fill","currentColor")},m(t,s){S(t,e,s),d(e,n)},d(t){t&&h(e)}}}function co(r){let e,n;return{c(){e=K("svg"),n=K("circle"),this.h()},l(t){e=j(t,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var s=v(e);n=j(s,"circle",{cx:!0,cy:!0,r:!0}),v(n).forEach(h),s.forEach(h),this.h()},h(){o(n,"cx","10"),o(n,"cy","10"),o(n,"r","3"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"class","h-3 w-3 animate-pulse text-base-content/40"),o(e,"viewBox","0 0 20 20"),o(e,"fill","currentColor")},m(t,s){S(t,e,s),d(e,n)},d(t){t&&h(e)}}}function uo(r){let e,n,t;return n=new ro({props:{content:r[3]}}),{c(){e=y("p"),bt(n.$$.fragment),this.h()},l(s){e=b(s,"P",{class:!0});var l=v(e);gt(n.$$.fragment,l),l.forEach(h),this.h()},h(){o(e,"class","whitespace-pre-wrap")},m(s,l){S(s,e,l),_t(n,e,null),t=!0},p(s,l){const i={};l[0]&8&&(i.content=s[3]),n.$set(i)},i(s){t||(ae(n.$$.fragment,s),t=!0)},o(s){_e(n.$$.fragment,s),t=!1},d(s){s&&h(e),vt(n)}}}function fo(r){let e,n='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path></svg> <span class="italic">Encrypted message</span>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-1c33he"&&(e.innerHTML=n),this.h()},h(){o(e,"class","flex items-center gap-2 text-sm opacity-70")},m(t,s){S(t,e,s)},p:ne,i:ne,o:ne,d(t){t&&h(e)}}}function Qs(r){let e,n='<svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path></svg> <span>Encrypted</span>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-1gjsd08"&&(e.innerHTML=n),this.h()},h(){o(e,"class","flex items-center gap-1 mt-1 text-xs opacity-60")},m(t,s){S(t,e,s)},d(t){t&&h(e)}}}function $s(r){let e,n,t=nt(r[4]),s=[];for(let i=0;i<t.length;i+=1)s[i]=er(Xs(r,t,i));const l=i=>_e(s[i],1,1,()=>{s[i]=null});return{c(){e=y("div");for(let i=0;i<s.length;i+=1)s[i].c();this.h()},l(i){e=b(i,"DIV",{class:!0});var a=v(e);for(let u=0;u<s.length;u+=1)s[u].l(a);a.forEach(h),this.h()},h(){o(e,"class","media-container mt-2")},m(i,a){S(i,e,a);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(e,null);n=!0},p(i,a){if(a[0]&16){t=nt(i[4]);let u;for(u=0;u<t.length;u+=1){const f=Xs(i,t,u);s[u]?(s[u].p(f,a),ae(s[u],1)):(s[u]=er(f),s[u].c(),ae(s[u],1),s[u].m(e,null))}for(pt(),u=t.length;u<s.length;u+=1)l(u);mt()}},i(i){if(!n){for(let a=0;a<t.length;a+=1)ae(s[a]);n=!0}},o(i){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)_e(s[a]);n=!1},d(i){i&&h(e),en(s,i)}}}function ho(r){let e,n;return e=new xi({props:{media:r[32]}}),{c(){bt(e.$$.fragment)},l(t){gt(e.$$.fragment,t)},m(t,s){_t(e,t,s),n=!0},p(t,s){const l={};s[0]&16&&(l.media=t[32]),e.$set(l)},i(t){n||(ae(e.$$.fragment,t),n=!0)},o(t){_e(e.$$.fragment,t),n=!1},d(t){vt(e,t)}}}function po(r){let e,n;return e=new fi({props:{url:r[32].url}}),{c(){bt(e.$$.fragment)},l(t){gt(e.$$.fragment,t)},m(t,s){_t(e,t,s),n=!0},p(t,s){const l={};s[0]&16&&(l.url=t[32].url),e.$set(l)},i(t){n||(ae(e.$$.fragment,t),n=!0)},o(t){_e(e.$$.fragment,t),n=!1},d(t){vt(e,t)}}}function er(r){let e,n,t,s;const l=[po,ho],i=[];function a(u,f){return u[32].type==="link"?0:1}return e=a(r),n=i[e]=l[e](r),{c(){n.c(),t=Be()},l(u){n.l(u),t=Be()},m(u,f){i[e].m(u,f),S(u,t,f),s=!0},p(u,f){let c=e;e=a(u),e===c?i[e].p(u,f):(pt(),_e(i[c],1,1,()=>{i[c]=null}),mt(),n=i[e],n?n.p(u,f):(n=i[e]=l[e](u),n.c()),ae(n,1),n.m(t.parentNode,t))},i(u){s||(ae(n),s=!0)},o(u){_e(n),s=!1},d(u){u&&h(t),i[e].d(u)}}}function tr(r){let e,n,t,s,l,i=r[13]?"Unpin":"Pin",a,u,f,c,p,_;return{c(){e=y("button"),n=K("svg"),t=K("path"),l=L(),a=$(i),this.h()},l(g){e=b(g,"BUTTON",{class:!0,"aria-label":!0,title:!0});var k=v(e);n=j(k,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var w=v(n);t=j(w,"path",{d:!0}),v(t).forEach(h),w.forEach(h),l=D(k),a=Q(k,i),k.forEach(h),this.h()},h(){o(t,"d","M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z"),o(n,"xmlns","http://www.w3.org/2000/svg"),o(n,"class",s="h-4 w-4 "+(r[13]?"text-warning":"")),o(n,"viewBox","0 0 20 20"),o(n,"fill","currentColor"),o(e,"class",u="btn btn-ghost btn-xs "+(r[13]?"opacity-100":"opacity-30 group-hover:opacity-100")+" transition-opacity"),o(e,"aria-label",f=r[13]?"Unpin message":"Pin message"),o(e,"title",c=r[13]?"Unpin message":"Pin message")},m(g,k){S(g,e,k),d(e,n),d(n,t),d(e,l),d(e,a),p||(_=oe(e,"click",r[18]),p=!0)},p(g,k){k[0]&8192&&s!==(s="h-4 w-4 "+(g[13]?"text-warning":""))&&o(n,"class",s),k[0]&8192&&i!==(i=g[13]?"Unpin":"Pin")&&me(a,i),k[0]&8192&&u!==(u="btn btn-ghost btn-xs "+(g[13]?"opacity-100":"opacity-30 group-hover:opacity-100")+" transition-opacity")&&o(e,"class",u),k[0]&8192&&f!==(f=g[13]?"Unpin message":"Pin message")&&o(e,"aria-label",f),k[0]&8192&&c!==(c=g[13]?"Unpin message":"Pin message")&&o(e,"title",c)},d(g){g&&h(e),p=!1,_()}}}function mo(r){let e,n;return{c(){e=K("svg"),n=K("path"),this.h()},l(t){e=j(t,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var s=v(e);n=j(s,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(n).forEach(h),s.forEach(h),this.h()},h(){o(n,"stroke-linecap","round"),o(n,"stroke-linejoin","round"),o(n,"stroke-width","2"),o(n,"d","M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"class","h-4 w-4"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24"),o(e,"stroke","currentColor")},m(t,s){S(t,e,s),d(e,n)},d(t){t&&h(e)}}}function vo(r){let e,n;return{c(){e=K("svg"),n=K("path"),this.h()},l(t){e=j(t,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var s=v(e);n=j(s,"path",{d:!0}),v(n).forEach(h),s.forEach(h),this.h()},h(){o(n,"d","M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"class","h-4 w-4"),o(e,"viewBox","0 0 20 20"),o(e,"fill","currentColor")},m(t,s){S(t,e,s),d(e,n)},d(t){t&&h(e)}}}function nr(r){let e,n=`<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
          Delete`,t,s;return{c(){e=y("button"),e.innerHTML=n,this.h()},l(l){e=b(l,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),re(e)!=="svelte-yzsrym"&&(e.innerHTML=n),this.h()},h(){o(e,"class","btn btn-ghost btn-xs opacity-30 group-hover:opacity-100 transition-opacity"),o(e,"aria-label","Delete message")},m(l,i){S(l,e,i),t||(s=oe(e,"click",r[16]),t=!0)},p:ne,d(l){l&&h(e),t=!1,s()}}}function _o(r){let e,n,t,s,l,i,a,u,f,c=sr(r[1].createdAt)+"",p,_,g,k,w,E,T,M,R,x,z,I,A,H,O,Z,G,B,W,U,le,te,Ne='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',ue,Y,we,J,Te,N,ee,de,Qe,ce=!r[8]&&qs(r);const je=[io,lo],Pe=[];function Ce(P,se){return P[8]?0:1}l=Ce(r),i=Pe[l]=je[l](r);let Ie=r[13]&&Js(),ke=r[6]&&r[1].sendStatus&&Zs(r);const Ke=[fo,uo],Le=[];function He(P,se){return P[1].isEncrypted&&!P[5]?0:1}E=He(r),T=Le[E]=Ke[E](r);let he=r[1].isEncrypted&&r[5]&&Qs(),ge=r[9]&&$s(r),Se=r[14]&&tr(r);function Ee(P,se){return P[15]?vo:mo}let De=Ee(r),be=De(r),Ae=r[12]&&nr(r);return Y=new Ji({props:{show:r[7]}}),Y.$on("select",r[19]),Y.$on("close",r[28]),J=new Yi({props:{messageId:r[1].id,relayUrl:r[2],authorPubkey:r[1].authorPubkey}}),J.$on("react",r[20]),J.$on("unreact",r[21]),{c(){e=y("div"),ce&&ce.c(),n=L(),t=y("div"),s=y("div"),i.c(),a=L(),Ie&&Ie.c(),u=L(),f=y("span"),p=$(c),_=L(),ke&&ke.c(),k=L(),w=y("div"),T.c(),M=L(),he&&he.c(),z=L(),ge&&ge.c(),I=L(),A=y("div"),Se&&Se.c(),H=L(),O=y("button"),be.c(),Z=$(`
        Bookmark`),W=L(),Ae&&Ae.c(),U=L(),le=y("div"),te=y("button"),te.innerHTML=Ne,ue=L(),bt(Y.$$.fragment),we=L(),bt(J.$$.fragment),this.h()},l(P){e=b(P,"DIV",{class:!0,id:!0});var se=v(e);ce&&ce.l(se),n=D(se),t=b(se,"DIV",{class:!0});var ie=v(t);s=b(ie,"DIV",{class:!0});var V=v(s);i.l(V),a=D(V),Ie&&Ie.l(V),u=D(V),f=b(V,"SPAN",{class:!0});var q=v(f);p=Q(q,c),_=D(q),ke&&ke.l(q),q.forEach(h),V.forEach(h),k=D(ie),w=b(ie,"DIV",{class:!0,style:!0});var Oe=v(w);T.l(Oe),M=D(Oe),he&&he.l(Oe),Oe.forEach(h),z=D(ie),ge&&ge.l(ie),I=D(ie),A=b(ie,"DIV",{class:!0});var ye=v(A);Se&&Se.l(ye),H=D(ye),O=b(ye,"BUTTON",{class:!0,"aria-label":!0});var Ve=v(O);be.l(Ve),Z=Q(Ve,`
        Bookmark`),Ve.forEach(h),W=D(ye),Ae&&Ae.l(ye),U=D(ye),le=b(ye,"DIV",{class:!0});var ze=v(le);te=b(ze,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),re(te)!=="svelte-lcpuro"&&(te.innerHTML=Ne),ue=D(ze),gt(Y.$$.fragment,ze),ze.forEach(h),ye.forEach(h),we=D(ie),gt(J.$$.fragment,ie),ie.forEach(h),se.forEach(h),this.h()},h(){o(f,"class","text-xs text-base-content/60 flex-shrink-0 flex items-center gap-1"),o(s,"class",g="flex items-baseline gap-2 mb-1 "+(r[6]?"flex-row-reverse":"")),o(w,"class",R="rounded-2xl px-4 py-2 break-words "+(r[13]?"ring-1 ring-warning/30":"")),o(w,"style",x=r[6]?"background-color: oklch(var(--p)); color: oklch(var(--pc));":"background-color: oklch(var(--b2)); color: oklch(var(--bc));"),o(O,"class",G="btn btn-ghost btn-xs "+(r[15]?"opacity-100":"opacity-30 group-hover:opacity-100")+" transition-opacity"),o(O,"aria-label",B=r[15]?"Remove bookmark":"Add bookmark"),o(te,"class","btn btn-ghost btn-xs opacity-30 group-hover:opacity-100 transition-opacity"),o(te,"aria-label","Add reaction"),o(le,"class","relative"),o(A,"class","flex gap-2 mt-1"),o(t,"class","flex-1 min-w-0 max-w-md"),o(e,"class",Te="flex gap-3 group "+(r[6]?"flex-row-reverse":"")+" "+(r[13]?"bg-warning/5 -mx-2 px-2 py-1 rounded-lg":"")),o(e,"id",N="message-"+r[1].id)},m(P,se){S(P,e,se),ce&&ce.m(e,null),d(e,n),d(e,t),d(t,s),Pe[l].m(s,null),d(s,a),Ie&&Ie.m(s,null),d(s,u),d(s,f),d(f,p),d(f,_),ke&&ke.m(f,null),d(t,k),d(t,w),Le[E].m(w,null),d(w,M),he&&he.m(w,null),d(t,z),ge&&ge.m(t,null),d(t,I),d(t,A),Se&&Se.m(A,null),d(A,H),d(A,O),be.m(O,null),d(O,Z),d(A,W),Ae&&Ae.m(A,null),d(A,U),d(A,le),d(le,te),d(le,ue),_t(Y,le,null),d(t,we),_t(J,t,null),r[29](e),ee=!0,de||(Qe=[oe(O,"click",r[17]),oe(te,"click",r[27])],de=!0)},p(P,se){P[8]?ce&&(pt(),_e(ce,1,1,()=>{ce=null}),mt()):ce?(ce.p(P,se),se[0]&256&&ae(ce,1)):(ce=qs(P),ce.c(),ae(ce,1),ce.m(e,n));let ie=l;l=Ce(P),l===ie?Pe[l].p(P,se):(pt(),_e(Pe[ie],1,1,()=>{Pe[ie]=null}),mt(),i=Pe[l],i?i.p(P,se):(i=Pe[l]=je[l](P),i.c()),ae(i,1),i.m(s,a)),P[13]?Ie||(Ie=Js(),Ie.c(),Ie.m(s,u)):Ie&&(Ie.d(1),Ie=null),(!ee||se[0]&2)&&c!==(c=sr(P[1].createdAt)+"")&&me(p,c),P[6]&&P[1].sendStatus?ke?ke.p(P,se):(ke=Zs(P),ke.c(),ke.m(f,null)):ke&&(ke.d(1),ke=null),(!ee||se[0]&64&&g!==(g="flex items-baseline gap-2 mb-1 "+(P[6]?"flex-row-reverse":"")))&&o(s,"class",g);let V=E;E=He(P),E===V?Le[E].p(P,se):(pt(),_e(Le[V],1,1,()=>{Le[V]=null}),mt(),T=Le[E],T?T.p(P,se):(T=Le[E]=Ke[E](P),T.c()),ae(T,1),T.m(w,M)),P[1].isEncrypted&&P[5]?he||(he=Qs(),he.c(),he.m(w,null)):he&&(he.d(1),he=null),(!ee||se[0]&8192&&R!==(R="rounded-2xl px-4 py-2 break-words "+(P[13]?"ring-1 ring-warning/30":"")))&&o(w,"class",R),(!ee||se[0]&64&&x!==(x=P[6]?"background-color: oklch(var(--p)); color: oklch(var(--pc));":"background-color: oklch(var(--b2)); color: oklch(var(--bc));"))&&o(w,"style",x),P[9]?ge?(ge.p(P,se),se[0]&512&&ae(ge,1)):(ge=$s(P),ge.c(),ae(ge,1),ge.m(t,I)):ge&&(pt(),_e(ge,1,1,()=>{ge=null}),mt()),P[14]?Se?Se.p(P,se):(Se=tr(P),Se.c(),Se.m(A,H)):Se&&(Se.d(1),Se=null),De!==(De=Ee(P))&&(be.d(1),be=De(P),be&&(be.c(),be.m(O,Z))),(!ee||se[0]&32768&&G!==(G="btn btn-ghost btn-xs "+(P[15]?"opacity-100":"opacity-30 group-hover:opacity-100")+" transition-opacity"))&&o(O,"class",G),(!ee||se[0]&32768&&B!==(B=P[15]?"Remove bookmark":"Add bookmark"))&&o(O,"aria-label",B),P[12]?Ae?Ae.p(P,se):(Ae=nr(P),Ae.c(),Ae.m(A,U)):Ae&&(Ae.d(1),Ae=null);const q={};se[0]&128&&(q.show=P[7]),Y.$set(q);const Oe={};se[0]&2&&(Oe.messageId=P[1].id),se[0]&4&&(Oe.relayUrl=P[2]),se[0]&2&&(Oe.authorPubkey=P[1].authorPubkey),J.$set(Oe),(!ee||se[0]&8256&&Te!==(Te="flex gap-3 group "+(P[6]?"flex-row-reverse":"")+" "+(P[13]?"bg-warning/5 -mx-2 px-2 py-1 rounded-lg":"")))&&o(e,"class",Te),(!ee||se[0]&2&&N!==(N="message-"+P[1].id))&&o(e,"id",N)},i(P){ee||(ae(ce),ae(i),ae(T),ae(ge),ae(Y.$$.fragment,P),ae(J.$$.fragment,P),ee=!0)},o(P){_e(ce),_e(i),_e(T),_e(ge),_e(Y.$$.fragment,P),_e(J.$$.fragment,P),ee=!1},d(P){P&&h(e),ce&&ce.d(),Pe[l].d(),Ie&&Ie.d(),ke&&ke.d(),Le[E].d(),he&&he.d(),ge&&ge.d(),Se&&Se.d(),be.d(),Ae&&Ae.d(),vt(Y),vt(J),r[29](null),de=!1,St(Qe)}}}function sr(r){const e=new Date(r),t=(new Date().getTime()-e.getTime())/(1e3*60*60);return t<24?e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):t<168?e.toLocaleDateString("en-US",{weekday:"short",hour:"numeric",minute:"2-digit",hour12:!0}):e.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function go(r,e,n){let t,s,l,i,a,u,f,c,p,_,g,k=ne,w=()=>(k(),k=_n(l,N=>n(13,g=N)),l),E,T,M,R,x,z=ne,I=()=>(z(),z=_n(f,N=>n(15,x=N)),f);Mt(r,Lt,N=>n(24,E=N)),Mt(r,Hi,N=>n(25,T=N)),Mt(r,Fr,N=>n(26,M=N)),Mt(r,yn,N=>n(14,R=N)),r.$$.on_destroy.push(()=>k()),r.$$.on_destroy.push(()=>z());let{message:A}=e,{channelName:H=void 0}=e,{messageElement:O=void 0}=e,{relayUrl:Z=""}=e,{searchQuery:G=""}=e;const B=An();let W=!1;async function U(){if(confirm("Are you sure you want to delete this message?"))try{if(!Jn())throw new Error("Not connected to relay");const N=In();if(!N)throw new Error("NDK not initialized");const ee=new qn(N);if(ee.kind=jr,ee.content="Deleted by user",ee.tags=[["h",A.channelId],["e",A.id]],!await dr(ee))throw new Error("Failed to publish deletion to relay");Gr.deleteMessage(A.channelId,A.id),B("deleted",{messageId:A.id}),Kt.success("Message deleted")}catch(N){console.error("Failed to delete message:",N),Kt.error("Failed to delete message",5e3,{label:"Retry",callback:async()=>{await U()}})}}function le(){Gn.toggleBookmark(A.id,A.channelId,a,A.authorPubkey,A.createdAt,H)}async function te(){if(g)await Yt.unpinMessage(A.channelId,A.id)?(B("unpinned",{messageId:A.id}),Kt.success("Message unpinned")):Kt.error("Failed to unpin message");else{if(!i){Kt.warning("Maximum of 5 messages can be pinned per channel");return}await Yt.pinMessage(A.channelId,A.id)?(B("pinned",{messageId:A.id}),Kt.success("Message pinned")):Kt.error("Failed to pin message")}}async function Ne(N){n(7,W=!1);try{await Xt.addReaction(A.id,N.detail.emoji,Z,A.authorPubkey),B("react",{messageId:A.id,emoji:N.detail.emoji})}catch(ee){console.error("Failed to add reaction:",ee)}}function ue(N){B("react",{messageId:A.id,emoji:N.detail.emoji})}function Y(){B("unreact",{messageId:A.id})}const we=()=>n(7,W=!W),J=()=>n(7,W=!1);function Te(N){fn[N?"unshift":"push"](()=>{O=N,n(0,O)})}return r.$$set=N=>{"message"in N&&n(1,A=N.message),"channelName"in N&&n(22,H=N.channelName),"messageElement"in N&&n(0,O=N.messageElement),"relayUrl"in N&&n(2,Z=N.relayUrl),"searchQuery"in N&&n(23,G=N.searchQuery)},r.$$.update=()=>{r.$$.dirty[0]&16777218&&n(6,t=E.publicKey===A.authorPubkey),r.$$.dirty[0]&67108928&&n(12,s=t||M==="admin"),r.$$.dirty[0]&2&&w(n(11,l=Zr(A.channelId,A.id))),r.$$.dirty[0]&2&&(i=Yt.canPinMore(A.channelId)),r.$$.dirty[0]&2&&n(3,a=A.isEncrypted&&A.decryptedContent?A.decryptedContent:A.content),r.$$.dirty[0]&2&&n(5,u=!A.isEncrypted||!!A.decryptedContent),r.$$.dirty[0]&2&&I(n(10,f=pl(A.id))),r.$$.dirty[0]&50331690&&n(4,c=T.linkPreviewsEnabled&&u?Sl(a,A.tags||[],E.publicKey??void 0,bl,Tl).slice(0,3):[]),r.$$.dirty[0]&16&&n(9,p=c.length>0),r.$$.dirty[0]&16777218&&n(8,_=E.publicKey===A.authorPubkey)},[O,A,Z,a,c,u,t,W,_,p,f,l,s,g,R,x,U,le,te,Ne,ue,Y,H,G,E,T,M,we,J,Te]}class bo extends Nt{constructor(e){super(),Pt(this,e,go,_o,Rt,{message:1,channelName:22,messageElement:0,relayUrl:2,searchQuery:23},null,[-1,-1])}}const{document:zn}=Ir;function rr(r,e,n){const t=r.slice();return t[34]=e[n],t}function yo(r){let e,n,t,s,l="← Back to Channels",i,a,u=r[2].name+"",f,c,p,_,g,k=r[2].visibility+"",w,E,T,M,R,x,z,I,A,H,O,Z,G,B=r[10]?"Hide":"Show",W,U,le,te,Ne,ue,Y,we,J,Te,N,ee,de,Qe,ce,je,Pe,Ce,Ie,ke,Ke=r[5]?"Sending...":"Send",Le,He,he,ge,Se,Ee=r[2].description&&lr(r),De=r[2].encrypted&&ir();te=new fl({props:{channelId:r[1],isExpanded:r[10]}}),ue=new sl({props:{channelId:r[1],messages:r[11]}}),ue.$on("scrollTo",Mo);let be=r[6]&&or(r);const Ae=[To,wo],P=[];function se(V,q){return V[0].length===0?0:1}N=se(r),ee=P[N]=Ae[N](r);let ie=r[8]&&cr(r);return{c(){e=y("div"),n=y("div"),t=y("div"),s=y("button"),s.textContent=l,i=L(),a=y("h1"),f=$(u),c=L(),Ee&&Ee.c(),p=L(),_=y("div"),g=y("span"),w=$(k),E=L(),De&&De.c(),T=L(),M=y("span"),R=$(r[9]),x=$(" messages"),z=L(),I=y("button"),A=K("svg"),H=K("path"),O=K("path"),Z=K("path"),G=L(),W=$(B),U=$(" Stats"),le=L(),bt(te.$$.fragment),Ne=L(),bt(ue.$$.fragment),Y=L(),be&&be.c(),we=L(),J=y("div"),Te=y("div"),ee.c(),de=L(),ie&&ie.c(),Qe=L(),ce=y("div"),je=y("div"),Pe=y("form"),Ce=y("input"),Ie=L(),ke=y("button"),Le=$(Ke),this.h()},l(V){e=b(V,"DIV",{class:!0});var q=v(e);n=b(q,"DIV",{class:!0});var Oe=v(n);t=b(Oe,"DIV",{class:!0});var ye=v(t);s=b(ye,"BUTTON",{class:!0,"data-svelte-h":!0}),re(s)!=="svelte-1ccmdp8"&&(s.textContent=l),i=D(ye),a=b(ye,"H1",{class:!0});var Ve=v(a);f=Q(Ve,u),Ve.forEach(h),c=D(ye),Ee&&Ee.l(ye),p=D(ye),_=b(ye,"DIV",{class:!0});var ze=v(_);g=b(ze,"SPAN",{class:!0});var Ct=v(g);w=Q(Ct,k),Ct.forEach(h),E=D(ze),De&&De.l(ze),T=D(ze),M=b(ze,"SPAN",{class:!0});var $e=v(M);R=Q($e,r[9]),x=Q($e," messages"),$e.forEach(h),z=D(ze),I=b(ze,"BUTTON",{class:!0});var it=v(I);A=j(it,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var We=v(A);H=j(We,"path",{d:!0}),v(H).forEach(h),O=j(We,"path",{d:!0}),v(O).forEach(h),Z=j(We,"path",{d:!0}),v(Z).forEach(h),We.forEach(h),G=D(it),W=Q(it,B),U=Q(it," Stats"),it.forEach(h),ze.forEach(h),ye.forEach(h),Oe.forEach(h),le=D(q),gt(te.$$.fragment,q),Ne=D(q),gt(ue.$$.fragment,q),Y=D(q),be&&be.l(q),we=D(q),J=b(q,"DIV",{class:!0});var Xe=v(J);Te=b(Xe,"DIV",{class:!0});var ot=v(Te);ee.l(ot),ot.forEach(h),de=D(Xe),ie&&ie.l(Xe),Xe.forEach(h),Qe=D(q),ce=b(q,"DIV",{class:!0});var Et=v(ce);je=b(Et,"DIV",{class:!0});var wt=v(je);Pe=b(wt,"FORM",{class:!0});var at=v(Pe);Ce=b(at,"INPUT",{type:!0,class:!0,placeholder:!0}),Ie=D(at),ke=b(at,"BUTTON",{type:!0,class:!0});var Je=v(ke);Le=Q(Je,Ke),Je.forEach(h),at.forEach(h),wt.forEach(h),Et.forEach(h),q.forEach(h),this.h()},h(){o(s,"class","btn btn-ghost btn-sm mb-2"),o(a,"class","text-2xl font-bold"),o(g,"class","badge badge-sm badge-ghost"),o(M,"class","badge badge-sm badge-outline"),o(H,"d","M18 20V10"),o(O,"d","M12 20V4"),o(Z,"d","M6 20v-6"),o(A,"width","16"),o(A,"height","16"),o(A,"viewBox","0 0 24 24"),o(A,"fill","none"),o(A,"stroke","currentColor"),o(A,"stroke-width","2"),o(I,"class","btn btn-ghost btn-sm"),o(_,"class","flex items-center gap-2 mt-1"),o(t,"class","container mx-auto max-w-4xl"),o(n,"class","bg-base-200 border-b border-base-300 p-4"),o(Te,"class","container mx-auto max-w-4xl"),o(J,"class","flex-1 overflow-y-auto p-4 bg-base-100 relative"),o(Ce,"type","text"),o(Ce,"class","input input-bordered flex-1 text-base-content"),o(Ce,"placeholder","Type a message..."),Ce.disabled=r[5],o(ke,"type","submit"),o(ke,"class","btn btn-primary"),ke.disabled=He=r[5]||!r[3].trim(),o(Pe,"class","flex gap-2"),o(je,"class","container mx-auto max-w-4xl"),o(ce,"class","bg-base-200 border-t border-base-300 p-4"),o(e,"class","flex flex-col h-[calc(100vh-64px)]")},m(V,q){S(V,e,q),d(e,n),d(n,t),d(t,s),d(t,i),d(t,a),d(a,f),d(t,c),Ee&&Ee.m(t,null),d(t,p),d(t,_),d(_,g),d(g,w),d(_,E),De&&De.m(_,null),d(_,T),d(_,M),d(M,R),d(M,x),d(_,z),d(_,I),d(I,A),d(A,H),d(A,O),d(A,Z),d(I,G),d(I,W),d(I,U),d(e,le),_t(te,e,null),d(e,Ne),_t(ue,e,null),d(e,Y),be&&be.m(e,null),d(e,we),d(e,J),d(J,Te),P[N].m(Te,null),d(J,de),ie&&ie.m(J,null),r[23](J),d(e,Qe),d(e,ce),d(ce,je),d(je,Pe),d(Pe,Ce),$n(Ce,r[3]),d(Pe,Ie),d(Pe,ke),d(ke,Le),he=!0,ge||(Se=[oe(s,"click",r[20]),oe(I,"click",r[21]),oe(J,"scroll",r[16]),oe(Ce,"input",r[24]),oe(Ce,"input",r[17]),oe(Pe,"submit",Mr(r[14]))],ge=!0)},p(V,q){(!he||q[0]&4)&&u!==(u=V[2].name+"")&&me(f,u),V[2].description?Ee?Ee.p(V,q):(Ee=lr(V),Ee.c(),Ee.m(t,p)):Ee&&(Ee.d(1),Ee=null),(!he||q[0]&4)&&k!==(k=V[2].visibility+"")&&me(w,k),V[2].encrypted?De||(De=ir(),De.c(),De.m(_,T)):De&&(De.d(1),De=null),(!he||q[0]&512)&&me(R,V[9]),(!he||q[0]&1024)&&B!==(B=V[10]?"Hide":"Show")&&me(W,B);const Oe={};q[0]&2&&(Oe.channelId=V[1]),q[0]&1024&&(Oe.isExpanded=V[10]),te.$set(Oe);const ye={};q[0]&2&&(ye.channelId=V[1]),q[0]&2048&&(ye.messages=V[11]),ue.$set(ye),V[6]?be?be.p(V,q):(be=or(V),be.c(),be.m(e,we)):be&&(be.d(1),be=null);let Ve=N;N=se(V),N===Ve?P[N].p(V,q):(pt(),_e(P[Ve],1,1,()=>{P[Ve]=null}),mt(),ee=P[N],ee?ee.p(V,q):(ee=P[N]=Ae[N](V),ee.c()),ae(ee,1),ee.m(Te,null)),V[8]?ie?ie.p(V,q):(ie=cr(V),ie.c(),ie.m(J,null)):ie&&(ie.d(1),ie=null),(!he||q[0]&32)&&(Ce.disabled=V[5]),q[0]&8&&Ce.value!==V[3]&&$n(Ce,V[3]),(!he||q[0]&32)&&Ke!==(Ke=V[5]?"Sending...":"Send")&&me(Le,Ke),(!he||q[0]&40&&He!==(He=V[5]||!V[3].trim()))&&(ke.disabled=He)},i(V){he||(ae(te.$$.fragment,V),ae(ue.$$.fragment,V),ae(ee),he=!0)},o(V){_e(te.$$.fragment,V),_e(ue.$$.fragment,V),_e(ee),he=!1},d(V){V&&h(e),Ee&&Ee.d(),De&&De.d(),vt(te),vt(ue),be&&be.d(),P[N].d(),ie&&ie.d(),r[23](null),ge=!1,St(Se)}}}function ko(r){let e,n,t="← Back to Channels",s,l,i,a,u,f;return{c(){e=y("div"),n=y("button"),n.textContent=t,s=L(),l=y("div"),i=y("span"),a=$(r[6]),this.h()},l(c){e=b(c,"DIV",{class:!0});var p=v(e);n=b(p,"BUTTON",{class:!0,"data-svelte-h":!0}),re(n)!=="svelte-1lc3dpi"&&(n.textContent=t),s=D(p),l=b(p,"DIV",{class:!0});var _=v(l);i=b(_,"SPAN",{});var g=v(i);a=Q(g,r[6]),g.forEach(h),_.forEach(h),p.forEach(h),this.h()},h(){o(n,"class","btn btn-ghost btn-sm mb-4"),o(l,"class","alert alert-error"),o(e,"class","container mx-auto p-4 max-w-4xl")},m(c,p){S(c,e,p),d(e,n),d(e,s),d(e,l),d(l,i),d(i,a),u||(f=oe(n,"click",r[19]),u=!0)},p(c,p){p[0]&64&&me(a,c[6])},i:ne,o:ne,d(c){c&&h(e),u=!1,f()}}}function Eo(r){let e,n='<div class="loading loading-spinner loading-lg text-primary"></div>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-mo2ait"&&(e.innerHTML=n),this.h()},h(){o(e,"class","flex justify-center items-center h-[calc(100vh-64px)]")},m(t,s){S(t,e,s)},p:ne,i:ne,o:ne,d(t){t&&h(e)}}}function lr(r){let e,n=r[2].description+"",t;return{c(){e=y("p"),t=$(n),this.h()},l(s){e=b(s,"P",{class:!0});var l=v(e);t=Q(l,n),l.forEach(h),this.h()},h(){o(e,"class","text-base-content/70 text-sm")},m(s,l){S(s,e,l),d(e,t)},p(s,l){l[0]&4&&n!==(n=s[2].description+"")&&me(t,n)},d(s){s&&h(e)}}}function ir(r){let e,n="Encrypted";return{c(){e=y("span"),e.textContent=n,this.h()},l(t){e=b(t,"SPAN",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-17lvcyk"&&(e.textContent=n),this.h()},h(){o(e,"class","badge badge-sm badge-primary")},m(t,s){S(t,e,s)},d(t){t&&h(e)}}}function or(r){let e,n,t,s,l,i,a="✕",u,f;return{c(){e=y("div"),n=y("div"),t=y("span"),s=$(r[6]),l=L(),i=y("button"),i.textContent=a,this.h()},l(c){e=b(c,"DIV",{class:!0});var p=v(e);n=b(p,"DIV",{class:!0});var _=v(n);t=b(_,"SPAN",{});var g=v(t);s=Q(g,r[6]),g.forEach(h),l=D(_),i=b(_,"BUTTON",{class:!0,"data-svelte-h":!0}),re(i)!=="svelte-1hwd9n8"&&(i.textContent=a),_.forEach(h),p.forEach(h),this.h()},h(){o(i,"class","btn btn-ghost btn-xs"),o(n,"class","alert alert-warning alert-sm"),o(e,"class","container mx-auto max-w-4xl p-2")},m(c,p){S(c,e,p),d(e,n),d(n,t),d(t,s),d(n,l),d(n,i),u||(f=oe(i,"click",r[22]),u=!0)},p(c,p){p[0]&64&&me(s,c[6])},d(c){c&&h(e),u=!1,f()}}}function wo(r){let e,n=[],t=new Map,s,l=nt(r[11]);const i=a=>a[34].id;for(let a=0;a<l.length;a+=1){let u=rr(r,l,a),f=i(u);t.set(f,n[a]=ar(f,u))}return{c(){e=y("div");for(let a=0;a<n.length;a+=1)n[a].c();this.h()},l(a){e=b(a,"DIV",{class:!0});var u=v(e);for(let f=0;f<n.length;f+=1)n[f].l(u);u.forEach(h),this.h()},h(){o(e,"class","space-y-4")},m(a,u){S(a,e,u);for(let f=0;f<n.length;f+=1)n[f]&&n[f].m(e,null);s=!0},p(a,u){u[0]&6148&&(l=nt(a[11]),pt(),n=fr(n,u,i,1,a,l,t,e,Cr,ar,null,rr),mt())},i(a){if(!s){for(let u=0;u<l.length;u+=1)ae(n[u]);s=!0}},o(a){for(let u=0;u<n.length;u+=1)_e(n[u]);s=!1},d(a){a&&h(e);for(let u=0;u<n.length;u+=1)n[u].d()}}}function To(r){let e,n="<p>No messages yet. Start the conversation!</p>";return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-jcsddy"&&(e.innerHTML=n),this.h()},h(){o(e,"class","flex items-center justify-center h-full text-base-content/50")},m(t,s){S(t,e,s)},p:ne,i:ne,o:ne,d(t){t&&h(e)}}}function ar(r,e){let n,t,s;return t=new bo({props:{message:e[34],channelName:e[2]?.name,relayUrl:e[12]}}),{key:r,first:null,c(){n=Be(),bt(t.$$.fragment),this.h()},l(l){n=Be(),gt(t.$$.fragment,l),this.h()},h(){this.first=n},m(l,i){S(l,n,i),_t(t,l,i),s=!0},p(l,i){e=l;const a={};i[0]&2048&&(a.message=e[34]),i[0]&4&&(a.channelName=e[2]?.name),i[0]&4096&&(a.relayUrl=e[12]),t.$set(a)},i(l){s||(ae(t.$$.fragment,l),s=!0)},o(l){_e(t.$$.fragment,l),s=!1},d(l){l&&h(n),vt(t,l)}}}function cr(r){let e,n='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>',t,s;return{c(){e=y("button"),e.innerHTML=n,this.h()},l(l){e=b(l,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),re(e)!=="svelte-ta14zf"&&(e.innerHTML=n),this.h()},h(){o(e,"class","absolute bottom-4 right-4 btn btn-circle btn-primary shadow-lg"),o(e,"aria-label","Scroll to bottom")},m(l,i){S(l,e,i),t||(s=oe(e,"click",r[15]),t=!0)},p:ne,d(l){l&&h(e),t=!1,s()}}}function Ao(r){let e,n,t,s,l,i;zn.title=e=(r[2]?.name||"Channel")+" - "+r[13].name;const a=[Eo,ko,yo],u=[];function f(c,p){return c[4]?0:c[6]&&!c[2]?1:c[2]?2:-1}return~(t=f(r))&&(s=u[t]=a[t](r)),{c(){n=L(),s&&s.c(),l=Be()},l(c){Ar("svelte-w1m9lo",zn.head).forEach(h),n=D(c),s&&s.l(c),l=Be()},m(c,p){S(c,n,p),~t&&u[t].m(c,p),S(c,l,p),i=!0},p(c,p){(!i||p[0]&8196)&&e!==(e=(c[2]?.name||"Channel")+" - "+c[13].name)&&(zn.title=e);let _=t;t=f(c),t===_?~t&&u[t].p(c,p):(s&&(pt(),_e(u[_],1,1,()=>{u[_]=null}),mt()),~t?(s=u[t],s?s.p(c,p):(s=u[t]=a[t](c),s.c()),ae(s,1),s.m(l.parentNode,l)):s=null)},i(c){i||(ae(s),i=!0)},o(c){_e(s),i=!1},d(c){c&&(h(n),h(l)),~t&&u[t].d(c)}}}function Mo(r){const e=document.getElementById(`message-${r.detail.messageId}`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("highlight-flash"),setTimeout(()=>{e.classList.remove("highlight-flash")},2e3))}function Io(r,e,n){let t,s,l,i,a;Mt(r,Lt,Y=>n(31,i=Y)),Mt(r,Dr,Y=>n(18,a=Y));const u=Pr();let f=null,c=[],p="",_=!0,g=!1,k=null,w,E=null,T=!1,M=null,R=0,x=null,z=null,I=!0,A=!1;Mn(async()=>{if(await Lt.waitForReady(),!i.isAuthenticated||!i.publicKey){Cn(`${Dn}/`);return}try{i.privateKey&&!Jn()&&await xr(Ur,i.privateKey);const Y=Ye(es),we=Y?.cohorts??[],J=Y?.isAdmin??!1,Te=await Br({userCohorts:we,userPubkey:i.publicKey??void 0,isAdmin:J});if(n(2,f=Te.find(ee=>ee.id===t)||null),!f){n(6,k="Channel not found"),n(4,_=!1);return}n(0,c=await Hr(t)),n(9,R=c.length),E=Vr(t,ee=>{c.find(de=>de.id===ee.id)||(n(0,c=[...c,ee]),n(9,R=c.length),I&&(O(),G()))}).unsubscribe,G(),x=setInterval(()=>{n(0,c=[...c])},6e4)}catch(Y){console.error("Error loading channel:",Y),n(6,k=Y instanceof Error?Y.message:"Failed to load channel")}finally{n(4,_=!1)}}),ur(()=>{if(c.length>0){const Y=Math.max(...c.map(we=>we.createdAt));ns.setLastRead(t,Y)}E&&E(),M&&clearTimeout(M),x&&clearInterval(x),z&&clearTimeout(z)});async function H(){if(!p.trim()||g||!f)return;n(5,g=!0);const Y=p;n(3,p="");try{const we=Ye(es),J={userCohorts:we?.cohorts??[],userPubkey:i.publicKey??"",isAdmin:we?.isAdmin??!1};await zr(t,Y,void 0,J),O()}catch(we){console.error("Error sending message:",we),n(3,p=Y),n(6,k=we instanceof Error?we.message:"Failed to send message")}finally{n(5,g=!1)}}function O(){w&&setTimeout(()=>{n(7,w.scrollTop=w.scrollHeight,w)},100)}function Z(){if(w){const{scrollTop:Y,scrollHeight:we,clientHeight:J}=w,Te=we-Y-J;n(8,T=Te>100),I=Te<50,I&&G()}}function G(){z&&clearTimeout(z),z=setTimeout(()=>{if(c.length>0){const Y=Math.max(...c.map(we=>we.createdAt));ns.setLastRead(t,Y)}},1e3)}function B(){M&&clearTimeout(M),M=setTimeout(()=>{},2e3)}const W=()=>Cn(`${Dn}/chat`),U=()=>Cn(`${Dn}/chat`),le=()=>n(10,A=!A),te=()=>n(6,k=null);function Ne(Y){fn[Y?"unshift":"push"](()=>{w=Y,n(7,w)})}function ue(){p=this.value,n(3,p)}return r.$$.update=()=>{r.$$.dirty[0]&262144&&n(1,t=a.params.channelId),r.$$.dirty[0]&3&&n(11,l=c.map(Y=>({id:Y.id,channelId:t,authorPubkey:Y.pubkey,content:Y.content,createdAt:Y.createdAt*1e3,isEncrypted:!1,decryptedContent:void 0,replyTo:Y.replyTo})))},n(12,s=Or()[0]||""),[c,t,f,p,_,g,k,w,T,R,A,l,s,u,H,O,Z,B,a,W,U,le,te,Ne,ue]}class Xo extends Nt{constructor(e){super(),Pt(this,e,Io,Ao,Rt,{},null,[-1,-1])}}export{Xo as component,Yo as universal};
