import{s as Te,n as x,d as c,i as N,m as Me,g as w,x as _e,j as P,k as W,p as Se,E as Ve,T as Ce,K as we,l as d,c as u,o as Y,h as f,a as j,b as o,q as ee,e as y,f as R,t as A,r as Pe,P as ve,U as Ne}from"../chunks/CwRy9Tox.js";import{e as be,u as He,d as Be}from"../chunks/BFk-VQ8S.js";import{S as Ke,i as Le}from"../chunks/D-vqeeah.js";import{g as ye}from"../chunks/BVYH3h24.js";import{p as Oe}from"../chunks/BMPJZPAg.js";import{b as te}from"../chunks/DjSB8mDa.js";import{g as Ue,a as ge,u as ke,o as je}from"../chunks/Do1Y_WLx.js";import{d as F}from"../chunks/jXB1l9wt.js";import{t as X}from"../chunks/DDymQvxb.js";import{p as Re}from"../chunks/Da8Ipvaz.js";const Ae=!1,Fe=async({params:l})=>({recipientPubkey:l.pubkey,messages:[]}),it=Object.freeze(Object.defineProperty({__proto__:null,load:Fe,prerender:Ae},Symbol.toStringTag,{value:"Module"}));function De(l,e,t){const a=l.slice();return a[18]=e[t],a}function xe(l){let e,t,a,n,p="‚Üê Back to Messages",r,s,i,k,h,m=l[5].charAt(0).toUpperCase()+"",v,g,T,D,H,B,C,K=se(l[0])+"",O,_,E,M,Z,U,L,$,ae;function le(b,I){return b[6].length===0?Ge:ze}let q=le(l),S=q(l);function re(b,I){return b[8]?Qe:Je}let z=re(l),V=z(l);return{c(){e=f("div"),t=f("div"),a=f("div"),n=f("button"),n.textContent=p,r=P(),s=f("div"),i=f("div"),k=f("div"),h=f("span"),v=A(m),g=P(),T=f("div"),D=f("h1"),H=A(l[5]),B=P(),C=f("p"),O=A(K),_=P(),E=f("div"),M=f("div"),S.c(),Z=P(),U=f("div"),L=f("div"),V.c(),this.h()},l(b){e=u(b,"DIV",{class:!0});var I=y(e);t=u(I,"DIV",{class:!0});var ne=y(t);a=u(ne,"DIV",{class:!0});var G=y(a);n=u(G,"BUTTON",{class:!0,"data-svelte-h":!0}),Y(n)!=="svelte-2onyz5"&&(n.textContent=p),r=w(G),s=u(G,"DIV",{class:!0});var J=y(s);i=u(J,"DIV",{class:!0});var ie=y(i);k=u(ie,"DIV",{class:!0});var oe=y(k);h=u(oe,"SPAN",{});var ce=y(h);v=R(ce,m),ce.forEach(c),oe.forEach(c),ie.forEach(c),g=w(J),T=u(J,"DIV",{});var Q=y(T);D=u(Q,"H1",{class:!0});var de=y(D);H=R(de,l[5]),de.forEach(c),B=w(Q),C=u(Q,"P",{class:!0,title:!0});var ue=y(C);O=R(ue,K),ue.forEach(c),Q.forEach(c),J.forEach(c),G.forEach(c),ne.forEach(c),_=w(I),E=u(I,"DIV",{class:!0});var fe=y(E);M=u(fe,"DIV",{class:!0});var pe=y(M);S.l(pe),pe.forEach(c),fe.forEach(c),Z=w(I),U=u(I,"DIV",{class:!0});var he=y(U);L=u(he,"DIV",{class:!0});var me=y(L);V.l(me),me.forEach(c),he.forEach(c),I.forEach(c),this.h()},h(){d(n,"class","btn btn-ghost btn-sm mb-2"),d(k,"class","bg-primary text-primary-content rounded-full w-10"),d(i,"class","avatar placeholder"),d(D,"class","text-xl font-bold"),d(C,"class","text-xs text-base-content/50"),d(C,"title",l[0]),d(s,"class","flex items-center gap-3"),d(a,"class","container mx-auto max-w-2xl"),d(t,"class","bg-base-200 border-b border-base-300 p-4"),d(M,"class","container mx-auto max-w-2xl"),d(E,"class","flex-1 overflow-y-auto p-4 bg-base-100"),d(L,"class","container mx-auto max-w-2xl"),d(U,"class","bg-base-200 border-t border-base-300 p-4"),d(e,"class","flex flex-col h-[calc(100vh-64px)]")},m(b,I){N(b,e,I),o(e,t),o(t,a),o(a,n),o(a,r),o(a,s),o(s,i),o(i,k),o(k,h),o(h,v),o(s,g),o(s,T),o(T,D),o(D,H),o(T,B),o(T,C),o(C,O),o(e,_),o(e,E),o(E,M),S.m(M,null),l[14](E),o(e,Z),o(e,U),o(U,L),V.m(L,null),$||(ae=ee(n,"click",l[13]),$=!0)},p(b,I){I&32&&m!==(m=b[5].charAt(0).toUpperCase()+"")&&j(v,m),I&32&&j(H,b[5]),I&1&&K!==(K=se(b[0])+"")&&j(O,K),I&1&&d(C,"title",b[0]),q===(q=le(b))&&S?S.p(b,I):(S.d(1),S=q(b),S&&(S.c(),S.m(M,null))),z===(z=re(b))&&V?V.p(b,I):(V.d(1),V=z(b),V&&(V.c(),V.m(L,null)))},d(b){b&&c(e),S.d(),l[14](null),V.d(),$=!1,ae()}}}function qe(l){let e,t='<div class="loading loading-spinner loading-lg text-primary"></div>';return{c(){e=f("div"),e.innerHTML=t,this.h()},l(a){e=u(a,"DIV",{class:!0,"data-svelte-h":!0}),Y(e)!=="svelte-mo2ait"&&(e.innerHTML=t),this.h()},h(){d(e,"class","flex justify-center items-center h-[calc(100vh-64px)]")},m(a,n){N(a,e,n)},p:x,d(a){a&&c(e)}}}function ze(l){let e,t=[],a=new Map,n=be(l[6]);const p=r=>r[18].id;for(let r=0;r<n.length;r+=1){let s=De(l,n,r),i=p(s);a.set(i,t[r]=Ee(i,s))}return{c(){e=f("div");for(let r=0;r<t.length;r+=1)t[r].c();this.h()},l(r){e=u(r,"DIV",{class:!0});var s=y(e);for(let i=0;i<t.length;i+=1)t[i].l(s);s.forEach(c),this.h()},h(){d(e,"class","space-y-2")},m(r,s){N(r,e,s);for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(e,null)},p(r,s){s&192&&(n=be(r[6]),t=He(t,s,p,1,r,n,a,e,Be,Ee,null,De))},d(r){r&&c(e);for(let s=0;s<t.length;s+=1)t[s].d()}}}function Ge(l){let e,t="<p>No messages yet. Start the conversation!</p>";return{c(){e=f("div"),e.innerHTML=t,this.h()},l(a){e=u(a,"DIV",{class:!0,"data-svelte-h":!0}),Y(e)!=="svelte-jcsddy"&&(e.innerHTML=t),this.h()},h(){d(e,"class","flex items-center justify-center h-full text-base-content/50")},m(a,n){N(a,e,n)},p:x,d(a){a&&c(e)}}}function Ee(l,e){let t,a,n=e[18].content+"",p,r,s,i=Ie(e[18].timestamp)+"",k,h,m;return{key:l,first:null,c(){t=f("div"),a=f("div"),p=A(n),r=P(),s=f("div"),k=A(i),h=P(),this.h()},l(v){t=u(v,"DIV",{class:!0});var g=y(t);a=u(g,"DIV",{class:!0});var T=y(a);p=R(T,n),T.forEach(c),r=w(g),s=u(g,"DIV",{class:!0});var D=y(s);k=R(D,i),D.forEach(c),h=w(g),g.forEach(c),this.h()},h(){d(a,"class","chat-bubble"),d(s,"class","chat-footer opacity-50 text-xs"),d(t,"class",m="chat "+(e[18].senderPubkey===e[7].publicKey?"chat-end":"chat-start")),this.first=t},m(v,g){N(v,t,g),o(t,a),o(a,p),o(t,r),o(t,s),o(s,k),o(t,h)},p(v,g){e=v,g&64&&n!==(n=e[18].content+"")&&j(p,n),g&64&&i!==(i=Ie(e[18].timestamp)+"")&&j(k,i),g&192&&m!==(m="chat "+(e[18].senderPubkey===e[7].publicKey?"chat-end":"chat-start"))&&d(t,"class",m)},d(v){v&&c(t)}}}function Je(l){let e,t,a,n,p=l[3]?"Sending...":"Send",r,s,i,k;return{c(){e=f("form"),t=f("input"),a=P(),n=f("button"),r=A(p),this.h()},l(h){e=u(h,"FORM",{class:!0});var m=y(e);t=u(m,"INPUT",{type:!0,class:!0,placeholder:!0}),a=w(m),n=u(m,"BUTTON",{type:!0,class:!0});var v=y(n);r=R(v,p),v.forEach(c),m.forEach(c),this.h()},h(){d(t,"type","text"),d(t,"class","input input-bordered flex-1"),d(t,"placeholder","Type a message..."),t.disabled=l[3],d(n,"type","submit"),d(n,"class","btn btn-primary"),n.disabled=s=l[3]||!l[1].trim(),d(e,"class","flex gap-2")},m(h,m){N(h,e,m),o(e,t),ve(t,l[1]),o(e,a),o(e,n),o(n,r),i||(k=[ee(t,"input",l[15]),ee(e,"submit",Ne(l[10]))],i=!0)},p(h,m){m&8&&(t.disabled=h[3]),m&2&&t.value!==h[1]&&ve(t,h[1]),m&8&&p!==(p=h[3]?"Sending...":"Send")&&j(r,p),m&10&&s!==(s=h[3]||!h[1].trim())&&(n.disabled=s)},d(h){h&&c(e),i=!1,Pe(k)}}}function Qe(l){let e,t=`<span>Messaging is disabled in read-only mode.</span> <a href="${te}/signup" class="link link-primary font-semibold">Complete signup</a> <span>to send messages.</span>`;return{c(){e=f("div"),e.innerHTML=t,this.h()},l(a){e=u(a,"DIV",{class:!0,"data-svelte-h":!0}),Y(e)!=="svelte-6h0dnl"&&(e.innerHTML=t),this.h()},h(){d(e,"class","text-center text-base-content/60 py-2")},m(a,n){N(a,e,n)},p:x,d(a){a&&c(e)}}}function We(l){let e,t,a;document.title=e="DM with "+l[5]+" - "+l[9].name;function n(s,i){return s[2]?qe:xe}let p=n(l),r=p(l);return{c(){t=P(),r.c(),a=_e()},l(s){Me("svelte-3oa5hb",document.head).forEach(c),t=w(s),r.l(s),a=_e()},m(s,i){N(s,t,i),r.m(s,i),N(s,a,i)},p(s,[i]){i&544&&e!==(e="DM with "+s[5]+" - "+s[9].name)&&(document.title=e),p===(p=n(s))&&r?r.p(s,i):(r.d(1),r=p(s),r&&(r.c(),r.m(a.parentNode,a)))},i:x,o:x,d(s){s&&(c(t),c(a)),r.d(s)}}}function Ie(l){return new Date(l*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function se(l){return l.slice(0,12)+"..."+l.slice(-8)}function Xe(l,e,t){let a,n,p,r,s,i,k;W(l,ge,_=>t(7,r=_)),W(l,F,_=>t(11,s=_)),W(l,Oe,_=>t(12,i=_)),W(l,je,_=>t(8,k=_));const h=Ue();function m(_){const E=Re.getCachedSync(_);return E?.displayName?E.displayName:se(_)}let v="",g=!0,T=!1,D,H=null;Se(async()=>{if(await ge.waitForReady(),!r.isAuthenticated||!r.privateKey){ye(`${te}/`);return}s.conversations.has(a)?F.selectConversation(a):F.startConversation(a);try{const _=ke.hexToBytes(r.privateKey);H=await F.subscribeToIncoming(_)}catch(_){console.error("Failed to subscribe to DMs:",_)}t(2,g=!1)}),Ve(()=>{H&&H()}),Ce(()=>{D&&t(4,D.scrollTop=D.scrollHeight,D)});async function B(){if(!v.trim()||T||!r.privateKey)return;t(3,T=!0);const _=v;t(1,v="");try{const E=ke.hexToBytes(r.privateKey),M={publish:async()=>{}};await F.sendDM(_,M,E),X.messageSent()}catch(E){console.error("Error sending DM:",E),t(1,v=_);const M=E instanceof Error?E.message:String(E);M.includes("network")||M.includes("connection")?X.networkError(B):M.includes("auth")||M.includes("session")?X.authError():X.error("Failed to send message. Please try again.",7e3,{label:"Retry",callback:B})}finally{t(3,T=!1)}}const C=()=>ye(`${te}/dm`);function K(_){we[_?"unshift":"push"](()=>{D=_,t(4,D)})}function O(){v=this.value,t(1,v)}return l.$$.update=()=>{l.$$.dirty&4096&&t(0,a=i.params.pubkey),l.$$.dirty&2048&&t(6,n=s.messages),l.$$.dirty&1&&t(5,p=m(a))},[a,v,g,T,D,p,n,r,k,h,B,s,i,C,K,O]}class ot extends Ke{constructor(e){super(),Le(this,e,Xe,We,Te,{})}}export{ot as component,it as universal};
