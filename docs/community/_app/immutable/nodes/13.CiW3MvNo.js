import{s as ke,n as W,d as f,a as Y,i as P,b as u,q as te,l as d,c as h,e as w,f as L,g as F,h as m,t as O,j as R,p as Le,o as G,x as Ve,w as Xe,C as Tt,u as Ne,v as Me,z as Vt,G as Oe,R as be,H as je,I as xe,J as Ue,k as Te,E as Ot,y as Fe,ad as jt,ae as xt,r as Ut,P as Ze,m as zt,B as Ht}from"../chunks/CwRy9Tox.js";import{S as ye,i as we,t as U,a as x,h as ve,g as me,c as _e,d as ae,m as oe,b as ie,e as ce}from"../chunks/D-vqeeah.js";import{e as ge,u as qt,o as Yt}from"../chunks/BFk-VQ8S.js";import{g as He}from"../chunks/CQ8JIY5d.js";import{b as Ee}from"../chunks/Box6chXe.js";import{p as Kt}from"../chunks/ac69Psw1.js";import{g as Jt,a as $e,e as Qt}from"../chunks/CHLmt3N8.js";import"../chunks/4dFzpEhj.js";import{w as Wt}from"../chunks/Cz6ajzO7.js";import{isConnected as Nt,ndk as Gt,ConnectionState as et,connectRelay as Xt,connectionState as Zt}from"../chunks/2VJMwIkg.js";import{R as $t}from"../chunks/C_zicc2g.js";import{f as en}from"../chunks/BMPISLEI.js";import{W as tn,B as nn,T as sn,a as ln,M as rn}from"../chunks/xXvTRzlm.js";import{g as an}from"../chunks/9tEgXtNp.js";import{l as on}from"../chunks/BYVlzbhD.js";import{p as qe}from"../chunks/Cgcvo8-k.js";/* empty css                *//* empty css                */import"../chunks/DrfPh9KJ.js";import{f as Ye,a as cn,s as Mt}from"../chunks/BvU0z6gS.js";import{s as fn}from"../chunks/dVT4xAZe.js";import{d as Ft}from"../chunks/tonEekYJ.js";function tt(l){return l===0?"":l>99?"99+":l.toString()}function un(l){const e=l.slice(),t=qe.getCachedSync(e[2].authorPubkey);e[9]=t;const n=e[9]?.displayName||e[2].authorPubkey.substring(0,8)+"...";e[10]=n;const s=e[9]?.avatar||an(e[2].authorPubkey,32);return e[11]=s,e}function nt(l){let e,t="Open";return{c(){e=m("span"),e.textContent=t,this.h()},l(n){e=h(n,"SPAN",{class:!0,title:!0,"data-svelte-h":!0}),G(e)!=="svelte-st15ms"&&(e.textContent=t),this.h()},h(){d(e,"class","badge badge-success badge-xs"),d(e,"title","Open - anyone can post")},m(n,s){P(n,e,s)},d(n){n&&f(e)}}}function st(l){let e,t=tt(l[4])+"",n;return{c(){e=m("span"),n=O(t),this.h()},l(s){e=h(s,"SPAN",{class:!0});var r=w(e);n=L(r,t),r.forEach(f),this.h()},h(){d(e,"class","badge badge-primary badge-sm rounded-full")},m(s,r){P(s,e,r),u(e,n)},p(s,r){r&16&&t!==(t=tt(s[4])+"")&&Y(n,t)},d(s){s&&f(e)}}}function lt(l){let e,t=l[0].description+"",n;return{c(){e=m("p"),n=O(t),this.h()},l(s){e=h(s,"P",{class:!0});var r=w(e);n=L(r,t),r.forEach(f),this.h()},h(){d(e,"class","text-sm text-base-content/70 line-clamp-1 mt-0.5")},m(s,r){P(s,e,r),u(e,n)},p(s,r){r&1&&t!==(t=s[0].description+"")&&Y(n,t)},d(s){s&&f(e)}}}function dn(l){let e,t,n,s,r,o=l[0].encrypted&&rt();return{c(){e=m("div"),t=O(l[1]),n=O(" posts"),s=R(),o&&o.c(),r=Ve(),this.h()},l(a){e=h(a,"DIV",{class:!0});var i=w(e);t=L(i,l[1]),n=L(i," posts"),i.forEach(f),s=F(a),o&&o.l(a),r=Ve(),this.h()},h(){d(e,"class","badge badge-primary badge-sm")},m(a,i){P(a,e,i),u(e,t),u(e,n),P(a,s,i),o&&o.m(a,i),P(a,r,i)},p(a,i){i&2&&Y(t,a[1]),a[0].encrypted?o||(o=rt(),o.c(),o.m(r.parentNode,r)):o&&(o.d(1),o=null)},d(a){a&&(f(e),f(s),f(r)),o&&o.d(a)}}}function hn(l){let e;return{c(){e=m("span"),this.h()},l(t){e=h(t,"SPAN",{class:!0}),w(e).forEach(f),this.h()},h(){d(e,"class","loading loading-spinner loading-xs")},m(t,n){P(t,e,n)},p:W,d(t){t&&f(e)}}}function rt(l){let e,t="üîí Encrypted";return{c(){e=m("div"),e.textContent=t,this.h()},l(n){e=h(n,"DIV",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-85okh"&&(e.textContent=t),this.h()},h(){d(e,"class","badge badge-secondary badge-sm")},m(n,s){P(n,e,s)},d(n){n&&f(e)}}}function mn(l){let e,t="No messages yet - be the first to post!";return{c(){e=m("div"),e.textContent=t,this.h()},l(n){e=h(n,"DIV",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-1wrkyee"&&(e.textContent=t),this.h()},h(){d(e,"class","mt-2 pt-2 border-t border-base-300 text-xs text-base-content/40 italic")},m(n,s){P(n,e,s)},p:W,d(n){n&&f(e)}}}function at(l){let e,t,n,s,r,o,a,i=l[10]+"",c,_,D,y,C=l[2].content+"",E,b,v,S=ot(l[2].timestamp)+"",I;return{c(){e=m("div"),t=m("div"),n=m("img"),o=R(),a=m("span"),c=O(i),_=O(":"),D=R(),y=m("span"),E=O(C),b=R(),v=m("span"),I=O(S),this.h()},l(p){e=h(p,"DIV",{class:!0});var k=w(e);t=h(k,"DIV",{class:!0});var V=w(t);n=h(V,"IMG",{src:!0,alt:!0,class:!0}),o=F(V),a=h(V,"SPAN",{class:!0});var M=w(a);c=L(M,i),_=L(M,":"),M.forEach(f),D=F(V),y=h(V,"SPAN",{class:!0});var T=w(y);E=L(T,C),T.forEach(f),b=F(V),v=h(V,"SPAN",{class:!0});var g=w(v);I=L(g,S),g.forEach(f),V.forEach(f),k.forEach(f),this.h()},h(){Xe(n.src,s=l[11])||d(n,"src",s),d(n,"alt",r=l[10]),d(n,"class","w-4 h-4 rounded-full"),d(a,"class","font-medium"),d(y,"class","truncate flex-1"),d(v,"class","flex-shrink-0"),d(t,"class","flex items-center gap-2"),d(e,"class","mt-2 pt-2 border-t border-base-300 text-xs text-base-content/60")},m(p,k){P(p,e,k),u(e,t),u(t,n),u(t,o),u(t,a),u(a,c),u(a,_),u(t,D),u(t,y),u(y,E),u(t,b),u(t,v),u(v,I)},p(p,k){k&4&&!Xe(n.src,s=p[11])&&d(n,"src",s),k&4&&r!==(r=p[10])&&d(n,"alt",r),k&4&&i!==(i=p[10]+"")&&Y(c,i),k&4&&C!==(C=p[2].content+"")&&Y(E,C),k&4&&S!==(S=ot(p[2].timestamp)+"")&&Y(I,S)},d(p){p&&f(e)}}}function _n(l){let e,t,n,s,r,o=l[5](l[0].name)+"",a,i,c,_,D,y,C,E=l[0].name+"",b,v,S,I,p,k,V,M,T,g=l[0].accessType==="open"&&nt(),A=!l[3]&&l[4]>0&&st(l),N=l[0].description&&lt(l);function J(j,H){return j[3]?hn:dn}let Q=J(l),K=Q(l);function ne(j,H){if(j[2])return at;if(!j[3])return mn}function se(j,H){return H===at?un(j):j}let Z=ne(l),z=Z&&Z(se(l,Z));return{c(){e=m("button"),t=m("div"),n=m("div"),s=m("div"),r=m("div"),a=O(o),i=R(),c=m("div"),_=m("div"),D=m("div"),y=m("div"),C=m("h3"),b=O(E),v=R(),g&&g.c(),S=R(),A&&A.c(),I=R(),N&&N.c(),p=R(),k=m("div"),K.c(),V=R(),z&&z.c(),this.h()},l(j){e=h(j,"BUTTON",{class:!0});var H=w(e);t=h(H,"DIV",{class:!0});var re=w(t);n=h(re,"DIV",{class:!0});var fe=w(n);s=h(fe,"DIV",{class:!0});var Ce=w(s);r=h(Ce,"DIV",{class:!0});var q=w(r);a=L(q,o),q.forEach(f),Ce.forEach(f),i=F(fe),c=h(fe,"DIV",{class:!0});var de=w(c);_=h(de,"DIV",{class:!0});var $=w(_);D=h($,"DIV",{class:!0});var he=w(D);y=h(he,"DIV",{class:!0});var B=w(y);C=h(B,"H3",{class:!0});var X=w(C);b=L(X,E),X.forEach(f),v=F(B),g&&g.l(B),S=F(B),A&&A.l(B),B.forEach(f),I=F(he),N&&N.l(he),he.forEach(f),p=F($),k=h($,"DIV",{class:!0});var le=w(k);K.l(le),le.forEach(f),$.forEach(f),V=F(de),z&&z.l(de),de.forEach(f),fe.forEach(f),re.forEach(f),H.forEach(f),this.h()},h(){d(r,"class","w-12 h-12 rounded-lg bg-primary/20 flex items-center justify-center text-2xl"),d(s,"class","flex-shrink-0"),d(C,"class","font-bold text-base truncate"),d(y,"class","flex items-center gap-2 flex-wrap"),d(D,"class","flex-1"),d(k,"class","flex flex-col items-end gap-1 flex-shrink-0"),d(_,"class","flex items-start justify-between gap-2"),d(c,"class","flex-1 min-w-0"),d(n,"class","flex gap-4"),d(t,"class","card-body p-4"),d(e,"class","card bg-base-200 hover:bg-base-300 transition-all cursor-pointer text-left w-full border border-transparent hover:border-primary/30")},m(j,H){P(j,e,H),u(e,t),u(t,n),u(n,s),u(s,r),u(r,a),u(n,i),u(n,c),u(c,_),u(_,D),u(D,y),u(y,C),u(C,b),u(y,v),g&&g.m(y,null),u(y,S),A&&A.m(y,null),u(D,I),N&&N.m(D,null),u(_,p),u(_,k),K.m(k,null),u(c,V),z&&z.m(c,null),M||(T=te(e,"click",l[6]),M=!0)},p(j,[H]){H&1&&o!==(o=j[5](j[0].name)+"")&&Y(a,o),H&1&&E!==(E=j[0].name+"")&&Y(b,E),j[0].accessType==="open"?g||(g=nt(),g.c(),g.m(y,S)):g&&(g.d(1),g=null),!j[3]&&j[4]>0?A?A.p(j,H):(A=st(j),A.c(),A.m(y,null)):A&&(A.d(1),A=null),j[0].description?N?N.p(j,H):(N=lt(j),N.c(),N.m(D,null)):N&&(N.d(1),N=null),Q===(Q=J(j))&&K?K.p(j,H):(K.d(1),K=Q(j),K&&(K.c(),K.m(k,null))),Z===(Z=ne(j))&&z?z.p(se(j,Z),H):(z&&z.d(1),z=Z&&Z(se(j,Z)),z&&(z.c(),z.m(c,null)))},i:W,o:W,d(j){j&&f(e),g&&g.d(),A&&A.d(),N&&N.d(),K.d(),z&&z.d(),M=!1,T()}}}function ot(l){const t=Math.floor(Date.now()/1e3)-l;return t<60?"just now":t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:t<604800?`${Math.floor(t/86400)}d ago`:new Date(l*1e3).toLocaleDateString()}function pn(l,e,t){let{channel:n}=e,s=0,r=null,o=!0,a=[],i=0;const c={general:"üí¨",music:"üéµ",tuneage:"üéµ",events:"üìÖ",calendar:"üìÖ",help:"‚ùì",support:"üÜò",announcements:"üì¢",news:"üì∞",random:"üé≤",offtopic:"üí≠",tech:"üíª",gaming:"üéÆ",art:"üé®",photos:"üì∑",video:"üé¨",food:"üçï",sports:"‚öΩ",fitness:"üí™",books:"üìö",movies:"üé¨",pets:"üêï",travel:"‚úàÔ∏è",memes:"üòÇ",default:"üí≠"};function _(y){const C=y.toLowerCase();for(const[E,b]of Object.entries(c))if(C.includes(E))return b;return c.default}Le(async()=>{try{if(!Nt()){console.warn("NDK not connected"),t(3,o=!1);return}const y=Gt();if(!y){console.warn("NDK instance not available"),t(3,o=!1);return}const C=await y.fetchEvents({kinds:[42],"#e":[n.id],limit:100});t(1,s=C.size),a=Array.from(C).map(b=>({id:b.id,channelId:n.id,authorPubkey:b.pubkey,content:b.content,createdAt:b.created_at||0,isEncrypted:!1})),t(4,i=on.getUnreadCount(n.id,a));let E=null;for(const b of C)(!E||(b.created_at||0)>E.created_at)&&(E={content:b.content,pubkey:b.pubkey,created_at:b.created_at||0});if(E){qe.getProfile(E.pubkey);const b=qe.getCachedSync(E.pubkey);t(2,r={content:E.content.substring(0,60)+(E.content.length>60?"...":""),author:b?.displayName||E.pubkey.substring(0,8)+"...",authorPubkey:E.pubkey,timestamp:E.created_at})}}catch(y){console.error("Failed to fetch channel stats:",y)}finally{t(3,o=!1)}});function D(){He(`${Ee}/chat/${n.id}`)}return l.$$set=y=>{"channel"in y&&t(0,n=y.channel)},[n,s,r,o,i,_,D]}class bn extends ye{constructor(e){super(),we(this,e,pn,_n,ke,{channel:0})}}const vn=!0,gn=async()=>({channels:[]}),Us=Object.freeze(Object.defineProperty({__proto__:null,load:gn,prerender:vn},Symbol.toStringTag,{value:"Module"}));function kn(l){let e,t,n;return{c(){e=Me("svg"),t=Me("path"),n=O(`
    Mark All as Read`),this.h()},l(s){e=Ne(s,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var r=w(e);t=Ne(r,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),w(t).forEach(f),r.forEach(f),n=L(s,`
    Mark All as Read`),this.h()},h(){d(t,"stroke-linecap","round"),d(t,"stroke-linejoin","round"),d(t,"stroke-width","2"),d(t,"d","M5 13l4 4L19 7"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"class","h-4 w-4"),d(e,"fill","none"),d(e,"viewBox","0 0 24 24"),d(e,"stroke","currentColor")},m(s,r){P(s,e,r),u(e,t),P(s,n,r)},d(s){s&&(f(e),f(n))}}}function yn(l){let e,t,n;return{c(){e=Me("svg"),t=Me("path"),n=O(`
    Marked!`),this.h()},l(s){e=Ne(s,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var r=w(e);t=Ne(r,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),w(t).forEach(f),r.forEach(f),n=L(s,`
    Marked!`),this.h()},h(){d(t,"stroke-linecap","round"),d(t,"stroke-linejoin","round"),d(t,"stroke-width","2"),d(t,"d","M5 13l4 4L19 7"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"class","h-4 w-4"),d(e,"fill","none"),d(e,"viewBox","0 0 24 24"),d(e,"stroke","currentColor")},m(s,r){P(s,e,r),u(e,t),P(s,n,r)},d(s){s&&(f(e),f(n))}}}function wn(l){let e;return{c(){e=m("span"),this.h()},l(t){e=h(t,"SPAN",{class:!0}),w(e).forEach(f),this.h()},h(){d(e,"class","loading loading-spinner loading-xs")},m(t,n){P(t,e,n)},d(t){t&&f(e)}}}function Cn(l){let e,t,n,s;function r(i,c){return i[0]?wn:i[1]?yn:kn}let o=r(l),a=o(l);return{c(){e=m("button"),a.c(),this.h()},l(i){e=h(i,"BUTTON",{class:!0});var c=w(e);a.l(c),c.forEach(f),this.h()},h(){d(e,"class",t="btn btn-sm "+(l[1]?"btn-success":"btn-ghost")+" gap-2"),e.disabled=l[0]},m(i,c){P(i,e,c),a.m(e,null),n||(s=te(e,"click",l[2]),n=!0)},p(i,[c]){o!==(o=r(i))&&(a.d(1),a=o(i),a&&(a.c(),a.m(e,null))),c&2&&t!==(t="btn btn-sm "+(i[1]?"btn-success":"btn-ghost")+" gap-2")&&d(e,"class",t),c&1&&(e.disabled=i[0])},i:W,o:W,d(i){i&&f(e),a.d(),n=!1,s()}}}const it="nostr_bbs_read_posts";function En(l,e,t){const n=Tt();let s=!1,r=!1;function o(){t(0,s=!0);const c=Math.floor(Date.now()/1e3);localStorage.setItem(it,c.toString()),setTimeout(()=>{t(0,s=!1),t(1,r=!0),n("marked"),setTimeout(()=>{t(1,r=!1)},2e3)},500)}function a(){const c=localStorage.getItem(it);return c?parseInt(c):0}function i(c){return c<=a()}return[s,r,o,a,i]}class Sn extends ye{constructor(e){super(),we(this,e,En,Cn,ke,{getLastReadTime:3,isPostRead:4})}get getLastReadTime(){return this.$$.ctx[3]}get isPostRead(){return this.$$.ctx[4]}}function ct(l,e,t){const n=l.slice();return n[4]=e[t],n[6]=t,n}function ft(l){let e,t,n;return{c(){e=m("div"),this.h()},l(s){e=h(s,"DIV",{class:!0,style:!0}),w(e).forEach(f),this.h()},h(){d(e,"class",t="skeleton bg-base-300 animate-pulse "+l[3][l[0]]+" svelte-94zcau"),d(e,"style",n=l[0]==="text"&&l[6]%3===2?"width: 60%":"")},m(s,r){P(s,e,r)},p(s,r){r&1&&t!==(t="skeleton bg-base-300 animate-pulse "+s[3][s[0]]+" svelte-94zcau")&&d(e,"class",t),r&1&&n!==(n=s[0]==="text"&&s[6]%3===2?"width: 60%":"")&&d(e,"style",n)},d(s){s&&f(e)}}}function In(l){let e,t,n=ge(Array(l[1])),s=[];for(let r=0;r<n.length;r+=1)s[r]=ft(ct(l,n,r));return{c(){e=m("div");for(let r=0;r<s.length;r+=1)s[r].c();this.h()},l(r){e=h(r,"DIV",{class:!0,style:!0});var o=w(e);for(let a=0;a<s.length;a+=1)s[a].l(o);o.forEach(f),this.h()},h(){d(e,"class","space-y-2"),d(e,"style",t=l[2]?`width: ${l[2]}`:"")},m(r,o){P(r,e,o);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null)},p(r,[o]){if(o&11){n=ge(Array(r[1]));let a;for(a=0;a<n.length;a+=1){const i=ct(r,n,a);s[a]?s[a].p(i,o):(s[a]=ft(i),s[a].c(),s[a].m(e,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=n.length}o&4&&t!==(t=r[2]?`width: ${r[2]}`:"")&&d(e,"style",t)},i:W,o:W,d(r){r&&f(e),Vt(s,r)}}}function Dn(l,e,t){let{variant:n="text"}=e,{count:s=1}=e,{width:r=""}=e;const o={text:"h-4 w-full rounded",avatar:"w-10 h-10 rounded-full",card:"h-24 w-full rounded-lg",message:"h-16 w-full rounded-lg",channel:"h-20 w-full rounded-lg"};return l.$$set=a=>{"variant"in a&&t(0,n=a.variant),"count"in a&&t(1,s=a.count),"width"in a&&t(2,r=a.width)},[n,s,r,o]}class An extends ye{constructor(e){super(),we(this,e,Dn,In,ke,{variant:0,count:1,width:2})}}const Pn=l=>({}),ut=l=>({}),Tn=l=>({}),dt=l=>({}),Vn=l=>({}),ht=l=>({});function Nn(l){let e;const t=l[11].illustration,n=Oe(t,l,l[10],ht);return{c(){n&&n.c()},l(s){n&&n.l(s)},m(s,r){n&&n.m(s,r),e=!0},p(s,r){n&&n.p&&(!e||r&1024)&&je(n,t,s,s[10],e?Ue(t,s[10],r,Vn):xe(s[10]),ht)},i(s){e||(x(n,s),e=!0)},o(s){U(n,s),e=!1},d(s){n&&n.d(s)}}}function Mn(l){let e,t,n;return{c(){e=m("div"),t=O(l[0]),this.h()},l(s){e=h(s,"DIV",{class:!0,style:!0,"aria-hidden":!0});var r=w(e);t=L(r,l[0]),r.forEach(f),this.h()},h(){d(e,"class","text-6xl mb-6 opacity-60"),Fe(e,"transform","translateY("+l[6]+"px)"),d(e,"aria-hidden","true")},m(s,r){P(s,e,r),u(e,t)},p(s,r){r&1&&Y(t,s[0]),r&64&&Fe(e,"transform","translateY("+s[6]+"px)")},i(s){s&&(n||be(()=>{n=ve(e,Mt,{duration:400,delay:100,start:.8}),n.start()}))},o:W,d(s){s&&f(e)}}}function Fn(l){let e,t,n=l[9][l[5]]+"",s;return{c(){e=m("div"),t=new xt(!1),this.h()},l(r){e=h(r,"DIV",{class:!0,style:!0});var o=w(e);t=jt(o,!1),o.forEach(f),this.h()},h(){t.a=null,d(e,"class","mb-6 opacity-80"),Fe(e,"transform","translateY("+l[6]+"px)")},m(r,o){P(r,e,o),t.m(n,e)},p(r,o){o&32&&n!==(n=r[9][r[5]]+"")&&t.p(n),o&64&&Fe(e,"transform","translateY("+r[6]+"px)")},i(r){r&&(s||be(()=>{s=ve(e,Mt,{duration:400,delay:100,start:.8}),s.start()}))},o:W,d(r){r&&f(e)}}}function mt(l){let e,t,n;return{c(){e=m("p"),t=O(l[2]),this.h()},l(s){e=h(s,"P",{class:!0});var r=w(e);t=L(r,l[2]),r.forEach(f),this.h()},h(){d(e,"class","text-base-content/60 mb-8 max-w-md leading-relaxed")},m(s,r){P(s,e,r),u(e,t)},p(s,r){r&4&&Y(t,s[2])},i(s){s&&(n||be(()=>{n=ve(e,Ye,{y:10,duration:300,delay:200}),n.start()}))},o:W,d(s){s&&f(e)}}}function _t(l){let e,t,n,s,r=l[3]&&pt(l),o=l[4]&&bt(l);return{c(){e=m("div"),r&&r.c(),t=R(),o&&o.c(),this.h()},l(a){e=h(a,"DIV",{class:!0});var i=w(e);r&&r.l(i),t=F(i),o&&o.l(i),i.forEach(f),this.h()},h(){d(e,"class","flex flex-wrap gap-3 justify-center")},m(a,i){P(a,e,i),r&&r.m(e,null),u(e,t),o&&o.m(e,null),s=!0},p(a,i){a[3]?r?(r.p(a,i),i&8&&x(r,1)):(r=pt(a),r.c(),x(r,1),r.m(e,t)):r&&(me(),U(r,1,1,()=>{r=null}),_e()),a[4]?o?(o.p(a,i),i&16&&x(o,1)):(o=bt(a),o.c(),x(o,1),o.m(e,null)):o&&(me(),U(o,1,1,()=>{o=null}),_e())},i(a){s||(x(r),x(o),a&&(n||be(()=>{n=ve(e,Ye,{y:10,duration:300,delay:250}),n.start()})),s=!0)},o(a){U(r),U(o),s=!1},d(a){a&&f(e),r&&r.d(),o&&o.d()}}}function pt(l){let e,t,n,s,r,o;const a=l[11]["action-icon"],i=Oe(a,l,l[10],dt);return{c(){e=m("button"),i&&i.c(),t=R(),n=O(l[3]),this.h()},l(c){e=h(c,"BUTTON",{class:!0});var _=w(e);i&&i.l(_),t=F(_),n=L(_,l[3]),_.forEach(f),this.h()},h(){d(e,"class","btn btn-primary gap-2 focus-ring")},m(c,_){P(c,e,_),i&&i.m(e,null),u(e,t),u(e,n),s=!0,r||(o=te(e,"click",l[12]),r=!0)},p(c,_){i&&i.p&&(!s||_&1024)&&je(i,a,c,c[10],s?Ue(a,c[10],_,Tn):xe(c[10]),dt),(!s||_&8)&&Y(n,c[3])},i(c){s||(x(i,c),s=!0)},o(c){U(i,c),s=!1},d(c){c&&f(e),i&&i.d(c),r=!1,o()}}}function bt(l){let e,t,n,s,r,o;const a=l[11]["secondary-icon"],i=Oe(a,l,l[10],ut);return{c(){e=m("button"),i&&i.c(),t=R(),n=O(l[4]),this.h()},l(c){e=h(c,"BUTTON",{class:!0});var _=w(e);i&&i.l(_),t=F(_),n=L(_,l[4]),_.forEach(f),this.h()},h(){d(e,"class","btn btn-ghost gap-2 focus-ring")},m(c,_){P(c,e,_),i&&i.m(e,null),u(e,t),u(e,n),s=!0,r||(o=te(e,"click",l[13]),r=!0)},p(c,_){i&&i.p&&(!s||_&1024)&&je(i,a,c,c[10],s?Ue(a,c[10],_,Pn):xe(c[10]),ut),(!s||_&16)&&Y(n,c[4])},i(c){s||(x(i,c),s=!0)},o(c){U(i,c),s=!1},d(c){c&&f(e),i&&i.d(c),r=!1,o()}}}function Rn(l){let e,t,n,s,r,o,a,i,c,_,D,y;const C=[Fn,Mn,Nn],E=[];function b(k,V){return k[5]!=="none"&&k[5]!=="custom"?0:k[0]?1:2}t=b(l),n=E[t]=C[t](l);let v=l[2]&&mt(l),S=(l[3]||l[4])&&_t(l);const I=l[11].default,p=Oe(I,l,l[10],null);return{c(){e=m("div"),n.c(),s=R(),r=m("h3"),o=O(l[1]),i=R(),v&&v.c(),c=R(),S&&S.c(),_=R(),p&&p.c(),this.h()},l(k){e=h(k,"DIV",{class:!0,role:!0,"aria-live":!0});var V=w(e);n.l(V),s=F(V),r=h(V,"H3",{class:!0});var M=w(r);o=L(M,l[1]),M.forEach(f),i=F(V),v&&v.l(V),c=F(V),S&&S.l(V),_=F(V),p&&p.l(V),V.forEach(f),this.h()},h(){d(r,"class","text-xl font-semibold text-base-content mb-3"),d(e,"class","flex flex-col items-center justify-center py-16 px-6 text-center"),d(e,"role","status"),d(e,"aria-live","polite")},m(k,V){P(k,e,V),E[t].m(e,null),u(e,s),u(e,r),u(r,o),u(e,i),v&&v.m(e,null),u(e,c),S&&S.m(e,null),u(e,_),p&&p.m(e,null),y=!0},p(k,[V]){let M=t;t=b(k),t===M?E[t].p(k,V):(me(),U(E[M],1,1,()=>{E[M]=null}),_e(),n=E[t],n?n.p(k,V):(n=E[t]=C[t](k),n.c()),x(n,1),n.m(e,s)),(!y||V&2)&&Y(o,k[1]),k[2]?v?(v.p(k,V),V&4&&x(v,1)):(v=mt(k),v.c(),x(v,1),v.m(e,c)):v&&(v.d(1),v=null),k[3]||k[4]?S?(S.p(k,V),V&24&&x(S,1)):(S=_t(k),S.c(),x(S,1),S.m(e,_)):S&&(me(),U(S,1,1,()=>{S=null}),_e()),p&&p.p&&(!y||V&1024)&&je(p,I,k,k[10],y?Ue(I,k[10],V,null):xe(k[10]),null)},i(k){y||(x(n),k&&(a||be(()=>{a=ve(r,Ye,{y:10,duration:300,delay:150}),a.start()})),x(v),x(S),x(p,k),k&&(D||be(()=>{D=ve(e,cn,{duration:300}),D.start()})),y=!0)},o(k){U(n),U(S),U(p,k),y=!1},d(k){k&&f(e),E[t].d(),v&&v.d(),S&&S.d(),p&&p.d(k)}}}function Bn(l,e,t){let n,{$$slots:s={},$$scope:r}=e,{icon:o=""}=e,{title:a="Nothing here yet"}=e,{description:i=""}=e,{actionLabel:c=""}=e,{secondaryActionLabel:_=""}=e,{illustration:D="none"}=e;const y=Tt(),C=fn(0,{stiffness:.02,damping:.3});Te(l,C,I=>t(6,n=I));let E=null;Le(()=>{E=setInterval(()=>{C.set(Math.sin(Date.now()/1e3)*4)},50)}),Ot(()=>{E&&clearInterval(E)});const b={"empty-inbox":`<svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-32 h-32 text-base-content/20">
      <rect x="40" y="60" width="120" height="100" rx="8" stroke="currentColor" stroke-width="2" fill="none"/>
      <path d="M40 80 L100 120 L160 80" stroke="currentColor" stroke-width="2" fill="none"/>
      <circle cx="100" cy="50" r="20" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
    </svg>`,"no-results":`<svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-32 h-32 text-base-content/20">
      <circle cx="85" cy="85" r="45" stroke="currentColor" stroke-width="2" fill="none"/>
      <line x1="120" y1="120" x2="160" y2="160" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
      <line x1="70" y1="85" x2="100" y2="85" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>`,error:`<svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-32 h-32 text-error/40">
      <circle cx="100" cy="100" r="60" stroke="currentColor" stroke-width="2" fill="none"/>
      <line x1="75" y1="75" x2="125" y2="125" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
      <line x1="125" y1="75" x2="75" y2="125" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
    </svg>`,offline:`<svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-32 h-32 text-warning/40">
      <path d="M50 120 Q100 80 150 120" stroke="currentColor" stroke-width="2" fill="none"/>
      <path d="M65 135 Q100 105 135 135" stroke="currentColor" stroke-width="2" fill="none"/>
      <path d="M80 150 Q100 130 120 150" stroke="currentColor" stroke-width="2" fill="none"/>
      <line x1="60" y1="60" x2="140" y2="140" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
    </svg>`,custom:"",none:""},v=()=>y("action"),S=()=>y("secondaryAction");return l.$$set=I=>{"icon"in I&&t(0,o=I.icon),"title"in I&&t(1,a=I.title),"description"in I&&t(2,i=I.description),"actionLabel"in I&&t(3,c=I.actionLabel),"secondaryActionLabel"in I&&t(4,_=I.secondaryActionLabel),"illustration"in I&&t(5,D=I.illustration),"$$scope"in I&&t(10,r=I.$$scope)},[o,a,i,c,_,D,n,y,C,b,r,s,v,S]}class Ln extends ye{constructor(e){super(),we(this,e,Bn,Rn,ke,{icon:0,title:1,description:2,actionLabel:3,secondaryActionLabel:4,illustration:5})}}const On="embedding_sync_preference";function jn(){if(typeof navigator>"u")return!1;const l=navigator.userAgent;return/Safari/.test(l)&&!/Chrome|CriOS|Edg/.test(l)}function xn(){return typeof navigator>"u"?!1:/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}function Un(){return typeof localStorage>"u"?null:localStorage.getItem(On)}function Rt(){if(typeof navigator>"u")return!1;const l=Un();if(l==="always")return!0;if(l==="manual")return!1;const e=navigator.connection;if(!e)return xn()?!1:(jn(),!0);const t=e.type;return t==="wifi"||t==="ethernet"||e.effectiveType==="4g"&&!e.saveData||e.metered===!1}const Ke="https://embedding-api-617806532906.us-central1.run.app",Bt="nostr-bbs/semantic";let ee=new Map,Se=!1,Re=0;function zn(l,e){if(l.length!==e.length)return 0;let t=0,n=0,s=0;for(let o=0;o<l.length;o++)t+=l[o]*e[o],n+=l[o]*l[o],s+=e[o]*e[o];const r=Math.sqrt(n)*Math.sqrt(s);return r===0?0:t/r}async function Hn(l){try{const e=await fetch(`${Ke}/embed`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:l})});if(!e.ok)throw new Error(`Embedding API error: ${e.status}`);const t=await e.json();if(!t.embeddings||t.embeddings.length===0)throw new Error("No embedding returned from API");return t.embeddings[0]}catch(e){return console.error("Embedding API call failed:",e),qn(l)}}function qn(l){const t=new Array(384).fill(0);for(let s=0;s<l.length;s++){const r=l.charCodeAt(s),o=r*(s+1)%384;t[o]+=r/255}const n=Math.sqrt(t.reduce((s,r)=>s+r*r,0))||1;return t.map(s=>s/n)}async function Lt(){try{const l=await fetch(`${Ke}/api/embeddings/list`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({namespace:Bt,limit:1e4})});if(!l.ok)return console.warn("RuVector API not available, trying local cache"),ze();const e=await l.json();if(!e.embeddings||e.embeddings.length===0)return console.log("No embeddings in RuVector, trying local cache"),ze();ee.clear();for(const t of e.embeddings){const n=t.metadata?.noteId||t.key;ee.set(n,{noteId:n,embedding:t.embedding,content:t.metadata?.content,timestamp:Date.now()})}return await Yn(),Se=!0,Re=Date.now(),console.log(`Loaded ${ee.size} embeddings from RuVector`),!0}catch(l){return console.error("Failed to load from RuVector:",l),ze()}}async function ze(){try{const l=await Ft.table("embeddings").get("ruvector_cache");if(!l?.data)return!1;const e=JSON.parse(l.data);ee.clear();for(const t of e)ee.set(t.noteId,t);return Se=ee.size>0,Re=l.timestamp||Date.now(),console.log(`Loaded ${ee.size} embeddings from IndexedDB cache`),Se}catch(l){return console.error("Failed to load from IndexedDB:",l),!1}}async function Yn(){try{const l=Array.from(ee.values());await Ft.table("embeddings").put({key:"ruvector_cache",data:JSON.stringify(l),timestamp:Date.now(),count:l.length})}catch(l){console.error("Failed to save to IndexedDB:",l)}}async function Kn(l,e=10,t=.5){const n=await Hn(l);try{const s=await Jn(n,e,t);if(s.length>0)return s}catch{console.log("Server search unavailable, using local cache")}return Qn(n,e,t)}async function Jn(l,e,t){const n=await fetch(`${Ke}/api/embeddings/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({embedding:l,namespace:Bt,k:e,minScore:t})});if(!n.ok)throw new Error(`Search API error: ${n.status}`);return(await n.json()).results.map(r=>({noteId:r.metadata?.noteId||r.key,score:r.score,distance:1-r.score}))}function Qn(l,e,t){if(!Se||ee.size===0)throw new Error("Local cache not loaded");const n=[];for(const[s,r]of ee){const o=zn(l,r.embedding);o>=t&&n.push({noteId:s,score:o,distance:1-o})}return n.sort((s,r)=>r.score-s.score),n.slice(0,e)}function vt(){return Se?{vectorCount:ee.size,dimensions:384,lastUpdated:Re?new Date(Re).toISOString():null,searchMode:navigator.onLine?"hybrid":"cached"}:null}async function Wn(l=!1){return!navigator.onLine&&!l?{synced:!1,count:ee.size}:{synced:await Lt(),count:ee.size}}const Gn=Lt;function gt(l,e,t){const n=l.slice();return n[16]=e[t],n}function kt(l){let e,t="...";return{c(){e=m("span"),e.textContent=t,this.h()},l(n){e=h(n,"SPAN",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-1nvyc9z"&&(e.textContent=t),this.h()},h(){d(e,"class","loading-indicator svelte-8oktfb")},m(n,s){P(n,e,s)},d(n){n&&f(e)}}}function yt(l){let e,t;return{c(){e=m("div"),t=O(l[4]),this.h()},l(n){e=h(n,"DIV",{class:!0});var s=w(e);t=L(s,l[4]),s.forEach(f),this.h()},h(){d(e,"class","error-message svelte-8oktfb")},m(n,s){P(n,e,s),u(e,t)},p(n,s){s&16&&Y(t,n[4])},d(n){n&&f(e)}}}function Xn(l){let e,t,n=l[5].vectorCount.toLocaleString()+"",s,r,o,a,i=Et(l[7])+"",c,_,D=Ct(l[5].lastUpdated)+"",y;return{c(){e=m("div"),t=m("span"),s=O(n),r=O(" messages indexed"),o=R(),a=m("span"),c=O(i),_=O(" ‚Ä¢ "),y=O(D),this.h()},l(C){e=h(C,"DIV",{class:!0});var E=w(e);t=h(E,"SPAN",{});var b=w(t);s=L(b,n),r=L(b," messages indexed"),b.forEach(f),o=F(E),a=h(E,"SPAN",{});var v=w(a);c=L(v,i),_=L(v," ‚Ä¢ "),y=L(v,D),v.forEach(f),E.forEach(f),this.h()},h(){d(e,"class","stats svelte-8oktfb")},m(C,E){P(C,e,E),u(e,t),u(t,s),u(t,r),u(e,o),u(e,a),u(a,c),u(a,_),u(a,y)},p(C,E){E&32&&n!==(n=C[5].vectorCount.toLocaleString()+"")&&Y(s,n),E&128&&i!==(i=Et(C[7])+"")&&Y(c,i),E&32&&D!==(D=Ct(C[5].lastUpdated)+"")&&Y(y,D)},d(C){C&&f(e)}}}function Zn(l){let e,t,n="Semantic search requires downloading the search index.",s;function r(i,c){return Rt()?es:$n}let a=r()(l);return{c(){e=m("div"),t=m("p"),t.textContent=n,s=R(),a.c(),this.h()},l(i){e=h(i,"DIV",{class:!0});var c=w(e);t=h(c,"P",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-y7h9br"&&(t.textContent=n),s=F(c),a.l(c),c.forEach(f),this.h()},h(){d(t,"class","svelte-8oktfb"),d(e,"class","info-message svelte-8oktfb")},m(i,c){P(i,e,c),u(e,t),u(e,s),a.m(e,null)},p(i,c){a.p(i,c)},d(i){i&&f(e),a.d()}}}function $n(l){let e,t="Connect to WiFi to download.";return{c(){e=m("p"),e.textContent=t,this.h()},l(n){e=h(n,"P",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-1vvgh80"&&(e.textContent=t),this.h()},h(){d(e,"class","wifi-notice svelte-8oktfb")},m(n,s){P(n,e,s)},p:W,d(n){n&&f(e)}}}function es(l){let e,t,n,s;return{c(){e=m("button"),t=O("Download Index"),this.h()},l(r){e=h(r,"BUTTON",{class:!0});var o=w(e);t=L(o,"Download Index"),o.forEach(f),this.h()},h(){e.disabled=l[3],d(e,"class","svelte-8oktfb")},m(r,o){P(r,e,o),u(e,t),n||(s=te(e,"click",l[9]),n=!0)},p(r,o){o&8&&(e.disabled=r[3])},d(r){r&&f(e),n=!1,s()}}}function ts(l){let e,t="No matching messages found";return{c(){e=m("div"),e.textContent=t,this.h()},l(n){e=h(n,"DIV",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-ig5svh"&&(e.textContent=t),this.h()},h(){d(e,"class","no-results svelte-8oktfb")},m(n,s){P(n,e,s)},p:W,d(n){n&&f(e)}}}function ns(l){let e,t=ge(l[2]),n=[];for(let s=0;s<t.length;s+=1)n[s]=wt(gt(l,t,s));return{c(){e=m("div");for(let s=0;s<n.length;s+=1)n[s].c();this.h()},l(s){e=h(s,"DIV",{class:!0});var r=w(e);for(let o=0;o<n.length;o+=1)n[o].l(r);r.forEach(f),this.h()},h(){d(e,"class","results svelte-8oktfb")},m(s,r){P(s,e,r);for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(e,null)},p(s,r){if(r&1028){t=ge(s[2]);let o;for(o=0;o<t.length;o+=1){const a=gt(s,t,o);n[o]?n[o].p(a,r):(n[o]=wt(a),n[o].c(),n[o].m(e,null))}for(;o<n.length;o+=1)n[o].d(1);n.length=t.length}},d(s){s&&f(e),Vt(n,s)}}}function wt(l){let e,t,n=l[16].noteId.slice(0,8)+"",s,r,o,a,i=(l[16].score*100).toFixed(0)+"",c,_,D,y,C;function E(){return l[13](l[16])}return{c(){e=m("button"),t=m("span"),s=O(n),r=O("..."),o=R(),a=m("span"),c=O(i),_=O("% match"),D=R(),this.h()},l(b){e=h(b,"BUTTON",{class:!0});var v=w(e);t=h(v,"SPAN",{class:!0});var S=w(t);s=L(S,n),r=L(S,"..."),S.forEach(f),o=F(v),a=h(v,"SPAN",{class:!0});var I=w(a);c=L(I,i),_=L(I,"% match"),I.forEach(f),D=F(v),v.forEach(f),this.h()},h(){d(t,"class","note-id svelte-8oktfb"),d(a,"class","score svelte-8oktfb"),d(e,"class","result-item svelte-8oktfb")},m(b,v){P(b,e,v),u(e,t),u(t,s),u(t,r),u(e,o),u(e,a),u(a,c),u(a,_),u(e,D),y||(C=te(e,"click",E),y=!0)},p(b,v){l=b,v&4&&n!==(n=l[16].noteId.slice(0,8)+"")&&Y(s,n),v&4&&i!==(i=(l[16].score*100).toFixed(0)+"")&&Y(c,i)},d(b){b&&f(e),y=!1,C()}}}function ss(l){let e,t,n,s,r,o,a,i,c,_,D,y,C,E,b=l[3]&&kt(),v=l[4]&&yt(l);function S(T,g){if(!T[6])return Zn;if(T[5])return Xn}let I=S(l),p=I&&I(l);function k(T,g){if(T[2].length>0)return ns;if(T[1]&&!T[3]&&T[6])return ts}let V=k(l),M=V&&V(l);return{c(){e=m("div"),t=m("div"),n=m("div"),s=m("input"),o=R(),b&&b.c(),a=R(),i=m("button"),c=O("‚Üª"),_=R(),v&&v.c(),D=R(),p&&p.c(),y=R(),M&&M.c(),this.h()},l(T){e=h(T,"DIV",{class:!0});var g=w(e);t=h(g,"DIV",{class:!0});var A=w(t);n=h(A,"DIV",{class:!0});var N=w(n);s=h(N,"INPUT",{type:!0,placeholder:!0,class:!0}),o=F(N),b&&b.l(N),N.forEach(f),a=F(A),i=h(A,"BUTTON",{class:!0,title:!0});var J=w(i);c=L(J,"‚Üª"),J.forEach(f),A.forEach(f),_=F(g),v&&v.l(g),D=F(g),p&&p.l(g),y=F(g),M&&M.l(g),g.forEach(f),this.h()},h(){d(s,"type","text"),d(s,"placeholder",l[0]),d(s,"class","search-input svelte-8oktfb"),s.disabled=r=!l[6],d(n,"class","search-input-wrapper svelte-8oktfb"),d(i,"class","sync-btn svelte-8oktfb"),i.disabled=l[3],d(i,"title","Sync embeddings"),d(t,"class","search-header svelte-8oktfb"),d(e,"class","semantic-search svelte-8oktfb")},m(T,g){P(T,e,g),u(e,t),u(t,n),u(n,s),Ze(s,l[1]),u(n,o),b&&b.m(n,null),u(t,a),u(t,i),u(i,c),u(e,_),v&&v.m(e,null),u(e,D),p&&p.m(e,null),u(e,y),M&&M.m(e,null),C||(E=[te(s,"input",l[12]),te(s,"input",l[8]),te(i,"click",l[9])],C=!0)},p(T,[g]){g&1&&d(s,"placeholder",T[0]),g&64&&r!==(r=!T[6])&&(s.disabled=r),g&2&&s.value!==T[1]&&Ze(s,T[1]),T[3]?b||(b=kt(),b.c(),b.m(n,null)):b&&(b.d(1),b=null),g&8&&(i.disabled=T[3]),T[4]?v?v.p(T,g):(v=yt(T),v.c(),v.m(e,D)):v&&(v.d(1),v=null),I===(I=S(T))&&p?p.p(T,g):(p&&p.d(1),p=I&&I(T),p&&(p.c(),p.m(e,y))),V===(V=k(T))&&M?M.p(T,g):(M&&M.d(1),M=V&&V(T),M&&(M.c(),M.m(e,null)))},i:W,o:W,d(T){T&&f(e),b&&b.d(),v&&v.d(),p&&p.d(),M&&M.d(),C=!1,Ut(E)}}}function Ct(l){return l?new Date(l).toLocaleDateString():"Never"}function Et(l){switch(l){case"server":return"RuVector (server)";case"cached":return"Offline cache";case"hybrid":return"RuVector + cache";default:return l}}function ls(l,e,t){let{onSelect:n=()=>{}}=e,{placeholder:s="Search by meaning..."}=e,r="",o=[],a=!1,i=null,c=null,_=!1,D="hybrid",y;Le(async()=>{try{t(6,_=await Gn()),_&&(t(5,c=vt()),t(7,D=c?.searchMode||"hybrid"))}catch(p){console.warn("Failed to load search index:",p)}});async function C(){if(!r.trim()){t(2,o=[]);return}if(!_){t(4,i="Search index not loaded. Sync embeddings first.");return}t(3,a=!0),t(4,i=null);try{t(2,o=await Kn(r,10,.3))}catch(p){t(4,i=p instanceof Error?p.message:"Search failed"),t(2,o=[])}finally{t(3,a=!1)}}function E(){clearTimeout(y),y=setTimeout(C,300)}async function b(){if(!Rt()&&!navigator.onLine){t(4,i="Please connect to sync embeddings");return}t(3,a=!0),t(4,i=null);try{(await Wn(!0)).synced&&(t(6,_=!0),t(5,c=vt()),t(7,D=c?.searchMode||"hybrid"))}catch(p){t(4,i=p instanceof Error?p.message:"Sync failed")}finally{t(3,a=!1)}}function v(p){n(p)}function S(){r=this.value,t(1,r)}const I=p=>v(p.noteId);return l.$$set=p=>{"onSelect"in p&&t(11,n=p.onSelect),"placeholder"in p&&t(0,s=p.placeholder)},[s,r,o,a,i,c,_,D,E,b,v,n,S,I]}class rs extends ye{constructor(e){super(),we(this,e,ls,ss,ke,{onSelect:11,placeholder:0})}}function St(l,e,t){const n=l.slice();return n[22]=e[t],n}function It(l){let e,t,n,s,r="Semantic Search",o,a,i='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',c,_,D="Search by meaning, not just keywords. Find messages that are semantically similar to your query.",y,C,E,b,v;return C=new rs({props:{onSelect:l[10],placeholder:"Search messages by meaning..."}}),{c(){e=m("div"),t=m("div"),n=m("div"),s=m("h3"),s.textContent=r,o=R(),a=m("button"),a.innerHTML=i,c=R(),_=m("p"),_.textContent=D,y=R(),ce(C.$$.fragment),this.h()},l(S){e=h(S,"DIV",{class:!0});var I=w(e);t=h(I,"DIV",{class:!0});var p=w(t);n=h(p,"DIV",{class:!0});var k=w(n);s=h(k,"H3",{class:!0,"data-svelte-h":!0}),G(s)!=="svelte-kr88ev"&&(s.textContent=r),o=F(k),a=h(k,"BUTTON",{class:!0,"data-svelte-h":!0}),G(a)!=="svelte-v6flfe"&&(a.innerHTML=i),k.forEach(f),c=F(p),_=h(p,"P",{class:!0,"data-svelte-h":!0}),G(_)!=="svelte-1qiiq15"&&(_.textContent=D),y=F(p),ie(C.$$.fragment,p),p.forEach(f),I.forEach(f),this.h()},h(){d(s,"class","text-lg font-semibold"),d(a,"class","btn btn-ghost btn-sm btn-circle"),d(n,"class","flex items-center justify-between mb-2"),d(_,"class","text-sm text-base-content/70 mb-3"),d(t,"class","card-body p-4"),d(e,"class","card bg-base-200 shadow-lg mb-6")},m(S,I){P(S,e,I),u(e,t),u(t,n),u(n,s),u(n,o),u(n,a),u(t,c),u(t,_),u(t,y),oe(C,t,null),E=!0,b||(v=te(a,"click",l[18]),b=!0)},p:W,i(S){E||(x(C.$$.fragment,S),E=!0)},o(S){U(C.$$.fragment,S),E=!1},d(S){S&&f(e),ae(C),b=!1,v()}}}function as(l){let e,t=[],n=new Map,s,r=ge(l[6]);const o=a=>a[22].id;for(let a=0;a<r.length;a+=1){let i=St(l,r,a),c=o(i);n.set(c,t[a]=Dt(c,i))}return{c(){e=m("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=h(a,"DIV",{class:!0});var i=w(e);for(let c=0;c<t.length;c+=1)t[c].l(i);i.forEach(f),this.h()},h(){d(e,"class","space-y-3")},m(a,i){P(a,e,i);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);s=!0},p(a,i){i&64&&(r=ge(a[6]),me(),t=qt(t,i,o,1,a,r,n,e,Yt,Dt,null,St),_e())},i(a){if(!s){for(let i=0;i<r.length;i+=1)x(t[i]);s=!0}},o(a){for(let i=0;i<t.length;i+=1)U(t[i]);s=!1},d(a){a&&f(e);for(let i=0;i<t.length;i+=1)t[i].d()}}}function os(l){let e,t,n,s;t=new Ln({props:{icon:"üí¨",title:l[0]?`No channels in ${l[8]}`:"No channels yet",description:l[0]?"This board doesn't have any channels yet. Check back later or browse all channels.":"Create or join a channel to start chatting with the community"}});let r=l[0]&&At();return{c(){e=m("div"),ce(t.$$.fragment),n=R(),r&&r.c(),this.h()},l(o){e=h(o,"DIV",{class:!0});var a=w(e);ie(t.$$.fragment,a),n=F(a),r&&r.l(a),a.forEach(f),this.h()},h(){d(e,"class","text-center")},m(o,a){P(o,e,a),oe(t,e,null),u(e,n),r&&r.m(e,null),s=!0},p(o,a){const i={};a&257&&(i.title=o[0]?`No channels in ${o[8]}`:"No channels yet"),a&1&&(i.description=o[0]?"This board doesn't have any channels yet. Check back later or browse all channels.":"Create or join a channel to start chatting with the community"),t.$set(i),o[0]?r||(r=At(),r.c(),r.m(e,null)):r&&(r.d(1),r=null)},i(o){s||(x(t.$$.fragment,o),s=!0)},o(o){U(t.$$.fragment,o),s=!1},d(o){o&&f(e),ae(t),r&&r.d()}}}function is(l){let e,t,n,s,r,o,a,i="Connection Issue",c,_,D,y,C,E,b,v="Back to Home",S;function I(A,N){return N&4&&(s=null),N&4&&(r=null),s==null&&(s=!!(A[2].includes("timed out")||A[2].includes("unavailable"))),s?ds:(r==null&&(r=!!A[2].includes("Authentication")),r?us:fs)}let p=I(l,-1),k=p(l);function V(A,N){return A[4]<Be?ms:hs}let M=V(l),T=M(l),g=l[4]>0&&Pt(l);return{c(){e=m("div"),t=m("div"),n=m("div"),k.c(),o=R(),a=m("h3"),a.textContent=i,c=R(),_=m("p"),D=O(l[2]),y=R(),C=m("div"),T.c(),E=R(),b=m("a"),b.textContent=v,S=R(),g&&g.c(),this.h()},l(A){e=h(A,"DIV",{class:!0});var N=w(e);t=h(N,"DIV",{class:!0});var J=w(t);n=h(J,"DIV",{class:!0});var Q=w(n);k.l(Q),Q.forEach(f),o=F(J),a=h(J,"H3",{class:!0,"data-svelte-h":!0}),G(a)!=="svelte-x29mwq"&&(a.textContent=i),c=F(J),_=h(J,"P",{class:!0});var K=w(_);D=L(K,l[2]),K.forEach(f),y=F(J),C=h(J,"DIV",{class:!0});var ne=w(C);T.l(ne),E=F(ne),b=h(ne,"A",{href:!0,class:!0,"data-svelte-h":!0}),G(b)!=="svelte-5104hx"&&(b.textContent=v),ne.forEach(f),S=F(J),g&&g.l(J),J.forEach(f),N.forEach(f),this.h()},h(){d(n,"class","text-6xl mb-4"),d(a,"class","text-lg font-semibold text-error mb-2"),d(_,"class","text-base-content/70 mb-4 max-w-md mx-auto"),d(b,"href",Ee+"/"),d(b,"class","btn btn-ghost btn-sm"),d(C,"class","flex flex-col sm:flex-row gap-2 justify-center"),d(t,"class","card-body text-center py-8"),d(e,"class","card bg-base-200 shadow-lg")},m(A,N){P(A,e,N),u(e,t),u(t,n),k.m(n,null),u(t,o),u(t,a),u(t,c),u(t,_),u(_,D),u(t,y),u(t,C),T.m(C,null),u(C,E),u(C,b),u(t,S),g&&g.m(t,null)},p(A,N){p!==(p=I(A,N))&&(k.d(1),k=p(A),k&&(k.c(),k.m(n,null))),N&4&&Y(D,A[2]),M===(M=V(A))&&T?T.p(A,N):(T.d(1),T=M(A),T&&(T.c(),T.m(C,E))),A[4]>0?g?g.p(A,N):(g=Pt(A),g.c(),g.m(t,null)):g&&(g.d(1),g=null)},i:W,o:W,d(A){A&&f(e),k.d(),T.d(),g&&g.d()}}}function cs(l){let e,t,n;return t=new An({props:{variant:"channel",count:5}}),{c(){e=m("div"),ce(t.$$.fragment),this.h()},l(s){e=h(s,"DIV",{class:!0});var r=w(e);ie(t.$$.fragment,r),r.forEach(f),this.h()},h(){d(e,"class","space-y-3")},m(s,r){P(s,e,r),oe(t,e,null),n=!0},p:W,i(s){n||(x(t.$$.fragment,s),n=!0)},o(s){U(t.$$.fragment,s),n=!1},d(s){s&&f(e),ae(t)}}}function Dt(l,e){let t,n,s;return n=new bn({props:{channel:e[22]}}),{key:l,first:null,c(){t=Ve(),ce(n.$$.fragment),this.h()},l(r){t=Ve(),ie(n.$$.fragment,r),this.h()},h(){this.first=t},m(r,o){P(r,t,o),oe(n,r,o),s=!0},p(r,o){e=r;const a={};o&64&&(a.channel=e[22]),n.$set(a)},i(r){s||(x(n.$$.fragment,r),s=!0)},o(r){U(n.$$.fragment,r),s=!1},d(r){r&&f(t),ae(n,r)}}}function At(l){let e,t="View All Channels";return{c(){e=m("a"),e.textContent=t,this.h()},l(n){e=h(n,"A",{href:!0,class:!0,"data-svelte-h":!0}),G(e)!=="svelte-10n5lvv"&&(e.textContent=t),this.h()},h(){d(e,"href",Ee+"/chat"),d(e,"class","btn btn-primary btn-sm")},m(n,s){P(n,e,s)},d(n){n&&f(e)}}}function fs(l){let e,t="‚ö†Ô∏è";return{c(){e=m("span"),e.textContent=t,this.h()},l(n){e=h(n,"SPAN",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-1e9k516"&&(e.textContent=t),this.h()},h(){d(e,"class","opacity-50")},m(n,s){P(n,e,s)},d(n){n&&f(e)}}}function us(l){let e,t="üîí";return{c(){e=m("span"),e.textContent=t,this.h()},l(n){e=h(n,"SPAN",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-czshv4"&&(e.textContent=t),this.h()},h(){d(e,"class","opacity-50")},m(n,s){P(n,e,s)},d(n){n&&f(e)}}}function ds(l){let e,t="üîå";return{c(){e=m("span"),e.textContent=t,this.h()},l(n){e=h(n,"SPAN",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-812b27"&&(e.textContent=t),this.h()},h(){d(e,"class","opacity-50")},m(n,s){P(n,e,s)},d(n){n&&f(e)}}}function hs(l){let e,t="Max retries reached. Please refresh the page.";return{c(){e=m("p"),e.textContent=t,this.h()},l(n){e=h(n,"P",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-7x6osl"&&(e.textContent=t),this.h()},h(){d(e,"class","text-sm text-base-content/50")},m(n,s){P(n,e,s)},p:W,d(n){n&&f(e)}}}function ms(l){let e,t,n;function s(a,i){return a[5]?ps:_s}let r=s(l),o=r(l);return{c(){e=m("button"),o.c(),this.h()},l(a){e=h(a,"BUTTON",{class:!0});var i=w(e);o.l(i),i.forEach(f),this.h()},h(){d(e,"class","btn btn-primary btn-sm"),e.disabled=l[5]},m(a,i){P(a,e,i),o.m(e,null),t||(n=te(e,"click",l[11]),t=!0)},p(a,i){r!==(r=s(a))&&(o.d(1),o=r(a),o&&(o.c(),o.m(e,null))),i&32&&(e.disabled=a[5])},d(a){a&&f(e),o.d(),t=!1,n()}}}function _s(l){let e;return{c(){e=O("Retry Connection")},l(t){e=L(t,"Retry Connection")},m(t,n){P(t,e,n)},d(t){t&&f(e)}}}function ps(l){let e,t;return{c(){e=m("span"),t=O(`
                    Retrying...`),this.h()},l(n){e=h(n,"SPAN",{class:!0}),w(e).forEach(f),t=L(n,`
                    Retrying...`),this.h()},h(){d(e,"class","loading loading-spinner loading-xs")},m(n,s){P(n,e,s),P(n,t,s)},d(n){n&&(f(e),f(t))}}}function Pt(l){let e,t,n,s,r;return{c(){e=m("p"),t=O("Retry attempt "),n=O(l[4]),s=O(" of "),r=O(Be),this.h()},l(o){e=h(o,"P",{class:!0});var a=w(e);t=L(a,"Retry attempt "),n=L(a,l[4]),s=L(a," of "),r=L(a,Be),a.forEach(f),this.h()},h(){d(e,"class","text-xs text-base-content/40 mt-2")},m(o,a){P(o,e,a),u(e,t),u(e,n),u(e,s),u(e,r)},p(o,a){a&16&&Y(n,o[4])},d(o){o&&f(e)}}}function bs(l){let e,t,n,s,r,o,a,i,c,_,D,y,C,E,b,v,S,I,p,k='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <span class="hidden sm:inline">Search</span>',V,M,T,g,A,N,J,Q,K,ne,se,Z,z,j,H,re,fe,Ce;document.title=e=l[8]+" - "+l[9].name,r=new tn({}),M=new Sn({});let q=l[3]&&It(l);const de=[cs,is,os,as],$=[];function he(B,X){return B[1]?0:B[2]?1:B[6].length===0?2:3}return A=he(l),N=$[A]=de[A](l),K=new nn({}),se=new sn({}),z=new ln({}),H=new rn({}),{c(){t=R(),n=m("div"),s=m("div"),ce(r.$$.fragment),o=R(),a=m("div"),i=m("div"),c=m("div"),_=m("div"),D=m("div"),y=m("h1"),C=O(l[8]),E=R(),b=m("p"),v=O(l[7]),S=R(),I=m("div"),p=m("button"),p.innerHTML=k,V=R(),ce(M.$$.fragment),T=R(),q&&q.c(),g=R(),N.c(),J=R(),Q=m("div"),ce(K.$$.fragment),ne=R(),ce(se.$$.fragment),Z=R(),ce(z.$$.fragment),j=R(),ce(H.$$.fragment),this.h()},l(B){zt("svelte-4a1mv3",document.head).forEach(f),t=F(B),n=h(B,"DIV",{class:!0});var le=w(n);s=h(le,"DIV",{class:!0});var Je=w(s);ie(r.$$.fragment,Je),Je.forEach(f),o=F(le),a=h(le,"DIV",{class:!0});var Ie=w(a);i=h(Ie,"DIV",{class:!0});var pe=w(i);c=h(pe,"DIV",{class:!0});var Qe=w(c);_=h(Qe,"DIV",{class:!0});var De=w(_);D=h(De,"DIV",{});var Ae=w(D);y=h(Ae,"H1",{class:!0});var We=w(y);C=L(We,l[8]),We.forEach(f),E=F(Ae),b=h(Ae,"P",{class:!0});var Ge=w(b);v=L(Ge,l[7]),Ge.forEach(f),Ae.forEach(f),S=F(De),I=h(De,"DIV",{class:!0});var Pe=w(I);p=h(Pe,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),G(p)!=="svelte-1oclgr5"&&(p.innerHTML=k),V=F(Pe),ie(M.$$.fragment,Pe),Pe.forEach(f),De.forEach(f),Qe.forEach(f),T=F(pe),q&&q.l(pe),g=F(pe),N.l(pe),pe.forEach(f),J=F(Ie),Q=h(Ie,"DIV",{class:!0});var ue=w(Q);ie(K.$$.fragment,ue),ne=F(ue),ie(se.$$.fragment,ue),Z=F(ue),ie(z.$$.fragment,ue),j=F(ue),ie(H.$$.fragment,ue),ue.forEach(f),Ie.forEach(f),le.forEach(f),this.h()},h(){d(s,"class","mb-4"),d(y,"class","text-4xl font-bold gradient-text mb-2"),d(b,"class","text-base-content/70"),d(p,"class","btn btn-ghost btn-sm"),d(p,"title","Semantic Search"),d(I,"class","flex items-center gap-2"),d(_,"class","flex items-start justify-between gap-4"),d(c,"class","mb-6"),d(i,"class","flex-1"),d(Q,"class","lg:w-80 space-y-4"),d(a,"class","flex flex-col lg:flex-row gap-6"),d(n,"class","container mx-auto p-4 max-w-6xl")},m(B,X){P(B,t,X),P(B,n,X),u(n,s),oe(r,s,null),u(n,o),u(n,a),u(a,i),u(i,c),u(c,_),u(_,D),u(D,y),u(y,C),u(D,E),u(D,b),u(b,v),u(_,S),u(_,I),u(I,p),u(I,V),oe(M,I,null),u(i,T),q&&q.m(i,null),u(i,g),$[A].m(i,null),u(a,J),u(a,Q),oe(K,Q,null),u(Q,ne),oe(se,Q,null),u(Q,Z),oe(z,Q,null),u(Q,j),oe(H,Q,null),re=!0,fe||(Ce=te(p,"click",l[17]),fe=!0)},p(B,[X]){(!re||X&768)&&e!==(e=B[8]+" - "+B[9].name)&&(document.title=e),(!re||X&256)&&Y(C,B[8]),(!re||X&128)&&Y(v,B[7]),B[3]?q?(q.p(B,X),X&8&&x(q,1)):(q=It(B),q.c(),x(q,1),q.m(i,g)):q&&(me(),U(q,1,1,()=>{q=null}),_e());let le=A;A=he(B),A===le?$[A].p(B,X):(me(),U($[le],1,1,()=>{$[le]=null}),_e(),N=$[A],N?N.p(B,X):(N=$[A]=de[A](B),N.c()),x(N,1),N.m(i,null))},i(B){re||(x(r.$$.fragment,B),x(M.$$.fragment,B),x(q),x(N),x(K.$$.fragment,B),x(se.$$.fragment,B),x(z.$$.fragment,B),x(H.$$.fragment,B),re=!0)},o(B){U(r.$$.fragment,B),U(M.$$.fragment,B),U(q),U(N),U(K.$$.fragment,B),U(se.$$.fragment,B),U(z.$$.fragment,B),U(H.$$.fragment,B),re=!1},d(B){B&&(f(t),f(n)),ae(r),ae(M),q&&q.d(),$[A].d(),ae(K),ae(se),ae(z),ae(H),fe=!1,Ce()}}}const Be=3;function vs(l,e,t){let n,s,r,o,a,i,c,_,D;Te(l,$e,g=>t(20,c=g)),Te(l,Zt,g=>t(15,_=g)),Te(l,Kt,g=>t(16,D=g));const y=Jt();let C=[],E=!0,b=null,v=!1,S=0,I=!1;async function p(g){t(3,v=!1);for(const A of r)if(A.id){He(`${Ee}/chat/${A.id}?highlight=${g}`);return}console.warn("Message not found in loaded channels:",g)}async function k(){try{c.privateKey&&!Nt()&&await Xt($t,c.privateKey);const g=Ht(Wt),A=g?.cohorts??[],N=g?.isAdmin??!1;t(12,C=await en({userCohorts:A,userPubkey:c.publicKey??void 0,isAdmin:N})),t(2,b=null),t(4,S=0)}catch(g){console.error("Failed to load channels:",g),t(2,b=g instanceof Error?g.message:"Failed to load channels"),b.includes("timeout")||b.includes("Timeout")?t(2,b="Connection timed out. The server may be temporarily unavailable."):b.includes("Invalid private key")&&t(2,b="Authentication failed. Please try logging out and back in.")}}async function V(){if(!(I||S>=Be)){t(5,I=!0),t(4,S++,S),t(2,b=null);try{await k()}finally{t(5,I=!1)}}}Le(async()=>{if(await $e.waitForReady(),!c.isAuthenticated||!c.publicKey){He(`${Ee}/`);return}await k(),t(1,E=!1)});const M=()=>t(3,v=!v),T=()=>t(3,v=!1);return l.$$.update=()=>{l.$$.dirty&65536&&t(0,n=D.url.searchParams.get("section")),l.$$.dirty&1&&t(14,s=n?Qt(n):null),l.$$.dirty&4097&&t(6,r=n?C.filter(g=>g.section===n):C),l.$$.dirty&16384&&t(8,o=s?s.name:"Channels"),l.$$.dirty&16384&&t(7,a=s?s.description:"Join conversations in public channels"),l.$$.dirty&32768&&t(13,i=_),l.$$.dirty&8192&&(i.state===et.Error||(i.state,et.AuthFailed))},[n,E,b,v,S,I,r,a,o,y,p,V,C,i,s,_,D,M,T]}class zs extends ye{constructor(e){super(),we(this,e,vs,bs,ke,{})}}export{zs as component,Us as universal};
