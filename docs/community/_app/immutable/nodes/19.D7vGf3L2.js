import{s as we,n as ce,d as o,l,i as w,b as f,c as m,e as k,u as G,h as v,v as J,r as He,P as Be,q as Y,o as T,g as P,f as he,j as S,t as me,k as Oe,C as Ue,p as ze,a as qe,m as Fe,x as Me}from"../chunks/CwRy9Tox.js";import{S as Ee,i as xe,d as ue,t as Q,a as X,m as fe,b as de,e as pe,c as Ye,g as Ge}from"../chunks/D-vqeeah.js";import{r as Je}from"../chunks/CFR2KKAl.js";import{a as M,w as Qe,g as Xe}from"../chunks/Do1Y_WLx.js";import{c as je}from"../chunks/Du7SxFKq.js";import{P as Ze}from"../chunks/BuaPm4r1.js";import{g as ae}from"../chunks/BVYH3h24.js";import{b as oe}from"../chunks/DjSB8mDa.js";const $e=!0,et=$e;function tt(i){let t,n,e,r,s,a;return{c(){t=v("div"),n=v("div"),e=J("svg"),r=J("path"),this.h()},l(u){t=m(u,"DIV",{class:!0,"data-tip":!0});var c=k(t);n=m(c,"DIV",{class:!0,"data-tip":!0});var p=k(n);e=G(p,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var d=k(e);r=G(d,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),k(r).forEach(o),d.forEach(o),p.forEach(o),c.forEach(o),this.h()},h(){l(r,"stroke-linecap","round"),l(r,"stroke-linejoin","round"),l(r,"stroke-width","2"),l(r,"d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"),l(e,"xmlns","http://www.w3.org/2000/svg"),l(e,"class","h-4 w-4 text-base-content/60 hover:text-info cursor-help transition-colors"),l(e,"fill","none"),l(e,"viewBox","0 0 24 24"),l(e,"stroke","currentColor"),l(n,"class",s="tooltip tooltip-"+i[1]+" svelte-kacsoa"),l(n,"data-tip",i[0]),l(t,"class",a="info-tooltip "+(i[2]?"inline-block":"")+" svelte-kacsoa"),l(t,"data-tip",i[0])},m(u,c){w(u,t,c),f(t,n),f(n,e),f(e,r)},p(u,[c]){c&2&&s!==(s="tooltip tooltip-"+u[1]+" svelte-kacsoa")&&l(n,"class",s),c&1&&l(n,"data-tip",u[0]),c&4&&a!==(a="info-tooltip "+(u[2]?"inline-block":"")+" svelte-kacsoa")&&l(t,"class",a),c&1&&l(t,"data-tip",u[0])},i:ce,o:ce,d(u){u&&o(t)}}}function nt(i,t,n){let{text:e}=t,{position:r="top"}=t,{maxWidth:s="300px"}=t,{inline:a=!1}=t;return i.$$set=u=>{"text"in u&&n(0,e=u.text),"position"in u&&n(1,r=u.position),"maxWidth"in u&&n(3,s=u.maxWidth),"inline"in u&&n(2,a=u.inline)},[e,r,a,s]}class We extends Ee{constructor(t){super(),xe(this,t,nt,tt,we,{text:0,position:1,maxWidth:3,inline:2})}}function st(i){let t,n='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span class="text-sm">Enter your private key (nsec or hex) to access your account</span>';return{c(){t=v("div"),t.innerHTML=n,this.h()},l(e){t=m(e,"DIV",{class:!0,"data-svelte-h":!0}),T(t)!=="svelte-1vtdacb"&&(t.innerHTML=n),this.h()},h(){l(t,"class","alert alert-info mb-4")},m(e,r){w(e,t,r)},p:ce,d(e){e&&o(t)}}}function rt(i){let t,n,e,r,s,a,u="Use your browser extension (Alby, nos2x, etc.) to sign in securely",c,p,d="OR USE PRIVATE KEY",_,E;function x(y,b){return y[6]?at:y[3]?it:lt}let L=x(i),C=L(i);return{c(){t=v("div"),n=v("button"),C.c(),s=S(),a=v("p"),a.textContent=u,c=S(),p=v("div"),p.textContent=d,this.h()},l(y){t=m(y,"DIV",{class:!0});var b=k(t);n=m(b,"BUTTON",{class:!0,"aria-busy":!0});var g=k(n);C.l(g),g.forEach(o),s=P(b),a=m(b,"P",{class:!0,"data-svelte-h":!0}),T(a)!=="svelte-91sree"&&(a.textContent=u),b.forEach(o),c=P(y),p=m(y,"DIV",{class:!0,"data-svelte-h":!0}),T(p)!=="svelte-1nauhqd"&&(p.textContent=d),this.h()},h(){l(n,"class","btn btn-primary btn-lg w-full gap-2"),n.disabled=e=i[6]||i[3],l(n,"aria-busy",r=i[6]||i[3]),l(a,"class","text-xs text-center text-base-content/60 mt-2"),l(t,"class","mb-4"),l(p,"class","divider text-xs")},m(y,b){w(y,t,b),f(t,n),C.m(n,null),f(t,s),f(t,a),w(y,c,b),w(y,p,b),_||(E=Y(n,"click",i[9]),_=!0)},p(y,b){L!==(L=x(y))&&(C.d(1),C=L(y),C&&(C.c(),C.m(n,null))),b&72&&e!==(e=y[6]||y[3])&&(n.disabled=e),b&72&&r!==(r=y[6]||y[3])&&l(n,"aria-busy",r)},d(y){y&&(o(t),o(c),o(p)),C.d(),_=!1,E()}}}function lt(i){let t,n,e;return{c(){t=J("svg"),n=J("path"),e=me(`
              Login with Nostr Extension`),this.h()},l(r){t=G(r,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var s=k(t);n=G(s,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),k(n).forEach(o),s.forEach(o),e=he(r,`
              Login with Nostr Extension`),this.h()},h(){l(n,"stroke-linecap","round"),l(n,"stroke-linejoin","round"),l(n,"stroke-width","2"),l(n,"d","M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"),l(t,"xmlns","http://www.w3.org/2000/svg"),l(t,"class","h-5 w-5"),l(t,"fill","none"),l(t,"viewBox","0 0 24 24"),l(t,"stroke","currentColor")},m(r,s){w(r,t,s),f(t,n),w(r,e,s)},d(r){r&&(o(t),o(e))}}}function it(i){let t,n,e,r="Checking approval status...";return{c(){t=v("span"),n=S(),e=v("span"),e.textContent=r,this.h()},l(s){t=m(s,"SPAN",{class:!0,"aria-hidden":!0}),k(t).forEach(o),n=P(s),e=m(s,"SPAN",{"data-svelte-h":!0}),T(e)!=="svelte-165kt37"&&(e.textContent=r),this.h()},h(){l(t,"class","loading loading-spinner"),l(t,"aria-hidden","true")},m(s,a){w(s,t,a),w(s,n,a),w(s,e,a)},d(s){s&&(o(t),o(n),o(e))}}}function at(i){let t,n,e,r="Connecting to extension...";return{c(){t=v("span"),n=S(),e=v("span"),e.textContent=r,this.h()},l(s){t=m(s,"SPAN",{class:!0,"aria-hidden":!0}),k(t).forEach(o),n=P(s),e=m(s,"SPAN",{"data-svelte-h":!0}),T(e)!=="svelte-kvbc4q"&&(e.textContent=r),this.h()},h(){l(t,"class","loading loading-spinner"),l(t,"aria-hidden","true")},m(s,a){w(s,t,a),w(s,n,a),w(s,e,a)},d(s){s&&(o(t),o(n),o(e))}}}function Re(i){let t,n,e,r,s,a=(i[2]||i[7].error)+"",u;return{c(){t=v("div"),n=J("svg"),e=J("path"),r=S(),s=v("span"),u=me(a),this.h()},l(c){t=m(c,"DIV",{class:!0});var p=k(t);n=G(p,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var d=k(n);e=G(d,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),k(e).forEach(o),d.forEach(o),r=P(p),s=m(p,"SPAN",{});var _=k(s);u=he(_,a),_.forEach(o),p.forEach(o),this.h()},h(){l(e,"stroke-linecap","round"),l(e,"stroke-linejoin","round"),l(e,"stroke-width","2"),l(e,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),l(n,"xmlns","http://www.w3.org/2000/svg"),l(n,"class","stroke-current shrink-0 h-6 w-6"),l(n,"fill","none"),l(n,"viewBox","0 0 24 24"),l(t,"class","alert alert-error mb-4")},m(c,p){w(c,t,p),f(t,n),f(n,e),f(t,r),f(t,s),f(s,u)},p(c,p){p&132&&a!==(a=(c[2]||c[7].error)+"")&&qe(u,a)},d(c){c&&o(t)}}}function ot(i){let t;return{c(){t=me("Log In")},l(n){t=he(n,"Log In")},m(n,e){w(n,t,e)},d(n){n&&o(t)}}}function ct(i){let t,n,e,r="Checking approval status...";return{c(){t=v("span"),n=S(),e=v("span"),e.textContent=r,this.h()},l(s){t=m(s,"SPAN",{class:!0,"aria-hidden":!0}),k(t).forEach(o),n=P(s),e=m(s,"SPAN",{"data-svelte-h":!0}),T(e)!=="svelte-165kt37"&&(e.textContent=r),this.h()},h(){l(t,"class","loading loading-spinner"),l(t,"aria-hidden","true")},m(s,a){w(s,t,a),w(s,n,a),w(s,e,a)},d(s){s&&(o(t),o(n),o(e))}}}function ut(i){let t,n,e,r="Validating key...";return{c(){t=v("span"),n=S(),e=v("span"),e.textContent=r,this.h()},l(s){t=m(s,"SPAN",{class:!0,"aria-hidden":!0}),k(t).forEach(o),n=P(s),e=m(s,"SPAN",{"data-svelte-h":!0}),T(e)!=="svelte-gew4fa"&&(e.textContent=r),this.h()},h(){l(t,"class","loading loading-spinner"),l(t,"aria-hidden","true")},m(s,a){w(s,t,a),w(s,n,a),w(s,e,a)},d(s){s&&(o(t),o(n),o(e))}}}function ft(i){let t,n,e,r,s,a="Log In",u,c,p,d,_,E,x,L,C,y,b,g,V,Z='<span id="private-key-hint" class="label-text-alt text-base-content/50">Supports nsec format (nsec1...) or raw 64-character hex</span>',$,ee,z,W,B,ve,O,Ce='<span class="label-text font-medium">Keep me signed in</span> <span class="label-text-alt text-base-content/60">Stay logged in on this browser using a secure cookie</span>',_e,q,K,te,ne,be,U,Pe="OR",ge,R,Se="Create a new account",H,ke,Ie;c=new We({props:{text:"Restore your Nostr identity using your private key (nsec). Your keys are never sent to any server - everything happens locally in your browser.",position:"bottom",maxWidth:"400px"}});function Ne(h,A){return h[5]?rt:st}let se=Ne(i),D=se(i);C=new We({props:{text:"Your private key (nsec) is the secret credential that proves you own your account. It starts with 'nsec1' or can be 64 hex characters. NEVER share this with anyone.",position:"top",maxWidth:"350px",inline:!0}});let I=(i[2]||i[7].error)&&Re(i);function Ae(h,A){return h[1]&&!h[3]?ut:h[3]?ct:ot}let re=Ae(i),j=re(i);return{c(){t=v("div"),n=v("div"),e=v("div"),r=v("div"),s=v("h2"),s.textContent=a,u=S(),pe(c.$$.fragment),p=S(),D.c(),d=S(),_=v("div"),E=v("label"),x=v("span"),L=me(`Private Key
            `),pe(C.$$.fragment),y=S(),b=v("input"),g=S(),V=v("label"),V.innerHTML=Z,$=S(),I&&I.c(),ee=S(),z=v("div"),W=v("label"),B=v("input"),ve=S(),O=v("div"),O.innerHTML=Ce,_e=S(),q=v("div"),K=v("button"),j.c(),be=S(),U=v("div"),U.textContent=Pe,ge=S(),R=v("button"),R.textContent=Se,this.h()},l(h){t=m(h,"DIV",{class:!0});var A=k(t);n=m(A,"DIV",{class:!0});var Le=k(n);e=m(Le,"DIV",{class:!0});var N=k(e);r=m(N,"DIV",{class:!0});var le=k(r);s=m(le,"H2",{class:!0,"data-svelte-h":!0}),T(s)!=="svelte-1mmzyn7"&&(s.textContent=a),u=P(le),de(c.$$.fragment,le),le.forEach(o),p=P(N),D.l(N),d=P(N),_=m(N,"DIV",{class:!0});var F=k(_);E=m(F,"LABEL",{class:!0,for:!0});var Ve=k(E);x=m(Ve,"SPAN",{class:!0});var ye=k(x);L=he(ye,`Private Key
            `),de(C.$$.fragment,ye),ye.forEach(o),Ve.forEach(o),y=P(F),b=m(F,"INPUT",{id:!0,type:!0,class:!0,placeholder:!0,autocomplete:!0,"aria-describedby":!0}),g=P(F),V=m(F,"LABEL",{class:!0,"data-svelte-h":!0}),T(V)!=="svelte-1vrhnyq"&&(V.innerHTML=Z),F.forEach(o),$=P(N),I&&I.l(N),ee=P(N),z=m(N,"DIV",{class:!0});var Ke=k(z);W=m(Ke,"LABEL",{class:!0});var ie=k(W);B=m(ie,"INPUT",{type:!0,class:!0}),ve=P(ie),O=m(ie,"DIV",{class:!0,"data-svelte-h":!0}),T(O)!=="svelte-p491ui"&&(O.innerHTML=Ce),ie.forEach(o),Ke.forEach(o),_e=P(N),q=m(N,"DIV",{class:!0});var Te=k(q);K=m(Te,"BUTTON",{class:!0,"aria-busy":!0});var De=k(K);j.l(De),De.forEach(o),Te.forEach(o),be=P(N),U=m(N,"DIV",{class:!0,"data-svelte-h":!0}),T(U)!=="svelte-cr75gt"&&(U.textContent=Pe),ge=P(N),R=m(N,"BUTTON",{class:!0,"data-svelte-h":!0}),T(R)!=="svelte-1l3thlz"&&(R.textContent=Se),N.forEach(o),Le.forEach(o),A.forEach(o),this.h()},h(){l(s,"class","card-title text-2xl"),l(r,"class","flex items-center justify-center gap-2 mb-4"),l(x,"class","label-text font-medium flex items-center gap-2"),l(E,"class","label"),l(E,"for","private-key-input"),l(b,"id","private-key-input"),l(b,"type","password"),l(b,"class","input input-bordered font-mono"),l(b,"placeholder","nsec1... or 64-character hex"),b.disabled=i[1],l(b,"autocomplete","off"),l(b,"aria-describedby","private-key-hint"),l(V,"class","label"),l(_,"class","form-control mb-4"),l(B,"type","checkbox"),l(B,"class","toggle toggle-primary"),B.disabled=i[1],l(O,"class","flex flex-col"),l(W,"class","label cursor-pointer justify-start gap-3"),l(z,"class","form-control mt-4"),l(K,"class","btn btn-primary btn-lg w-full"),K.disabled=te=i[1]||i[3],l(K,"aria-busy",ne=i[1]||i[3]),l(q,"class","card-actions justify-center mt-4"),l(U,"class","divider"),l(R,"class","btn btn-ghost btn-sm"),l(e,"class","card-body"),l(n,"class","card w-full max-w-md bg-base-100 shadow-xl"),l(t,"class","flex flex-col items-center justify-center min-h-screen p-4 bg-base-200 gradient-mesh")},m(h,A){w(h,t,A),f(t,n),f(n,e),f(e,r),f(r,s),f(r,u),fe(c,r,null),f(e,p),D.m(e,null),f(e,d),f(e,_),f(_,E),f(E,x),f(x,L),fe(C,x,null),f(_,y),f(_,b),Be(b,i[0]),f(_,g),f(_,V),f(e,$),I&&I.m(e,null),f(e,ee),f(e,z),f(z,W),f(W,B),B.checked=i[4],f(W,ve),f(W,O),f(e,_e),f(e,q),f(q,K),j.m(K,null),f(e,be),f(e,U),f(e,ge),f(e,R),H=!0,ke||(Ie=[Y(b,"input",i[11]),Y(b,"keypress",i[12]),Y(B,"change",i[13]),Y(K,"click",i[10]),Y(R,"click",i[14])],ke=!0)},p(h,[A]){se===(se=Ne(h))&&D?D.p(h,A):(D.d(1),D=se(h),D&&(D.c(),D.m(e,d))),(!H||A&2)&&(b.disabled=h[1]),A&1&&b.value!==h[0]&&Be(b,h[0]),h[2]||h[7].error?I?I.p(h,A):(I=Re(h),I.c(),I.m(e,ee)):I&&(I.d(1),I=null),(!H||A&2)&&(B.disabled=h[1]),A&16&&(B.checked=h[4]),re!==(re=Ae(h))&&(j.d(1),j=re(h),j&&(j.c(),j.m(K,null))),(!H||A&10&&te!==(te=h[1]||h[3]))&&(K.disabled=te),(!H||A&10&&ne!==(ne=h[1]||h[3]))&&l(K,"aria-busy",ne)},i(h){H||(X(c.$$.fragment,h),X(C.$$.fragment,h),H=!0)},o(h){Q(c.$$.fragment,h),Q(C.$$.fragment,h),H=!1},d(h){h&&o(t),ue(c),D.d(),ue(C),I&&I.d(),j.d(),ke=!1,He(Ie)}}}function dt(i,t,n){let e;Oe(i,M,g=>n(7,e=g));const r=Ue();let s="",a=!1,u="",c=!1,p=!0,d=!1,_=!1;ze(async()=>{{const g=localStorage.getItem("nostr_bbs_keep_signed_in");g!==null&&n(4,p=g==="true"),n(5,d=await Qe(1e3))}});async function E(){n(6,_=!0),n(2,u=""),M.clearError();try{const{publicKey:g}=await M.loginWithExtension();n(3,c=!0);const V=await je(g);n(3,c=!1),V.isApproved||V.isAdmin?r("successNip07",{publicKey:g}):r("pendingNip07",{publicKey:g})}catch(g){n(2,u=g instanceof Error?g.message:"Failed to connect to extension")}finally{n(6,_=!1),n(3,c=!1)}}async function x(){n(1,a=!0),n(2,u=""),M.clearError();try{if(await new Promise($=>setTimeout($,100)),!s.trim()){n(2,u="Please enter your private key (nsec or hex format)");return}const{publicKey:g,privateKey:V}=Je(s);et&&localStorage.setItem("nostr_bbs_keep_signed_in",String(p)),n(3,c=!0);const Z=await je(g);n(3,c=!1),Z.isApproved||Z.isAdmin?r("success",{publicKey:g,privateKey:V,keepSignedIn:p}):r("pending",{publicKey:g,privateKey:V,keepSignedIn:p})}catch(g){n(2,u=g instanceof Error?g.message:"Invalid private key"),M.setError(u)}finally{n(1,a=!1),n(3,c=!1)}}function L(){s=this.value,n(0,s)}const C=g=>g.key==="Enter"&&x();function y(){p=this.checked,n(4,p)}return[s,a,u,c,p,d,_,e,r,E,x,L,C,y,()=>r("signup")]}class pt extends Ee{constructor(t){super(),xe(this,t,dt,ft,we,{})}}function ht(i){let t,n;return t=new Ze({props:{publicKey:i[1]}}),t.$on("approved",i[7]),{c(){pe(t.$$.fragment)},l(e){de(t.$$.fragment,e)},m(e,r){fe(t,e,r),n=!0},p(e,r){const s={};r&2&&(s.publicKey=e[1]),t.$set(s)},i(e){n||(X(t.$$.fragment,e),n=!0)},o(e){Q(t.$$.fragment,e),n=!1},d(e){ue(t,e)}}}function mt(i){let t,n;return t=new pt({}),t.$on("success",i[3]),t.$on("pending",i[4]),t.$on("successNip07",i[5]),t.$on("pendingNip07",i[6]),t.$on("signup",i[8]),{c(){pe(t.$$.fragment)},l(e){de(t.$$.fragment,e)},m(e,r){fe(t,e,r),n=!0},p:ce,i(e){n||(X(t.$$.fragment,e),n=!0)},o(e){Q(t.$$.fragment,e),n=!1},d(e){ue(t,e)}}}function vt(i){let t,n,e,r,s,a;document.title=t="Login - "+i[2].name;const u=[mt,ht],c=[];function p(d,_){return d[0]==="login"?0:d[0]==="pending"?1:-1}return~(e=p(i))&&(r=c[e]=u[e](i)),{c(){n=S(),r&&r.c(),s=Me()},l(d){Fe("svelte-25kolx",document.head).forEach(o),n=P(d),r&&r.l(d),s=Me()},m(d,_){w(d,n,_),~e&&c[e].m(d,_),w(d,s,_),a=!0},p(d,[_]){(!a||_&4)&&t!==(t="Login - "+d[2].name)&&(document.title=t);let E=e;e=p(d),e===E?~e&&c[e].p(d,_):(r&&(Ge(),Q(c[E],1,1,()=>{c[E]=null}),Ye()),~e?(r=c[e],r?r.p(d,_):(r=c[e]=u[e](d),r.c()),X(r,1),r.m(s.parentNode,s)):r=null)},i(d){a||(X(r),a=!0)},o(d){Q(r),a=!1},d(d){d&&(o(n),o(s)),~e&&c[e].d(d)}}}function _t(i,t,n){const e=Xe();let r="login",s="";async function a(E){const{publicKey:x,privateKey:L}=E.detail;await M.setKeys(x,L,"complete",!0),ae(`${oe}/chat`)}async function u(E){const{publicKey:x,privateKey:L}=E.detail;await M.setKeys(x,L,"complete",!0),M.setPending(!0),n(1,s=x),n(0,r="pending")}function c(E){ae(`${oe}/chat`)}function p(E){const{publicKey:x}=E.detail;M.setPending(!0),n(1,s=x),n(0,r="pending")}function d(){M.setPending(!1),ae(`${oe}/chat`)}function _(){ae(`${oe}/signup`)}return[r,s,e,a,u,c,p,d,_]}class Pt extends Ee{constructor(t){super(),xe(this,t,_t,vt,we,{})}}export{Pt as component};
