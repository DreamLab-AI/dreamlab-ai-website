const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/BTawUe4R.js","../chunks/Do1Y_WLx.js","../chunks/CmsKOCeN.js","../chunks/DjSB8mDa.js","../chunks/CwRy9Tox.js","../chunks/BToyndCo.js","../chunks/C_zicc2g.js"])))=>i.map(i=>d[i]);
import{_ as dt}from"../chunks/CmsKOCeN.js";import{B as ct,s as Xe,n as he,d as u,a as de,i as $,b as l,l as a,c as p,e as v,f as W,g as N,o as ne,h as g,t as Q,j as R,z as at,r as $e,q as ue,C as _t,u as Ee,v as Ce,P as je,Q as rt,R as wt,M as yt,A as lt,af as an,x as Et,k as Rt,p as Xs,y as $s,W as on,K as cn,L as un,m as dn,E as fn}from"../chunks/CwRy9Tox.js";import{S as et,i as tt,t as qe,a as Be,g as ft,c as ht,d as Je,m as xe,b as Ze,e as Ge,f as hn}from"../chunks/D-vqeeah.js";import{g as Dt}from"../chunks/BVYH3h24.js";import{d as qt,w as pn,b as gt}from"../chunks/DjSB8mDa.js";import{N as Qe,S as ze,a as Pt,E as Gt}from"../chunks/Do1Y_WLx.js";import{c as Yt,i as St,w as gn}from"../chunks/CfA8cFIx.js";import{f as _n,u as It,a as vn,b as mn}from"../chunks/Du7SxFKq.js";import{ndk as He,getRelayUrls as bn,isConnected as kn,connectRelay as Wt,reconnectRelay as wn}from"../chunks/BTawUe4R.js";import{R as Qt}from"../chunks/C_zicc2g.js";import{f as yn,c as En}from"../chunks/GPTLThIR.js";import{n as Cn}from"../chunks/iHtL0Owe.js";import{KIND_JOIN_REQUEST as Xt,KIND_ADD_USER as $t,KIND_DELETION as ut,KIND_USER_REGISTRATION as es}from"../chunks/CZb6OUdE.js";import{U as Bt,c as Tn}from"../chunks/Blzy4VFC.js";import{e as Ie,u as vt,d as en,o as Ut}from"../chunks/BFk-VQ8S.js";const An=!0,Mn=async()=>({stats:null}),tr=Object.freeze(Object.defineProperty({__proto__:null,load:Mn,prerender:An},Symbol.toStringTag,{value:"Module"})),tn="nostr_bbs_rate_limits",sn={sectionAccessRequest:{maxAttempts:5,windowMs:60*1e3,backoffMultiplier:2,maxBackoffMs:300*1e3},cohortChange:{maxAttempts:3,windowMs:60*60*1e3,backoffMultiplier:3,maxBackoffMs:24*60*60*1e3},adminAction:{maxAttempts:10,windowMs:60*1e3,backoffMultiplier:1.5,maxBackoffMs:60*1e3}};function nn(){try{const n=sessionStorage.getItem(tn);return n?JSON.parse(n):{}}catch{return{}}}function Dn(n){try{sessionStorage.setItem(tn,JSON.stringify(n))}catch{console.warn("[RateLimit] Failed to save state")}}function Sn(n,e){const t=sn[e],s=nn(),r=Date.now(),o=s[n];if(!o)return{allowed:!0};if(o.backoffUntil>r){const i=o.backoffUntil-r;return{allowed:!1,waitMs:i,reason:`Rate limited. Please wait ${Math.ceil(i/1e3)} seconds.`}}if(r-o.firstAttempt>t.windowMs)return{allowed:!0};if(o.attempts>=t.maxAttempts){const i=Math.min(t.windowMs*Math.pow(t.backoffMultiplier,o.consecutiveFailures),t.maxBackoffMs);return{allowed:!1,waitMs:i,reason:`Too many attempts. Please wait ${Math.ceil(i/1e3)} seconds.`}}return{allowed:!0}}function Nt(n,e,t){const s=sn[e],r=nn(),o=Date.now();let i=r[n];if((!i||o-i.firstAttempt>s.windowMs)&&(i={attempts:0,firstAttempt:o,lastAttempt:o,consecutiveFailures:0,backoffUntil:0}),i.attempts++,i.lastAttempt=o,t)i.consecutiveFailures=0,i.backoffUntil=0;else if(i.consecutiveFailures++,i.attempts>=s.maxAttempts){const c=Math.min(s.windowMs*Math.pow(s.backoffMultiplier,i.consecutiveFailures),s.maxBackoffMs);i.backoffUntil=o+c}r[n]=i,Dn(r)}const In=1059,Nn=13,jt="nostr_bbs_section_access",Lt={access:[{section:"public-lobby",status:"approved"}],pendingRequests:[],stats:[],loading:!1,error:null};function Rn(){try{const n=localStorage.getItem(jt);if(n){const e=JSON.parse(n);return e.access?.some(s=>s.section==="public-lobby")||(e.access=[{section:"public-lobby",status:"approved"},...e.access||[]]),{...Lt,...e}}}catch(n){console.error("[Sections] Failed to load from storage:",n)}return Lt}function Pn(n){try{localStorage.setItem(jt,JSON.stringify({access:n.access,stats:n.stats}))}catch(e){console.error("[Sections] Failed to save to storage:",e)}}function Ln(){const{subscribe:n,set:e,update:t}=pn(Rn());return n(s=>Pn(s)),{subscribe:n,getAccessStatus(s){return ct({subscribe:n}).access.find(i=>i.section===s)?.status||"none"},canAccessSection(s){return this.getAccessStatus(s)==="approved"},async requestSectionAccess(s,r){const o=ct(Yt);if(!o)return{success:!1,error:"Not authenticated"};const i=`section_access:${o}:${s}`,c=Sn(i,"sectionAccessRequest");if(!c.allowed)return console.warn("[Sections] Rate limited:",c.reason),{success:!1,error:c.reason||"Too many requests. Please wait.",waitMs:c.waitMs};const f=this.getAccessStatus(s);if(f==="approved")return{success:!1,error:"Already have access to this section"};if(f==="pending")return{success:!1,error:"Request already pending"};if(s==="public-lobby")return t(k=>({...k,access:[...k.access.filter(h=>h.section!==s),{section:s,status:"approved",approvedAt:Date.now()}]})),Nt(i,"sectionAccessRequest",!0),{success:!0};t(k=>({...k,access:[...k.access.filter(h=>h.section!==s),{section:s,status:"pending",requestedAt:Date.now()}]}));const{requestSectionAccess:_}=await dt(async()=>{const{requestSectionAccess:k}=await Promise.resolve().then(()=>kt);return{requestSectionAccess:k}},void 0,import.meta.url),m=await _(s,r);return m.success?(Nt(i,"sectionAccessRequest",!0),{success:!0}):(Nt(i,"sectionAccessRequest",!1),t(k=>({...k,access:k.access.filter(h=>!(h.section===s&&h.status==="pending"))})),{success:!1,error:m.error})},async approveRequest(s){if(!ct(St))return{success:!1,error:"Admin access required"};t(c=>({...c,pendingRequests:c.pendingRequests.filter(f=>f.id!==s.id)}));const{approveSectionAccess:o}=await dt(async()=>{const{approveSectionAccess:c}=await Promise.resolve().then(()=>kt);return{approveSectionAccess:c}},void 0,import.meta.url),i=await o(s);return i.success?{success:!0}:(t(c=>({...c,pendingRequests:[s,...c.pendingRequests]})),{success:!1,error:i.error})},async denyRequest(s,r){if(!ct(St))return{success:!1,error:"Admin access required"};if(t(i=>({...i,pendingRequests:i.pendingRequests.filter(c=>c.id!==s.id)})),r)try{const{ndk:i}=await dt(async()=>{const{ndk:m}=await import("../chunks/BTawUe4R.js");return{ndk:m}},__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url),{NDKEvent:c}=await dt(async()=>{const{NDKEvent:m}=await import("../chunks/Do1Y_WLx.js").then(k=>k.X);return{NDKEvent:m}},__vite__mapDeps([1,2,3,4,5]),import.meta.url),f=i();if(!f)return console.error("[Sections] NDK not initialized for DM"),{success:!0};const _=f.signer;if(_){const m=`Your access request for ${s.section} has been denied. Reason: ${r}`,k=f.getUser({pubkey:s.requesterPubkey}),h=new c(f);h.kind=Nn,h.tags=[["p",s.requesterPubkey]],h.content=m,h.created_at=Math.floor(Date.now()/1e3),await h.sign(_);const d=new c(f);d.kind=In,d.tags=[["p",s.requesterPubkey]],d.content=await _.encrypt(k,JSON.stringify(h.rawEvent())),d.created_at=Math.floor(Date.now()/1e3),await d.sign(_),await d.publish()}}catch(i){console.error("[Sections] Failed to send denial DM:",i)}return{success:!0}},addPendingRequest(s){t(r=>({...r,pendingRequests:[s,...r.pendingRequests.filter(o=>o.id!==s.id)]})),Cn.addNotification("join-request",`New access request for ${s.section}`,{senderPubkey:s.requesterPubkey,url:"/admin?tab=section-requests"})},setAccess(s){t(r=>({...r,access:[...r.access.filter(o=>o.section!==s.section),s]}))},updateStats(s){t(r=>({...r,stats:[...r.stats.filter(o=>o.section!==s.section),s]}))},getStats(s){return ct({subscribe:n}).stats.find(o=>o.section===s)},clear(){e(Lt),localStorage.removeItem(jt)},async refresh(){t(s=>({...s,loading:!0,error:null}));try{const s=ct(Yt),r=ct(St),{fetchSectionStats:o,fetchUserAccess:i,fetchPendingRequests:c}=await dt(async()=>{const{fetchSectionStats:k,fetchUserAccess:h,fetchPendingRequests:d}=await Promise.resolve().then(()=>kt);return{fetchSectionStats:k,fetchUserAccess:h,fetchPendingRequests:d}},void 0,import.meta.url),[f,_,m]=await Promise.all([o(),s?i(s):Promise.resolve([]),r?c():Promise.resolve([])]);t(k=>({...k,stats:f,access:_.length>0?_:k.access,pendingRequests:r?m:k.pendingRequests,loading:!1}))}catch(s){const r=s instanceof Error?s.message:"Failed to refresh";t(o=>({...o,loading:!1,error:r}))}}}}const Ct=Ln();qt(Ct,n=>n.access.filter(e=>e.status==="approved").map(e=>e.section));qt(Ct,n=>n.access.filter(e=>e.status==="pending").map(e=>e.section));qt(Ct,n=>n.pendingRequests.length);const Tt=9022,Ot=9023,Vn=30079,qn=1059;async function Bn(n,e){if(n==="public-lobby")return{success:!1,error:"This section does not require approval"};try{const t=He();if(!t)return{success:!1,error:"NDK not initialized"};const s=t.signer;if(!s)return{success:!1,error:"No signer available"};if(!(await s.user())?.pubkey)return{success:!1,error:"Unable to get user pubkey"};const o="11ed64225dd5e2c5e18f61ad43d5ad9272d08739d3a20dd25886197b0738663c".split(",").map(c=>c.trim()).filter(Boolean);if(o.length===0)return{success:!1,error:"No admin configured"};const i=new Qe(t);return i.kind=Tt,i.content=e||"",i.tags=[["section",n],...o.map(c=>["p",c])],await i.sign(s),await i.publish(),{success:!0,eventId:i.id}}catch(t){return console.error("[Sections] Failed to request access:",t),{success:!1,error:t instanceof Error?t.message:"Failed to publish request"}}}async function ln(n){try{const e=He();if(!e)return{success:!1,error:"NDK not initialized"};const t=e.signer;if(!t)return{success:!1,error:"No signer available"};if(!(await t.user())?.pubkey)return{success:!1,error:"Unable to get admin pubkey"};const r=new Qe(e);r.kind=Ot,r.content=JSON.stringify({section:n.section,approvedAt:Date.now()}),r.tags=[["section",n.section],["p",n.requesterPubkey],["e",n.id]],await r.sign(t),await r.publish();const i=`Welcome to ${ze[n.section].name}! Your access request has been approved. You can now join public channels in this area.`;return await Un(n.requesterPubkey,i),{success:!0}}catch(e){return console.error("[Sections] Failed to approve access:",e),{success:!1,error:e instanceof Error?e.message:"Failed to approve"}}}async function Un(n,e){try{const t=He();if(!t){console.warn("[Sections] Cannot send DM: NDK not initialized");return}const s=t.signer;if(!s){console.warn("[Sections] Cannot send DM: no signer");return}if(await s.user()){const o=new Qe(t);o.kind=13,o.tags=[["p",n]],o.content=e,o.created_at=Math.floor(Date.now()/1e3),await o.sign(s);const i=new Qe(t);i.kind=qn,i.tags=[["p",n]],i.content=await s.encrypt({pubkey:n},JSON.stringify(o.rawEvent())),i.created_at=Math.floor(Date.now()/1e3),await i.sign(s),await i.publish()}}catch(t){console.error("[Sections] Failed to send approval DM:",t)}}async function jn(){try{const n=He();if(!n)return[];const e="11ed64225dd5e2c5e18f61ad43d5ad9272d08739d3a20dd25886197b0738663c".split(",").map(f=>f.trim()).filter(Boolean);if(e.length===0)return[];const t={kinds:[Tt],"#p":e,limit:100},s=await n.fetchEvents(t),r=[],o={kinds:[Ot],limit:500},i=await n.fetchEvents(o),c=new Set(Array.from(i).flatMap(f=>f.tags.filter(_=>_[0]==="e").map(_=>_[1])));for(const f of s){if(c.has(f.id))continue;const _=f.tags.find(m=>m[0]==="section")?.[1];_&&r.push({id:f.id,section:_,requesterPubkey:f.pubkey,requestedAt:(f.created_at||0)*1e3,message:f.content||void 0,status:"pending"})}return r}catch(n){return console.error("[Sections] Failed to fetch requests:",n),[]}}async function On(n){if(!n)return[];try{const e=He();if(!e)return[];const t={kinds:[Ot],"#p":[n],limit:50},s=await e.fetchEvents(t),r=[];r.push({section:"public-lobby",status:"approved"});for(const f of s){const _=f.tags.find(k=>k[0]==="section")?.[1];if(!_)continue;let m={};try{m=JSON.parse(f.content)}catch{}r.push({section:_,status:"approved",approvedAt:m.approvedAt||(f.created_at||0)*1e3,approvedBy:f.pubkey})}const o={kinds:[Tt],authors:[n],limit:10},i=await e.fetchEvents(o),c=new Set(r.map(f=>f.section));for(const f of i){const _=f.tags.find(m=>m[0]==="section")?.[1];!_||c.has(_)||r.push({section:_,status:"pending",requestedAt:(f.created_at||0)*1e3})}return r}catch(e){return console.error("[Sections] Failed to fetch user access:",e),[]}}async function Hn(){try{const n=He();if(!n)return[];const e={kinds:[Vn],limit:10},t=await n.fetchEvents(e),s=[];for(const r of t){const o=r.tags.find(c=>c[0]==="d")?.[1];if(!o)continue;let i={};try{i=JSON.parse(r.content)}catch{}s.push({section:o,channelCount:i.channelCount||0,memberCount:i.memberCount||0,messageCount:i.messageCount||0,lastActivity:i.lastActivity||(r.created_at||0)*1e3})}return s}catch(n){return console.error("[Sections] Failed to fetch stats:",n),[]}}function rn(n){try{const e=He();if(!e)return null;const t="11ed64225dd5e2c5e18f61ad43d5ad9272d08739d3a20dd25886197b0738663c".split(",").map(o=>o.trim()).filter(Boolean);if(t.length===0)return null;const s={kinds:[Tt],"#p":t,since:Math.floor(Date.now()/1e3)},r=e.subscribe(s,{closeOnEose:!1});return r.on("event",o=>{const i=o.tags.find(c=>c[0]==="section")?.[1];i&&n({id:o.id,section:i,requesterPubkey:o.pubkey,requestedAt:(o.created_at||0)*1e3,message:o.content||void 0,status:"pending"})}),r}catch(e){return console.error("[Sections] Failed to subscribe to requests:",e),null}}const kt=Object.freeze(Object.defineProperty({__proto__:null,approveSectionAccess:ln,fetchPendingRequests:jn,fetchSectionStats:Hn,fetchUserAccess:On,requestSectionAccess:Bn,subscribeAccessRequests:rn},Symbol.toStringTag,{value:"Module"}));function Fn(n){let e,t,s,r,o=n[0].totalUsers+"",i,c,f,_="Total Users",m,k,h,d,b=n[0].totalChannels+"",w,D,C,j="Total Channels",B,q,y,A,L=n[0].totalMessages+"",x,K,Z,G="Total Messages",te,F,z,O,P=n[0].pendingApprovals+"",S,I,E,M="Pending Approvals";return{c(){e=g("div"),t=g("div"),s=g("div"),r=g("div"),i=Q(o),c=R(),f=g("div"),f.textContent=_,m=R(),k=g("div"),h=g("div"),d=g("div"),w=Q(b),D=R(),C=g("div"),C.textContent=j,B=R(),q=g("div"),y=g("div"),A=g("div"),x=Q(L),K=R(),Z=g("div"),Z.textContent=G,te=R(),F=g("div"),z=g("div"),O=g("div"),S=Q(P),I=R(),E=g("div"),E.textContent=M,this.h()},l(U){e=p(U,"DIV",{class:!0});var V=v(e);t=p(V,"DIV",{class:!0});var ie=v(t);s=p(ie,"DIV",{class:!0});var re=v(s);r=p(re,"DIV",{class:!0});var J=v(r);i=W(J,o),J.forEach(u),c=N(re),f=p(re,"DIV",{class:!0,"data-svelte-h":!0}),ne(f)!=="svelte-mko655"&&(f.textContent=_),re.forEach(u),ie.forEach(u),m=N(V),k=p(V,"DIV",{class:!0});var ae=v(k);h=p(ae,"DIV",{class:!0});var T=v(h);d=p(T,"DIV",{class:!0});var H=v(d);w=W(H,b),H.forEach(u),D=N(T),C=p(T,"DIV",{class:!0,"data-svelte-h":!0}),ne(C)!=="svelte-1vop7r"&&(C.textContent=j),T.forEach(u),ae.forEach(u),B=N(V),q=p(V,"DIV",{class:!0});var ee=v(q);y=p(ee,"DIV",{class:!0});var X=v(y);A=p(X,"DIV",{class:!0});var pe=v(A);x=W(pe,L),pe.forEach(u),K=N(X),Z=p(X,"DIV",{class:!0,"data-svelte-h":!0}),ne(Z)!=="svelte-16fgwgv"&&(Z.textContent=G),X.forEach(u),ee.forEach(u),te=N(V),F=p(V,"DIV",{class:!0});var ge=v(F);z=p(ge,"DIV",{class:!0});var be=v(z);O=p(be,"DIV",{class:!0});var we=v(O);S=W(we,P),we.forEach(u),I=N(be),E=p(be,"DIV",{class:!0,"data-svelte-h":!0}),ne(E)!=="svelte-14ec3qe"&&(E.textContent=M),be.forEach(u),ge.forEach(u),V.forEach(u),this.h()},h(){a(r,"class","stat-value text-primary"),a(f,"class","text-sm text-base-content/70 uppercase tracking-wide"),a(s,"class","card-body items-center text-center"),a(t,"class","card bg-base-200"),a(d,"class","stat-value text-primary"),a(C,"class","text-sm text-base-content/70 uppercase tracking-wide"),a(h,"class","card-body items-center text-center"),a(k,"class","card bg-base-200"),a(A,"class","stat-value text-primary"),a(Z,"class","text-sm text-base-content/70 uppercase tracking-wide"),a(y,"class","card-body items-center text-center"),a(q,"class","card bg-base-200"),a(O,"class","stat-value text-warning"),a(E,"class","text-sm text-base-content/70 uppercase tracking-wide"),a(z,"class","card-body items-center text-center"),a(F,"class","card bg-warning/20 border border-warning"),a(e,"class","grid gap-4 sm:grid-cols-2 lg:grid-cols-4 mb-8")},m(U,V){$(U,e,V),l(e,t),l(t,s),l(s,r),l(r,i),l(s,c),l(s,f),l(e,m),l(e,k),l(k,h),l(h,d),l(d,w),l(h,D),l(h,C),l(e,B),l(e,q),l(q,y),l(y,A),l(A,x),l(y,K),l(y,Z),l(e,te),l(e,F),l(F,z),l(z,O),l(O,S),l(z,I),l(z,E)},p(U,[V]){V&1&&o!==(o=U[0].totalUsers+"")&&de(i,o),V&1&&b!==(b=U[0].totalChannels+"")&&de(w,b),V&1&&L!==(L=U[0].totalMessages+"")&&de(x,L),V&1&&P!==(P=U[0].pendingApprovals+"")&&de(S,P)},i:he,o:he,d(U){U&&u(e)}}}function zn(n,e,t){let{stats:s}=e;return n.$$set=r=>{"stats"in r&&t(0,s=r.stats)},[s]}class Kn extends et{constructor(e){super(),tt(this,e,zn,Fn,Xe,{stats:0})}}function Jn(n,e,t){const s=n.slice();return s[5]=e[t],s}function xn(n){let e;return{c(){e=Q("Connected to public Nostr relays. Messages are federated.")},l(t){e=W(t,"Connected to public Nostr relays. Messages are federated.")},m(t,s){$(t,e,s)},d(t){t&&u(e)}}}function Zn(n){let e;return{c(){e=Q("Only connected to local relay. Messages stay private.")},l(t){e=W(t,"Only connected to local relay. Messages stay private.")},m(t,s){$(t,e,s)},d(t){t&&u(e)}}}function ts(n){let e;return{c(){e=g("span"),this.h()},l(t){e=p(t,"SPAN",{class:!0}),v(e).forEach(u),this.h()},h(){a(e,"class","loading loading-spinner loading-sm ml-2")},m(t,s){$(t,e,s)},d(t){t&&u(e)}}}function Gn(n){let e,t;return{c(){e=g("span"),t=Q(n[5]),this.h()},l(s){e=p(s,"SPAN",{class:!0});var r=v(e);t=W(r,n[5]),r.forEach(u),this.h()},h(){a(e,"class","badge badge-outline")},m(s,r){$(s,e,r),l(e,t)},p:he,d(s){s&&u(e)}}}function ss(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg> <span>Federated mode connects to public relays. Messages will be visible on the wider Nostr network.</span>';return{c(){e=g("div"),e.innerHTML=t,this.h()},l(s){e=p(s,"DIV",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-zkqud2"&&(e.innerHTML=t),this.h()},h(){a(e,"class","alert alert-warning mt-4")},m(s,r){$(s,e,r)},d(s){s&&u(e)}}}function Yn(n){let e,t,s,r="Relay Settings",o,i,c="Control whether the app connects only to your private relay or federates with the wider Nostr network.",f,_,m,k,h,d,b,w=n[0]?"Private Mode":"Federated Mode",D,C,j,B,q,y,A,L="Active Relays:",x,K,Z,G,te;function F(M,U){return M[0]?Zn:xn}let z=F(n),O=z(n),P=n[1]&&ts(),S=Ie(bn()),I=[];for(let M=0;M<S.length;M+=1)I[M]=Gn(Jn(n,S,M));let E=!n[0]&&ss();return{c(){e=g("div"),t=g("div"),s=g("h2"),s.textContent=r,o=R(),i=g("p"),i.textContent=c,f=R(),_=g("div"),m=g("label"),k=g("input"),h=R(),d=g("div"),b=g("span"),D=Q(w),C=R(),j=g("p"),O.c(),B=R(),P&&P.c(),q=R(),y=g("div"),A=g("div"),A.textContent=L,x=R(),K=g("div");for(let M=0;M<I.length;M+=1)I[M].c();Z=R(),E&&E.c(),this.h()},l(M){e=p(M,"DIV",{class:!0});var U=v(e);t=p(U,"DIV",{class:!0});var V=v(t);s=p(V,"H2",{class:!0,"data-svelte-h":!0}),ne(s)!=="svelte-n4dr3s"&&(s.textContent=r),o=N(V),i=p(V,"P",{class:!0,"data-svelte-h":!0}),ne(i)!=="svelte-z9s0un"&&(i.textContent=c),f=N(V),_=p(V,"DIV",{class:!0});var ie=v(_);m=p(ie,"LABEL",{class:!0});var re=v(m);k=p(re,"INPUT",{type:!0,class:!0}),h=N(re),d=p(re,"DIV",{});var J=v(d);b=p(J,"SPAN",{class:!0});var ae=v(b);D=W(ae,w),ae.forEach(u),C=N(J),j=p(J,"P",{class:!0});var T=v(j);O.l(T),T.forEach(u),J.forEach(u),B=N(re),P&&P.l(re),re.forEach(u),ie.forEach(u),q=N(V),y=p(V,"DIV",{class:!0});var H=v(y);A=p(H,"DIV",{class:!0,"data-svelte-h":!0}),ne(A)!=="svelte-11eaj9u"&&(A.textContent=L),x=N(H),K=p(H,"DIV",{class:!0});var ee=v(K);for(let X=0;X<I.length;X+=1)I[X].l(ee);ee.forEach(u),H.forEach(u),Z=N(V),E&&E.l(V),V.forEach(u),U.forEach(u),this.h()},h(){a(s,"class","card-title"),a(i,"class","text-sm text-base-content/70 mb-4"),a(k,"type","checkbox"),a(k,"class","toggle toggle-primary toggle-lg"),k.disabled=n[1],a(b,"class","label-text font-semibold text-lg"),a(j,"class","text-sm text-base-content/60"),a(m,"class","label cursor-pointer justify-start gap-4"),a(_,"class","form-control"),a(A,"class","text-sm font-medium mb-2"),a(K,"class","flex flex-wrap gap-2"),a(y,"class","mt-4 p-3 bg-base-300 rounded-lg"),a(t,"class","card-body"),a(e,"class","card bg-base-200 mb-6")},m(M,U){$(M,e,U),l(e,t),l(t,s),l(t,o),l(t,i),l(t,f),l(t,_),l(_,m),l(m,k),k.checked=n[0],l(m,h),l(m,d),l(d,b),l(b,D),l(d,C),l(d,j),O.m(j,null),l(m,B),P&&P.m(m,null),l(t,q),l(t,y),l(y,A),l(y,x),l(y,K);for(let V=0;V<I.length;V+=1)I[V]&&I[V].m(K,null);l(t,Z),E&&E.m(t,null),G||(te=[ue(k,"change",n[3]),ue(k,"change",n[2])],G=!0)},p(M,[U]){U&2&&(k.disabled=M[1]),U&1&&(k.checked=M[0]),U&1&&w!==(w=M[0]?"Private Mode":"Federated Mode")&&de(D,w),z!==(z=F(M))&&(O.d(1),O=z(M),O&&(O.c(),O.m(j,null))),M[1]?P||(P=ts(),P.c(),P.m(m,null)):P&&(P.d(1),P=null),M[0]?E&&(E.d(1),E=null):E||(E=ss(),E.c(),E.m(t,null))},i:he,o:he,d(M){M&&u(e),O.d(),P&&P.d(),at(I,M),E&&E.d(),G=!1,$e(te)}}}function Wn(n,e,t){let{isPrivateMode:s}=e,{isSwitchingMode:r}=e;const o=_t();function i(){o("modeChange")}function c(){s=this.checked,t(0,s)}return n.$$set=f=>{"isPrivateMode"in f&&t(0,s=f.isPrivateMode),"isSwitchingMode"in f&&t(1,r=f.isSwitchingMode)},[s,r,i,c]}class Qn extends et{constructor(e){super(),tt(this,e,Wn,Yn,Xe,{isPrivateMode:0,isSwitchingMode:1})}}function ns(n,e,t){const s=n.slice();return s[19]=e[t],s}function ls(n,e,t){const s=n.slice();return s[22]=e[t],s}function rs(n,e,t){const s=n.slice();return s[25]=e[t][0],s[26]=e[t][1],s}function as(n){let e,t,s="New Channel",r,o,i,c='<span class="label-text">Channel Name *</span>',f,_,m,k,h,d='<span class="label-text">Description</span>',b,w,D,C,j,B='<span class="label-text">Section (Area)</span>',q,y,A,L,x=(ze[n[8]]?.description||"")+"",K,Z,G,te,F,z='<span class="label-text">Visibility</span>',O,P,S,I="Public",E,M="Cohort Only",U,V="Private",ie,re,J,ae='<span class="label-text">Cohorts (comma-separated)</span>',T,H,ee,X,pe,ge,be,we,Me="Encrypted Messages",Y,le,ce,ke="Cancel",Te,Ae,De,Oe,Re,Se,Ue=Ie(Object.entries(ze)),Pe=[];for(let oe=0;oe<Ue.length;oe+=1)Pe[oe]=os(rs(n,Ue,oe));let ve=n[2]&&is();return{c(){e=g("div"),t=g("h3"),t.textContent=s,r=R(),o=g("div"),i=g("label"),i.innerHTML=c,f=R(),_=g("input"),m=R(),k=g("div"),h=g("label"),h.innerHTML=d,b=R(),w=g("textarea"),D=R(),C=g("div"),j=g("label"),j.innerHTML=B,q=R(),y=g("select");for(let oe=0;oe<Pe.length;oe+=1)Pe[oe].c();A=R(),L=g("span"),K=Q(x),Z=R(),G=g("div"),te=g("div"),F=g("label"),F.innerHTML=z,O=R(),P=g("select"),S=g("option"),S.textContent=I,E=g("option"),E.textContent=M,U=g("option"),U.textContent=V,ie=R(),re=g("div"),J=g("label"),J.innerHTML=ae,T=R(),H=g("input"),ee=R(),X=g("div"),pe=g("label"),ge=g("input"),be=R(),we=g("span"),we.textContent=Me,Y=R(),le=g("div"),ce=g("button"),ce.textContent=ke,Te=R(),Ae=g("button"),ve&&ve.c(),De=Q(`
            Create Channel`),this.h()},l(oe){e=p(oe,"DIV",{class:!0});var me=v(e);t=p(me,"H3",{class:!0,"data-svelte-h":!0}),ne(t)!=="svelte-1429g2p"&&(t.textContent=s),r=N(me),o=p(me,"DIV",{class:!0});var fe=v(o);i=p(fe,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),ne(i)!=="svelte-1ty5we0"&&(i.innerHTML=c),f=N(fe),_=p(fe,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),fe.forEach(u),m=N(me),k=p(me,"DIV",{class:!0});var Ne=v(k);h=p(Ne,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),ne(h)!=="svelte-bmf767"&&(h.innerHTML=d),b=N(Ne),w=p(Ne,"TEXTAREA",{id:!0,class:!0,placeholder:!0,rows:!0}),v(w).forEach(u),Ne.forEach(u),D=N(me),C=p(me,"DIV",{class:!0});var Ye=v(C);j=p(Ye,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),ne(j)!=="svelte-qoxf07"&&(j.innerHTML=B),q=N(Ye),y=p(Ye,"SELECT",{id:!0,class:!0});var ot=v(y);for(let it=0;it<Pe.length;it+=1)Pe[it].l(ot);ot.forEach(u),A=N(Ye),L=p(Ye,"SPAN",{class:!0});var Fe=v(L);K=W(Fe,x),Fe.forEach(u),Ye.forEach(u),Z=N(me),G=p(me,"DIV",{class:!0});var Le=v(G);te=p(Le,"DIV",{class:!0});var Ve=v(te);F=p(Ve,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),ne(F)!=="svelte-zq4cp"&&(F.innerHTML=z),O=N(Ve),P=p(Ve,"SELECT",{id:!0,class:!0});var se=v(P);S=p(se,"OPTION",{"data-svelte-h":!0}),ne(S)!=="svelte-56kvny"&&(S.textContent=I),E=p(se,"OPTION",{"data-svelte-h":!0}),ne(E)!=="svelte-11ea9qe"&&(E.textContent=M),U=p(se,"OPTION",{"data-svelte-h":!0}),ne(U)!=="svelte-1biwgrw"&&(U.textContent=V),se.forEach(u),Ve.forEach(u),ie=N(Le),re=p(Le,"DIV",{class:!0});var ye=v(re);J=p(ye,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),ne(J)!=="svelte-1pvacrn"&&(J.innerHTML=ae),T=N(ye),H=p(ye,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),ye.forEach(u),Le.forEach(u),ee=N(me),X=p(me,"DIV",{class:!0});var _e=v(X);pe=p(_e,"LABEL",{class:!0});var Ke=v(pe);ge=p(Ke,"INPUT",{type:!0,class:!0}),be=N(Ke),we=p(Ke,"SPAN",{class:!0,"data-svelte-h":!0}),ne(we)!=="svelte-19w2onf"&&(we.textContent=Me),Ke.forEach(u),_e.forEach(u),Y=N(me),le=p(me,"DIV",{class:!0});var We=v(le);ce=p(We,"BUTTON",{class:!0,"data-svelte-h":!0}),ne(ce)!=="svelte-2wjeji"&&(ce.textContent=ke),Te=N(We),Ae=p(We,"BUTTON",{class:!0});var st=v(Ae);ve&&ve.l(st),De=W(st,`
            Create Channel`),st.forEach(u),We.forEach(u),me.forEach(u),this.h()},h(){a(t,"class","font-semibold mb-4"),a(i,"class","label"),a(i,"for","mgmt-channel-name"),a(_,"id","mgmt-channel-name"),a(_,"type","text"),a(_,"placeholder","Enter channel name"),a(_,"class","input input-bordered"),a(o,"class","form-control mb-3"),a(h,"class","label"),a(h,"for","mgmt-channel-description"),a(w,"id","mgmt-channel-description"),a(w,"class","textarea textarea-bordered"),a(w,"placeholder","Channel description (optional)"),a(w,"rows","2"),a(k,"class","form-control mb-3"),a(j,"class","label"),a(j,"for","mgmt-channel-section"),a(y,"id","mgmt-channel-section"),a(y,"class","select select-bordered"),n[8]===void 0&&wt(()=>n[13].call(y)),a(L,"class","label-text-alt text-base-content/60 mt-1"),a(C,"class","form-control mb-3"),a(F,"class","label"),a(F,"for","mgmt-channel-visibility"),S.__value="public",je(S,S.__value),E.__value="cohort",je(E,E.__value),U.__value="private",je(U,U.__value),a(P,"id","mgmt-channel-visibility"),a(P,"class","select select-bordered"),n[5]===void 0&&wt(()=>n[14].call(P)),a(te,"class","form-control"),a(J,"class","label"),a(J,"for","mgmt-channel-cohorts"),a(H,"id","mgmt-channel-cohorts"),a(H,"type","text"),a(H,"placeholder","e.g., 2024, 2025"),a(H,"class","input input-bordered"),a(re,"class","form-control"),a(G,"class","grid grid-cols-1 md:grid-cols-2 gap-4 mb-3"),a(ge,"type","checkbox"),a(ge,"class","toggle toggle-primary"),a(we,"class","label-text"),a(pe,"class","label cursor-pointer justify-start gap-2"),a(X,"class","form-control mb-4"),a(ce,"class","btn btn-ghost"),a(Ae,"class","btn btn-primary"),Ae.disabled=Oe=n[2]||!n[3].trim(),a(le,"class","flex justify-end gap-2"),a(e,"class","mt-4 p-4 bg-base-300 rounded-lg")},m(oe,me){$(oe,e,me),l(e,t),l(e,r),l(e,o),l(o,i),l(o,f),l(o,_),je(_,n[3]),l(e,m),l(e,k),l(k,h),l(k,b),l(k,w),je(w,n[4]),l(e,D),l(e,C),l(C,j),l(C,q),l(C,y);for(let fe=0;fe<Pe.length;fe+=1)Pe[fe]&&Pe[fe].m(y,null);rt(y,n[8],!0),l(C,A),l(C,L),l(L,K),l(e,Z),l(e,G),l(G,te),l(te,F),l(te,O),l(te,P),l(P,S),l(P,E),l(P,U),rt(P,n[5],!0),l(G,ie),l(G,re),l(re,J),l(re,T),l(re,H),je(H,n[6]),l(e,ee),l(e,X),l(X,pe),l(pe,ge),ge.checked=n[7],l(pe,be),l(pe,we),l(e,Y),l(e,le),l(le,ce),l(le,Te),l(le,Ae),ve&&ve.m(Ae,null),l(Ae,De),Re||(Se=[ue(_,"input",n[11]),ue(w,"input",n[12]),ue(y,"change",n[13]),ue(P,"change",n[14]),ue(H,"input",n[15]),ue(ge,"change",n[16]),ue(ce,"click",n[17]),ue(Ae,"click",n[9])],Re=!0)},p(oe,me){if(me&8&&_.value!==oe[3]&&je(_,oe[3]),me&16&&je(w,oe[4]),me&0){Ue=Ie(Object.entries(ze));let fe;for(fe=0;fe<Ue.length;fe+=1){const Ne=rs(oe,Ue,fe);Pe[fe]?Pe[fe].p(Ne,me):(Pe[fe]=os(Ne),Pe[fe].c(),Pe[fe].m(y,null))}for(;fe<Pe.length;fe+=1)Pe[fe].d(1);Pe.length=Ue.length}me&256&&rt(y,oe[8]),me&256&&x!==(x=(ze[oe[8]]?.description||"")+"")&&de(K,x),me&32&&rt(P,oe[5]),me&64&&H.value!==oe[6]&&je(H,oe[6]),me&128&&(ge.checked=oe[7]),oe[2]?ve||(ve=is(),ve.c(),ve.m(Ae,De)):ve&&(ve.d(1),ve=null),me&12&&Oe!==(Oe=oe[2]||!oe[3].trim())&&(Ae.disabled=Oe)},d(oe){oe&&u(e),at(Pe,oe),ve&&ve.d(),Re=!1,$e(Se)}}}function os(n){let e,t=n[26].icon+"",s,r,o=n[26].name+"",i;return{c(){e=g("option"),s=Q(t),r=R(),i=Q(o),this.h()},l(c){e=p(c,"OPTION",{});var f=v(e);s=W(f,t),r=N(f),i=W(f,o),f.forEach(u),this.h()},h(){e.__value=n[25],je(e,e.__value)},m(c,f){$(c,e,f),l(e,s),l(e,r),l(e,i)},p:he,d(c){c&&u(e)}}}function is(n){let e;return{c(){e=g("span"),this.h()},l(t){e=p(t,"SPAN",{class:!0}),v(e).forEach(u),this.h()},h(){a(e,"class","loading loading-spinner loading-sm")},m(t,s){$(t,e,s)},d(t){t&&u(e)}}}function Xn(n){let e,t=[],s=new Map,r=Ie(n[1]);const o=i=>i[19].id;for(let i=0;i<r.length;i+=1){let c=ns(n,r,i),f=o(c);s.set(f,t[i]=fs(f,c))}return{c(){e=g("div");for(let i=0;i<t.length;i+=1)t[i].c();this.h()},l(i){e=p(i,"DIV",{class:!0});var c=v(e);for(let f=0;f<t.length;f+=1)t[f].l(c);c.forEach(u),this.h()},h(){a(e,"class","grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4")},m(i,c){$(i,e,c);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null)},p(i,c){c&2&&(r=Ie(i[1]),t=vt(t,c,o,1,i,r,s,e,en,fs,null,ns))},d(i){i&&u(e);for(let c=0;c<t.length;c+=1)t[c].d()}}}function $n(n){let e,t="<p>No channels yet. Create your first channel above.</p>";return{c(){e=g("div"),e.innerHTML=t,this.h()},l(s){e=p(s,"DIV",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-1t3kezq"&&(e.innerHTML=t),this.h()},h(){a(e,"class","text-center py-8 text-base-content/50")},m(s,r){$(s,e,r)},p:he,d(s){s&&u(e)}}}function el(n){let e,t='<span class="loading loading-spinner loading-lg"></span> <p class="mt-2 text-base-content/70">Loading channels...</p>';return{c(){e=g("div"),e.innerHTML=t,this.h()},l(s){e=p(s,"DIV",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-1rdo2xv"&&(e.innerHTML=t),this.h()},h(){a(e,"class","text-center py-8")},m(s,r){$(s,e,r)},p:he,d(s){s&&u(e)}}}function cs(n){let e,t=n[19].description+"",s;return{c(){e=g("p"),s=Q(t),this.h()},l(r){e=p(r,"P",{class:!0});var o=v(e);s=W(o,t),o.forEach(u),this.h()},h(){a(e,"class","text-sm text-base-content/70 line-clamp-2")},m(r,o){$(r,e,o),l(e,s)},p(r,o){o&2&&t!==(t=r[19].description+"")&&de(s,t)},d(r){r&&u(e)}}}function us(n){let e,t="Encrypted";return{c(){e=g("span"),e.textContent=t,this.h()},l(s){e=p(s,"SPAN",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-1g44nk6"&&(e.textContent=t),this.h()},h(){a(e,"class","badge badge-info badge-sm")},m(s,r){$(s,e,r)},d(s){s&&u(e)}}}function ds(n){let e,t=n[22]+"",s;return{c(){e=g("span"),s=Q(t),this.h()},l(r){e=p(r,"SPAN",{class:!0});var o=v(e);s=W(o,t),o.forEach(u),this.h()},h(){a(e,"class","badge badge-outline badge-sm")},m(r,o){$(r,e,o),l(e,s)},p(r,o){o&2&&t!==(t=r[22]+"")&&de(s,t)},d(r){r&&u(e)}}}function fs(n,e){let t,s,r,o=e[19].name+"",i,c,f,_,m,k=(ze[e[19].section]?.icon||"ðŸ‘‹")+"",h,d,b=(ze[e[19].section]?.name||"Guest Area")+"",w,D,C,j=e[19].visibility+"",B,q,y,A,L,x,K,Z=hs(e[19].createdAt)+"",G,te,F=e[19].description&&cs(e),z=e[19].encrypted&&us(),O=Ie(e[19].cohorts),P=[];for(let S=0;S<O.length;S+=1)P[S]=ds(ls(e,O,S));return{key:n,first:null,c(){t=g("div"),s=g("div"),r=g("h3"),i=Q(o),c=R(),F&&F.c(),f=R(),_=g("div"),m=g("span"),h=Q(k),d=R(),w=Q(b),D=R(),C=g("span"),B=Q(j),y=R(),z&&z.c(),A=R();for(let S=0;S<P.length;S+=1)P[S].c();L=R(),x=g("div"),K=Q("Created "),G=Q(Z),te=R(),this.h()},l(S){t=p(S,"DIV",{class:!0});var I=v(t);s=p(I,"DIV",{class:!0});var E=v(s);r=p(E,"H3",{class:!0});var M=v(r);i=W(M,o),M.forEach(u),c=N(E),F&&F.l(E),f=N(E),_=p(E,"DIV",{class:!0});var U=v(_);m=p(U,"SPAN",{class:!0,title:!0});var V=v(m);h=W(V,k),d=N(V),w=W(V,b),V.forEach(u),D=N(U),C=p(U,"SPAN",{class:!0});var ie=v(C);B=W(ie,j),ie.forEach(u),y=N(U),z&&z.l(U),A=N(U);for(let J=0;J<P.length;J+=1)P[J].l(U);U.forEach(u),L=N(E),x=p(E,"DIV",{class:!0});var re=v(x);K=W(re,"Created "),G=W(re,Z),re.forEach(u),E.forEach(u),te=N(I),I.forEach(u),this.h()},h(){a(r,"class","font-semibold"),a(m,"class","badge badge-neutral badge-sm"),a(m,"title","Section"),a(C,"class",q="badge "+ps(e[19].visibility)+" badge-sm"),a(_,"class","flex flex-wrap gap-1 mt-2"),a(x,"class","text-xs text-base-content/50 mt-2"),a(s,"class","card-body p-4"),a(t,"class","card bg-base-300"),this.first=t},m(S,I){$(S,t,I),l(t,s),l(s,r),l(r,i),l(s,c),F&&F.m(s,null),l(s,f),l(s,_),l(_,m),l(m,h),l(m,d),l(m,w),l(_,D),l(_,C),l(C,B),l(_,y),z&&z.m(_,null),l(_,A);for(let E=0;E<P.length;E+=1)P[E]&&P[E].m(_,null);l(s,L),l(s,x),l(x,K),l(x,G),l(t,te)},p(S,I){if(e=S,I&2&&o!==(o=e[19].name+"")&&de(i,o),e[19].description?F?F.p(e,I):(F=cs(e),F.c(),F.m(s,f)):F&&(F.d(1),F=null),I&2&&k!==(k=(ze[e[19].section]?.icon||"ðŸ‘‹")+"")&&de(h,k),I&2&&b!==(b=(ze[e[19].section]?.name||"Guest Area")+"")&&de(w,b),I&2&&j!==(j=e[19].visibility+"")&&de(B,j),I&2&&q!==(q="badge "+ps(e[19].visibility)+" badge-sm")&&a(C,"class",q),e[19].encrypted?z||(z=us(),z.c(),z.m(_,A)):z&&(z.d(1),z=null),I&2){O=Ie(e[19].cohorts);let E;for(E=0;E<O.length;E+=1){const M=ls(e,O,E);P[E]?P[E].p(M,I):(P[E]=ds(M),P[E].c(),P[E].m(_,null))}for(;E<P.length;E+=1)P[E].d(1);P.length=O.length}I&2&&Z!==(Z=hs(e[19].createdAt)+"")&&de(G,Z)},d(S){S&&u(t),F&&F.d(),z&&z.d(),at(P,S)}}}function tl(n){let e,t,s,r,o="Channel Management",i,c,f,_,m,k,h,d,b,w,D=n[0]&&as(n);function C(q,y){return q[2]&&q[1].length===0?el:q[1].length===0?$n:Xn}let j=C(n),B=j(n);return{c(){e=g("div"),t=g("div"),s=g("div"),r=g("h2"),r.textContent=o,i=R(),c=g("button"),f=Ce("svg"),_=Ce("path"),m=Q(`
        Create Channel`),k=R(),D&&D.c(),h=R(),d=g("div"),B.c(),this.h()},l(q){e=p(q,"DIV",{class:!0});var y=v(e);t=p(y,"DIV",{class:!0});var A=v(t);s=p(A,"DIV",{class:!0});var L=v(s);r=p(L,"H2",{class:!0,"data-svelte-h":!0}),ne(r)!=="svelte-xef5nc"&&(r.textContent=o),i=N(L),c=p(L,"BUTTON",{class:!0});var x=v(c);f=Ee(x,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var K=v(f);_=Ee(K,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(_).forEach(u),K.forEach(u),m=W(x,`
        Create Channel`),x.forEach(u),L.forEach(u),k=N(A),D&&D.l(A),h=N(A),d=p(A,"DIV",{class:!0});var Z=v(d);B.l(Z),Z.forEach(u),A.forEach(u),y.forEach(u),this.h()},h(){a(r,"class","card-title"),a(_,"stroke-linecap","round"),a(_,"stroke-linejoin","round"),a(_,"stroke-width","2"),a(_,"d","M12 4v16m8-8H4"),a(f,"xmlns","http://www.w3.org/2000/svg"),a(f,"class","h-5 w-5"),a(f,"fill","none"),a(f,"viewBox","0 0 24 24"),a(f,"stroke","currentColor"),a(c,"class","btn btn-primary gap-2"),c.disabled=n[2],a(s,"class","flex items-center justify-between"),a(d,"class","mt-4"),a(t,"class","card-body"),a(e,"class","card bg-base-200 mb-6")},m(q,y){$(q,e,y),l(e,t),l(t,s),l(s,r),l(s,i),l(s,c),l(c,f),l(f,_),l(c,m),l(t,k),D&&D.m(t,null),l(t,h),l(t,d),B.m(d,null),b||(w=ue(c,"click",n[10]),b=!0)},p(q,[y]){y&4&&(c.disabled=q[2]),q[0]?D?D.p(q,y):(D=as(q),D.c(),D.m(t,h)):D&&(D.d(1),D=null),j===(j=C(q))&&B?B.p(q,y):(B.d(1),B=j(q),B&&(B.c(),B.m(d,null)))},i:he,o:he,d(q){q&&u(e),D&&D.d(),B.d(),b=!1,w()}}}function hs(n){return new Date(n*1e3).toLocaleDateString()}function ps(n){return{public:"badge-success",cohort:"badge-warning",private:"badge-error"}[n]||"badge-ghost"}function sl(n,e,t){let{channels:s}=e,{isLoading:r}=e,{showCreateForm:o=!1}=e,i="",c="",f="public",_="",m=!1,k="Nostr-BBS-guests";const h=_t();function d(){const A=_.split(",").map(L=>L.trim()).filter(Boolean);h("create",{name:i.trim(),description:c.trim()||void 0,visibility:f,cohorts:A,encrypted:m,section:k}),t(3,i=""),t(4,c=""),t(5,f="public"),t(6,_=""),t(7,m=!1),t(8,k="Nostr-BBS-guests"),t(0,o=!1)}const b=()=>t(0,o=!o);function w(){i=this.value,t(3,i)}function D(){c=this.value,t(4,c)}function C(){k=yt(this),t(8,k)}function j(){f=yt(this),t(5,f)}function B(){_=this.value,t(6,_)}function q(){m=this.checked,t(7,m)}const y=()=>t(0,o=!1);return n.$$set=A=>{"channels"in A&&t(1,s=A.channels),"isLoading"in A&&t(2,r=A.isLoading),"showCreateForm"in A&&t(0,o=A.showCreateForm)},[o,s,r,i,c,f,_,m,k,d,b,w,D,C,j,B,q,y]}class nl extends et{constructor(e){super(),tt(this,e,sl,tl,Xe,{channels:1,isLoading:2,showCreateForm:0})}}function gs(n,e,t){const s=n.slice();return s[6]=e[t],s}function _s(n){let e,t=n[0].length+"",s;return{c(){e=g("span"),s=Q(t),this.h()},l(r){e=p(r,"SPAN",{class:!0});var o=v(e);s=W(o,t),o.forEach(u),this.h()},h(){a(e,"class","badge badge-error")},m(r,o){$(r,e,o),l(e,s)},p(r,o){o&1&&t!==(t=r[0].length+"")&&de(s,t)},d(r){r&&u(e)}}}function ll(n){let e,t,s,r='<tr><th>User</th> <th>Message</th> <th>Requested</th> <th class="text-right">Actions</th></tr>',o,i,c=[],f=new Map,_,m=Ie(n[0]);const k=h=>h[6].id;for(let h=0;h<m.length;h+=1){let d=gs(n,m,h),b=k(d);f.set(b,c[h]=vs(b,d))}return{c(){e=g("div"),t=g("table"),s=g("thead"),s.innerHTML=r,o=R(),i=g("tbody");for(let h=0;h<c.length;h+=1)c[h].c();this.h()},l(h){e=p(h,"DIV",{class:!0});var d=v(e);t=p(d,"TABLE",{class:!0});var b=v(t);s=p(b,"THEAD",{"data-svelte-h":!0}),ne(s)!=="svelte-ud2ebl"&&(s.innerHTML=r),o=N(b),i=p(b,"TBODY",{});var w=v(i);for(let D=0;D<c.length;D+=1)c[D].l(w);w.forEach(u),b.forEach(u),d.forEach(u),this.h()},h(){a(t,"class","table table-zebra"),a(e,"class","overflow-x-auto mt-4")},m(h,d){$(h,e,d),l(e,t),l(t,s),l(t,o),l(t,i);for(let b=0;b<c.length;b+=1)c[b]&&c[b].m(i,null);_=!0},p(h,d){d&7&&(m=Ie(h[0]),ft(),c=vt(c,d,k,1,h,m,f,i,Ut,vs,null,gs),ht())},i(h){if(!_){for(let d=0;d<m.length;d+=1)Be(c[d]);_=!0}},o(h){for(let d=0;d<c.length;d+=1)qe(c[d]);_=!1},d(h){h&&u(e);for(let d=0;d<c.length;d+=1)c[d].d()}}}function rl(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-2 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path></svg> <p>No pending user registrations</p> <p class="text-sm mt-1">New users signing up will appear here for approval</p>';return{c(){e=g("div"),e.innerHTML=t,this.h()},l(s){e=p(s,"DIV",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-11xswww"&&(e.innerHTML=t),this.h()},h(){a(e,"class","text-center py-8 text-base-content/50")},m(s,r){$(s,e,r)},p:he,i:he,o:he,d(s){s&&u(e)}}}function al(n){let e,t='<span class="loading loading-spinner loading-lg"></span> <p class="mt-2 text-base-content/70">Loading user registrations...</p>';return{c(){e=g("div"),e.innerHTML=t,this.h()},l(s){e=p(s,"DIV",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-1qyhxzs"&&(e.innerHTML=t),this.h()},h(){a(e,"class","text-center py-8")},m(s,r){$(s,e,r)},p:he,i:he,o:he,d(s){s&&u(e)}}}function ol(n){let e,t="No message";return{c(){e=g("span"),e.textContent=t,this.h()},l(s){e=p(s,"SPAN",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-tay6cd"&&(e.textContent=t),this.h()},h(){a(e,"class","text-xs text-base-content/50")},m(s,r){$(s,e,r)},p:he,d(s){s&&u(e)}}}function il(n){let e,t=n[6].message+"",s;return{c(){e=g("span"),s=Q(t),this.h()},l(r){e=p(r,"SPAN",{class:!0});var o=v(e);s=W(o,t),o.forEach(u),this.h()},h(){a(e,"class","text-sm text-base-content/70 line-clamp-2")},m(r,o){$(r,e,o),l(e,s)},p(r,o){o&1&&t!==(t=r[6].message+"")&&de(s,t)},d(r){r&&u(e)}}}function vs(n,e){let t,s,r,o,i,c,f,_,m=ms(e[6].createdAt)+"",k,h,d,b,w,D,C,j,B,q,y,A,L;r=new Bt({props:{pubkey:e[6].pubkey,showAvatar:!0,showName:!0,showFullName:!0,avatarSize:"sm",clickable:!1}});function x(F,z){return F[6].message?il:ol}let K=x(e),Z=K(e);function G(){return e[4](e[6])}function te(){return e[5](e[6])}return{key:n,first:null,c(){t=g("tr"),s=g("td"),Ge(r.$$.fragment),o=R(),i=g("td"),Z.c(),c=R(),f=g("td"),_=g("span"),k=Q(m),h=R(),d=g("td"),b=g("div"),w=g("button"),D=Q("Approve"),C=R(),j=g("button"),B=Q("Reject"),q=R(),this.h()},l(F){t=p(F,"TR",{});var z=v(t);s=p(z,"TD",{});var O=v(s);Ze(r.$$.fragment,O),O.forEach(u),o=N(z),i=p(z,"TD",{});var P=v(i);Z.l(P),P.forEach(u),c=N(z),f=p(z,"TD",{});var S=v(f);_=p(S,"SPAN",{class:!0});var I=v(_);k=W(I,m),I.forEach(u),S.forEach(u),h=N(z),d=p(z,"TD",{});var E=v(d);b=p(E,"DIV",{class:!0});var M=v(b);w=p(M,"BUTTON",{class:!0});var U=v(w);D=W(U,"Approve"),U.forEach(u),C=N(M),j=p(M,"BUTTON",{class:!0});var V=v(j);B=W(V,"Reject"),V.forEach(u),M.forEach(u),E.forEach(u),q=N(z),z.forEach(u),this.h()},h(){a(_,"class","text-sm"),a(w,"class","btn btn-success btn-sm"),w.disabled=e[1],a(j,"class","btn btn-error btn-sm btn-outline"),j.disabled=e[1],a(b,"class","flex justify-end gap-2"),this.first=t},m(F,z){$(F,t,z),l(t,s),xe(r,s,null),l(t,o),l(t,i),Z.m(i,null),l(t,c),l(t,f),l(f,_),l(_,k),l(t,h),l(t,d),l(d,b),l(b,w),l(w,D),l(b,C),l(b,j),l(j,B),l(t,q),y=!0,A||(L=[ue(w,"click",G),ue(j,"click",te)],A=!0)},p(F,z){e=F;const O={};z&1&&(O.pubkey=e[6].pubkey),r.$set(O),K===(K=x(e))&&Z?Z.p(e,z):(Z.d(1),Z=K(e),Z&&(Z.c(),Z.m(i,null))),(!y||z&1)&&m!==(m=ms(e[6].createdAt)+"")&&de(k,m),(!y||z&2)&&(w.disabled=e[1]),(!y||z&2)&&(j.disabled=e[1])},i(F){y||(Be(r.$$.fragment,F),y=!0)},o(F){qe(r.$$.fragment,F),y=!1},d(F){F&&u(t),Je(r),Z.d(),A=!1,$e(L)}}}function cl(n){let e,t,s,r,o,i,c,f,_,m,k,h,d,b,w,D,C=n[0].length>0&&_s(n);const j=[al,rl,ll],B=[];function q(y,A){return y[1]&&y[0].length===0?0:y[0].length===0?1:2}return h=q(n),d=B[h]=j[h](n),{c(){e=g("div"),t=g("div"),s=g("div"),r=g("h2"),o=Q(`Pending User Registrations
        `),C&&C.c(),i=R(),c=g("button"),f=Ce("svg"),_=Ce("path"),m=Q(`
        Refresh`),k=R(),d.c(),this.h()},l(y){e=p(y,"DIV",{class:!0});var A=v(e);t=p(A,"DIV",{class:!0});var L=v(t);s=p(L,"DIV",{class:!0});var x=v(s);r=p(x,"H2",{class:!0});var K=v(r);o=W(K,`Pending User Registrations
        `),C&&C.l(K),K.forEach(u),i=N(x),c=p(x,"BUTTON",{class:!0});var Z=v(c);f=Ee(Z,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var G=v(f);_=Ee(G,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(_).forEach(u),G.forEach(u),m=W(Z,`
        Refresh`),Z.forEach(u),x.forEach(u),k=N(L),d.l(L),L.forEach(u),A.forEach(u),this.h()},h(){a(r,"class","card-title"),a(_,"stroke-linecap","round"),a(_,"stroke-linejoin","round"),a(_,"stroke-width","2"),a(_,"d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"),a(f,"xmlns","http://www.w3.org/2000/svg"),a(f,"class","h-4 w-4"),a(f,"fill","none"),a(f,"viewBox","0 0 24 24"),a(f,"stroke","currentColor"),a(c,"class","btn btn-ghost btn-sm"),c.disabled=n[1],a(s,"class","flex items-center justify-between"),a(t,"class","card-body"),a(e,"class","card bg-base-200 mb-6")},m(y,A){$(y,e,A),l(e,t),l(t,s),l(s,r),l(r,o),C&&C.m(r,null),l(s,i),l(s,c),l(c,f),l(f,_),l(c,m),l(t,k),B[h].m(t,null),b=!0,w||(D=ue(c,"click",n[3]),w=!0)},p(y,[A]){y[0].length>0?C?C.p(y,A):(C=_s(y),C.c(),C.m(r,null)):C&&(C.d(1),C=null),(!b||A&2)&&(c.disabled=y[1]);let L=h;h=q(y),h===L?B[h].p(y,A):(ft(),qe(B[L],1,1,()=>{B[L]=null}),ht(),d=B[h],d?d.p(y,A):(d=B[h]=j[h](y),d.c()),Be(d,1),d.m(t,null))},i(y){b||(Be(d),b=!0)},o(y){qe(d),b=!1},d(y){y&&u(e),C&&C.d(),B[h].d(),w=!1,D()}}}function ms(n){const t=Date.now()-n,s=Math.floor(t/1e3),r=Math.floor(s/60),o=Math.floor(r/60),i=Math.floor(o/24);return i>0?`${i}d ago`:o>0?`${o}h ago`:r>0?`${r}m ago`:"just now"}function ul(n,e,t){let{pendingUserRegistrations:s}=e,{isLoading:r}=e;const o=_t(),i=()=>o("refresh"),c=_=>o("approve",_),f=_=>o("reject",_);return n.$$set=_=>{"pendingUserRegistrations"in _&&t(0,s=_.pendingUserRegistrations),"isLoading"in _&&t(1,r=_.isLoading)},[s,r,o,i,c,f]}class dl extends et{constructor(e){super(),tt(this,e,ul,cl,Xe,{pendingUserRegistrations:0,isLoading:1})}}function bs(n,e,t){const s=n.slice();s[49]=e[t];const r=s[12].includes(s[49].id);return s[50]=r,s}function ks(n,e,t){const s=n.slice();s[53]=e[t];const r=s[20](s[53]);s[54]=r;const o=s[14].has(s[53].pubkey);s[55]=o;const i=s[2].has(s[53].pubkey);return s[56]=i,s}function ws(n,e,t){const s=n.slice();s[49]=e[t];const r=vl(s[53],s[49].id);return s[56]=r,s}function ys(n,e,t){const s=n.slice();return s[61]=e[t],s}function Es(n,e,t){const s=n.slice();return s[49]=e[t],s}function Cs(n,e,t){const s=n.slice();return s[49]=e[t],s}function Ts(n){let e,t,s,r,o,i,c,f,_="Dismiss",m,k;return{c(){e=g("div"),t=Ce("svg"),s=Ce("path"),r=R(),o=g("span"),i=Q(n[8]),c=R(),f=g("button"),f.textContent=_,this.h()},l(h){e=p(h,"DIV",{class:!0});var d=v(e);t=Ee(d,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var b=v(t);s=Ee(b,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(s).forEach(u),b.forEach(u),r=N(d),o=p(d,"SPAN",{});var w=v(o);i=W(w,n[8]),w.forEach(u),c=N(d),f=p(d,"BUTTON",{class:!0,"data-svelte-h":!0}),ne(f)!=="svelte-1oc0rew"&&(f.textContent=_),d.forEach(u),this.h()},h(){a(s,"stroke-linecap","round"),a(s,"stroke-linejoin","round"),a(s,"stroke-width","2"),a(s,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),a(t,"xmlns","http://www.w3.org/2000/svg"),a(t,"class","stroke-current shrink-0 h-6 w-6"),a(t,"fill","none"),a(t,"viewBox","0 0 24 24"),a(f,"class","btn btn-ghost btn-sm"),a(e,"class","alert alert-error mb-4")},m(h,d){$(h,e,d),l(e,t),l(t,s),l(e,r),l(e,o),l(o,i),l(e,c),l(e,f),m||(k=ue(f,"click",n[32]),m=!0)},p(h,d){d[0]&256&&de(i,h[8])},d(h){h&&u(e),m=!1,k()}}}function As(n){let e,t,s,r,o,i;return{c(){e=g("div"),t=Ce("svg"),s=Ce("path"),r=R(),o=g("span"),i=Q(n[9]),this.h()},l(c){e=p(c,"DIV",{class:!0});var f=v(e);t=Ee(f,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var _=v(t);s=Ee(_,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(s).forEach(u),_.forEach(u),r=N(f),o=p(f,"SPAN",{});var m=v(o);i=W(m,n[9]),m.forEach(u),f.forEach(u),this.h()},h(){a(s,"stroke-linecap","round"),a(s,"stroke-linejoin","round"),a(s,"stroke-width","2"),a(s,"d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"),a(t,"xmlns","http://www.w3.org/2000/svg"),a(t,"class","stroke-current shrink-0 h-6 w-6"),a(t,"fill","none"),a(t,"viewBox","0 0 24 24"),a(e,"class","alert alert-success mb-4")},m(c,f){$(c,e,f),l(e,t),l(t,s),l(e,r),l(e,o),l(o,i)},p(c,f){f[0]&512&&de(i,c[9])},d(c){c&&u(e)}}}function Ms(n){let e,t=n[49].label+"",s;return{c(){e=g("option"),s=Q(t),this.h()},l(r){e=p(r,"OPTION",{});var o=v(e);s=W(o,t),o.forEach(u),this.h()},h(){e.__value=n[49].id,je(e,e.__value)},m(r,o){$(r,e,o),l(e,s)},p:he,d(r){r&&u(e)}}}function Ds(n){let e,t,s=n[2].size+"",r,o,i=n[2].size!==1?"s":"",c,f,_,m,k,h,d,b,w,D,C,j,B,q,y,A,L,x,K,Z="Clear selection",G,te,F,z=Ie(n[18]),O=[];for(let S=0;S<z.length;S+=1)O[S]=Ss(Es(n,z,S));let P=n[10]&&Is();return{c(){e=g("div"),t=g("span"),r=Q(s),o=Q(" user"),c=Q(i),f=Q(" selected"),_=R(),m=g("div"),k=R(),h=g("button"),d=Ce("svg"),b=Ce("path"),w=Q(`
          Assign Zones`),D=R(),C=g("div"),j=g("button"),B=Ce("svg"),q=Ce("path"),y=Q(`
            Remove Zone`),A=R(),L=g("ul");for(let S=0;S<O.length;S+=1)O[S].c();x=R(),K=g("button"),K.textContent=Z,G=R(),P&&P.c(),this.h()},l(S){e=p(S,"DIV",{class:!0});var I=v(e);t=p(I,"SPAN",{class:!0});var E=v(t);r=W(E,s),o=W(E," user"),c=W(E,i),f=W(E," selected"),E.forEach(u),_=N(I),m=p(I,"DIV",{class:!0}),v(m).forEach(u),k=N(I),h=p(I,"BUTTON",{class:!0});var M=v(h);d=Ee(M,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var U=v(d);b=Ee(U,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(b).forEach(u),U.forEach(u),w=W(M,`
          Assign Zones`),M.forEach(u),D=N(I),C=p(I,"DIV",{class:!0});var V=v(C);j=p(V,"BUTTON",{tabindex:!0,class:!0});var ie=v(j);B=Ee(ie,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var re=v(B);q=Ee(re,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(q).forEach(u),re.forEach(u),y=W(ie,`
            Remove Zone`),ie.forEach(u),A=N(V),L=p(V,"UL",{tabindex:!0,class:!0});var J=v(L);for(let ae=0;ae<O.length;ae+=1)O[ae].l(J);J.forEach(u),V.forEach(u),x=N(I),K=p(I,"BUTTON",{class:!0,"data-svelte-h":!0}),ne(K)!=="svelte-h4yim2"&&(K.textContent=Z),G=N(I),P&&P.l(I),I.forEach(u),this.h()},h(){a(t,"class","font-medium text-sm"),a(m,"class","divider divider-horizontal mx-1"),a(b,"stroke-linecap","round"),a(b,"stroke-linejoin","round"),a(b,"stroke-width","2"),a(b,"d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"),a(d,"xmlns","http://www.w3.org/2000/svg"),a(d,"class","h-4 w-4"),a(d,"fill","none"),a(d,"viewBox","0 0 24 24"),a(d,"stroke","currentColor"),a(h,"class","btn btn-sm btn-primary"),h.disabled=n[10],a(q,"stroke-linecap","round"),a(q,"stroke-linejoin","round"),a(q,"stroke-width","2"),a(q,"d","M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"),a(B,"xmlns","http://www.w3.org/2000/svg"),a(B,"class","h-4 w-4"),a(B,"fill","none"),a(B,"viewBox","0 0 24 24"),a(B,"stroke","currentColor"),a(j,"tabindex","0"),a(j,"class","btn btn-sm btn-outline btn-error"),j.disabled=n[10],a(L,"tabindex","0"),a(L,"class","dropdown-content z-10 menu p-2 shadow bg-base-100 rounded-box w-52"),a(C,"class","dropdown dropdown-bottom"),a(K,"class","btn btn-sm btn-ghost"),a(e,"class","flex flex-wrap items-center gap-2 p-3 bg-primary/10 rounded-lg mb-4 border border-primary/30")},m(S,I){$(S,e,I),l(e,t),l(t,r),l(t,o),l(t,c),l(t,f),l(e,_),l(e,m),l(e,k),l(e,h),l(h,d),l(d,b),l(h,w),l(e,D),l(e,C),l(C,j),l(j,B),l(B,q),l(j,y),l(C,A),l(C,L);for(let E=0;E<O.length;E+=1)O[E]&&O[E].m(L,null);l(e,x),l(e,K),l(e,G),P&&P.m(e,null),te||(F=[ue(h,"click",n[28]),ue(K,"click",n[27])],te=!0)},p(S,I){if(I[0]&4&&s!==(s=S[2].size+"")&&de(r,s),I[0]&4&&i!==(i=S[2].size!==1?"s":"")&&de(c,i),I[0]&1024&&(h.disabled=S[10]),I[0]&1024&&(j.disabled=S[10]),I[0]&262144|I[1]&1){z=Ie(S[18]);let E;for(E=0;E<z.length;E+=1){const M=Es(S,z,E);O[E]?O[E].p(M,I):(O[E]=Ss(M),O[E].c(),O[E].m(L,null))}for(;E<O.length;E+=1)O[E].d(1);O.length=z.length}S[10]?P||(P=Is(),P.c(),P.m(e,null)):P&&(P.d(1),P=null)},d(S){S&&u(e),at(O,S),P&&P.d(),te=!1,$e(F)}}}function Ss(n){let e,t,s,r,o=n[49].label+"",i,c,f,_;function m(){return n[35](n[49])}return{c(){e=g("li"),t=g("button"),s=g("span"),r=R(),i=Q(o),c=R(),this.h()},l(k){e=p(k,"LI",{});var h=v(e);t=p(h,"BUTTON",{class:!0});var d=v(t);s=p(d,"SPAN",{class:!0,style:!0}),v(s).forEach(u),r=N(d),i=W(d,o),d.forEach(u),c=N(h),h.forEach(u),this.h()},h(){a(s,"class","w-3 h-3 rounded-full"),$s(s,"background-color",n[49].color),a(t,"class","text-sm")},m(k,h){$(k,e,h),l(e,t),l(t,s),l(t,r),l(t,i),l(e,c),f||(_=ue(t,"click",m),f=!0)},p(k,h){n=k},d(k){k&&u(e),f=!1,_()}}}function Is(n){let e;return{c(){e=g("span"),this.h()},l(t){e=p(t,"SPAN",{class:!0}),v(e).forEach(u),this.h()},h(){a(e,"class","loading loading-spinner loading-sm ml-2")},m(t,s){$(t,e,s)},d(t){t&&u(e)}}}function fl(n){let e=[],t=new Map,s,r=Ie(n[6]);const o=i=>i[53].pubkey;for(let i=0;i<r.length;i+=1){let c=ks(n,r,i),f=o(c);t.set(f,e[i]=qs(f,c))}return{c(){for(let i=0;i<e.length;i+=1)e[i].c();s=Et()},l(i){for(let c=0;c<e.length;c+=1)e[c].l(i);s=Et()},m(i,c){for(let f=0;f<e.length;f+=1)e[f]&&e[f].m(i,c);$(i,s,c)},p(i,c){c[0]&70533188&&(r=Ie(i[6]),e=vt(e,c,o,1,i,r,t,s.parentNode,en,qs,s,ks))},d(i){i&&u(s);for(let c=0;c<e.length;c+=1)e[c].d(i)}}}function hl(n){let e,t='<td colspan="4" class="text-center py-8 text-base-content/50">No users found</td>';return{c(){e=g("tr"),e.innerHTML=t},l(s){e=p(s,"TR",{"data-svelte-h":!0}),ne(e)!=="svelte-r1ejgo"&&(e.innerHTML=t)},m(s,r){$(s,e,r)},p:he,d(s){s&&u(e)}}}function pl(n){let e,t='<td colspan="4" class="text-center py-8"><span class="loading loading-spinner loading-md"></span></td>';return{c(){e=g("tr"),e.innerHTML=t},l(s){e=p(s,"TR",{"data-svelte-h":!0}),ne(e)!=="svelte-jceq40"&&(e.innerHTML=t)},m(s,r){$(s,e,r)},p:he,d(s){s&&u(e)}}}function Ns(n){let e,t=Ie(n[53].cohorts.filter(n[37])),s=[];for(let r=0;r<t.length;r+=1)s[r]=Rs(ys(n,t,r));return{c(){e=g("div");for(let r=0;r<s.length;r+=1)s[r].c();this.h()},l(r){e=p(r,"DIV",{class:!0});var o=v(e);for(let i=0;i<s.length;i+=1)s[i].l(o);o.forEach(u),this.h()},h(){a(e,"class","flex flex-wrap gap-1 mt-1")},m(r,o){$(r,e,o);for(let i=0;i<s.length;i+=1)s[i]&&s[i].m(e,null)},p(r,o){if(o[0]&262208){t=Ie(r[53].cohorts.filter(r[37]));let i;for(i=0;i<t.length;i+=1){const c=ys(r,t,i);s[i]?s[i].p(c,o):(s[i]=Rs(c),s[i].c(),s[i].m(e,null))}for(;i<s.length;i+=1)s[i].d(1);s.length=t.length}},d(r){r&&u(e),at(s,r)}}}function Rs(n){let e,t=n[61]+"",s;return{c(){e=g("span"),s=Q(t),this.h()},l(r){e=p(r,"SPAN",{class:!0});var o=v(e);s=W(o,t),o.forEach(u),this.h()},h(){a(e,"class","badge badge-xs badge-ghost")},m(r,o){$(r,e,o),l(e,s)},p(r,o){o[0]&64&&t!==(t=r[61]+"")&&de(s,t)},d(r){r&&u(e)}}}function Ps(n){let e,t,s,r,o,i,c=n[49].label+"",f,_,m,k,h;function d(...b){return n[38](n[53],n[49],...b)}return{c(){e=g("label"),t=g("input"),o=R(),i=g("span"),f=Q(c),this.h()},l(b){e=p(b,"LABEL",{class:!0,style:!0});var w=v(e);t=p(w,"INPUT",{type:!0,class:!0,style:!0}),o=N(w),i=p(w,"SPAN",{class:!0,style:!0});var D=v(i);f=W(D,c),D.forEach(u),w.forEach(u),this.h()},h(){a(t,"type","checkbox"),a(t,"class","checkbox checkbox-sm"),a(t,"style",`--chkbg: ${n[49].color}; --bc: ${n[49].color};`),t.checked=s=n[56],t.disabled=r=n[55],a(i,"class","text-xs font-medium"),a(i,"style",_=n[56]?`color: ${n[49].color};`:""),a(e,"class","flex items-center gap-1 cursor-pointer px-2 py-1 rounded-lg border-2 transition-all"),a(e,"style",m=n[56]?`border-color: ${n[49].color}; background-color: ${n[49].color}20;`:""),lt(e,"border-transparent",!n[56]),lt(e,"bg-base-100",!n[56]),lt(e,"opacity-70",!n[56])},m(b,w){$(b,e,w),l(e,t),l(e,o),l(e,i),l(i,f),k||(h=ue(t,"change",d),k=!0)},p(b,w){n=b,w[0]&64&&s!==(s=n[56])&&(t.checked=s),w[0]&16448&&r!==(r=n[55])&&(t.disabled=r),w[0]&64&&_!==(_=n[56]?`color: ${n[49].color};`:"")&&a(i,"style",_),w[0]&64&&m!==(m=n[56]?`border-color: ${n[49].color}; background-color: ${n[49].color}20;`:"")&&a(e,"style",m),w[0]&262208&&lt(e,"border-transparent",!n[56]),w[0]&262208&&lt(e,"bg-base-100",!n[56]),w[0]&262208&&lt(e,"opacity-70",!n[56])},d(b){b&&u(e),k=!1,h()}}}function Ls(n){let e;return{c(){e=g("span"),this.h()},l(t){e=p(t,"SPAN",{class:!0}),v(e).forEach(u),this.h()},h(){a(e,"class","loading loading-spinner loading-xs")},m(t,s){$(t,e,s)},d(t){t&&u(e)}}}function Vs(n){let e,t="No zones assigned";return{c(){e=g("div"),e.textContent=t,this.h()},l(s){e=p(s,"DIV",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-hmjmvm"&&(e.textContent=t),this.h()},h(){a(e,"class","text-xs text-warning text-center mt-1")},m(s,r){$(s,e,r)},d(s){s&&u(e)}}}function qs(n,e){let t,s,r,o,i,c,f,_,m=(e[53].displayName||"Anonymous")+"",k,h,d,b=Vt(e[53].pubkey)+"",w,D,C,j,B=Hs(e[53].addedAt)+"",q,y,A,L,x,K,Z,G,te,F;function z(){return e[36](e[53])}let O=e[53].cohorts.length>0&&Ns(e),P=Ie(e[18]),S=[];for(let M=0;M<P.length;M+=1)S[M]=Ps(ws(e,P,M));let I=e[55]&&Ls(),E=e[54].length===0&&Vs();return{key:n,first:null,c(){t=g("tr"),s=g("td"),r=g("input"),i=R(),c=g("td"),f=g("div"),_=g("span"),k=Q(m),h=R(),d=g("span"),w=Q(b),D=R(),O&&O.c(),C=R(),j=g("td"),q=Q(B),y=R(),A=g("td"),L=g("div");for(let M=0;M<S.length;M+=1)S[M].c();x=R(),I&&I.c(),K=R(),E&&E.c(),Z=R(),this.h()},l(M){t=p(M,"TR",{class:!0});var U=v(t);s=p(U,"TD",{});var V=v(s);r=p(V,"INPUT",{type:!0,class:!0}),V.forEach(u),i=N(U),c=p(U,"TD",{});var ie=v(c);f=p(ie,"DIV",{class:!0});var re=v(f);_=p(re,"SPAN",{class:!0});var J=v(_);k=W(J,m),J.forEach(u),h=N(re),d=p(re,"SPAN",{class:!0});var ae=v(d);w=W(ae,b),ae.forEach(u),D=N(re),O&&O.l(re),re.forEach(u),ie.forEach(u),C=N(U),j=p(U,"TD",{class:!0});var T=v(j);q=W(T,B),T.forEach(u),y=N(U),A=p(U,"TD",{});var H=v(A);L=p(H,"DIV",{class:!0});var ee=v(L);for(let X=0;X<S.length;X+=1)S[X].l(ee);x=N(ee),I&&I.l(ee),ee.forEach(u),K=N(H),E&&E.l(H),H.forEach(u),Z=N(U),U.forEach(u),this.h()},h(){a(r,"type","checkbox"),a(r,"class","checkbox checkbox-sm"),r.checked=o=e[56],a(_,"class","font-medium"),a(d,"class","text-xs text-base-content/50 font-mono"),a(f,"class","flex flex-col"),a(j,"class","text-sm text-base-content/70"),a(L,"class","flex flex-wrap justify-center gap-2"),a(t,"class",G=(e[55]?"opacity-50":"")+" "+(e[56]?"bg-primary bg-opacity-5":"")),this.first=t},m(M,U){$(M,t,U),l(t,s),l(s,r),l(t,i),l(t,c),l(c,f),l(f,_),l(_,k),l(f,h),l(f,d),l(d,w),l(f,D),O&&O.m(f,null),l(t,C),l(t,j),l(j,q),l(t,y),l(t,A),l(A,L);for(let V=0;V<S.length;V+=1)S[V]&&S[V].m(L,null);l(L,x),I&&I.m(L,null),l(A,K),E&&E.m(A,null),l(t,Z),te||(F=ue(r,"change",z),te=!0)},p(M,U){if(e=M,U[0]&68&&o!==(o=e[56])&&(r.checked=o),U[0]&64&&m!==(m=(e[53].displayName||"Anonymous")+"")&&de(k,m),U[0]&64&&b!==(b=Vt(e[53].pubkey)+"")&&de(w,b),e[53].cohorts.length>0?O?O.p(e,U):(O=Ns(e),O.c(),O.m(f,null)):O&&(O.d(1),O=null),U[0]&64&&B!==(B=Hs(e[53].addedAt)+"")&&de(q,B),U[0]&2375744){P=Ie(e[18]);let V;for(V=0;V<P.length;V+=1){const ie=ws(e,P,V);S[V]?S[V].p(ie,U):(S[V]=Ps(ie),S[V].c(),S[V].m(L,x))}for(;V<S.length;V+=1)S[V].d(1);S.length=P.length}e[55]?I||(I=Ls(),I.c(),I.m(L,null)):I&&(I.d(1),I=null),e[54].length===0?E||(E=Vs(),E.c(),E.m(A,null)):E&&(E.d(1),E=null),U[0]&16452&&G!==(G=(e[55]?"opacity-50":"")+" "+(e[56]?"bg-primary bg-opacity-5":""))&&a(t,"class",G)},d(M){M&&u(t),O&&O.d(),at(S,M),I&&I.d(),E&&E.d(),te=!1,F()}}}function Bs(n){let e,t,s,r,o,i,c,f,_,m,k,h,d,b,w,D,C,j,B,q,y,A,L,x,K,Z,G,te;return{c(){e=g("div"),t=g("button"),s=Ce("svg"),r=Ce("path"),i=R(),c=g("button"),f=Ce("svg"),_=Ce("path"),k=R(),h=g("span"),d=Q("Page "),b=Q(n[3]),w=Q(" of "),D=Q(n[16]),C=R(),j=g("button"),B=Ce("svg"),q=Ce("path"),A=R(),L=g("button"),x=Ce("svg"),K=Ce("path"),this.h()},l(F){e=p(F,"DIV",{class:!0});var z=v(e);t=p(z,"BUTTON",{class:!0});var O=v(t);s=Ee(O,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var P=v(s);r=Ee(P,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(r).forEach(u),P.forEach(u),O.forEach(u),i=N(z),c=p(z,"BUTTON",{class:!0});var S=v(c);f=Ee(S,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var I=v(f);_=Ee(I,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(_).forEach(u),I.forEach(u),S.forEach(u),k=N(z),h=p(z,"SPAN",{class:!0});var E=v(h);d=W(E,"Page "),b=W(E,n[3]),w=W(E," of "),D=W(E,n[16]),E.forEach(u),C=N(z),j=p(z,"BUTTON",{class:!0});var M=v(j);B=Ee(M,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var U=v(B);q=Ee(U,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(q).forEach(u),U.forEach(u),M.forEach(u),A=N(z),L=p(z,"BUTTON",{class:!0});var V=v(L);x=Ee(V,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var ie=v(x);K=Ee(ie,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(K).forEach(u),ie.forEach(u),V.forEach(u),z.forEach(u),this.h()},h(){a(r,"stroke-linecap","round"),a(r,"stroke-linejoin","round"),a(r,"stroke-width","2"),a(r,"d","M11 19l-7-7 7-7m8 14l-7-7 7-7"),a(s,"xmlns","http://www.w3.org/2000/svg"),a(s,"class","h-4 w-4"),a(s,"fill","none"),a(s,"viewBox","0 0 24 24"),a(s,"stroke","currentColor"),a(t,"class","btn btn-sm btn-ghost"),t.disabled=o=n[3]===1||n[7],a(_,"stroke-linecap","round"),a(_,"stroke-linejoin","round"),a(_,"stroke-width","2"),a(_,"d","M15 19l-7-7 7-7"),a(f,"xmlns","http://www.w3.org/2000/svg"),a(f,"class","h-4 w-4"),a(f,"fill","none"),a(f,"viewBox","0 0 24 24"),a(f,"stroke","currentColor"),a(c,"class","btn btn-sm btn-ghost"),c.disabled=m=n[3]===1||n[7],a(h,"class","text-sm text-base-content/70"),a(q,"stroke-linecap","round"),a(q,"stroke-linejoin","round"),a(q,"stroke-width","2"),a(q,"d","M9 5l7 7-7 7"),a(B,"xmlns","http://www.w3.org/2000/svg"),a(B,"class","h-4 w-4"),a(B,"fill","none"),a(B,"viewBox","0 0 24 24"),a(B,"stroke","currentColor"),a(j,"class","btn btn-sm btn-ghost"),j.disabled=y=n[3]===n[16]||n[7],a(K,"stroke-linecap","round"),a(K,"stroke-linejoin","round"),a(K,"stroke-width","2"),a(K,"d","M13 5l7 7-7 7M5 5l7 7-7 7"),a(x,"xmlns","http://www.w3.org/2000/svg"),a(x,"class","h-4 w-4"),a(x,"fill","none"),a(x,"viewBox","0 0 24 24"),a(x,"stroke","currentColor"),a(L,"class","btn btn-sm btn-ghost"),L.disabled=Z=n[3]===n[16]||n[7],a(e,"class","flex justify-center items-center gap-2 mt-4")},m(F,z){$(F,e,z),l(e,t),l(t,s),l(s,r),l(e,i),l(e,c),l(c,f),l(f,_),l(e,k),l(e,h),l(h,d),l(h,b),l(h,w),l(h,D),l(e,C),l(e,j),l(j,B),l(B,q),l(e,A),l(e,L),l(L,x),l(x,K),G||(te=[ue(t,"click",n[39]),ue(c,"click",n[40]),ue(j,"click",n[41]),ue(L,"click",n[42])],G=!0)},p(F,z){z[0]&136&&o!==(o=F[3]===1||F[7])&&(t.disabled=o),z[0]&136&&m!==(m=F[3]===1||F[7])&&(c.disabled=m),z[0]&8&&de(b,F[3]),z[0]&65536&&de(D,F[16]),z[0]&65672&&y!==(y=F[3]===F[16]||F[7])&&(j.disabled=y),z[0]&65672&&Z!==(Z=F[3]===F[16]||F[7])&&(L.disabled=Z)},d(F){F&&u(e),G=!1,$e(te)}}}function Us(n){let e,t,s,r,o=n[2].size+"",i,c,f=n[2].size!==1?"s":"",_,m,k,h="Select zones to assign. This will add the selected zones while preserving any existing non-zone cohorts.",d,b,w,D,C,j,B,q,y,A=n[2].size+"",L,x,K=n[2].size!==1?"s":"",Z,G,te,F,z,O=Ie(n[18]),P=[];for(let I=0;I<O.length;I+=1)P[I]=js(bs(n,O,I));let S=n[10]&&Os();return{c(){e=g("div"),t=g("div"),s=g("h3"),r=Q("Assign Zones to "),i=Q(o),c=Q(" User"),_=Q(f),m=R(),k=g("p"),k.textContent=h,d=R(),b=g("div");for(let I=0;I<P.length;I+=1)P[I].c();w=R(),D=g("div"),C=g("button"),j=Q("Cancel"),B=R(),q=g("button"),S&&S.c(),y=Q(`
          Apply to `),L=Q(A),x=Q(" User"),Z=Q(K),G=R(),te=g("div"),this.h()},l(I){e=p(I,"DIV",{class:!0});var E=v(e);t=p(E,"DIV",{class:!0});var M=v(t);s=p(M,"H3",{class:!0});var U=v(s);r=W(U,"Assign Zones to "),i=W(U,o),c=W(U," User"),_=W(U,f),U.forEach(u),m=N(M),k=p(M,"P",{class:!0,"data-svelte-h":!0}),ne(k)!=="svelte-1tc2pn8"&&(k.textContent=h),d=N(M),b=p(M,"DIV",{class:!0});var V=v(b);for(let ae=0;ae<P.length;ae+=1)P[ae].l(V);V.forEach(u),w=N(M),D=p(M,"DIV",{class:!0});var ie=v(D);C=p(ie,"BUTTON",{class:!0});var re=v(C);j=W(re,"Cancel"),re.forEach(u),B=N(ie),q=p(ie,"BUTTON",{class:!0});var J=v(q);S&&S.l(J),y=W(J,`
          Apply to `),L=W(J,A),x=W(J," User"),Z=W(J,K),J.forEach(u),ie.forEach(u),M.forEach(u),G=N(E),te=p(E,"DIV",{class:!0,role:!0,tabindex:!0}),v(te).forEach(u),E.forEach(u),this.h()},h(){a(s,"class","font-bold text-lg mb-4"),a(k,"class","text-sm text-base-content/70 mb-4"),a(b,"class","space-y-3"),a(C,"class","btn btn-ghost"),C.disabled=n[10],a(q,"class","btn btn-primary"),q.disabled=n[10],a(D,"class","modal-action"),a(t,"class","modal-box"),a(te,"class","modal-backdrop"),a(te,"role","button"),a(te,"tabindex","0"),a(e,"class","modal modal-open")},m(I,E){$(I,e,E),l(e,t),l(t,s),l(s,r),l(s,i),l(s,c),l(s,_),l(t,m),l(t,k),l(t,d),l(t,b);for(let M=0;M<P.length;M+=1)P[M]&&P[M].m(b,null);l(t,w),l(t,D),l(D,C),l(C,j),l(D,B),l(D,q),S&&S.m(q,null),l(q,y),l(q,L),l(q,x),l(q,Z),l(e,G),l(e,te),F||(z=[ue(C,"click",n[29]),ue(q,"click",n[30]),ue(te,"click",n[29]),ue(te,"keydown",n[46])],F=!0)},p(I,E){if(E[0]&4&&o!==(o=I[2].size+"")&&de(i,o),E[0]&4&&f!==(f=I[2].size!==1?"s":"")&&de(_,f),E[0]&266240){O=Ie(I[18]);let M;for(M=0;M<O.length;M+=1){const U=bs(I,O,M);P[M]?P[M].p(U,E):(P[M]=js(U),P[M].c(),P[M].m(b,null))}for(;M<P.length;M+=1)P[M].d(1);P.length=O.length}E[0]&1024&&(C.disabled=I[10]),I[10]?S||(S=Os(),S.c(),S.m(q,y)):S&&(S.d(1),S=null),E[0]&4&&A!==(A=I[2].size+"")&&de(L,A),E[0]&4&&K!==(K=I[2].size!==1?"s":"")&&de(Z,K),E[0]&1024&&(q.disabled=I[10])},d(I){I&&u(e),at(P,I),S&&S.d(),F=!1,$e(z)}}}function js(n){let e,t,s,r,o,i,c,f=n[49].label+"",_,m,k,h,d;function b(...w){return n[45](n[49],...w)}return{c(){e=g("label"),t=g("input"),r=R(),o=g("span"),i=R(),c=g("span"),_=Q(f),m=R(),this.h()},l(w){e=p(w,"LABEL",{class:!0});var D=v(e);t=p(D,"INPUT",{type:!0,class:!0,style:!0}),r=N(D),o=p(D,"SPAN",{class:!0,style:!0}),v(o).forEach(u),i=N(D),c=p(D,"SPAN",{class:!0});var C=v(c);_=W(C,f),C.forEach(u),m=N(D),D.forEach(u),this.h()},h(){a(t,"type","checkbox"),a(t,"class","checkbox"),a(t,"style",`--chkbg: ${n[49].color}; --bc: ${n[49].color};`),t.checked=s=n[50],a(o,"class","w-4 h-4 rounded-full"),$s(o,"background-color",n[49].color),a(c,"class","font-medium"),a(e,"class",k="flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all hover:bg-base-200 "+(n[50]?"border-primary bg-primary bg-opacity-10":""))},m(w,D){$(w,e,D),l(e,t),l(e,r),l(e,o),l(e,i),l(e,c),l(c,_),l(e,m),h||(d=ue(t,"change",b),h=!0)},p(w,D){n=w,D[0]&4096&&s!==(s=n[50])&&(t.checked=s),D[0]&4096&&k!==(k="flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all hover:bg-base-200 "+(n[50]?"border-primary bg-primary bg-opacity-10":""))&&a(e,"class",k)},d(w){w&&u(e),h=!1,d()}}}function Os(n){let e;return{c(){e=g("span"),this.h()},l(t){e=p(t,"SPAN",{class:!0}),v(e).forEach(u),this.h()},h(){a(e,"class","loading loading-spinner loading-sm")},m(t,s){$(t,e,s)},d(t){t&&u(e)}}}function gl(n){let e,t,s,r,o,i=`<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path></svg>
          User Management`,c,f,_,m,k=n[1]!==1?"s":"",h,d,b,w,D,C,j,B,q,y,A,L,x,K,Z,G="All Zones",te,F,z,O,P,S,I,E,M,U,V,ie="User",re,J,ae="Added",T,H,ee="Zone Access (multi-select)",X,pe,ge,be,we,Me,Y,le="10 per page",ce,ke="20 per page",Te,Ae="50 per page",De,Oe="100 per page",Re,Se,Ue,Pe,ve=n[8]&&Ts(n),oe=n[9]&&As(n),me=Ie(n[18]),fe=[];for(let se=0;se<me.length;se+=1)fe[se]=Ms(Cs(n,me,se));let Ne=n[17]&&Ds(n);function Ye(se,ye){return se[7]&&se[0].length===0?pl:se[6].length===0?hl:fl}let ot=Ye(n),Fe=ot(n),Le=n[16]>1&&Bs(n),Ve=n[11]&&Us(n);return{c(){e=g("div"),t=g("div"),s=g("div"),r=g("div"),o=g("h2"),o.innerHTML=i,c=R(),f=g("p"),_=Q(n[1]),m=Q(" registered user"),h=Q(k),d=R(),b=g("button"),w=Ce("svg"),D=Ce("path"),C=Q(`
        Refresh`),j=R(),ve&&ve.c(),B=R(),oe&&oe.c(),q=R(),y=g("div"),A=g("div"),L=g("input"),x=R(),K=g("select"),Z=g("option"),Z.textContent=G;for(let se=0;se<fe.length;se+=1)fe[se].c();te=R(),Ne&&Ne.c(),F=R(),z=g("div"),O=g("table"),P=g("thead"),S=g("tr"),I=g("th"),E=g("input"),U=R(),V=g("th"),V.textContent=ie,re=R(),J=g("th"),J.textContent=ae,T=R(),H=g("th"),H.textContent=ee,X=R(),pe=g("tbody"),Fe.c(),ge=R(),Le&&Le.c(),be=R(),we=g("div"),Me=g("select"),Y=g("option"),Y.textContent=le,ce=g("option"),ce.textContent=ke,Te=g("option"),Te.textContent=Ae,De=g("option"),De.textContent=Oe,Re=R(),Ve&&Ve.c(),Se=Et(),this.h()},l(se){e=p(se,"DIV",{class:!0});var ye=v(e);t=p(ye,"DIV",{class:!0});var _e=v(t);s=p(_e,"DIV",{class:!0});var Ke=v(s);r=p(Ke,"DIV",{});var We=v(r);o=p(We,"H2",{class:!0,"data-svelte-h":!0}),ne(o)!=="svelte-13deh80"&&(o.innerHTML=i),c=N(We),f=p(We,"P",{class:!0});var st=v(f);_=W(st,n[1]),m=W(st," registered user"),h=W(st,k),st.forEach(u),We.forEach(u),d=N(Ke),b=p(Ke,"BUTTON",{class:!0});var it=v(b);w=Ee(it,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var Ht=v(w);D=Ee(Ht,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(D).forEach(u),Ht.forEach(u),C=W(it,`
        Refresh`),it.forEach(u),Ke.forEach(u),j=N(_e),ve&&ve.l(_e),B=N(_e),oe&&oe.l(_e),q=N(_e),y=p(_e,"DIV",{class:!0});var mt=v(y);A=p(mt,"DIV",{class:!0});var Ft=v(A);L=p(Ft,"INPUT",{type:!0,placeholder:!0,class:!0}),Ft.forEach(u),x=N(mt),K=p(mt,"SELECT",{class:!0});var At=v(K);Z=p(At,"OPTION",{"data-svelte-h":!0}),ne(Z)!=="svelte-vubagw"&&(Z.textContent=G);for(let Mt=0;Mt<fe.length;Mt+=1)fe[Mt].l(At);At.forEach(u),mt.forEach(u),te=N(_e),Ne&&Ne.l(_e),F=N(_e),z=p(_e,"DIV",{class:!0});var zt=v(z);O=p(zt,"TABLE",{class:!0});var bt=v(O);P=p(bt,"THEAD",{});var Kt=v(P);S=p(Kt,"TR",{});var nt=v(S);I=p(nt,"TH",{class:!0});var Jt=v(I);E=p(Jt,"INPUT",{type:!0,class:!0,title:!0}),Jt.forEach(u),U=N(nt),V=p(nt,"TH",{"data-svelte-h":!0}),ne(V)!=="svelte-fgzd59"&&(V.textContent=ie),re=N(nt),J=p(nt,"TH",{"data-svelte-h":!0}),ne(J)!=="svelte-1a7fes8"&&(J.textContent=ae),T=N(nt),H=p(nt,"TH",{class:!0,"data-svelte-h":!0}),ne(H)!=="svelte-17h50gp"&&(H.textContent=ee),nt.forEach(u),Kt.forEach(u),X=N(bt),pe=p(bt,"TBODY",{});var xt=v(pe);Fe.l(xt),xt.forEach(u),bt.forEach(u),zt.forEach(u),ge=N(_e),Le&&Le.l(_e),be=N(_e),we=p(_e,"DIV",{class:!0});var Zt=v(we);Me=p(Zt,"SELECT",{class:!0});var pt=v(Me);Y=p(pt,"OPTION",{"data-svelte-h":!0}),ne(Y)!=="svelte-eqj90a"&&(Y.textContent=le),ce=p(pt,"OPTION",{"data-svelte-h":!0}),ne(ce)!=="svelte-16bdf7a"&&(ce.textContent=ke),Te=p(pt,"OPTION",{"data-svelte-h":!0}),ne(Te)!=="svelte-zh0qgi"&&(Te.textContent=Ae),De=p(pt,"OPTION",{"data-svelte-h":!0}),ne(De)!=="svelte-ln5wdu"&&(De.textContent=Oe),pt.forEach(u),Zt.forEach(u),_e.forEach(u),ye.forEach(u),Re=N(se),Ve&&Ve.l(se),Se=Et(),this.h()},h(){a(o,"class","card-title flex items-center gap-2"),a(f,"class","text-base-content/60 text-sm mt-1"),a(D,"stroke-linecap","round"),a(D,"stroke-linejoin","round"),a(D,"stroke-width","2"),a(D,"d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"),a(w,"xmlns","http://www.w3.org/2000/svg"),a(w,"class","h-4 w-4"),a(w,"fill","none"),a(w,"viewBox","0 0 24 24"),a(w,"stroke","currentColor"),lt(w,"animate-spin",n[7]),a(b,"class","btn btn-ghost btn-sm"),b.disabled=n[7],a(s,"class","flex items-center justify-between mb-4"),a(L,"type","text"),a(L,"placeholder","Search by name or pubkey..."),a(L,"class","input input-bordered w-full"),a(A,"class","flex-1"),Z.__value="",je(Z,Z.__value),a(K,"class","select select-bordered"),n[13]===void 0&&wt(()=>n[34].call(K)),a(y,"class","flex flex-col md:flex-row gap-4 mb-4"),a(E,"type","checkbox"),a(E,"class","checkbox checkbox-sm"),E.checked=n[15],a(E,"title","Select all"),a(I,"class","w-10"),a(H,"class","text-center"),a(O,"class","table table-zebra w-full"),a(z,"class","overflow-x-auto"),Y.__value=10,je(Y,Y.__value),ce.__value=20,je(ce,ce.__value),Te.__value=50,je(Te,Te.__value),De.__value=100,je(De,De.__value),a(Me,"class","select select-bordered select-sm"),n[4]===void 0&&wt(()=>n[43].call(Me)),a(we,"class","flex justify-end mt-2"),a(t,"class","card-body"),a(e,"class","card bg-base-200 shadow-lg mb-6")},m(se,ye){$(se,e,ye),l(e,t),l(t,s),l(s,r),l(r,o),l(r,c),l(r,f),l(f,_),l(f,m),l(f,h),l(s,d),l(s,b),l(b,w),l(w,D),l(b,C),l(t,j),ve&&ve.m(t,null),l(t,B),oe&&oe.m(t,null),l(t,q),l(t,y),l(y,A),l(A,L),je(L,n[5]),l(y,x),l(y,K),l(K,Z);for(let _e=0;_e<fe.length;_e+=1)fe[_e]&&fe[_e].m(K,null);rt(K,n[13],!0),l(t,te),Ne&&Ne.m(t,null),l(t,F),l(t,z),l(z,O),l(O,P),l(P,S),l(S,I),l(I,E),l(S,U),l(S,V),l(S,re),l(S,J),l(S,T),l(S,H),l(O,X),l(O,pe),Fe.m(pe,null),l(t,ge),Le&&Le.m(t,null),l(t,be),l(t,we),l(we,Me),l(Me,Y),l(Me,ce),l(Me,Te),l(Me,De),rt(Me,n[4],!0),$(se,Re,ye),Ve&&Ve.m(se,ye),$(se,Se,ye),Ue||(Pe=[ue(b,"click",n[19]),ue(L,"input",n[33]),ue(L,"input",n[23]),ue(K,"change",n[34]),ue(K,"change",n[24]),ue(E,"change",n[25]),an(M=_l.call(null,E,n[17]&&!n[15])),ue(Me,"change",n[43]),ue(Me,"change",n[44])],Ue=!0)},p(se,ye){if(ye[0]&2&&de(_,se[1]),ye[0]&2&&k!==(k=se[1]!==1?"s":"")&&de(h,k),ye[0]&128&&lt(w,"animate-spin",se[7]),ye[0]&128&&(b.disabled=se[7]),se[8]?ve?ve.p(se,ye):(ve=Ts(se),ve.c(),ve.m(t,B)):ve&&(ve.d(1),ve=null),se[9]?oe?oe.p(se,ye):(oe=As(se),oe.c(),oe.m(t,q)):oe&&(oe.d(1),oe=null),ye[0]&32&&L.value!==se[5]&&je(L,se[5]),ye[0]&262144){me=Ie(se[18]);let _e;for(_e=0;_e<me.length;_e+=1){const Ke=Cs(se,me,_e);fe[_e]?fe[_e].p(Ke,ye):(fe[_e]=Ms(Ke),fe[_e].c(),fe[_e].m(K,null))}for(;_e<fe.length;_e+=1)fe[_e].d(1);fe.length=me.length}ye[0]&270336&&rt(K,se[13]),se[17]?Ne?Ne.p(se,ye):(Ne=Ds(se),Ne.c(),Ne.m(t,F)):Ne&&(Ne.d(1),Ne=null),ye[0]&32768&&(E.checked=se[15]),M&&on(M.update)&&ye[0]&163840&&M.update.call(null,se[17]&&!se[15]),ot===(ot=Ye(se))&&Fe?Fe.p(se,ye):(Fe.d(1),Fe=ot(se),Fe&&(Fe.c(),Fe.m(pe,null))),se[16]>1?Le?Le.p(se,ye):(Le=Bs(se),Le.c(),Le.m(t,be)):Le&&(Le.d(1),Le=null),ye[0]&16&&rt(Me,se[4]),se[11]?Ve?Ve.p(se,ye):(Ve=Us(se),Ve.c(),Ve.m(Se.parentNode,Se)):Ve&&(Ve.d(1),Ve=null)},i:he,o:he,d(se){se&&(u(e),u(Re),u(Se)),ve&&ve.d(),oe&&oe.d(),at(fe,se),Ne&&Ne.d(),Fe.d(),Le&&Le.d(),Ve&&Ve.d(se),Ue=!1,$e(Pe)}}}function _l(n,e){return n.indeterminate=e,{update(t){n.indeterminate=t}}}function vl(n,e){return n.cohorts.includes(e)}function Vt(n){return n?n.slice(0,8)+"..."+n.slice(-4):""}function Hs(n){return new Date(n*1e3).toLocaleDateString()}function ml(n,e,t){let s,r,o,i,c,f;Rt(n,Pt,Y=>t(48,f=Y));const _=[{id:"family",label:"Family",color:"#4a7c59"},{id:"dreamlab",label:"DreamLab",color:"#ec4899"},{id:"minimoonoir",label:"Minimoonoir",color:"#8b5cf6"},{id:"admin",label:"Admin",color:"#ef4444"}];let m=[],k=0,h=!1,d=null,b=null,w=new Set,D=!1,C=!1,j=[],B=1,q=20,y="",A="",L=new Set;async function x(){t(7,h=!0),t(8,d=null);try{const Y=await _n({limit:q,offset:r,cohort:A||void 0});t(0,m=Y.users),t(1,k=Y.total)}catch(Y){const le=Y instanceof Error?Y.message:"Failed to load users";console.error("[UserManagement] Error loading users:",le),t(8,d=le),t(0,m=[]),t(1,k=0)}finally{t(7,h=!1)}}function K(Y){return _.filter(le=>Y.cohorts.includes(le.id)).map(le=>le.id)}async function Z(Y,le,ce){const ke=f.publicKey;if(!ke){t(8,d="Not authenticated");return}L.add(Y.pubkey),t(14,L);const Te=Y.cohorts.filter(Se=>!_.some(Ue=>Ue.id===Se)),Ae=K(Y);let De;ce?De=[...Ae,le]:De=Ae.filter(Se=>Se!==le);const Oe=De.length>0?[...Te,...De,"approved"]:[...Te,"approved"],Re=[...new Set(Oe)];try{const Se=await It(Y.pubkey,Re,ke);if(Se.success){const Ue=m.findIndex(oe=>oe.pubkey===Y.pubkey);Ue>=0&&(t(0,m[Ue]={...m[Ue],cohorts:Re},m),t(0,m));const Pe=_.find(oe=>oe.id===le)?.label||le,ve=ce?"added to":"removed from";t(9,b=`${Y.displayName||Vt(Y.pubkey)} ${ve} ${Pe}`),setTimeout(()=>{t(9,b=null)},3e3)}else t(8,d=Se.error||"Failed to update zones")}catch(Se){t(8,d=Se instanceof Error?Se.message:"Failed to update zones")}finally{L.delete(Y.pubkey),t(14,L)}}function G(Y){Y>=1&&Y<=s&&(t(3,B=Y),x())}function te(){t(3,B=1),x()}function F(){t(3,B=1),x()}function z(){o?c.forEach(Y=>w.delete(Y.pubkey)):c.forEach(Y=>w.add(Y.pubkey)),t(2,w)}function O(Y){w.has(Y)?w.delete(Y):w.add(Y),t(2,w)}function P(){w.clear(),t(2,w)}function S(){t(12,j=[]),t(11,C=!0)}function I(){t(11,C=!1),t(12,j=[])}async function E(){const Y=f.publicKey;if(!Y){t(8,d="Not authenticated");return}if(w.size===0){t(8,d="No users selected");return}t(10,D=!0),t(8,d=null);let le=0,ce=0;for(const ke of w){const Te=m.find(Oe=>Oe.pubkey===ke);if(!Te)continue;const Ae=Te.cohorts.filter(Oe=>!_.some(Re=>Re.id===Oe)),De=j.length>0?[...new Set([...Ae,...j,"approved"])]:[...new Set([...Ae,"approved"])];try{if((await It(ke,De,Y)).success){le++;const Re=m.findIndex(Se=>Se.pubkey===ke);Re>=0&&t(0,m[Re]={...m[Re],cohorts:De},m)}else ce++}catch{ce++}}if(t(0,m),t(10,D=!1),I(),P(),le>0){const ke=j.length>0?j.map(Te=>_.find(Ae=>Ae.id===Te)?.label||Te).join(", "):"approved status";t(9,b=`Updated ${le} user${le!==1?"s":""} with ${ke}`),setTimeout(()=>{t(9,b=null)},4e3)}ce>0&&t(8,d=`Failed to update ${ce} user${ce!==1?"s":""}`)}async function M(Y){const le=f.publicKey;if(!le){t(8,d="Not authenticated");return}t(10,D=!0);let ce=0,ke=0;for(const Ae of w){const De=m.find(Re=>Re.pubkey===Ae);if(!De||!De.cohorts.includes(Y))continue;const Oe=De.cohorts.filter(Re=>Re!==Y);try{if((await It(Ae,Oe,le)).success){ce++;const Se=m.findIndex(Ue=>Ue.pubkey===Ae);Se>=0&&t(0,m[Se]={...m[Se],cohorts:Oe},m)}else ke++}catch{ke++}}t(0,m),t(10,D=!1),P();const Te=_.find(Ae=>Ae.id===Y)?.label||Y;ce>0&&(t(9,b=`Removed ${Te} from ${ce} user${ce!==1?"s":""}`),setTimeout(()=>{t(9,b=null)},4e3)),ke>0&&t(8,d=`Failed to update ${ke} user${ke!==1?"s":""}`)}Xs(()=>{x()});const U=()=>t(8,d=null);function V(){y=this.value,t(5,y)}function ie(){A=yt(this),t(13,A),t(18,_)}const re=Y=>M(Y.id),J=Y=>O(Y.pubkey),ae=Y=>!_.some(le=>le.id===Y),T=(Y,le,ce)=>Z(Y,le.id,ce.currentTarget.checked),H=()=>G(1),ee=()=>G(B-1),X=()=>G(B+1),pe=()=>G(s);function ge(){q=yt(this),t(4,q)}const be=()=>{t(3,B=1),x()},we=(Y,le)=>{le.currentTarget.checked?t(12,j=[...j,Y.id]):t(12,j=j.filter(ce=>ce!==Y.id))},Me=Y=>Y.key==="Escape"&&I();return n.$$.update=()=>{n.$$.dirty[0]&18&&t(16,s=Math.ceil(k/q)),n.$$.dirty[0]&24&&(r=(B-1)*q),n.$$.dirty[0]&33&&t(6,c=y?m.filter(Y=>{const le=y.toLowerCase(),ce=(Y.displayName||"").toLowerCase(),ke=Y.pubkey.toLowerCase();return ce.includes(le)||ke.includes(le)}):m),n.$$.dirty[0]&68&&t(15,o=c.length>0&&c.every(Y=>w.has(Y.pubkey))),n.$$.dirty[0]&4&&t(17,i=w.size>0)},[m,k,w,B,q,y,c,h,d,b,D,C,j,A,L,o,s,i,_,x,K,Z,G,te,F,z,O,P,S,I,E,M,U,V,ie,re,J,ae,T,H,ee,X,pe,ge,be,we,Me]}class bl extends et{constructor(e){super(),tt(this,e,ml,gl,Xe,{},null,[-1,-1,-1])}}function Fs(n,e,t){const s=n.slice();return s[6]=e[t],s}function zs(n){let e,t=n[0].length+"",s;return{c(){e=g("span"),s=Q(t),this.h()},l(r){e=p(r,"SPAN",{class:!0});var o=v(e);s=W(o,t),o.forEach(u),this.h()},h(){a(e,"class","badge badge-warning")},m(r,o){$(r,e,o),l(e,s)},p(r,o){o&1&&t!==(t=r[0].length+"")&&de(s,t)},d(r){r&&u(e)}}}function kl(n){let e,t,s,r='<tr><th>User</th> <th>Section</th> <th>Message</th> <th>Requested</th> <th class="text-right">Actions</th></tr>',o,i,c=[],f=new Map,_,m=Ie(n[0]);const k=h=>h[6].id;for(let h=0;h<m.length;h+=1){let d=Fs(n,m,h),b=k(d);f.set(b,c[h]=Ks(b,d))}return{c(){e=g("div"),t=g("table"),s=g("thead"),s.innerHTML=r,o=R(),i=g("tbody");for(let h=0;h<c.length;h+=1)c[h].c();this.h()},l(h){e=p(h,"DIV",{class:!0});var d=v(e);t=p(d,"TABLE",{class:!0});var b=v(t);s=p(b,"THEAD",{"data-svelte-h":!0}),ne(s)!=="svelte-nl7lwv"&&(s.innerHTML=r),o=N(b),i=p(b,"TBODY",{});var w=v(i);for(let D=0;D<c.length;D+=1)c[D].l(w);w.forEach(u),b.forEach(u),d.forEach(u),this.h()},h(){a(t,"class","table table-zebra"),a(e,"class","overflow-x-auto mt-4")},m(h,d){$(h,e,d),l(e,t),l(t,s),l(t,o),l(t,i);for(let b=0;b<c.length;b+=1)c[b]&&c[b].m(i,null);_=!0},p(h,d){d&7&&(m=Ie(h[0]),ft(),c=vt(c,d,k,1,h,m,f,i,Ut,Ks,null,Fs),ht())},i(h){if(!_){for(let d=0;d<m.length;d+=1)Be(c[d]);_=!0}},o(h){for(let d=0;d<c.length;d+=1)qe(c[d]);_=!1},d(h){h&&u(e);for(let d=0;d<c.length;d+=1)c[d].d()}}}function wl(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-2 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <p>No pending section access requests</p> <p class="text-sm mt-1">New users requesting section access will appear here</p>';return{c(){e=g("div"),e.innerHTML=t,this.h()},l(s){e=p(s,"DIV",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-1bgh5v3"&&(e.innerHTML=t),this.h()},h(){a(e,"class","text-center py-8 text-base-content/50")},m(s,r){$(s,e,r)},p:he,i:he,o:he,d(s){s&&u(e)}}}function yl(n){let e,t='<span class="loading loading-spinner loading-lg"></span> <p class="mt-2 text-base-content/70">Loading pending requests...</p>';return{c(){e=g("div"),e.innerHTML=t,this.h()},l(s){e=p(s,"DIV",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-1gnd61m"&&(e.innerHTML=t),this.h()},h(){a(e,"class","text-center py-8")},m(s,r){$(s,e,r)},p:he,i:he,o:he,d(s){s&&u(e)}}}function El(n){let e,t="No message";return{c(){e=g("span"),e.textContent=t,this.h()},l(s){e=p(s,"SPAN",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-tay6cd"&&(e.textContent=t),this.h()},h(){a(e,"class","text-xs text-base-content/50")},m(s,r){$(s,e,r)},p:he,d(s){s&&u(e)}}}function Cl(n){let e,t=n[6].message+"",s;return{c(){e=g("span"),s=Q(t),this.h()},l(r){e=p(r,"SPAN",{class:!0});var o=v(e);s=W(o,t),o.forEach(u),this.h()},h(){a(e,"class","text-sm text-base-content/70 line-clamp-2")},m(r,o){$(r,e,o),l(e,s)},p(r,o){o&1&&t!==(t=r[6].message+"")&&de(s,t)},d(r){r&&u(e)}}}function Ks(n,e){let t,s,r,o,i,c,f=(ze[e[6].section]?.icon||"")+"",_,m,k=(ze[e[6].section]?.name||e[6].section)+"",h,d,b,w,D,C,j=Js(e[6].requestedAt)+"",B,q,y,A,L,x,K,Z,G,te,F,z,O;r=new Bt({props:{pubkey:e[6].requesterPubkey,showAvatar:!0,showName:!0,avatarSize:"sm",clickable:!1}});function P(U,V){return U[6].message?Cl:El}let S=P(e),I=S(e);function E(){return e[4](e[6])}function M(){return e[5](e[6])}return{key:n,first:null,c(){t=g("tr"),s=g("td"),Ge(r.$$.fragment),o=R(),i=g("td"),c=g("span"),_=Q(f),m=R(),h=Q(k),d=R(),b=g("td"),I.c(),w=R(),D=g("td"),C=g("span"),B=Q(j),q=R(),y=g("td"),A=g("div"),L=g("button"),x=Q("Approve"),K=R(),Z=g("button"),G=Q("Deny"),te=R(),this.h()},l(U){t=p(U,"TR",{});var V=v(t);s=p(V,"TD",{});var ie=v(s);Ze(r.$$.fragment,ie),ie.forEach(u),o=N(V),i=p(V,"TD",{});var re=v(i);c=p(re,"SPAN",{class:!0});var J=v(c);_=W(J,f),m=N(J),h=W(J,k),J.forEach(u),re.forEach(u),d=N(V),b=p(V,"TD",{});var ae=v(b);I.l(ae),ae.forEach(u),w=N(V),D=p(V,"TD",{});var T=v(D);C=p(T,"SPAN",{class:!0});var H=v(C);B=W(H,j),H.forEach(u),T.forEach(u),q=N(V),y=p(V,"TD",{});var ee=v(y);A=p(ee,"DIV",{class:!0});var X=v(A);L=p(X,"BUTTON",{class:!0});var pe=v(L);x=W(pe,"Approve"),pe.forEach(u),K=N(X),Z=p(X,"BUTTON",{class:!0});var ge=v(Z);G=W(ge,"Deny"),ge.forEach(u),X.forEach(u),ee.forEach(u),te=N(V),V.forEach(u),this.h()},h(){a(c,"class","badge badge-primary"),a(C,"class","text-sm"),a(L,"class","btn btn-success btn-sm"),L.disabled=e[1],a(Z,"class","btn btn-error btn-sm btn-outline"),Z.disabled=e[1],a(A,"class","flex justify-end gap-2"),this.first=t},m(U,V){$(U,t,V),l(t,s),xe(r,s,null),l(t,o),l(t,i),l(i,c),l(c,_),l(c,m),l(c,h),l(t,d),l(t,b),I.m(b,null),l(t,w),l(t,D),l(D,C),l(C,B),l(t,q),l(t,y),l(y,A),l(A,L),l(L,x),l(A,K),l(A,Z),l(Z,G),l(t,te),F=!0,z||(O=[ue(L,"click",E),ue(Z,"click",M)],z=!0)},p(U,V){e=U;const ie={};V&1&&(ie.pubkey=e[6].requesterPubkey),r.$set(ie),(!F||V&1)&&f!==(f=(ze[e[6].section]?.icon||"")+"")&&de(_,f),(!F||V&1)&&k!==(k=(ze[e[6].section]?.name||e[6].section)+"")&&de(h,k),S===(S=P(e))&&I?I.p(e,V):(I.d(1),I=S(e),I&&(I.c(),I.m(b,null))),(!F||V&1)&&j!==(j=Js(e[6].requestedAt)+"")&&de(B,j),(!F||V&2)&&(L.disabled=e[1]),(!F||V&2)&&(Z.disabled=e[1])},i(U){F||(Be(r.$$.fragment,U),F=!0)},o(U){qe(r.$$.fragment,U),F=!1},d(U){U&&u(t),Je(r),I.d(),z=!1,$e(O)}}}function Tl(n){let e,t,s,r,o,i,c,f,_,m,k,h,d,b,w,D,C=n[0].length>0&&zs(n);const j=[yl,wl,kl],B=[];function q(y,A){return y[1]&&y[0].length===0?0:y[0].length===0?1:2}return h=q(n),d=B[h]=j[h](n),{c(){e=g("div"),t=g("div"),s=g("div"),r=g("h2"),o=Q(`Pending Section Access Requests
        `),C&&C.c(),i=R(),c=g("button"),f=Ce("svg"),_=Ce("path"),m=Q(`
        Refresh`),k=R(),d.c(),this.h()},l(y){e=p(y,"DIV",{class:!0});var A=v(e);t=p(A,"DIV",{class:!0});var L=v(t);s=p(L,"DIV",{class:!0});var x=v(s);r=p(x,"H2",{class:!0});var K=v(r);o=W(K,`Pending Section Access Requests
        `),C&&C.l(K),K.forEach(u),i=N(x),c=p(x,"BUTTON",{class:!0});var Z=v(c);f=Ee(Z,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var G=v(f);_=Ee(G,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(_).forEach(u),G.forEach(u),m=W(Z,`
        Refresh`),Z.forEach(u),x.forEach(u),k=N(L),d.l(L),L.forEach(u),A.forEach(u),this.h()},h(){a(r,"class","card-title"),a(_,"stroke-linecap","round"),a(_,"stroke-linejoin","round"),a(_,"stroke-width","2"),a(_,"d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"),a(f,"xmlns","http://www.w3.org/2000/svg"),a(f,"class","h-4 w-4"),a(f,"fill","none"),a(f,"viewBox","0 0 24 24"),a(f,"stroke","currentColor"),a(c,"class","btn btn-ghost btn-sm"),c.disabled=n[1],a(s,"class","flex items-center justify-between"),a(t,"class","card-body"),a(e,"class","card bg-base-200 mb-6")},m(y,A){$(y,e,A),l(e,t),l(t,s),l(s,r),l(r,o),C&&C.m(r,null),l(s,i),l(s,c),l(c,f),l(f,_),l(c,m),l(t,k),B[h].m(t,null),b=!0,w||(D=ue(c,"click",n[3]),w=!0)},p(y,[A]){y[0].length>0?C?C.p(y,A):(C=zs(y),C.c(),C.m(r,null)):C&&(C.d(1),C=null),(!b||A&2)&&(c.disabled=y[1]);let L=h;h=q(y),h===L?B[h].p(y,A):(ft(),qe(B[L],1,1,()=>{B[L]=null}),ht(),d=B[h],d?d.p(y,A):(d=B[h]=j[h](y),d.c()),Be(d,1),d.m(t,null))},i(y){b||(Be(d),b=!0)},o(y){qe(d),b=!1},d(y){y&&u(e),C&&C.d(),B[h].d(),w=!1,D()}}}function Js(n){const t=Date.now()-n,s=Math.floor(t/1e3),r=Math.floor(s/60),o=Math.floor(r/60),i=Math.floor(o/24);return i>0?`${i}d ago`:o>0?`${o}h ago`:r>0?`${r}m ago`:"just now"}function Al(n,e,t){let{pendingRequests:s}=e,{isLoading:r}=e;const o=_t(),i=()=>o("refresh"),c=_=>o("approve",_),f=_=>o("deny",_);return n.$$set=_=>{"pendingRequests"in _&&t(0,s=_.pendingRequests),"isLoading"in _&&t(1,r=_.isLoading)},[s,r,o,i,c,f]}class Ml extends et{constructor(e){super(),tt(this,e,Al,Tl,Xe,{pendingRequests:0,isLoading:1})}}function xs(n,e,t){const s=n.slice();return s[7]=e[t],s}function Zs(n){let e,t=n[0].length+"",s;return{c(){e=g("span"),s=Q(t),this.h()},l(r){e=p(r,"SPAN",{class:!0});var o=v(e);s=W(o,t),o.forEach(u),this.h()},h(){a(e,"class","badge badge-info")},m(r,o){$(r,e,o),l(e,s)},p(r,o){o&1&&t!==(t=r[0].length+"")&&de(s,t)},d(r){r&&u(e)}}}function Dl(n){let e,t,s,r='<tr><th>User</th> <th>Channel</th> <th>Message</th> <th>Requested</th> <th class="text-right">Actions</th></tr>',o,i,c=[],f=new Map,_,m=Ie(n[0]);const k=h=>h[7].id;for(let h=0;h<m.length;h+=1){let d=xs(n,m,h),b=k(d);f.set(b,c[h]=Gs(b,d))}return{c(){e=g("div"),t=g("table"),s=g("thead"),s.innerHTML=r,o=R(),i=g("tbody");for(let h=0;h<c.length;h+=1)c[h].c();this.h()},l(h){e=p(h,"DIV",{class:!0});var d=v(e);t=p(d,"TABLE",{class:!0});var b=v(t);s=p(b,"THEAD",{"data-svelte-h":!0}),ne(s)!=="svelte-7se8xz"&&(s.innerHTML=r),o=N(b),i=p(b,"TBODY",{});var w=v(i);for(let D=0;D<c.length;D+=1)c[D].l(w);w.forEach(u),b.forEach(u),d.forEach(u),this.h()},h(){a(t,"class","table table-zebra"),a(e,"class","overflow-x-auto mt-4")},m(h,d){$(h,e,d),l(e,t),l(t,s),l(t,o),l(t,i);for(let b=0;b<c.length;b+=1)c[b]&&c[b].m(i,null);_=!0},p(h,d){d&15&&(m=Ie(h[0]),ft(),c=vt(c,d,k,1,h,m,f,i,Ut,Gs,null,xs),ht())},i(h){if(!_){for(let d=0;d<m.length;d+=1)Be(c[d]);_=!0}},o(h){for(let d=0;d<c.length;d+=1)qe(c[d]);_=!1},d(h){h&&u(e);for(let d=0;d<c.length;d+=1)c[d].d()}}}function Sl(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-2 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg> <p>No pending channel join requests</p> <p class="text-sm mt-1">Users requesting to join specific channels will appear here</p>';return{c(){e=g("div"),e.innerHTML=t,this.h()},l(s){e=p(s,"DIV",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-r348y1"&&(e.innerHTML=t),this.h()},h(){a(e,"class","text-center py-8 text-base-content/50")},m(s,r){$(s,e,r)},p:he,i:he,o:he,d(s){s&&u(e)}}}function Il(n){let e,t='<span class="loading loading-spinner loading-lg"></span> <p class="mt-2 text-base-content/70">Loading channel join requests...</p>';return{c(){e=g("div"),e.innerHTML=t,this.h()},l(s){e=p(s,"DIV",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-1otqaby"&&(e.innerHTML=t),this.h()},h(){a(e,"class","text-center py-8")},m(s,r){$(s,e,r)},p:he,i:he,o:he,d(s){s&&u(e)}}}function Nl(n){let e,t="No message";return{c(){e=g("span"),e.textContent=t,this.h()},l(s){e=p(s,"SPAN",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-tay6cd"&&(e.textContent=t),this.h()},h(){a(e,"class","text-xs text-base-content/50")},m(s,r){$(s,e,r)},p:he,d(s){s&&u(e)}}}function Rl(n){let e,t=n[7].message+"",s;return{c(){e=g("span"),s=Q(t),this.h()},l(r){e=p(r,"SPAN",{class:!0});var o=v(e);s=W(o,t),o.forEach(u),this.h()},h(){a(e,"class","text-sm text-base-content/70 line-clamp-2")},m(r,o){$(r,e,o),l(e,s)},p(r,o){o&1&&t!==(t=r[7].message+"")&&de(s,t)},d(r){r&&u(e)}}}function Gs(n,e){let t,s,r,o,i,c,f,_=e[2](e[7].channelId)+"",m,k,h,d,b,w,D=Ys(e[7].createdAt)+"",C,j,B,q,y,A,L,x,K,Z,G,te,F;r=new Bt({props:{pubkey:e[7].pubkey,showAvatar:!0,showName:!0,avatarSize:"sm",clickable:!1}});function z(E,M){return E[7].message?Rl:Nl}let O=z(e),P=O(e);function S(){return e[5](e[7])}function I(){return e[6](e[7])}return{key:n,first:null,c(){t=g("tr"),s=g("td"),Ge(r.$$.fragment),o=R(),i=g("td"),c=g("span"),f=Q("# "),m=Q(_),k=R(),h=g("td"),P.c(),d=R(),b=g("td"),w=g("span"),C=Q(D),j=R(),B=g("td"),q=g("div"),y=g("button"),A=Q("Approve"),L=R(),x=g("button"),K=Q("Deny"),Z=R(),this.h()},l(E){t=p(E,"TR",{});var M=v(t);s=p(M,"TD",{});var U=v(s);Ze(r.$$.fragment,U),U.forEach(u),o=N(M),i=p(M,"TD",{});var V=v(i);c=p(V,"SPAN",{class:!0});var ie=v(c);f=W(ie,"# "),m=W(ie,_),ie.forEach(u),V.forEach(u),k=N(M),h=p(M,"TD",{});var re=v(h);P.l(re),re.forEach(u),d=N(M),b=p(M,"TD",{});var J=v(b);w=p(J,"SPAN",{class:!0});var ae=v(w);C=W(ae,D),ae.forEach(u),J.forEach(u),j=N(M),B=p(M,"TD",{});var T=v(B);q=p(T,"DIV",{class:!0});var H=v(q);y=p(H,"BUTTON",{class:!0});var ee=v(y);A=W(ee,"Approve"),ee.forEach(u),L=N(H),x=p(H,"BUTTON",{class:!0});var X=v(x);K=W(X,"Deny"),X.forEach(u),H.forEach(u),T.forEach(u),Z=N(M),M.forEach(u),this.h()},h(){a(c,"class","badge badge-secondary"),a(w,"class","text-sm"),a(y,"class","btn btn-success btn-sm"),y.disabled=e[1],a(x,"class","btn btn-error btn-sm btn-outline"),x.disabled=e[1],a(q,"class","flex justify-end gap-2"),this.first=t},m(E,M){$(E,t,M),l(t,s),xe(r,s,null),l(t,o),l(t,i),l(i,c),l(c,f),l(c,m),l(t,k),l(t,h),P.m(h,null),l(t,d),l(t,b),l(b,w),l(w,C),l(t,j),l(t,B),l(B,q),l(q,y),l(y,A),l(q,L),l(q,x),l(x,K),l(t,Z),G=!0,te||(F=[ue(y,"click",S),ue(x,"click",I)],te=!0)},p(E,M){e=E;const U={};M&1&&(U.pubkey=e[7].pubkey),r.$set(U),(!G||M&5)&&_!==(_=e[2](e[7].channelId)+"")&&de(m,_),O===(O=z(e))&&P?P.p(e,M):(P.d(1),P=O(e),P&&(P.c(),P.m(h,null))),(!G||M&1)&&D!==(D=Ys(e[7].createdAt)+"")&&de(C,D),(!G||M&2)&&(y.disabled=e[1]),(!G||M&2)&&(x.disabled=e[1])},i(E){G||(Be(r.$$.fragment,E),G=!0)},o(E){qe(r.$$.fragment,E),G=!1},d(E){E&&u(t),Je(r),P.d(),te=!1,$e(F)}}}function Pl(n){let e,t,s,r,o,i,c,f,_,m,k,h,d,b,w,D,C=n[0].length>0&&Zs(n);const j=[Il,Sl,Dl],B=[];function q(y,A){return y[1]&&y[0].length===0?0:y[0].length===0?1:2}return h=q(n),d=B[h]=j[h](n),{c(){e=g("div"),t=g("div"),s=g("div"),r=g("h2"),o=Q(`Pending Channel Join Requests
        `),C&&C.c(),i=R(),c=g("button"),f=Ce("svg"),_=Ce("path"),m=Q(`
        Refresh`),k=R(),d.c(),this.h()},l(y){e=p(y,"DIV",{class:!0});var A=v(e);t=p(A,"DIV",{class:!0});var L=v(t);s=p(L,"DIV",{class:!0});var x=v(s);r=p(x,"H2",{class:!0});var K=v(r);o=W(K,`Pending Channel Join Requests
        `),C&&C.l(K),K.forEach(u),i=N(x),c=p(x,"BUTTON",{class:!0});var Z=v(c);f=Ee(Z,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var G=v(f);_=Ee(G,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(_).forEach(u),G.forEach(u),m=W(Z,`
        Refresh`),Z.forEach(u),x.forEach(u),k=N(L),d.l(L),L.forEach(u),A.forEach(u),this.h()},h(){a(r,"class","card-title"),a(_,"stroke-linecap","round"),a(_,"stroke-linejoin","round"),a(_,"stroke-width","2"),a(_,"d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"),a(f,"xmlns","http://www.w3.org/2000/svg"),a(f,"class","h-4 w-4"),a(f,"fill","none"),a(f,"viewBox","0 0 24 24"),a(f,"stroke","currentColor"),a(c,"class","btn btn-ghost btn-sm"),c.disabled=n[1],a(s,"class","flex items-center justify-between"),a(t,"class","card-body"),a(e,"class","card bg-base-200 mb-6")},m(y,A){$(y,e,A),l(e,t),l(t,s),l(s,r),l(r,o),C&&C.m(r,null),l(s,i),l(s,c),l(c,f),l(f,_),l(c,m),l(t,k),B[h].m(t,null),b=!0,w||(D=ue(c,"click",n[4]),w=!0)},p(y,[A]){y[0].length>0?C?C.p(y,A):(C=Zs(y),C.c(),C.m(r,null)):C&&(C.d(1),C=null),(!b||A&2)&&(c.disabled=y[1]);let L=h;h=q(y),h===L?B[h].p(y,A):(ft(),qe(B[L],1,1,()=>{B[L]=null}),ht(),d=B[h],d?d.p(y,A):(d=B[h]=j[h](y),d.c()),Be(d,1),d.m(t,null))},i(y){b||(Be(d),b=!0)},o(y){qe(d),b=!1},d(y){y&&u(e),C&&C.d(),B[h].d(),w=!1,D()}}}function Ys(n){const t=Date.now()-n,s=Math.floor(t/1e3),r=Math.floor(s/60),o=Math.floor(r/60),i=Math.floor(o/24);return i>0?`${i}d ago`:o>0?`${o}h ago`:r>0?`${r}m ago`:"just now"}function Ll(n,e,t){let{pendingChannelJoinRequests:s}=e,{isLoading:r}=e,{getChannelName:o}=e;const i=_t(),c=()=>i("refresh"),f=m=>i("approve",m),_=m=>i("reject",m);return n.$$set=m=>{"pendingChannelJoinRequests"in m&&t(0,s=m.pendingChannelJoinRequests),"isLoading"in m&&t(1,r=m.isLoading),"getChannelName"in m&&t(2,o=m.getChannelName)},[s,r,o,i,c,f,_]}class Vl extends et{constructor(e){super(),tt(this,e,Ll,Pl,Xe,{pendingChannelJoinRequests:0,isLoading:1,getChannelName:2})}}function ql(n){let e,t=`<a href="${gt}/admin/stats" class="card bg-base-200 hover:bg-base-300 transition-colors cursor-pointer"><div class="card-body"><h2 class="card-title"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
        Statistics</h2> <p class="text-sm text-base-content/70">View detailed system analytics and reports</p></div></a> <a href="${gt}/admin/calendar" class="card bg-base-200 hover:bg-base-300 transition-colors cursor-pointer"><div class="card-body"><h2 class="card-title"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
        Calendar Events</h2> <p class="text-sm text-base-content/70">Manage NIP-52 calendar events and scheduling</p></div></a>`;return{c(){e=g("div"),e.innerHTML=t,this.h()},l(s){e=p(s,"DIV",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-h0273p"&&(e.innerHTML=t),this.h()},h(){a(e,"class","grid gap-4 md:grid-cols-2 lg:grid-cols-3")},m(s,r){$(s,e,r)},p:he,i:he,o:he,d(s){s&&u(e)}}}class Bl extends et{constructor(e){super(),tt(this,e,null,ql,Xe,{})}}function Ws(n){let e,t,s,r,o,i,c,f,_="Dismiss",m,k;return{c(){e=g("div"),t=Ce("svg"),s=Ce("path"),r=R(),o=g("span"),i=Q(n[6]),c=R(),f=g("button"),f.textContent=_,this.h()},l(h){e=p(h,"DIV",{class:!0});var d=v(e);t=Ee(d,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var b=v(t);s=Ee(b,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(s).forEach(u),b.forEach(u),r=N(d),o=p(d,"SPAN",{});var w=v(o);i=W(w,n[6]),w.forEach(u),c=N(d),f=p(d,"BUTTON",{class:!0,"data-svelte-h":!0}),ne(f)!=="svelte-1oc0rew"&&(f.textContent=_),d.forEach(u),this.h()},h(){a(s,"stroke-linecap","round"),a(s,"stroke-linejoin","round"),a(s,"stroke-width","2"),a(s,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),a(t,"xmlns","http://www.w3.org/2000/svg"),a(t,"class","stroke-current shrink-0 h-6 w-6"),a(t,"fill","none"),a(t,"viewBox","0 0 24 24"),a(f,"class","btn btn-ghost btn-sm"),a(e,"class","alert alert-error mb-4")},m(h,d){$(h,e,d),l(e,t),l(t,s),l(e,r),l(e,o),l(o,i),l(e,c),l(e,f),m||(k=ue(f,"click",n[23]),m=!0)},p(h,d){d[0]&64&&de(i,h[6])},d(h){h&&u(e),m=!1,k()}}}function Qs(n){let e,t,s,r,o,i,c,f,_="Dismiss",m,k;return{c(){e=g("div"),t=Ce("svg"),s=Ce("path"),r=R(),o=g("span"),i=Q(n[7]),c=R(),f=g("button"),f.textContent=_,this.h()},l(h){e=p(h,"DIV",{class:!0});var d=v(e);t=Ee(d,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var b=v(t);s=Ee(b,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(s).forEach(u),b.forEach(u),r=N(d),o=p(d,"SPAN",{});var w=v(o);i=W(w,n[7]),w.forEach(u),c=N(d),f=p(d,"BUTTON",{class:!0,"data-svelte-h":!0}),ne(f)!=="svelte-7k7et6"&&(f.textContent=_),d.forEach(u),this.h()},h(){a(s,"stroke-linecap","round"),a(s,"stroke-linejoin","round"),a(s,"stroke-width","2"),a(s,"d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"),a(t,"xmlns","http://www.w3.org/2000/svg"),a(t,"class","stroke-current shrink-0 h-6 w-6"),a(t,"fill","none"),a(t,"viewBox","0 0 24 24"),a(f,"class","btn btn-ghost btn-sm"),a(e,"class","alert alert-success mb-4")},m(h,d){$(h,e,d),l(e,t),l(t,s),l(e,r),l(e,o),l(o,i),l(e,c),l(e,f),m||(k=ue(f,"click",n[24]),m=!0)},p(h,d){d[0]&128&&de(i,h[7])},d(h){h&&u(e),m=!1,k()}}}function Ul(n){let e,t,s,r,o="Admin Dashboard",i,c,f="System overview and management",_,m,k,h,d,b,w,D="Relay Status",C,j,B,q,y,A,L,x,K,Z,G,te,F,z,O,P,S,I,E,M,U=n[6]&&Ws(n),V=n[7]&&Qs(n);q=new Kn({props:{stats:n[3]}});function ie(J){n[25](J)}let re={isSwitchingMode:n[10]};return n[9]!==void 0&&(re.isPrivateMode=n[9]),A=new Qn({props:re}),cn.push(()=>hn(A,"isPrivateMode",ie)),A.$on("modeChange",n[11]),K=new nl({props:{channels:n[4],isLoading:n[5]}}),K.$on("create",n[22]),G=new dl({props:{pendingUserRegistrations:n[2],isLoading:n[5]}}),G.$on("approve",n[26]),G.$on("reject",n[27]),G.$on("refresh",n[14]),F=new bl({}),O=new Ml({props:{pendingRequests:n[0],isLoading:n[5]}}),O.$on("approve",n[28]),O.$on("deny",n[29]),O.$on("refresh",n[12]),S=new Vl({props:{pendingChannelJoinRequests:n[1],isLoading:n[5],getChannelName:n[21]}}),S.$on("approve",n[30]),S.$on("reject",n[31]),S.$on("refresh",n[13]),E=new Bl({}),{c(){e=R(),t=g("div"),s=g("div"),r=g("h1"),r.textContent=o,i=R(),c=g("p"),c.textContent=f,_=R(),m=g("div"),k=g("span"),h=Q(n[8]),b=R(),w=g("span"),w.textContent=D,C=R(),U&&U.c(),j=R(),V&&V.c(),B=R(),Ge(q.$$.fragment),y=R(),Ge(A.$$.fragment),x=R(),Ge(K.$$.fragment),Z=R(),Ge(G.$$.fragment),te=R(),Ge(F.$$.fragment),z=R(),Ge(O.$$.fragment),P=R(),Ge(S.$$.fragment),I=R(),Ge(E.$$.fragment),this.h()},l(J){dn("svelte-1t0vptb",document.head).forEach(u),e=N(J),t=p(J,"DIV",{class:!0});var T=v(t);s=p(T,"DIV",{class:!0});var H=v(s);r=p(H,"H1",{class:!0,"data-svelte-h":!0}),ne(r)!=="svelte-48mamn"&&(r.textContent=o),i=N(H),c=p(H,"P",{class:!0,"data-svelte-h":!0}),ne(c)!=="svelte-g7e0f6"&&(c.textContent=f),_=N(H),m=p(H,"DIV",{class:!0});var ee=v(m);k=p(ee,"SPAN",{class:!0});var X=v(k);h=W(X,n[8]),X.forEach(u),b=N(ee),w=p(ee,"SPAN",{class:!0,"data-svelte-h":!0}),ne(w)!=="svelte-1jtew3n"&&(w.textContent=D),ee.forEach(u),H.forEach(u),C=N(T),U&&U.l(T),j=N(T),V&&V.l(T),B=N(T),Ze(q.$$.fragment,T),y=N(T),Ze(A.$$.fragment,T),x=N(T),Ze(K.$$.fragment,T),Z=N(T),Ze(G.$$.fragment,T),te=N(T),Ze(F.$$.fragment,T),z=N(T),Ze(O.$$.fragment,T),P=N(T),Ze(S.$$.fragment,T),I=N(T),Ze(E.$$.fragment,T),T.forEach(u),this.h()},h(){document.title="Admin Dashboard - Nostr-BBS",a(r,"class","text-4xl font-bold gradient-text mb-2"),a(c,"class","text-base-content/70"),a(k,"class",d="badge "+(n[8]==="connected"?"badge-success":n[8]==="error"?"badge-error":"badge-warning")),a(w,"class","text-sm text-base-content/50"),a(m,"class","mt-2 flex items-center gap-2"),a(s,"class","mb-6"),a(t,"class","container mx-auto p-4 max-w-6xl")},m(J,ae){$(J,e,ae),$(J,t,ae),l(t,s),l(s,r),l(s,i),l(s,c),l(s,_),l(s,m),l(m,k),l(k,h),l(m,b),l(m,w),l(t,C),U&&U.m(t,null),l(t,j),V&&V.m(t,null),l(t,B),xe(q,t,null),l(t,y),xe(A,t,null),l(t,x),xe(K,t,null),l(t,Z),xe(G,t,null),l(t,te),xe(F,t,null),l(t,z),xe(O,t,null),l(t,P),xe(S,t,null),l(t,I),xe(E,t,null),M=!0},p(J,ae){(!M||ae[0]&256)&&de(h,J[8]),(!M||ae[0]&256&&d!==(d="badge "+(J[8]==="connected"?"badge-success":J[8]==="error"?"badge-error":"badge-warning")))&&a(k,"class",d),J[6]?U?U.p(J,ae):(U=Ws(J),U.c(),U.m(t,j)):U&&(U.d(1),U=null),J[7]?V?V.p(J,ae):(V=Qs(J),V.c(),V.m(t,B)):V&&(V.d(1),V=null);const T={};ae[0]&8&&(T.stats=J[3]),q.$set(T);const H={};ae[0]&1024&&(H.isSwitchingMode=J[10]),!L&&ae[0]&512&&(L=!0,H.isPrivateMode=J[9],un(()=>L=!1)),A.$set(H);const ee={};ae[0]&16&&(ee.channels=J[4]),ae[0]&32&&(ee.isLoading=J[5]),K.$set(ee);const X={};ae[0]&4&&(X.pendingUserRegistrations=J[2]),ae[0]&32&&(X.isLoading=J[5]),G.$set(X);const pe={};ae[0]&1&&(pe.pendingRequests=J[0]),ae[0]&32&&(pe.isLoading=J[5]),O.$set(pe);const ge={};ae[0]&2&&(ge.pendingChannelJoinRequests=J[1]),ae[0]&32&&(ge.isLoading=J[5]),S.$set(ge)},i(J){M||(Be(q.$$.fragment,J),Be(A.$$.fragment,J),Be(K.$$.fragment,J),Be(G.$$.fragment,J),Be(F.$$.fragment,J),Be(O.$$.fragment,J),Be(S.$$.fragment,J),Be(E.$$.fragment,J),M=!0)},o(J){qe(q.$$.fragment,J),qe(A.$$.fragment,J),qe(K.$$.fragment,J),qe(G.$$.fragment,J),qe(F.$$.fragment,J),qe(O.$$.fragment,J),qe(S.$$.fragment,J),qe(E.$$.fragment,J),M=!1},d(J){J&&(u(e),u(t)),U&&U.d(),V&&V.d(),Je(q),Je(A),Je(K),Je(G),Je(F),Je(O),Je(S),Je(E)}}}function jl(n,e,t){let s,r;Rt(n,Pt,T=>t(35,s=T)),Rt(n,Gt,T=>t(36,r=T));let o=[],i=[],c=[],f=null,_=null,m=null,k={totalUsers:0,totalChannels:0,totalMessages:0,pendingApprovals:0},h=[],d=!1,b=null,w=null,D="disconnected",C=r.relayMode==="private",j=!1;async function B(){t(10,j=!0);const T=C?"private":"federated";Gt.setRelayMode(T);try{await wn(),s.privateKey&&await Wt(Qt,s.privateKey),t(8,D="connected")}catch(H){console.error("Failed to reconnect:",H),t(8,D="error")}finally{t(10,j=!1)}}async function q(){if(!s.privateKey){t(6,b="Please login first to access admin features");return}try{t(5,d=!0),t(6,b=null),kn()||await Wt(Qt,s.privateKey),t(8,D="connected"),t(4,h=await yn({isAdmin:!0})),t(3,k.totalChannels=h.length,k),await y(),await A(),await x(),f=rn(T=>{o.find(H=>H.id===T.id)||t(0,o=[T,...o])}),_=L(),m=K()}catch(T){t(6,b=T instanceof Error?T.message:"Failed to initialize admin"),t(8,D="error")}finally{t(5,d=!1)}}async function y(){try{const{fetchPendingRequests:T}=await dt(async()=>{const{fetchPendingRequests:H}=await Promise.resolve().then(()=>kt);return{fetchPendingRequests:H}},void 0,import.meta.url);t(0,o=await T())}catch(T){console.error("Failed to load pending requests:",T)}}async function A(){try{const T=He();if(!T)return;const H={kinds:[Xt],limit:100},ee=await T.fetchEvents(H),X={kinds:[$t],limit:500},pe=await T.fetchEvents(X),ge=new Set;for(const le of pe){const ce=le.tags.find(Te=>Te[0]==="h")?.[1],ke=le.tags.find(Te=>Te[0]==="p")?.[1];ce&&ke&&ge.add(`${ce}:${ke}`)}const be={kinds:[ut],limit:500},we=await T.fetchEvents(be),Me=new Set;for(const le of we)le.tags.filter(ke=>ke[0]==="e").map(ke=>ke[1]).forEach(ke=>Me.add(ke));const Y=[];for(const le of ee){if(Me.has(le.id))continue;const ce=le.tags.find(ke=>ke[0]==="h")?.[1]||"";ge.has(`${ce}:${le.pubkey}`)||Y.push({id:le.id,pubkey:le.pubkey,channelId:ce,createdAt:(le.created_at||0)*1e3,status:"pending",message:le.content||void 0})}Y.sort((le,ce)=>ce.createdAt-le.createdAt),t(1,i=Y)}catch(T){console.error("Failed to load channel join requests:",T)}}function L(){try{const T=He();if(!T)return null;const H={kinds:[Xt],since:Math.floor(Date.now()/1e3)},ee=T.subscribe(H,{closeOnEose:!1});return ee.on("event",X=>{const pe=X.tags.find(be=>be[0]==="h")?.[1]||"",ge={id:X.id,pubkey:X.pubkey,channelId:pe,createdAt:(X.created_at||0)*1e3,status:"pending",message:X.content||void 0};i.find(be=>be.id===ge.id)||t(1,i=[ge,...i])}),ee}catch(T){return console.error("Failed to subscribe to channel join requests:",T),null}}async function x(){try{const T=He();if(!T)return;const H={kinds:[es],limit:100},ee=await T.fetchEvents(H),X={kinds:[ut],limit:500},pe=await T.fetchEvents(X),ge=new Set;for(const we of pe)we.tags.filter(Y=>Y[0]==="e").map(Y=>Y[1]).forEach(Y=>ge.add(Y));const be=[];for(const we of ee){if(ge.has(we.id))continue;const Me=we.tags.find(Y=>Y[0]==="name");be.push({id:we.id,pubkey:we.pubkey,createdAt:(we.created_at||0)*1e3,status:"pending",displayName:Me?.[1]||void 0,message:we.content||void 0})}be.sort((we,Me)=>Me.createdAt-we.createdAt),t(2,c=be)}catch(T){console.error("Failed to load user registrations:",T)}}function K(){try{const T=He();if(!T)return null;const H={kinds:[es],since:Math.floor(Date.now()/1e3)},ee=T.subscribe(H,{closeOnEose:!1});return ee.on("event",X=>{const pe=X.tags.find(be=>be[0]==="name"),ge={id:X.id,pubkey:X.pubkey,createdAt:(X.created_at||0)*1e3,status:"pending",displayName:pe?.[1]||void 0,message:X.content||void 0};c.find(be=>be.id===ge.id)||t(2,c=[ge,...c])}),ee}catch(T){return console.error("Failed to subscribe to user registrations:",T),null}}async function Z(T){try{t(5,d=!0),t(6,b=null),t(7,w=null);const H=await mn(T.pubkey,s.publicKey||"");H.success||console.warn("[Admin] Whitelist API failed:",H.error);const ee=He();if(!ee||!ee.signer)throw new Error("No signer available");const X=new Qe(ee);X.kind=ut,X.tags=[["e",T.id]],X.content="Approved",await X.publish(),t(2,c=c.filter(pe=>pe.id!==T.id)),t(7,w="Approved user registration. User can now access the system."),setTimeout(()=>{t(7,w=null)},5e3)}catch(H){t(6,b=H instanceof Error?H.message:"Failed to approve registration")}finally{t(5,d=!1)}}async function G(T){try{t(5,d=!0),t(6,b=null);const H=He();if(!H||!H.signer)throw new Error("No signer available");const ee=new Qe(H);ee.kind=ut,ee.tags=[["e",T.id]],ee.content="Rejected by admin",await ee.publish(),t(2,c=c.filter(X=>X.id!==T.id))}catch(H){t(6,b=H instanceof Error?H.message:"Failed to reject registration")}finally{t(5,d=!1)}}async function te(T){try{t(5,d=!0),t(6,b=null),t(7,w=null);const H=await ln(T);if(H.success){t(0,o=o.filter(X=>X.id!==T.id));const ee=T.section&&ze[T.section]?.name||T.section||"Unknown Section";t(7,w=`Approved access to ${ee}. User has been notified.`),setTimeout(()=>{t(7,w=null)},5e3)}else t(6,b=H.error||"Failed to approve request")}catch(H){t(6,b=H instanceof Error?H.message:"Failed to approve request")}finally{t(5,d=!1)}}async function F(T){try{t(5,d=!0),await Ct.denyRequest(T,"Access denied by admin"),t(0,o=o.filter(H=>H.id!==T.id))}catch(H){t(6,b=H instanceof Error?H.message:"Failed to deny request")}finally{t(5,d=!1)}}async function z(T){try{t(5,d=!0),t(6,b=null),t(7,w=null);const H=He();if(!H||!H.signer)throw new Error("No signer available");const ee=new Qe(H);ee.kind=$t,ee.tags=[["h",T.channelId],["p",T.pubkey]],ee.content="",await ee.publish();const X=new Qe(H);X.kind=ut,X.tags=[["e",T.id]],X.content="Approved",await X.publish(),Tn.approveMember(T.channelId,T.pubkey),t(1,i=i.filter(be=>be.id!==T.id));const ge=h.find(be=>be.id===T.channelId)?.name||T.channelId.slice(0,8)+"...";t(7,w=`Approved join request for channel "${ge}". User has been added.`),setTimeout(()=>{t(7,w=null)},5e3)}catch(H){t(6,b=H instanceof Error?H.message:"Failed to approve join request")}finally{t(5,d=!1)}}async function O(T){try{t(5,d=!0),t(6,b=null);const H=He();if(!H||!H.signer)throw new Error("No signer available");const ee=new Qe(H);ee.kind=ut,ee.tags=[["e",T.id]],ee.content="Rejected by admin",await ee.publish(),t(1,i=i.filter(X=>X.id!==T.id))}catch(H){t(6,b=H instanceof Error?H.message:"Failed to reject join request")}finally{t(5,d=!1)}}function P(T){return h.find(ee=>ee.id===T)?.name||T.slice(0,12)+"..."}async function S(T){try{t(5,d=!0),t(6,b=null);const H=await En(T.detail);t(4,h=[H,...h]),t(3,k.totalChannels=h.length,k)}catch(H){t(6,b=H instanceof Error?H.message:"Failed to create channel")}finally{t(5,d=!1)}}Xs(async()=>{if(await Pt.waitForReady(),!s.publicKey){Dt(`${gt}/chat`);return}try{t(5,d=!0);const T=await vn(s.publicKey);if(gn.set(T),!T.isAdmin){t(6,b="Access denied: Admin privileges required"),setTimeout(()=>Dt(`${gt}/chat`),2e3);return}q()}catch{t(6,b="Failed to verify admin status"),setTimeout(()=>Dt(`${gt}/chat`),2e3)}}),fn(()=>{f&&(f.stop(),f=null),_&&(_.stop(),_=null),m&&(m.stop(),m=null)});const I=()=>t(6,b=null),E=()=>t(7,w=null);function M(T){C=T,t(9,C)}const U=T=>Z(T.detail),V=T=>G(T.detail),ie=T=>te(T.detail),re=T=>F(T.detail),J=T=>z(T.detail),ae=T=>O(T.detail);return n.$$.update=()=>{n.$$.dirty[0]&7&&t(3,k.pendingApprovals=o.length+i.length+c.length,k)},[o,i,c,k,h,d,b,w,D,C,j,B,y,A,x,Z,G,te,F,z,O,P,S,I,E,M,U,V,ie,re,J,ae]}class sr extends et{constructor(e){super(),tt(this,e,jl,Ul,Xe,{},null,[-1,-1])}}export{sr as component,tr as universal};
