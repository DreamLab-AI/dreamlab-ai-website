import{w as d,d as r}from"./xKPZ-4ZK.js";import{a as u}from"./DxD0Wn3l.js";import{verifyWhitelistStatus as c,createFallbackStatus as b}from"./BPZifr_e.js";import{profileCache as m}from"./D7m-JnSU.js";const n=d(null);function y(e){return{pubkey:e,name:null,displayName:null,avatar:null,about:null,cohorts:[],isAdmin:!1,isApproved:!1,nip05:null,lud16:null,website:null,banner:null,birthday:null,createdAt:null,updatedAt:null}}const o=r(u,(e,t)=>{if(e.state!=="authenticated"||!e.pubkey){t({profile:null,isLoading:!1,error:null});return}const a=y(e.pubkey);t({profile:a,isLoading:!0,error:null}),(async()=>{if(!e.pubkey){t({profile:a,isLoading:!1,error:null});return}let i;try{i=await c(e.pubkey),n.set(i),console.log("[User] Whitelist status verified:",{pubkey:e.pubkey?e.pubkey.slice(0,8)+"...":"unknown",isAdmin:i.isAdmin,source:i.source})}catch(s){console.warn("[User] Whitelist verification failed:",s),i=b(e.pubkey),n.set(i)}const f=[...i.cohorts];let l=null;try{l=await m.getProfile(e.pubkey)}catch(s){console.warn("[User] Profile fetch failed (non-fatal):",s)}const p={...a,name:l?.profile?.name??null,displayName:l?.displayName??null,avatar:l?.avatar??null,about:l?.about??null,nip05:l?.nip05??null,lud16:l?.profile?.lud16??null,website:l?.profile?.website??null,banner:l?.profile?.banner??null,birthday:l?.profile?.birthday??null,isAdmin:i.isAdmin,isApproved:i.isWhitelisted,cohorts:f,createdAt:Date.now(),updatedAt:Date.now()};t({profile:p,isLoading:!1,error:null})})()},{profile:null,isLoading:!1,error:null}),P=r(u,e=>e.state==="authenticated"&&e.pubkey!==null),S=r(o,e=>e.profile?.isAdmin??!1),g=r(n,e=>e?.isAdmin??!1),L=r(n,e=>e?.source??null),N=r(o,e=>e.profile?.isApproved??!1),D=r(u,e=>e.pubkey),W=r(o,e=>e.profile?.cohorts??[]),U=r(o,e=>e.profile?.displayName??e.profile?.name??null);export{W as currentCohorts,U as currentDisplayName,D as currentPubkey,S as isAdmin,g as isAdminVerified,N as isApproved,P as isAuthenticated,o as userStore,L as whitelistSource,n as whitelistStatusStore};
