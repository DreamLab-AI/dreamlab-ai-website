import{X as m,Y as _}from"./0ZVSoAEn.js";import{d}from"./6Pu-XtiL.js";function v(e){const t=e-1;return t*t*t+1}function U(e,{delay:t=0,duration:n=400,easing:a=_}={}){const o=+getComputedStyle(e).opacity;return{delay:t,duration:n,easing:a,css:s=>`opacity: ${s*o}`}}function N(e,{delay:t=0,duration:n=400,easing:a=v,x:o=0,y:s=0,opacity:i=0}={}){const r=getComputedStyle(e),c=+r.opacity,u=r.transform==="none"?"":r.transform,l=c*(1-i),[g,f]=m(o),[w,S]=m(s);return{delay:t,duration:n,easing:a,css:(p,h)=>`
			transform: ${u} translate(${(1-p)*g}${f}, ${(1-p)*w}${S});
			opacity: ${c-l*h}`}}function T(e,{delay:t=0,duration:n=400,easing:a=v,start:o=0,opacity:s=0}={}){const i=getComputedStyle(e),r=+i.opacity,c=i.transform==="none"?"":i.transform,u=1-o,l=r*(1-s);return{delay:t,duration:n,easing:a,css:(g,f)=>`
			transform: ${c} scale(${1-u*f});
			opacity: ${r-l*f}
		`}}const y="https://storage.googleapis.com/Nostr-BBS-vectors",b="embedding_sync_preference";function $(){if(typeof navigator>"u")return!1;const e=navigator.userAgent;return/Safari/.test(e)&&!/Chrome|CriOS|Edg/.test(e)}function x(){return typeof navigator>"u"?!1:/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}function E(){return typeof localStorage>"u"?null:localStorage.getItem(b)}function B(){if(typeof navigator>"u")return!1;const e=E();if(e==="always")return!0;if(e==="manual")return!1;const t=navigator.connection;if(!t)return x()?!1:($(),!0);const n=t.type;return n==="wifi"||n==="ethernet"||t.effectiveType==="4g"&&!t.saveData||t.metered===!1}async function C(){try{const e=await fetch(`${y}/latest/manifest.json`,{cache:"no-cache"});return e.ok?await e.json():(console.warn("Failed to fetch embedding manifest:",e.status),null)}catch(e){return console.warn("Error fetching embedding manifest:",e),null}}async function k(){try{return(await d.table("metadata").get("embedding_sync_state"))?.value??null}catch{return null}}async function F(e){await d.table("metadata").put({key:"embedding_sync_state",value:e})}async function P(e){try{console.log(`Downloading HNSW index (${(e.index_size_bytes/1024/1024).toFixed(1)} MB)...`);const t=await fetch(`${y}/${e.latest.index}`);if(!t.ok)throw new Error("Failed to download index");const n=await t.arrayBuffer(),a=await fetch(`${y}/${e.latest.index_mapping}`);if(!a.ok)throw new Error("Failed to download mapping");const o=await a.arrayBuffer();return await d.table("embeddings").put({key:"hnsw_index",data:n,version:e.version}),await d.table("embeddings").put({key:"index_mapping",data:o,version:e.version}),console.log("Index downloaded and stored"),!0}catch(t){return console.error("Error downloading index:",t),!1}}async function A(e=!1){if(!e&&!B())return console.log("Skipping embedding sync (not on WiFi)"),{synced:!1,version:0};const n=(await k())?.version||0,a=await C();return a?!e&&a.version<=n?(console.log(`Embeddings up to date (v${n})`),{synced:!1,version:n}):(console.log(`Updating embeddings: v${n} -> v${a.version}`),await P(a)?(await F({version:a.version,lastSynced:Date.now(),indexLoaded:!1}),{synced:!0,version:a.version}):{synced:!1,version:n}):{synced:!1,version:n}}export{U as a,B as b,v as c,A as d,N as f,k as g,T as s};
