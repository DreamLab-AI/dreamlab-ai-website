import{B as We,s as Nt,n as ne,d as h,i as S,x as Ue,k as Mt,C as Sn,a as ve,A as St,b as d,q as ce,l as o,c as b,e as v,g as D,u as K,f as Z,h as y,j as L,v as j,t as Q,Z as yn,r as Ct,o as le,D as kn,z as nn,y as En,w as Ke,T as Cr,p as Cn,ag as Gn,K as hn,E as mr,m as Dr,P as es,U as Lr}from"../chunks/0ZVSoAEn.js";import{S as Rt,i as Pt,t as _e,a as ae,g as bt,c as yt,d as ut,m as ft,b as dt,e as ht}from"../chunks/DKVmOqaf.js";import{g as Nr}from"../chunks/D0QH3NT1.js";import{e as nt,u as vr,d as Rr,o as Pr}from"../chunks/m0NROLOn.js";import{g as ts}from"../chunks/CTVLmyHZ.js";import{p as Or}from"../chunks/BdMR7A5I.js";import{w as pn,d as mn,b as ns}from"../chunks/xKPZ-4ZK.js";import{q as ss,u as Kn,n as Dn,h as dn,N as Zn,a as Lt,s as xr,L as rs,M as gr,j as Br,g as Ur,b as Hr,c as Vr,e as zr}from"../chunks/DxD0Wn3l.js";import{isAdmin as wn,whitelistStatusStore as ls}from"../chunks/CF3XGpNG.js";import{a as Fr,b as Gr,s as Kr,d as jr}from"../chunks/BqFahvin.js";import{l as is}from"../chunks/CVI4yqfx.js";import{profileCache as Zt}from"../chunks/D7m-JnSU.js";import{c as Nn,A as _r}from"../chunks/CH2AtOeB.js";import{u as Yr,U as br,c as Wr,g as Xr}from"../chunks/DaQoddso.js";import{t as Yt}from"../chunks/C5DPgcI1.js";import{KIND_DELETE_EVENT as qr}from"../chunks/Bk9P-LIi.js";import{B as Jr}from"../chunks/eGtfPii9.js";const Tn={METADATA:0,SHORT_TEXT_NOTE:1,TEXT_NOTE:1,RECOMMEND_RELAY:2,CONTACTS:3,ENCRYPTED_DM:4,DELETION:5,REPOST:6,REACTION:7,BADGE_AWARD:8,CHANNEL_CREATE:40,CHANNEL_METADATA:41,CHANNEL_MESSAGE:42,CHANNEL_HIDE:43,CHANNEL_MUTE:44,REPORT:1984,ZAP_REQUEST:9734,ZAP_RECEIPT:9735,MUTE_LIST:1e4,RELAY_LIST:10002,AUTH:22242,GIFT_WRAP:1059,SEALED:13},Zr=256,os=12,vn=16;class Xt extends Error{constructor(e,n){super(e),this.code=n,this.name="ImageEncryptionError"}}function Qr(){return typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof crypto.getRandomValues<"u"}async function $r(r){const e=new ArrayBuffer(r.length);return new Uint8Array(e).set(r),crypto.subtle.importKey("raw",e,{name:"AES-GCM",length:Zr},!1,["encrypt","decrypt"])}async function el(r,e){if(!Qr())throw new Xt("Web Crypto API not available","CRYPTO_UNAVAILABLE");if(e.length!==32)throw new Xt("Key must be 32 bytes (256 bits)","INVALID_KEY_LENGTH");const n=new Uint8Array(r);n.slice(0,vn);const t=n.slice(vn,vn+os),s=n.slice(vn+os),l=await $r(e);try{const i=await crypto.subtle.decrypt({name:"AES-GCM",iv:t},l,s);return new Blob([i])}catch{throw new Xt("Decryption failed - invalid key or corrupted data","DECRYPTION_FAILED")}}async function tl(r,e,n){try{if(!/^[0-9a-f]{64}$/i.test(e))throw new Xt("Invalid sender pubkey format","INVALID_SENDER_PUBKEY");if(!/^[0-9a-f]{64}$/i.test(n))throw new Xt("Invalid recipient privkey format","INVALID_RECIPIENT_PRIVKEY");const t=ss.v2.utils.getConversationKey(Kn.hexToBytes(n),e),s=ss.v2.decrypt(r,t);return Kn.hexToBytes(s)}catch(t){throw t instanceof Xt?t:new Xt("Failed to decrypt image key","KEY_DECRYPTION_FAILED")}}async function nl(r,e,n,t){const s=await tl(e,n,t);return el(r,s)}const sl=!1,rl=async({params:r})=>({channelId:r.channelId,channel:null,messages:[]}),na=Object.freeze(Object.defineProperty({__proto__:null,load:rl,prerender:sl},Symbol.toStringTag,{value:"Module"})),yr="Nostr-BBS-pinned-messages",Rn=5,kr=30001;function ll(){if(typeof window>"u")return{};try{const r=localStorage.getItem(yr);return r?JSON.parse(r):{}}catch(r){return console.error("Failed to load pinned messages from storage:",r),{}}}function Pn(r){if(!(typeof window>"u"))try{localStorage.setItem(yr,JSON.stringify(r))}catch(e){console.error("Failed to save pinned messages to storage:",e)}}function il(){const{subscribe:r,set:e,update:n}=pn(ll());return{subscribe:r,init:async()=>{},fetchPinnedMessages:async t=>{const s=Dn();if(s)try{const l={kinds:[kr],"#d":[`pinned:${t}`],limit:1},i=await s.fetchEvents(l);if(i.size>0){const u=Array.from(i).sort((f,c)=>c.created_at-f.created_at)[0].tags.filter(f=>f[0]==="e").map(f=>f[1]);n(f=>{const c={...f,[t]:u};return Pn(c),c})}}catch(l){console.error(`Failed to fetch pinned messages for ${t}:`,l)}},pinMessage:async(t,s)=>{if(!We(wn))return console.warn("Only admins can pin messages"),!1;const a=We({subscribe:r})[t]||[];if(a.includes(s))return console.warn("Message is already pinned"),!0;if(a.length>=Rn)return console.warn(`Cannot pin more than ${Rn} messages per channel`),!1;const u=[...a,s];return await as(t,u)?(n(c=>{const p={...c,[t]:u};return Pn(p),p}),!0):(console.error("Failed to publish pin to relay"),!1)},unpinMessage:async(t,s)=>{if(!We(wn))return console.warn("Only admins can unpin messages"),!1;const a=We({subscribe:r})[t]||[];if(!a.includes(s))return console.warn("Message is not pinned"),!0;const u=a.filter(c=>c!==s);return await as(t,u)?(n(c=>{const p={...c,[t]:u};return Pn(p),p}),!0):(console.error("Failed to publish unpin to relay"),!1)},isPinned:(t,s)=>(We({subscribe:r})[t]||[]).includes(s),getPinnedMessages:t=>We({subscribe:r})[t]||[],canPinMore:t=>(We({subscribe:r})[t]||[]).length<Rn}}async function as(r,e){if(!dn())return console.error("Cannot publish pins: Not connected to relay"),!1;const n=Dn();if(!n||!n.signer)return console.error("Cannot publish pins: NDK not initialized or no signer"),!1;try{const t=new Zn(n);return t.kind=kr,t.tags=[["d",`pinned:${r}`],["h",r],...e.map(s=>["e",s])],await t.publish(),!0}catch(t){return console.error("Failed to publish pinned messages list:",t),!1}}const qt=il();function ol(r){return setTimeout(()=>qt.fetchPinnedMessages(r),0),mn(qt,e=>e[r]||[])}function al(r,e){return mn(qt,n=>(n[r]||[]).includes(e))}function cs(r,e,n){const t=r.slice();return t[17]=e[n],t}function us(r){let e,n,t,s,l,i,a,u,f,c,p,g=r[0].length+"",_,E,w,k,T,I=[],R=new Map,O,Y,M=nt(r[0]);const A=B=>B[17].id;for(let B=0;B<M.length;B+=1){let x=cs(r,M,B),J=A(x);R.set(J,I[B]=ds(J,x))}return{c(){e=y("div"),n=y("div"),t=y("div"),s=y("input"),l=L(),i=y("div"),a=j("svg"),u=j("path"),f=L(),c=y("span"),p=Q("Pinned Messages ("),_=Q(g),E=Q(")"),w=L(),k=y("div"),T=y("div");for(let B=0;B<I.length;B+=1)I[B].c();this.h()},l(B){e=b(B,"DIV",{class:!0});var x=v(e);n=b(x,"DIV",{class:!0});var J=v(n);t=b(J,"DIV",{class:!0});var G=v(t);s=b(G,"INPUT",{type:!0,class:!0}),l=D(G),i=b(G,"DIV",{class:!0});var V=v(i);a=K(V,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var W=v(a);u=K(W,"path",{d:!0}),v(u).forEach(h),W.forEach(h),f=D(V),c=b(V,"SPAN",{class:!0});var U=v(c);p=Z(U,"Pinned Messages ("),_=Z(U,g),E=Z(U,")"),U.forEach(h),V.forEach(h),w=D(G),k=b(G,"DIV",{class:!0});var ie=v(k);T=b(ie,"DIV",{class:!0});var ee=v(T);for(let Re=0;Re<I.length;Re+=1)I[Re].l(ee);ee.forEach(h),ie.forEach(h),G.forEach(h),J.forEach(h),x.forEach(h),this.h()},h(){o(s,"type","checkbox"),o(s,"class","min-h-0"),o(u,"d","M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z"),o(a,"xmlns","http://www.w3.org/2000/svg"),o(a,"class","h-5 w-5 text-warning"),o(a,"viewBox","0 0 20 20"),o(a,"fill","currentColor"),o(c,"class","font-semibold text-sm"),o(i,"class","collapse-title min-h-0 py-3 px-4 flex items-center gap-2 svelte-e5oa2s"),o(T,"class","space-y-2"),o(k,"class","collapse-content px-4 pb-3 pt-0"),o(t,"class","collapse collapse-arrow"),St(t,"collapse-open",r[1]),St(t,"collapse-close",!r[1]),o(n,"class","container mx-auto max-w-4xl"),o(e,"class","bg-base-200 border-b border-base-300")},m(B,x){S(B,e,x),d(e,n),d(n,t),d(t,s),s.checked=r[1],d(t,l),d(t,i),d(i,a),d(a,u),d(i,f),d(i,c),d(c,p),d(c,_),d(c,E),d(t,w),d(t,k),d(k,T);for(let J=0;J<I.length;J+=1)I[J]&&I[J].m(T,null);O||(Y=ce(s,"change",r[12]),O=!0)},p(B,x){x&2&&(s.checked=B[1]),x&1&&g!==(g=B[0].length+"")&&ve(_,g),x&241&&(M=nt(B[0]),I=vr(I,x,A,1,B,M,R,T,Rr,ds,null,cs)),x&2&&St(t,"collapse-open",B[1]),x&2&&St(t,"collapse-close",!B[1])},d(B){B&&h(e);for(let x=0;x<I.length;x+=1)I[x].d();O=!1,Y()}}}function cl(r){let e,n="Encrypted message";return{c(){e=y("span"),e.textContent=n,this.h()},l(t){e=b(t,"SPAN",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-1apnv1n"&&(e.textContent=n),this.h()},h(){o(e,"class","italic opacity-70")},m(t,s){S(t,e,s)},p:ne,d(t){t&&h(e)}}}function ul(r){let e=An(r[17].content)+"",n;return{c(){n=Q(e)},l(t){n=Z(t,e)},m(t,s){S(t,n,s)},p(t,s){s&1&&e!==(e=An(t[17].content)+"")&&ve(n,e)},d(t){t&&h(n)}}}function fl(r){let e=An(r[17].decryptedContent)+"",n;return{c(){n=Q(e)},l(t){n=Z(t,e)},m(t,s){S(t,n,s)},p(t,s){s&1&&e!==(e=An(t[17].decryptedContent)+"")&&ve(n,e)},d(t){t&&h(n)}}}function fs(r){let e,n='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>',t,s;function l(){return r[13](r[17])}return{c(){e=y("button"),e.innerHTML=n,this.h()},l(i){e=b(i,"BUTTON",{class:!0,"aria-label":!0,title:!0,"data-svelte-h":!0}),le(e)!=="svelte-78sxea"&&(e.innerHTML=n),this.h()},h(){o(e,"class","btn btn-ghost btn-xs opacity-30 group-hover:opacity-100 transition-opacity flex-shrink-0"),o(e,"aria-label","Unpin message"),o(e,"title","Unpin message")},m(i,a){S(i,e,a),t||(s=ce(e,"click",kn(l)),t=!0)},p(i,a){r=i},d(i){i&&h(e),t=!1,s()}}}function ds(r,e){let n,t,s,l='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-warning" viewBox="0 0 20 20" fill="currentColor"><path d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z"></path></svg>',i,a,u,f,c=e[7](e[17].authorPubkey)+"",p,g,_,E=hs(e[17].createdAt)+"",w,k,T,I,R,O,Y;function M(V,W){return V[17].isEncrypted&&V[17].decryptedContent?fl:V[17].isEncrypted?cl:ul}let A=M(e),B=A(e),x=e[4]&&fs(e);function J(){return e[14](e[17])}function G(...V){return e[15](e[17],...V)}return{key:r,first:null,c(){n=y("div"),t=y("div"),s=y("div"),s.innerHTML=l,i=L(),a=y("div"),u=y("div"),f=y("span"),p=Q(c),g=L(),_=y("span"),w=Q(E),k=L(),T=y("p"),B.c(),I=L(),x&&x.c(),R=L(),this.h()},l(V){n=b(V,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0});var W=v(n);t=b(W,"DIV",{class:!0});var U=v(t);s=b(U,"DIV",{class:!0,"data-svelte-h":!0}),le(s)!=="svelte-r1jnbg"&&(s.innerHTML=l),i=D(U),a=b(U,"DIV",{class:!0});var ie=v(a);u=b(ie,"DIV",{class:!0});var ee=v(u);f=b(ee,"SPAN",{class:!0});var Re=v(f);p=Z(Re,c),Re.forEach(h),g=D(ee),_=b(ee,"SPAN",{class:!0});var ue=v(_);w=Z(ue,E),ue.forEach(h),ee.forEach(h),k=D(ie),T=b(ie,"P",{class:!0});var be=v(T);B.l(be),be.forEach(h),ie.forEach(h),I=D(U),x&&x.l(U),U.forEach(h),R=D(W),W.forEach(h),this.h()},h(){o(s,"class","flex-shrink-0"),o(f,"class","font-semibold text-sm"),o(_,"class","text-xs text-base-content/60"),o(u,"class","flex items-baseline gap-2 mb-1"),o(T,"class","text-sm text-base-content/80 break-words"),o(a,"class","flex-1 min-w-0"),o(t,"class","flex items-start gap-3"),o(n,"class","bg-base-100 rounded-lg p-3 border border-warning/20 hover:border-warning/40 transition-colors cursor-pointer group"),o(n,"role","button"),o(n,"tabindex","0"),o(n,"aria-label","Jump to pinned message"),this.first=n},m(V,W){S(V,n,W),d(n,t),d(t,s),d(t,i),d(t,a),d(a,u),d(u,f),d(f,p),d(u,g),d(u,_),d(_,w),d(a,k),d(a,T),B.m(T,null),d(t,I),x&&x.m(t,null),d(n,R),O||(Y=[ce(n,"click",J),ce(n,"keydown",G)],O=!0)},p(V,W){e=V,W&1&&c!==(c=e[7](e[17].authorPubkey)+"")&&ve(p,c),W&1&&E!==(E=hs(e[17].createdAt)+"")&&ve(w,E),A===(A=M(e))&&B?B.p(e,W):(B.d(1),B=A(e),B&&(B.c(),B.m(T,null))),e[4]?x?x.p(e,W):(x=fs(e),x.c(),x.m(t,null)):x&&(x.d(1),x=null)},d(V){V&&h(n),B.d(),x&&x.d(),O=!1,Ct(Y)}}}function dl(r){let e,n=r[2]&&us(r);return{c(){n&&n.c(),e=Ue()},l(t){n&&n.l(t),e=Ue()},m(t,s){n&&n.m(t,s),S(t,e,s)},p(t,[s]){t[2]?n?n.p(t,s):(n=us(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ne,o:ne,d(t){t&&h(e),n&&n.d(t)}}}function An(r,e=80){return r.length<=e?r:r.slice(0,e)+"..."}function hs(r){return new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function hl(r,e,n){let t,s,l,i,a,u=ne,f=()=>(u(),u=yn(t,M=>n(11,a=M)),t),c;Mt(r,Lt,M=>n(10,i=M)),Mt(r,wn,M=>n(4,c=M)),r.$$.on_destroy.push(()=>u());let{channelId:p}=e,{messages:g}=e;const _=Sn();let E=!0;async function w(M){await qt.unpinMessage(p,M)&&_("unpin",{messageId:M})}function k(M){_("scrollTo",{messageId:M})}function T(M){return i.publicKey===M?"You":Zt.getCachedSync(M)?.displayName||M.slice(0,8)+"..."+M.slice(-4)}function I(){E=this.checked,n(1,E)}const R=M=>w(M.id),O=M=>k(M.id),Y=(M,A)=>(A.key==="Enter"||A.key===" ")&&(A.preventDefault(),k(M.id));return r.$$set=M=>{"channelId"in M&&n(8,p=M.channelId),"messages"in M&&n(9,g=M.messages)},r.$$.update=()=>{if(r.$$.dirty&256&&f(n(3,t=ol(p))),r.$$.dirty&2560&&n(0,s=g.filter(M=>a.includes(M.id))),r.$$.dirty&1&&n(2,l=s.length>0),r.$$.dirty&1025&&s.length>0){const M=s.map(A=>A.authorPubkey).filter(A=>A!==i.publicKey);M.length>0&&Zt.prefetchProfiles(M)}},[s,E,l,t,c,w,k,T,p,g,i,a,I,R,O,Y]}class pl extends Rt{constructor(e){super(),Pt(this,e,hl,dl,Nt,{channelId:8,messages:9})}}function ps(r,e,n){const t=r.slice();t[7]=e[n];const s=Math.max(...t[1].activityByHour.map(i=>i.count));t[8]=s;const l=t[8]>0?t[7].count/t[8]*100:0;return t[9]=l,t}function ms(r,e,n){const t=r.slice();t[12]=e[n],t[17]=n;const s=Zt.getCachedSync(t[12].pubkey);t[13]=s;const l=t[13]?.displayName||t[12].name||`${t[12].pubkey.slice(0,8)}...`;t[14]=l;const i=t[13]?.avatar||t[12].avatar;return t[15]=i,t}function vs(r){let e,n,t,s;const l=[gl,vl,ml],i=[];function a(u,f){return u[2]?0:u[3]?1:u[1]?2:-1}return~(n=a(r))&&(t=i[n]=l[n](r)),{c(){e=y("div"),t&&t.c(),this.h()},l(u){e=b(u,"DIV",{class:!0});var f=v(e);t&&t.l(f),f.forEach(h),this.h()},h(){o(e,"class","channel-stats svelte-1p16fog")},m(u,f){S(u,e,f),~n&&i[n].m(e,null),s=!0},p(u,f){let c=n;n=a(u),n===c?~n&&i[n].p(u,f):(t&&(bt(),_e(i[c],1,1,()=>{i[c]=null}),yt()),~n?(t=i[n],t?t.p(u,f):(t=i[n]=l[n](u),t.c()),ae(t,1),t.m(e,null)):t=null)},i(u){s||(ae(t),s=!0)},o(u){_e(t),s=!1},d(u){u&&h(e),~n&&i[n].d()}}}function ml(r){let e,n,t,s="Channel Statistics",l,i,a='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>',u,f,c,p,g='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>',_,E,w,k=ks(r[1].messageCount)+"",T,I,R,O="Total Messages",Y,M,A,B='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>',x,J,G,V=r[1].uniquePosters+"",W,U,ie,ee="Active Members",Re,ue,be,$='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>',z,he,N,te=r[1].avgMessagesPerDay.toFixed(1)+"",fe,Ze,re,Ve="Messages/Day",Pe,Ce,Me,we='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>',je,Le,He,pe=In(r[1].peakHour)+"",ye,Se,Te,De="Peak Hour",ke,Ae,P,se="Activity Trend (Last 7 Days)",oe,H,q,Oe,Ee,ze,Xe="Activity by Hour",st,rt,pt,Fe,qe,$e,wt,Tt=new Date(r[1].lastUpdated).toLocaleString()+"",mt,Ye,Ot,xt;H=new _r({props:{data:r[1].activityByDay,days:7}});let Je=r[1].topPosters.length>0&&gs(r),Bt=nt(r[1].activityByHour),me=[];for(let ge=0;ge<Bt.length;ge+=1)me[ge]=bs(ps(r,Bt,ge));let Ne=r[1].memberGrowth.length>0&&ys(r);return{c(){e=y("div"),n=y("div"),t=y("h3"),t.textContent=s,l=L(),i=y("button"),i.innerHTML=a,u=L(),f=y("div"),c=y("div"),p=y("div"),p.innerHTML=g,_=L(),E=y("div"),w=y("div"),T=Q(k),I=L(),R=y("div"),R.textContent=O,Y=L(),M=y("div"),A=y("div"),A.innerHTML=B,x=L(),J=y("div"),G=y("div"),W=Q(V),U=L(),ie=y("div"),ie.textContent=ee,Re=L(),ue=y("div"),be=y("div"),be.innerHTML=$,z=L(),he=y("div"),N=y("div"),fe=Q(te),Ze=L(),re=y("div"),re.textContent=Ve,Pe=L(),Ce=y("div"),Me=y("div"),Me.innerHTML=we,je=L(),Le=y("div"),He=y("div"),ye=Q(pe),Se=L(),Te=y("div"),Te.textContent=De,ke=L(),Ae=y("div"),P=y("h4"),P.textContent=se,oe=L(),ht(H.$$.fragment),q=L(),Je&&Je.c(),Oe=L(),Ee=y("div"),ze=y("h4"),ze.textContent=Xe,st=L(),rt=y("div");for(let ge=0;ge<me.length;ge+=1)me[ge].c();pt=L(),Ne&&Ne.c(),Fe=L(),qe=y("div"),$e=y("span"),wt=Q("Last updated: "),mt=Q(Tt),this.h()},l(ge){e=b(ge,"DIV",{class:!0});var Ie=v(e);n=b(Ie,"DIV",{class:!0});var et=v(n);t=b(et,"H3",{class:!0,"data-svelte-h":!0}),le(t)!=="svelte-wjtcmm"&&(t.textContent=s),l=D(et),i=b(et,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),le(i)!=="svelte-1i0imug"&&(i.innerHTML=a),et.forEach(h),u=D(Ie),f=b(Ie,"DIV",{class:!0});var xe=v(f);c=b(xe,"DIV",{class:!0});var At=v(c);p=b(At,"DIV",{class:!0,"data-svelte-h":!0}),le(p)!=="svelte-1tvwkz8"&&(p.innerHTML=g),_=D(At),E=b(At,"DIV",{class:!0});var Qt=v(E);w=b(Qt,"DIV",{class:!0});var ct=v(w);T=Z(ct,k),ct.forEach(h),I=D(Qt),R=b(Qt,"DIV",{class:!0,"data-svelte-h":!0}),le(R)!=="svelte-1h50s8y"&&(R.textContent=O),Qt.forEach(h),At.forEach(h),Y=D(xe),M=b(xe,"DIV",{class:!0});var vt=v(M);A=b(vt,"DIV",{class:!0,"data-svelte-h":!0}),le(A)!=="svelte-5no1ux"&&(A.innerHTML=B),x=D(vt),J=b(vt,"DIV",{class:!0});var zt=v(J);G=b(zt,"DIV",{class:!0});var sn=v(G);W=Z(sn,V),sn.forEach(h),U=D(zt),ie=b(zt,"DIV",{class:!0,"data-svelte-h":!0}),le(ie)!=="svelte-d85fa1"&&(ie.textContent=ee),zt.forEach(h),vt.forEach(h),Re=D(xe),ue=b(xe,"DIV",{class:!0});var Ut=v(ue);be=b(Ut,"DIV",{class:!0,"data-svelte-h":!0}),le(be)!=="svelte-1svbi9h"&&(be.innerHTML=$),z=D(Ut),he=b(Ut,"DIV",{class:!0});var Ft=v(he);N=b(Ft,"DIV",{class:!0});var gt=v(N);fe=Z(gt,te),gt.forEach(h),Ze=D(Ft),re=b(Ft,"DIV",{class:!0,"data-svelte-h":!0}),le(re)!=="svelte-1fdzrrl"&&(re.textContent=Ve),Ft.forEach(h),Ut.forEach(h),Pe=D(xe),Ce=b(xe,"DIV",{class:!0});var Gt=v(Ce);Me=b(Gt,"DIV",{class:!0,"data-svelte-h":!0}),le(Me)!=="svelte-agj8wc"&&(Me.innerHTML=we),je=D(Gt),Le=b(Gt,"DIV",{class:!0});var Kt=v(Le);He=b(Kt,"DIV",{class:!0});var rn=v(He);ye=Z(rn,pe),rn.forEach(h),Se=D(Kt),Te=b(Kt,"DIV",{class:!0,"data-svelte-h":!0}),le(Te)!=="svelte-1sn6ndz"&&(Te.textContent=De),Kt.forEach(h),Gt.forEach(h),xe.forEach(h),ke=D(Ie),Ae=b(Ie,"DIV",{class:!0});var jt=v(Ae);P=b(jt,"H4",{class:!0,"data-svelte-h":!0}),le(P)!=="svelte-vuppev"&&(P.textContent=se),oe=D(jt),dt(H.$$.fragment,jt),jt.forEach(h),q=D(Ie),Je&&Je.l(Ie),Oe=D(Ie),Ee=b(Ie,"DIV",{class:!0});var $t=v(Ee);ze=b($t,"H4",{class:!0,"data-svelte-h":!0}),le(ze)!=="svelte-1gud1x2"&&(ze.textContent=Xe),st=D($t),rt=b($t,"DIV",{class:!0});var X=v(rt);for(let F=0;F<me.length;F+=1)me[F].l(X);X.forEach(h),$t.forEach(h),pt=D(Ie),Ne&&Ne.l(Ie),Fe=D(Ie),qe=b(Ie,"DIV",{class:!0});var m=v(qe);$e=b(m,"SPAN",{class:!0});var C=v($e);wt=Z(C,"Last updated: "),mt=Z(C,Tt),C.forEach(h),m.forEach(h),Ie.forEach(h),this.h()},h(){o(t,"class","svelte-1p16fog"),o(i,"class","refresh-button svelte-1p16fog"),o(i,"title","Refresh statistics"),o(n,"class","stats-header svelte-1p16fog"),o(p,"class","metric-icon messages svelte-1p16fog"),o(w,"class","metric-value svelte-1p16fog"),o(R,"class","metric-label svelte-1p16fog"),o(E,"class","metric-content svelte-1p16fog"),o(c,"class","metric-card svelte-1p16fog"),o(A,"class","metric-icon members svelte-1p16fog"),o(G,"class","metric-value svelte-1p16fog"),o(ie,"class","metric-label svelte-1p16fog"),o(J,"class","metric-content svelte-1p16fog"),o(M,"class","metric-card svelte-1p16fog"),o(be,"class","metric-icon activity svelte-1p16fog"),o(N,"class","metric-value svelte-1p16fog"),o(re,"class","metric-label svelte-1p16fog"),o(he,"class","metric-content svelte-1p16fog"),o(ue,"class","metric-card svelte-1p16fog"),o(Me,"class","metric-icon peak svelte-1p16fog"),o(He,"class","metric-value svelte-1p16fog"),o(Te,"class","metric-label svelte-1p16fog"),o(Le,"class","metric-content svelte-1p16fog"),o(Ce,"class","metric-card svelte-1p16fog"),o(f,"class","metrics-grid svelte-1p16fog"),o(P,"class","svelte-1p16fog"),o(Ae,"class","section svelte-1p16fog"),o(ze,"class","svelte-1p16fog"),o(rt,"class","heatmap svelte-1p16fog"),o(Ee,"class","section svelte-1p16fog"),o($e,"class","last-updated svelte-1p16fog"),o(qe,"class","stats-footer svelte-1p16fog"),o(e,"class","stats-container svelte-1p16fog")},m(ge,Ie){S(ge,e,Ie),d(e,n),d(n,t),d(n,l),d(n,i),d(e,u),d(e,f),d(f,c),d(c,p),d(c,_),d(c,E),d(E,w),d(w,T),d(E,I),d(E,R),d(f,Y),d(f,M),d(M,A),d(M,x),d(M,J),d(J,G),d(G,W),d(J,U),d(J,ie),d(f,Re),d(f,ue),d(ue,be),d(ue,z),d(ue,he),d(he,N),d(N,fe),d(he,Ze),d(he,re),d(f,Pe),d(f,Ce),d(Ce,Me),d(Ce,je),d(Ce,Le),d(Le,He),d(He,ye),d(Le,Se),d(Le,Te),d(e,ke),d(e,Ae),d(Ae,P),d(Ae,oe),ft(H,Ae,null),d(e,q),Je&&Je.m(e,null),d(e,Oe),d(e,Ee),d(Ee,ze),d(Ee,st),d(Ee,rt);for(let et=0;et<me.length;et+=1)me[et]&&me[et].m(rt,null);d(e,pt),Ne&&Ne.m(e,null),d(e,Fe),d(e,qe),d(qe,$e),d($e,wt),d($e,mt),Ye=!0,Ot||(xt=ce(i,"click",r[4]),Ot=!0)},p(ge,Ie){(!Ye||Ie&2)&&k!==(k=ks(ge[1].messageCount)+"")&&ve(T,k),(!Ye||Ie&2)&&V!==(V=ge[1].uniquePosters+"")&&ve(W,V),(!Ye||Ie&2)&&te!==(te=ge[1].avgMessagesPerDay.toFixed(1)+"")&&ve(fe,te),(!Ye||Ie&2)&&pe!==(pe=In(ge[1].peakHour)+"")&&ve(ye,pe);const et={};if(Ie&2&&(et.data=ge[1].activityByDay),H.$set(et),ge[1].topPosters.length>0?Je?Je.p(ge,Ie):(Je=gs(ge),Je.c(),Je.m(e,Oe)):Je&&(Je.d(1),Je=null),Ie&2){Bt=nt(ge[1].activityByHour);let xe;for(xe=0;xe<Bt.length;xe+=1){const At=ps(ge,Bt,xe);me[xe]?me[xe].p(At,Ie):(me[xe]=bs(At),me[xe].c(),me[xe].m(rt,null))}for(;xe<me.length;xe+=1)me[xe].d(1);me.length=Bt.length}ge[1].memberGrowth.length>0?Ne?(Ne.p(ge,Ie),Ie&2&&ae(Ne,1)):(Ne=ys(ge),Ne.c(),ae(Ne,1),Ne.m(e,Fe)):Ne&&(bt(),_e(Ne,1,1,()=>{Ne=null}),yt()),(!Ye||Ie&2)&&Tt!==(Tt=new Date(ge[1].lastUpdated).toLocaleString()+"")&&ve(mt,Tt)},i(ge){Ye||(ae(H.$$.fragment,ge),ae(Ne),Ye=!0)},o(ge){_e(H.$$.fragment,ge),_e(Ne),Ye=!1},d(ge){ge&&h(e),ut(H),Je&&Je.d(),nn(me,ge),Ne&&Ne.d(),Ot=!1,xt()}}}function vl(r){let e,n,t,s,l,i="Retry",a,u;return{c(){e=y("div"),n=y("p"),t=Q(r[3]),s=L(),l=y("button"),l.textContent=i,this.h()},l(f){e=b(f,"DIV",{class:!0});var c=v(e);n=b(c,"P",{class:!0});var p=v(n);t=Z(p,r[3]),p.forEach(h),s=D(c),l=b(c,"BUTTON",{class:!0,"data-svelte-h":!0}),le(l)!=="svelte-794okw"&&(l.textContent=i),c.forEach(h),this.h()},h(){o(n,"class","error-message svelte-1p16fog"),o(l,"class","retry-button svelte-1p16fog"),o(e,"class","error-state svelte-1p16fog")},m(f,c){S(f,e,c),d(e,n),d(n,t),d(e,s),d(e,l),a||(u=ce(l,"click",r[4]),a=!0)},p(f,c){c&8&&ve(t,f[3])},i:ne,o:ne,d(f){f&&h(e),a=!1,u()}}}function gl(r){let e,n='<div class="spinner svelte-1p16fog"></div> <p>Loading statistics...</p>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-13n5rrw"&&(e.innerHTML=n),this.h()},h(){o(e,"class","loading-state svelte-1p16fog")},m(t,s){S(t,e,s)},p:ne,i:ne,o:ne,d(t){t&&h(e)}}}function gs(r){let e,n,t="Top Contributors",s,l,i=nt(r[1].topPosters),a=[];for(let u=0;u<i.length;u+=1)a[u]=_s(ms(r,i,u));return{c(){e=y("div"),n=y("h4"),n.textContent=t,s=L(),l=y("div");for(let u=0;u<a.length;u+=1)a[u].c();this.h()},l(u){e=b(u,"DIV",{class:!0});var f=v(e);n=b(f,"H4",{class:!0,"data-svelte-h":!0}),le(n)!=="svelte-7zv2lh"&&(n.textContent=t),s=D(f),l=b(f,"DIV",{class:!0});var c=v(l);for(let p=0;p<a.length;p+=1)a[p].l(c);c.forEach(h),f.forEach(h),this.h()},h(){o(n,"class","svelte-1p16fog"),o(l,"class","top-posters svelte-1p16fog"),o(e,"class","section svelte-1p16fog")},m(u,f){S(u,e,f),d(e,n),d(e,s),d(e,l);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(l,null)},p(u,f){if(f&2){i=nt(u[1].topPosters);let c;for(c=0;c<i.length;c+=1){const p=ms(u,i,c);a[c]?a[c].p(p,f):(a[c]=_s(p),a[c].c(),a[c].m(l,null))}for(;c<a.length;c+=1)a[c].d(1);a.length=i.length}},d(u){u&&h(e),nn(a,u)}}}function _l(r){let e,n=r[14].charAt(0).toUpperCase()+"",t;return{c(){e=y("div"),t=Q(n),this.h()},l(s){e=b(s,"DIV",{class:!0});var l=v(e);t=Z(l,n),l.forEach(h),this.h()},h(){o(e,"class","avatar-placeholder svelte-1p16fog")},m(s,l){S(s,e,l),d(e,t)},p(s,l){l&2&&n!==(n=s[14].charAt(0).toUpperCase()+"")&&ve(t,n)},d(s){s&&h(e)}}}function bl(r){let e,n,t;return{c(){e=y("img"),this.h()},l(s){e=b(s,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Ke(e.src,n=r[15])||o(e,"src",n),o(e,"alt",t=r[14]),o(e,"class","svelte-1p16fog")},m(s,l){S(s,e,l)},p(s,l){l&2&&!Ke(e.src,n=s[15])&&o(e,"src",n),l&2&&t!==(t=s[14])&&o(e,"alt",t)},d(s){s&&h(e)}}}function _s(r){let e,n,t,s=r[17]+1+"",l,i,a,u,f,c,p=r[14]+"",g,_,E,w=r[12].messageCount+"",k,T,I=r[12].percentage.toFixed(1)+"",R,O,Y,M,A,B;function x(V,W){return V[15]?bl:_l}let J=x(r),G=J(r);return{c(){e=y("div"),n=y("div"),t=Q("#"),l=Q(s),i=L(),a=y("div"),G.c(),u=L(),f=y("div"),c=y("div"),g=Q(p),_=L(),E=y("div"),k=Q(w),T=Q(" messages • "),R=Q(I),O=Q("%"),Y=L(),M=y("div"),A=y("div"),B=L(),this.h()},l(V){e=b(V,"DIV",{class:!0});var W=v(e);n=b(W,"DIV",{class:!0});var U=v(n);t=Z(U,"#"),l=Z(U,s),U.forEach(h),i=D(W),a=b(W,"DIV",{class:!0});var ie=v(a);G.l(ie),ie.forEach(h),u=D(W),f=b(W,"DIV",{class:!0});var ee=v(f);c=b(ee,"DIV",{class:!0});var Re=v(c);g=Z(Re,p),Re.forEach(h),_=D(ee),E=b(ee,"DIV",{class:!0});var ue=v(E);k=Z(ue,w),T=Z(ue," messages • "),R=Z(ue,I),O=Z(ue,"%"),ue.forEach(h),ee.forEach(h),Y=D(W),M=b(W,"DIV",{class:!0});var be=v(M);A=b(be,"DIV",{class:!0,style:!0}),v(A).forEach(h),be.forEach(h),B=D(W),W.forEach(h),this.h()},h(){o(n,"class","poster-rank svelte-1p16fog"),o(a,"class","poster-avatar svelte-1p16fog"),o(c,"class","poster-name svelte-1p16fog"),o(E,"class","poster-stats svelte-1p16fog"),o(f,"class","poster-info svelte-1p16fog"),o(A,"class","poster-bar-fill svelte-1p16fog"),En(A,"width",r[12].percentage+"%"),o(M,"class","poster-bar svelte-1p16fog"),o(e,"class","poster-item svelte-1p16fog")},m(V,W){S(V,e,W),d(e,n),d(n,t),d(n,l),d(e,i),d(e,a),G.m(a,null),d(e,u),d(e,f),d(f,c),d(c,g),d(f,_),d(f,E),d(E,k),d(E,T),d(E,R),d(E,O),d(e,Y),d(e,M),d(M,A),d(e,B)},p(V,W){J===(J=x(V))&&G?G.p(V,W):(G.d(1),G=J(V),G&&(G.c(),G.m(a,null))),W&2&&p!==(p=V[14]+"")&&ve(g,p),W&2&&w!==(w=V[12].messageCount+"")&&ve(k,w),W&2&&I!==(I=V[12].percentage.toFixed(1)+"")&&ve(R,I),W&2&&En(A,"width",V[12].percentage+"%")},d(V){V&&h(e),G.d()}}}function bs(r){let e,n,t,s,l=Es(r[7].hour)+"",i,a,u;return{c(){e=y("div"),n=y("div"),t=L(),s=y("div"),i=Q(l),a=L(),this.h()},l(f){e=b(f,"DIV",{class:!0,title:!0});var c=v(e);n=b(c,"DIV",{class:!0,style:!0}),v(n).forEach(h),t=D(c),s=b(c,"DIV",{class:!0});var p=v(s);i=Z(p,l),p.forEach(h),a=D(c),c.forEach(h),this.h()},h(){o(n,"class","heatmap-bar svelte-1p16fog"),En(n,"height",r[9]+"%"),o(s,"class","heatmap-label svelte-1p16fog"),o(e,"class","heatmap-cell svelte-1p16fog"),o(e,"title",u=In(r[7].hour)+": "+r[7].count+" messages")},m(f,c){S(f,e,c),d(e,n),d(e,t),d(e,s),d(s,i),d(e,a)},p(f,c){c&2&&En(n,"height",f[9]+"%"),c&2&&l!==(l=Es(f[7].hour)+"")&&ve(i,l),c&2&&u!==(u=In(f[7].hour)+": "+f[7].count+" messages")&&o(e,"title",u)},d(f){f&&h(e)}}}function ys(r){let e,n,t="Member Growth (Last 30 Days)",s,l,i;return l=new _r({props:{data:r[1].memberGrowth.map(ws),days:30}}),{c(){e=y("div"),n=y("h4"),n.textContent=t,s=L(),ht(l.$$.fragment),this.h()},l(a){e=b(a,"DIV",{class:!0});var u=v(e);n=b(u,"H4",{class:!0,"data-svelte-h":!0}),le(n)!=="svelte-1c0tez4"&&(n.textContent=t),s=D(u),dt(l.$$.fragment,u),u.forEach(h),this.h()},h(){o(n,"class","svelte-1p16fog"),o(e,"class","section svelte-1p16fog")},m(a,u){S(a,e,u),d(e,n),d(e,s),ft(l,e,null),i=!0},p(a,u){const f={};u&2&&(f.data=a[1].memberGrowth.map(ws)),l.$set(f)},i(a){i||(ae(l.$$.fragment,a),i=!0)},o(a){_e(l.$$.fragment,a),i=!1},d(a){a&&h(e),ut(l)}}}function yl(r){let e,n,t=r[0]&&vs(r);return{c(){t&&t.c(),e=Ue()},l(s){t&&t.l(s),e=Ue()},m(s,l){t&&t.m(s,l),S(s,e,l),n=!0},p(s,[l]){s[0]?t?(t.p(s,l),l&1&&ae(t,1)):(t=vs(s),t.c(),ae(t,1),t.m(e.parentNode,e)):t&&(bt(),_e(t,1,1,()=>{t=null}),yt())},i(s){n||(ae(t),n=!0)},o(s){_e(t),n=!1},d(s){s&&h(e),t&&t.d(s)}}}function ks(r){return r>=1e6?(r/1e6).toFixed(1)+"M":r>=1e3?(r/1e3).toFixed(1)+"K":r.toString()}function In(r){return r===0?"12 AM":r===12?"12 PM":r<12?`${r} AM`:`${r-12} PM`}function Es(r){return r===0?"12a":r===12?"12p":r<12?`${r}a`:`${r-12}p`}const ws=r=>({date:r.date,count:r.memberCount,timestamp:r.timestamp});function kl(r,e,n){let{channelId:t}=e,{isExpanded:s=!1}=e,l=null,i=!1,a=null;async function u(){n(2,i=!0),n(3,a=null);try{if(n(1,l=await Nn.getStats(t)),l?.topPosters?.length){const c=l.topPosters.map(p=>p.pubkey);Zt.prefetchProfiles(c)}}catch(c){n(3,a=c instanceof Error?c.message:"Failed to load statistics"),console.error("Failed to load stats:",c)}finally{n(2,i=!1)}}async function f(){n(2,i=!0),n(3,a=null);try{await Nn.refreshStats(t),n(1,l=await Nn.getStats(t))}catch(c){n(3,a=c instanceof Error?c.message:"Failed to refresh statistics"),console.error("Failed to refresh stats:",c)}finally{n(2,i=!1)}}return r.$$set=c=>{"channelId"in c&&n(5,t=c.channelId),"isExpanded"in c&&n(0,s=c.isExpanded)},r.$$.update=()=>{r.$$.dirty&3&&s&&!l&&u()},[s,l,i,a,f,t]}class El extends Rt{constructor(e){super(),Pt(this,e,kl,yl,Nt,{channelId:5,isExpanded:0})}}const Er="Nostr-BBS-bookmarks";function wl(){if(typeof window>"u")return{};try{const r=localStorage.getItem(Er);if(r)return JSON.parse(r)}catch(r){console.error("Failed to load bookmarks from localStorage:",r)}return{}}function On(r){if(!(typeof window>"u"))try{localStorage.setItem(Er,JSON.stringify(r))}catch(e){console.error("Failed to save bookmarks to localStorage:",e)}}const Tl={bookmarks:wl()},Vt=pn(Tl),jn={subscribe:Vt.subscribe,addBookmark:(r,e,n,t,s,l)=>{Vt.update(i=>{const a={messageId:r,channelId:e,content:n,authorPubkey:t,timestamp:s,channelName:l,createdAt:Date.now()},u={...i.bookmarks,[r]:a};return On(u),{...i,bookmarks:u}})},removeBookmark:r=>{Vt.update(e=>{const n={...e.bookmarks};return delete n[r],On(n),{...e,bookmarks:n}})},toggleBookmark:(r,e,n,t,s,l)=>{We(Vt).bookmarks[r]?jn.removeBookmark(r):jn.addBookmark(r,e,n,t,s,l)},getBookmarks:()=>{const r=We(Vt);return Object.values(r.bookmarks).sort((e,n)=>n.createdAt-e.createdAt)},clearAll:()=>{Vt.set({bookmarks:{}}),On({})}};function Al(r){return mn(Vt,e=>!!e.bookmarks[r])}mn(Vt,r=>Object.keys(r.bookmarks).length);const Il=/(https?:\/\/[^\s<>"']+)/gi,Ml=/\.(jpg|jpeg|png|gif|webp|svg|bmp)(\?.*)?$/i,Sl=/\.(mp4|webm|ogg|mov|avi)(\?.*)?$/i,Cl=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i;function Dl(r){const e=r.match(Il);return e?[...new Set(e)].filter(t=>{try{return new URL(t),!0}catch{return!1}}):[]}function Ll(r){try{const n=new URL(r).pathname;return Ml.test(n)}catch{return!1}}function Nl(r){try{const n=new URL(r).pathname;return Sl.test(n)}catch{return!1}}function Rl(r){const e=r.match(Cl);return e?e[1]:null}function Yn(r){try{return new URL(r).hostname.replace(/^www\./,"")}catch{return""}}function Pl(r){try{return`https://www.google.com/s2/favicons?domain=${new URL(r).hostname}&sz=32`}catch{return""}}function Ol(r){if(Ll(r))return{type:"image",url:r};if(Nl(r))return{type:"video",url:r};const e=Rl(r);return e?{type:"youtube",url:r,youtubeId:e}:{type:"link",url:r}}function xl(r){const e=[],n=r.filter(c=>c[0]==="image"&&c.length>=4&&c[3]==="encrypted");if(n.length===0)return[];const t=r.find(c=>c[0]==="image-iv"),s=r.find(c=>c[0]==="image-salt"),l=r.find(c=>c[0]==="image-sender");if(!t||!s||!l)return console.warn("Missing encryption metadata tags for encrypted image"),[];const i=t[1],a=s[1],u=l[1],f=new Map;for(const c of r)c[0]==="image-key"&&c.length>=3&&f.set(c[1],c[2]);for(const c of n)e.push({url:c[1],contentType:c[2]||"application/octet-stream",iv:i,salt:a,senderPubkey:u,recipientKeys:f});return e}function Bl(r,e){return r.recipientKeys.get(e)||null}function Ul(r,e){const n=Bl(r,e);if(!n)return null;const t={encrypted:!0,encryptedKey:n,senderPubkey:r.senderPubkey};return{type:"image",url:r.url,encryption:t}}function Hl(r,e,n,t,s){const l=[],i=new Set,a=xl(e);for(const f of a)if(n){const c=Ul(f,n);c&&(l.push(c),i.add(f.url))}const u=t(r);for(const f of u)i.has(f)||(l.push(s(f)),i.add(f));return l.slice(0,5)}/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:wr,setPrototypeOf:Ts,isFrozen:Vl,getPrototypeOf:zl,getOwnPropertyDescriptor:Fl}=Object;let{freeze:it,seal:kt,create:Wn}=Object,{apply:Xn,construct:qn}=typeof Reflect<"u"&&Reflect;it||(it=function(e){return e});kt||(kt=function(e){return e});Xn||(Xn=function(e,n){for(var t=arguments.length,s=new Array(t>2?t-2:0),l=2;l<t;l++)s[l-2]=arguments[l];return e.apply(n,s)});qn||(qn=function(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),s=1;s<n;s++)t[s-1]=arguments[s];return new e(...t)});const gn=ot(Array.prototype.forEach),Gl=ot(Array.prototype.lastIndexOf),As=ot(Array.prototype.pop),ln=ot(Array.prototype.push),Kl=ot(Array.prototype.splice),bn=ot(String.prototype.toLowerCase),xn=ot(String.prototype.toString),Bn=ot(String.prototype.match),on=ot(String.prototype.replace),jl=ot(String.prototype.indexOf),Yl=ot(String.prototype.trim),Et=ot(Object.prototype.hasOwnProperty),lt=ot(RegExp.prototype.test),an=Wl(TypeError);function ot(r){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,t=new Array(n>1?n-1:0),s=1;s<n;s++)t[s-1]=arguments[s];return Xn(r,e,t)}}function Wl(r){return function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return qn(r,n)}}function de(r,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:bn;Ts&&Ts(r,null);let t=e.length;for(;t--;){let s=e[t];if(typeof s=="string"){const l=n(s);l!==s&&(Vl(e)||(e[t]=l),s=l)}r[s]=!0}return r}function Xl(r){for(let e=0;e<r.length;e++)Et(r,e)||(r[e]=null);return r}function It(r){const e=Wn(null);for(const[n,t]of wr(r))Et(r,n)&&(Array.isArray(t)?e[n]=Xl(t):t&&typeof t=="object"&&t.constructor===Object?e[n]=It(t):e[n]=t);return e}function cn(r,e){for(;r!==null;){const t=Fl(r,e);if(t){if(t.get)return ot(t.get);if(typeof t.value=="function")return ot(t.value)}r=zl(r)}function n(){return null}return n}const Is=it(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Un=it(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Hn=it(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ql=it(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Vn=it(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Jl=it(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ms=it(["#text"]),Ss=it(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),zn=it(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Cs=it(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),_n=it(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Zl=kt(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Ql=kt(/<%[\w\W]*|[\w\W]*%>/gm),$l=kt(/\$\{[\w\W]*/gm),ei=kt(/^data-[\-\w.\u00B7-\uFFFF]+$/),ti=kt(/^aria-[\-\w]+$/),Tr=kt(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ni=kt(/^(?:\w+script|data):/i),si=kt(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Ar=kt(/^html$/i),ri=kt(/^[a-z][.\w]*(-[.\w]+)+$/i);var Ds=Object.freeze({__proto__:null,ARIA_ATTR:ti,ATTR_WHITESPACE:si,CUSTOM_ELEMENT:ri,DATA_ATTR:ei,DOCTYPE_NAME:Ar,ERB_EXPR:Ql,IS_ALLOWED_URI:Tr,IS_SCRIPT_OR_DATA:ni,MUSTACHE_EXPR:Zl,TMPLIT_EXPR:$l});const un={element:1,text:3,progressingInstruction:7,comment:8,document:9},li=function(){return typeof window>"u"?null:window},ii=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let t=null;const s="data-tt-policy-suffix";n&&n.hasAttribute(s)&&(t=n.getAttribute(s));const l="dompurify"+(t?"#"+t:"");try{return e.createPolicy(l,{createHTML(i){return i},createScriptURL(i){return i}})}catch{return console.warn("TrustedTypes policy "+l+" could not be created."),null}},Ls=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Ir(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:li();const e=X=>Ir(X);if(e.version="3.3.1",e.removed=[],!r||!r.document||r.document.nodeType!==un.document||!r.Element)return e.isSupported=!1,e;let{document:n}=r;const t=n,s=t.currentScript,{DocumentFragment:l,HTMLTemplateElement:i,Node:a,Element:u,NodeFilter:f,NamedNodeMap:c=r.NamedNodeMap||r.MozNamedAttrMap,HTMLFormElement:p,DOMParser:g,trustedTypes:_}=r,E=u.prototype,w=cn(E,"cloneNode"),k=cn(E,"remove"),T=cn(E,"nextSibling"),I=cn(E,"childNodes"),R=cn(E,"parentNode");if(typeof i=="function"){const X=n.createElement("template");X.content&&X.content.ownerDocument&&(n=X.content.ownerDocument)}let O,Y="";const{implementation:M,createNodeIterator:A,createDocumentFragment:B,getElementsByTagName:x}=n,{importNode:J}=t;let G=Ls();e.isSupported=typeof wr=="function"&&typeof R=="function"&&M&&M.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:V,ERB_EXPR:W,TMPLIT_EXPR:U,DATA_ATTR:ie,ARIA_ATTR:ee,IS_SCRIPT_OR_DATA:Re,ATTR_WHITESPACE:ue,CUSTOM_ELEMENT:be}=Ds;let{IS_ALLOWED_URI:$}=Ds,z=null;const he=de({},[...Is,...Un,...Hn,...Vn,...Ms]);let N=null;const te=de({},[...Ss,...zn,...Cs,..._n]);let fe=Object.seal(Wn(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Ze=null,re=null;const Ve=Object.seal(Wn(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Pe=!0,Ce=!0,Me=!1,we=!0,je=!1,Le=!0,He=!1,pe=!1,ye=!1,Se=!1,Te=!1,De=!1,ke=!0,Ae=!1;const P="user-content-";let se=!0,oe=!1,H={},q=null;const Oe=de({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ee=null;const ze=de({},["audio","video","img","source","image","track"]);let Xe=null;const st=de({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),rt="http://www.w3.org/1998/Math/MathML",pt="http://www.w3.org/2000/svg",Fe="http://www.w3.org/1999/xhtml";let qe=Fe,$e=!1,wt=null;const Tt=de({},[rt,pt,Fe],xn);let mt=de({},["mi","mo","mn","ms","mtext"]),Ye=de({},["annotation-xml"]);const Ot=de({},["title","style","font","a","script"]);let xt=null;const Je=["application/xhtml+xml","text/html"],Bt="text/html";let me=null,Ne=null;const ge=n.createElement("form"),Ie=function(m){return m instanceof RegExp||m instanceof Function},et=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Ne&&Ne===m)){if((!m||typeof m!="object")&&(m={}),m=It(m),xt=Je.indexOf(m.PARSER_MEDIA_TYPE)===-1?Bt:m.PARSER_MEDIA_TYPE,me=xt==="application/xhtml+xml"?xn:bn,z=Et(m,"ALLOWED_TAGS")?de({},m.ALLOWED_TAGS,me):he,N=Et(m,"ALLOWED_ATTR")?de({},m.ALLOWED_ATTR,me):te,wt=Et(m,"ALLOWED_NAMESPACES")?de({},m.ALLOWED_NAMESPACES,xn):Tt,Xe=Et(m,"ADD_URI_SAFE_ATTR")?de(It(st),m.ADD_URI_SAFE_ATTR,me):st,Ee=Et(m,"ADD_DATA_URI_TAGS")?de(It(ze),m.ADD_DATA_URI_TAGS,me):ze,q=Et(m,"FORBID_CONTENTS")?de({},m.FORBID_CONTENTS,me):Oe,Ze=Et(m,"FORBID_TAGS")?de({},m.FORBID_TAGS,me):It({}),re=Et(m,"FORBID_ATTR")?de({},m.FORBID_ATTR,me):It({}),H=Et(m,"USE_PROFILES")?m.USE_PROFILES:!1,Pe=m.ALLOW_ARIA_ATTR!==!1,Ce=m.ALLOW_DATA_ATTR!==!1,Me=m.ALLOW_UNKNOWN_PROTOCOLS||!1,we=m.ALLOW_SELF_CLOSE_IN_ATTR!==!1,je=m.SAFE_FOR_TEMPLATES||!1,Le=m.SAFE_FOR_XML!==!1,He=m.WHOLE_DOCUMENT||!1,Se=m.RETURN_DOM||!1,Te=m.RETURN_DOM_FRAGMENT||!1,De=m.RETURN_TRUSTED_TYPE||!1,ye=m.FORCE_BODY||!1,ke=m.SANITIZE_DOM!==!1,Ae=m.SANITIZE_NAMED_PROPS||!1,se=m.KEEP_CONTENT!==!1,oe=m.IN_PLACE||!1,$=m.ALLOWED_URI_REGEXP||Tr,qe=m.NAMESPACE||Fe,mt=m.MATHML_TEXT_INTEGRATION_POINTS||mt,Ye=m.HTML_INTEGRATION_POINTS||Ye,fe=m.CUSTOM_ELEMENT_HANDLING||{},m.CUSTOM_ELEMENT_HANDLING&&Ie(m.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(fe.tagNameCheck=m.CUSTOM_ELEMENT_HANDLING.tagNameCheck),m.CUSTOM_ELEMENT_HANDLING&&Ie(m.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(fe.attributeNameCheck=m.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),m.CUSTOM_ELEMENT_HANDLING&&typeof m.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(fe.allowCustomizedBuiltInElements=m.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),je&&(Ce=!1),Te&&(Se=!0),H&&(z=de({},Ms),N=[],H.html===!0&&(de(z,Is),de(N,Ss)),H.svg===!0&&(de(z,Un),de(N,zn),de(N,_n)),H.svgFilters===!0&&(de(z,Hn),de(N,zn),de(N,_n)),H.mathMl===!0&&(de(z,Vn),de(N,Cs),de(N,_n))),m.ADD_TAGS&&(typeof m.ADD_TAGS=="function"?Ve.tagCheck=m.ADD_TAGS:(z===he&&(z=It(z)),de(z,m.ADD_TAGS,me))),m.ADD_ATTR&&(typeof m.ADD_ATTR=="function"?Ve.attributeCheck=m.ADD_ATTR:(N===te&&(N=It(N)),de(N,m.ADD_ATTR,me))),m.ADD_URI_SAFE_ATTR&&de(Xe,m.ADD_URI_SAFE_ATTR,me),m.FORBID_CONTENTS&&(q===Oe&&(q=It(q)),de(q,m.FORBID_CONTENTS,me)),m.ADD_FORBID_CONTENTS&&(q===Oe&&(q=It(q)),de(q,m.ADD_FORBID_CONTENTS,me)),se&&(z["#text"]=!0),He&&de(z,["html","head","body"]),z.table&&(de(z,["tbody"]),delete Ze.tbody),m.TRUSTED_TYPES_POLICY){if(typeof m.TRUSTED_TYPES_POLICY.createHTML!="function")throw an('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof m.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw an('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');O=m.TRUSTED_TYPES_POLICY,Y=O.createHTML("")}else O===void 0&&(O=ii(_,s)),O!==null&&typeof Y=="string"&&(Y=O.createHTML(""));it&&it(m),Ne=m}},xe=de({},[...Un,...Hn,...ql]),At=de({},[...Vn,...Jl]),Qt=function(m){let C=R(m);(!C||!C.tagName)&&(C={namespaceURI:qe,tagName:"template"});const F=bn(m.tagName),Be=bn(C.tagName);return wt[m.namespaceURI]?m.namespaceURI===pt?C.namespaceURI===Fe?F==="svg":C.namespaceURI===rt?F==="svg"&&(Be==="annotation-xml"||mt[Be]):!!xe[F]:m.namespaceURI===rt?C.namespaceURI===Fe?F==="math":C.namespaceURI===pt?F==="math"&&Ye[Be]:!!At[F]:m.namespaceURI===Fe?C.namespaceURI===pt&&!Ye[Be]||C.namespaceURI===rt&&!mt[Be]?!1:!At[F]&&(Ot[F]||!xe[F]):!!(xt==="application/xhtml+xml"&&wt[m.namespaceURI]):!1},ct=function(m){ln(e.removed,{element:m});try{R(m).removeChild(m)}catch{k(m)}},vt=function(m,C){try{ln(e.removed,{attribute:C.getAttributeNode(m),from:C})}catch{ln(e.removed,{attribute:null,from:C})}if(C.removeAttribute(m),m==="is")if(Se||Te)try{ct(C)}catch{}else try{C.setAttribute(m,"")}catch{}},zt=function(m){let C=null,F=null;if(ye)m="<remove></remove>"+m;else{const Ge=Bn(m,/^[\r\n\t ]+/);F=Ge&&Ge[0]}xt==="application/xhtml+xml"&&qe===Fe&&(m='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+m+"</body></html>");const Be=O?O.createHTML(m):m;if(qe===Fe)try{C=new g().parseFromString(Be,xt)}catch{}if(!C||!C.documentElement){C=M.createDocument(qe,"template",null);try{C.documentElement.innerHTML=$e?Y:Be}catch{}}const tt=C.body||C.documentElement;return m&&F&&tt.insertBefore(n.createTextNode(F),tt.childNodes[0]||null),qe===Fe?x.call(C,He?"html":"body")[0]:He?C.documentElement:tt},sn=function(m){return A.call(m.ownerDocument||m,m,f.SHOW_ELEMENT|f.SHOW_COMMENT|f.SHOW_TEXT|f.SHOW_PROCESSING_INSTRUCTION|f.SHOW_CDATA_SECTION,null)},Ut=function(m){return m instanceof p&&(typeof m.nodeName!="string"||typeof m.textContent!="string"||typeof m.removeChild!="function"||!(m.attributes instanceof c)||typeof m.removeAttribute!="function"||typeof m.setAttribute!="function"||typeof m.namespaceURI!="string"||typeof m.insertBefore!="function"||typeof m.hasChildNodes!="function")},Ft=function(m){return typeof a=="function"&&m instanceof a};function gt(X,m,C){gn(X,F=>{F.call(e,m,C,Ne)})}const Gt=function(m){let C=null;if(gt(G.beforeSanitizeElements,m,null),Ut(m))return ct(m),!0;const F=me(m.nodeName);if(gt(G.uponSanitizeElement,m,{tagName:F,allowedTags:z}),Le&&m.hasChildNodes()&&!Ft(m.firstElementChild)&&lt(/<[/\w!]/g,m.innerHTML)&&lt(/<[/\w!]/g,m.textContent)||m.nodeType===un.progressingInstruction||Le&&m.nodeType===un.comment&&lt(/<[/\w]/g,m.data))return ct(m),!0;if(!(Ve.tagCheck instanceof Function&&Ve.tagCheck(F))&&(!z[F]||Ze[F])){if(!Ze[F]&&rn(F)&&(fe.tagNameCheck instanceof RegExp&&lt(fe.tagNameCheck,F)||fe.tagNameCheck instanceof Function&&fe.tagNameCheck(F)))return!1;if(se&&!q[F]){const Be=R(m)||m.parentNode,tt=I(m)||m.childNodes;if(tt&&Be){const Ge=tt.length;for(let at=Ge-1;at>=0;--at){const Dt=w(tt[at],!0);Dt.__removalCount=(m.__removalCount||0)+1,Be.insertBefore(Dt,T(m))}}}return ct(m),!0}return m instanceof u&&!Qt(m)||(F==="noscript"||F==="noembed"||F==="noframes")&&lt(/<\/no(script|embed|frames)/i,m.innerHTML)?(ct(m),!0):(je&&m.nodeType===un.text&&(C=m.textContent,gn([V,W,U],Be=>{C=on(C,Be," ")}),m.textContent!==C&&(ln(e.removed,{element:m.cloneNode()}),m.textContent=C)),gt(G.afterSanitizeElements,m,null),!1)},Kt=function(m,C,F){if(ke&&(C==="id"||C==="name")&&(F in n||F in ge))return!1;if(!(Ce&&!re[C]&&lt(ie,C))){if(!(Pe&&lt(ee,C))){if(!(Ve.attributeCheck instanceof Function&&Ve.attributeCheck(C,m))){if(!N[C]||re[C]){if(!(rn(m)&&(fe.tagNameCheck instanceof RegExp&&lt(fe.tagNameCheck,m)||fe.tagNameCheck instanceof Function&&fe.tagNameCheck(m))&&(fe.attributeNameCheck instanceof RegExp&&lt(fe.attributeNameCheck,C)||fe.attributeNameCheck instanceof Function&&fe.attributeNameCheck(C,m))||C==="is"&&fe.allowCustomizedBuiltInElements&&(fe.tagNameCheck instanceof RegExp&&lt(fe.tagNameCheck,F)||fe.tagNameCheck instanceof Function&&fe.tagNameCheck(F))))return!1}else if(!Xe[C]){if(!lt($,on(F,ue,""))){if(!((C==="src"||C==="xlink:href"||C==="href")&&m!=="script"&&jl(F,"data:")===0&&Ee[m])){if(!(Me&&!lt(Re,on(F,ue,"")))){if(F)return!1}}}}}}}return!0},rn=function(m){return m!=="annotation-xml"&&Bn(m,be)},jt=function(m){gt(G.beforeSanitizeAttributes,m,null);const{attributes:C}=m;if(!C||Ut(m))return;const F={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:N,forceKeepAttr:void 0};let Be=C.length;for(;Be--;){const tt=C[Be],{name:Ge,namespaceURI:at,value:Dt}=tt,en=me(Ge),Ln=Dt;let Qe=Ge==="value"?Ln:Yl(Ln);if(F.attrName=en,F.attrValue=Qe,F.keepAttr=!0,F.forceKeepAttr=void 0,gt(G.uponSanitizeAttribute,m,F),Qe=F.attrValue,Ae&&(en==="id"||en==="name")&&(vt(Ge,m),Qe=P+Qe),Le&&lt(/((--!?|])>)|<\/(style|title|textarea)/i,Qe)){vt(Ge,m);continue}if(en==="attributename"&&Bn(Qe,"href")){vt(Ge,m);continue}if(F.forceKeepAttr)continue;if(!F.keepAttr){vt(Ge,m);continue}if(!we&&lt(/\/>/i,Qe)){vt(Ge,m);continue}je&&gn([V,W,U],$n=>{Qe=on(Qe,$n," ")});const Qn=me(m.nodeName);if(!Kt(Qn,en,Qe)){vt(Ge,m);continue}if(O&&typeof _=="object"&&typeof _.getAttributeType=="function"&&!at)switch(_.getAttributeType(Qn,en)){case"TrustedHTML":{Qe=O.createHTML(Qe);break}case"TrustedScriptURL":{Qe=O.createScriptURL(Qe);break}}if(Qe!==Ln)try{at?m.setAttributeNS(at,Ge,Qe):m.setAttribute(Ge,Qe),Ut(m)?ct(m):As(e.removed)}catch{vt(Ge,m)}}gt(G.afterSanitizeAttributes,m,null)},$t=function X(m){let C=null;const F=sn(m);for(gt(G.beforeSanitizeShadowDOM,m,null);C=F.nextNode();)gt(G.uponSanitizeShadowNode,C,null),Gt(C),jt(C),C.content instanceof l&&X(C.content);gt(G.afterSanitizeShadowDOM,m,null)};return e.sanitize=function(X){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},C=null,F=null,Be=null,tt=null;if($e=!X,$e&&(X="<!-->"),typeof X!="string"&&!Ft(X))if(typeof X.toString=="function"){if(X=X.toString(),typeof X!="string")throw an("dirty is not a string, aborting")}else throw an("toString is not a function");if(!e.isSupported)return X;if(pe||et(m),e.removed=[],typeof X=="string"&&(oe=!1),oe){if(X.nodeName){const Dt=me(X.nodeName);if(!z[Dt]||Ze[Dt])throw an("root node is forbidden and cannot be sanitized in-place")}}else if(X instanceof a)C=zt("<!---->"),F=C.ownerDocument.importNode(X,!0),F.nodeType===un.element&&F.nodeName==="BODY"||F.nodeName==="HTML"?C=F:C.appendChild(F);else{if(!Se&&!je&&!He&&X.indexOf("<")===-1)return O&&De?O.createHTML(X):X;if(C=zt(X),!C)return Se?null:De?Y:""}C&&ye&&ct(C.firstChild);const Ge=sn(oe?X:C);for(;Be=Ge.nextNode();)Gt(Be),jt(Be),Be.content instanceof l&&$t(Be.content);if(oe)return X;if(Se){if(Te)for(tt=B.call(C.ownerDocument);C.firstChild;)tt.appendChild(C.firstChild);else tt=C;return(N.shadowroot||N.shadowrootmode)&&(tt=J.call(t,tt,!0)),tt}let at=He?C.outerHTML:C.innerHTML;return He&&z["!doctype"]&&C.ownerDocument&&C.ownerDocument.doctype&&C.ownerDocument.doctype.name&&lt(Ar,C.ownerDocument.doctype.name)&&(at="<!DOCTYPE "+C.ownerDocument.doctype.name+`>
`+at),je&&gn([V,W,U],Dt=>{at=on(at,Dt," ")}),O&&De?O.createHTML(at):at},e.setConfig=function(){let X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};et(X),pe=!0},e.clearConfig=function(){Ne=null,pe=!1},e.isValidAttribute=function(X,m,C){Ne||et({});const F=me(X),Be=me(m);return Kt(F,Be,C)},e.addHook=function(X,m){typeof m=="function"&&ln(G[X],m)},e.removeHook=function(X,m){if(m!==void 0){const C=Gl(G[X],m);return C===-1?void 0:Kl(G[X],C,1)[0]}return As(G[X])},e.removeHooks=function(X){G[X]=[]},e.removeAllHooks=function(){G=Ls()},e}var oi=Ir();const Ns="/api/proxy",Mr="nostr_bbs_link_previews",ai=10*24*60*60*1e3,Rs=100;function ci(){try{const r=localStorage.getItem(Mr);if(!r)return{};const e=JSON.parse(r),n=Date.now(),t={};for(const[s,l]of Object.entries(e)){const i=l;n-i.timestamp<ai&&(t[s]=i)}return t}catch{return{}}}function ui(r){try{const e=Object.entries(r);e.length>Rs&&(e.sort((n,t)=>t[1].timestamp-n[1].timestamp),r=Object.fromEntries(e.slice(0,Rs))),localStorage.setItem(Mr,JSON.stringify(r))}catch(e){console.warn("Failed to save link preview cache:",e)}}const Wt=pn(ci());Wt.subscribe(r=>{ui(r)});async function fi(r){const e=We(Wt);if(e[r])return e[r].data;const n=new URL(r).hostname.replace(/^www\./,""),t=`https://www.google.com/s2/favicons?domain=${n}&sz=32`;try{const s=`${Ns}${Ns.includes("/api/proxy")?"?":"/preview?"}url=${encodeURIComponent(r)}`,l=await fetch(s,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(15e3)});if(!l.ok)throw new Error(`Proxy returned ${l.status}`);const i=await l.json();if(i.type==="twitter"){const u={url:r,domain:n,favicon:"https://abs.twimg.com/favicons/twitter.3.ico",type:"twitter",html:i.html,title:i.author_name?`Post by ${i.author_name}`:"X Post",authorName:i.author_name,authorUrl:i.author_url,siteName:i.provider_name||"X"};return Wt.update(f=>(f[r]={data:u,timestamp:Date.now()},f)),u}const a={url:i.url||r,domain:i.domain||n,favicon:i.favicon||t,title:i.title,description:i.description,image:i.image,siteName:i.siteName,type:"opengraph"};return Wt.update(u=>(u[r]={data:a,timestamp:Date.now()},u)),a}catch(s){console.warn("Failed to fetch preview for",r,s);try{const i=await fetch(r,{method:"GET",headers:{Accept:"text/html"},signal:AbortSignal.timeout(5e3)});if(i.ok){const a=await i.text(),u=di(a,r);return u.type="opengraph",Wt.update(f=>(f[r]={data:u,timestamp:Date.now()},f)),u}}catch{}const l={url:r,domain:n,favicon:t,error:!0};return Wt.update(i=>(i[r]={data:l,timestamp:Date.now()},i)),l}}function di(r,e){const n=new URL(e).hostname.replace(/^www\./,""),t=`https://www.google.com/s2/favicons?domain=${n}&sz=32`,s={url:e,domain:n,favicon:t},l=r.match(/<meta\s+property=["']og:title["']\s+content=["']([^"']+)["']/i);if(l&&(s.title=fn(l[1])),!s.title){const f=r.match(/<title>([^<]+)<\/title>/i);f&&(s.title=fn(f[1]))}const i=r.match(/<meta\s+property=["']og:description["']\s+content=["']([^"']+)["']/i);if(i&&(s.description=fn(i[1])),!s.description){const f=r.match(/<meta\s+name=["']description["']\s+content=["']([^"']+)["']/i);f&&(s.description=fn(f[1]))}const a=r.match(/<meta\s+property=["']og:image["']\s+content=["']([^"']+)["']/i);a&&(s.image=hi(a[1],e));const u=r.match(/<meta\s+property=["']og:site_name["']\s+content=["']([^"']+)["']/i);return u&&(s.siteName=fn(u[1])),s}function fn(r){const e={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&apos;":"'","&nbsp;":" ","&copy;":"©","&reg;":"®","&trade;":"™","&mdash;":"—","&ndash;":"–","&hellip;":"…","&lsquo;":"‘","&rsquo;":"’","&ldquo;":"“","&rdquo;":"”"};let n=r;for(const[t,s]of Object.entries(e))n=n.replace(new RegExp(t,"gi"),s);return n=n.replace(/&#(\d+);/g,(t,s)=>{const l=parseInt(s,10);return l>0&&l<1114111?String.fromCodePoint(l):""}),n=n.replace(/&#x([0-9a-fA-F]+);/g,(t,s)=>{const l=parseInt(s,16);return l>0&&l<1114111?String.fromCodePoint(l):""}),n}function hi(r,e){try{return new URL(r,e).href}catch{return r}}function pi(r){return We(Wt)[r]?.data||null}function mi(r){let e,n,t,s,l,i,a=(r[1].siteName||r[1].domain)+"",u,f,c,p=r[1].title+"",g,_,E,w,k,T,I,R=r[1].image&&Ps(r),O=r[1].favicon&&Os(r),Y=r[1].description&&xs(r);return{c(){e=y("div"),R&&R.c(),n=L(),t=y("div"),s=y("div"),O&&O.c(),l=L(),i=y("span"),u=Q(a),f=L(),c=y("h4"),g=Q(p),_=L(),Y&&Y.c(),E=L(),w=j("svg"),k=j("path"),T=j("polyline"),I=j("line"),this.h()},l(M){e=b(M,"DIV",{class:!0});var A=v(e);R&&R.l(A),n=D(A),t=b(A,"DIV",{class:!0});var B=v(t);s=b(B,"DIV",{class:!0});var x=v(s);O&&O.l(x),l=D(x),i=b(x,"SPAN",{class:!0});var J=v(i);u=Z(J,a),J.forEach(h),x.forEach(h),f=D(B),c=b(B,"H4",{class:!0});var G=v(c);g=Z(G,p),G.forEach(h),_=D(B),Y&&Y.l(B),B.forEach(h),E=D(A),w=K(A,"svg",{class:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var V=v(w);k=K(V,"path",{d:!0}),v(k).forEach(h),T=K(V,"polyline",{points:!0}),v(T).forEach(h),I=K(V,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(I).forEach(h),V.forEach(h),A.forEach(h),this.h()},h(){o(i,"class","domain svelte-1padtbd"),o(s,"class","preview-header svelte-1padtbd"),o(c,"class","preview-title svelte-1padtbd"),o(t,"class","preview-content svelte-1padtbd"),o(k,"d","M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"),o(T,"points","15 3 21 3 21 9"),o(I,"x1","10"),o(I,"y1","14"),o(I,"x2","21"),o(I,"y2","3"),o(w,"class","external-icon svelte-1padtbd"),o(w,"viewBox","0 0 24 24"),o(w,"fill","none"),o(w,"stroke","currentColor"),o(w,"stroke-width","2"),o(e,"class","preview-card svelte-1padtbd")},m(M,A){S(M,e,A),R&&R.m(e,null),d(e,n),d(e,t),d(t,s),O&&O.m(s,null),d(s,l),d(s,i),d(i,u),d(t,f),d(t,c),d(c,g),d(t,_),Y&&Y.m(t,null),d(e,E),d(e,w),d(w,k),d(w,T),d(w,I)},p(M,A){M[1].image?R?R.p(M,A):(R=Ps(M),R.c(),R.m(e,n)):R&&(R.d(1),R=null),M[1].favicon?O?O.p(M,A):(O=Os(M),O.c(),O.m(s,l)):O&&(O.d(1),O=null),A&2&&a!==(a=(M[1].siteName||M[1].domain)+"")&&ve(u,a),A&2&&p!==(p=M[1].title+"")&&ve(g,p),M[1].description?Y?Y.p(M,A):(Y=xs(M),Y.c(),Y.m(t,null)):Y&&(Y.d(1),Y=null)},d(M){M&&h(e),R&&R.d(),O&&O.d(),Y&&Y.d()}}}function vi(r){let e,n,t,s,l=(r[1]?.domain||Yn(r[0]))+"",i,a,u,f,c,p,g,_,E,w=r[1]?.favicon&&Bs(r);return{c(){e=y("div"),w&&w.c(),n=L(),t=y("div"),s=y("div"),i=Q(l),a=L(),u=y("div"),f=Q(r[0]),c=L(),p=j("svg"),g=j("path"),_=j("polyline"),E=j("line"),this.h()},l(k){e=b(k,"DIV",{class:!0});var T=v(e);w&&w.l(T),n=D(T),t=b(T,"DIV",{class:!0});var I=v(t);s=b(I,"DIV",{class:!0});var R=v(s);i=Z(R,l),R.forEach(h),a=D(I),u=b(I,"DIV",{class:!0,title:!0});var O=v(u);f=Z(O,r[0]),O.forEach(h),I.forEach(h),c=D(T),p=K(T,"svg",{class:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var Y=v(p);g=K(Y,"path",{d:!0}),v(g).forEach(h),_=K(Y,"polyline",{points:!0}),v(_).forEach(h),E=K(Y,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(E).forEach(h),Y.forEach(h),T.forEach(h),this.h()},h(){o(s,"class","domain svelte-1padtbd"),o(u,"class","url svelte-1padtbd"),o(u,"title",r[0]),o(t,"class","link-text svelte-1padtbd"),o(g,"d","M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"),o(_,"points","15 3 21 3 21 9"),o(E,"x1","10"),o(E,"y1","14"),o(E,"x2","21"),o(E,"y2","3"),o(p,"class","external-icon svelte-1padtbd"),o(p,"viewBox","0 0 24 24"),o(p,"fill","none"),o(p,"stroke","currentColor"),o(p,"stroke-width","2"),o(e,"class","preview-minimal svelte-1padtbd")},m(k,T){S(k,e,T),w&&w.m(e,null),d(e,n),d(e,t),d(t,s),d(s,i),d(t,a),d(t,u),d(u,f),d(e,c),d(e,p),d(p,g),d(p,_),d(p,E)},p(k,T){k[1]?.favicon?w?w.p(k,T):(w=Bs(k),w.c(),w.m(e,n)):w&&(w.d(1),w=null),T&3&&l!==(l=(k[1]?.domain||Yn(k[0]))+"")&&ve(i,l),T&1&&ve(f,k[0]),T&1&&o(u,"title",k[0])},d(k){k&&h(e),w&&w.d()}}}function gi(r){let e,n="",t,s;return{c(){e=y("div"),e.innerHTML=n,this.h()},l(l){e=b(l,"DIV",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-fc4hww"&&(e.innerHTML=n),this.h()},h(){o(e,"class","twitter-embed svelte-1padtbd")},m(l,i){S(l,e,i),r[9](e),t||(s=[ce(e,"click",kn(r[7])),ce(e,"keydown",kn(r[8]))],t=!0)},p:ne,d(l){l&&h(e),r[9](null),t=!1,Ct(s)}}}function _i(r){let e,n='<div class="skeleton-image svelte-1padtbd"></div> <div class="skeleton-content svelte-1padtbd"><div class="skeleton-title svelte-1padtbd"></div> <div class="skeleton-description svelte-1padtbd"></div> <div class="skeleton-domain svelte-1padtbd"></div></div>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-ywu8x8"&&(e.innerHTML=n),this.h()},h(){o(e,"class","preview-skeleton svelte-1padtbd")},m(t,s){S(t,e,s)},p:ne,d(t){t&&h(e)}}}function Ps(r){let e,n,t,s;return{c(){e=y("div"),n=y("img"),this.h()},l(l){e=b(l,"DIV",{class:!0});var i=v(e);n=b(i,"IMG",{src:!0,alt:!0,class:!0,loading:!0}),i.forEach(h),this.h()},h(){Ke(n.src,t=r[1].image)||o(n,"src",t),o(n,"alt",s=r[1].title||""),o(n,"class","preview-image svelte-1padtbd"),o(n,"loading","lazy"),o(e,"class","preview-image-container svelte-1padtbd")},m(l,i){S(l,e,i),d(e,n)},p(l,i){i&2&&!Ke(n.src,t=l[1].image)&&o(n,"src",t),i&2&&s!==(s=l[1].title||"")&&o(n,"alt",s)},d(l){l&&h(e)}}}function Os(r){let e,n;return{c(){e=y("img"),this.h()},l(t){e=b(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Ke(e.src,n=r[1].favicon)||o(e,"src",n),o(e,"alt",""),o(e,"class","favicon svelte-1padtbd")},m(t,s){S(t,e,s)},p(t,s){s&2&&!Ke(e.src,n=t[1].favicon)&&o(e,"src",n)},d(t){t&&h(e)}}}function xs(r){let e,n=r[1].description+"",t;return{c(){e=y("p"),t=Q(n),this.h()},l(s){e=b(s,"P",{class:!0});var l=v(e);t=Z(l,n),l.forEach(h),this.h()},h(){o(e,"class","preview-description svelte-1padtbd")},m(s,l){S(s,e,l),d(e,t)},p(s,l){l&2&&n!==(n=s[1].description+"")&&ve(t,n)},d(s){s&&h(e)}}}function Bs(r){let e,n;return{c(){e=y("img"),this.h()},l(t){e=b(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Ke(e.src,n=r[1].favicon)||o(e,"src",n),o(e,"alt",""),o(e,"class","favicon svelte-1padtbd")},m(t,s){S(t,e,s)},p(t,s){s&2&&!Ke(e.src,n=t[1].favicon)&&o(e,"src",n)},d(t){t&&h(e)}}}function bi(r){let e,n,t;function s(a,u){return a[2]?_i:a[1]?.type==="twitter"&&a[1].html?gi:a[3]||!a[1]?.title?vi:mi}let l=s(r),i=l(r);return{c(){e=y("div"),i.c(),this.h()},l(a){e=b(a,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0});var u=v(e);i.l(u),u.forEach(h),this.h()},h(){o(e,"class","link-preview svelte-1padtbd"),o(e,"role","button"),o(e,"tabindex","0"),o(e,"aria-label","Open link in new tab")},m(a,u){S(a,e,u),i.m(e,null),r[10](e),n||(t=[ce(e,"click",r[6]),ce(e,"keydown",r[11])],n=!0)},p(a,[u]){l===(l=s(a))&&i?i.p(a,u):(i.d(1),i=l(a),i&&(i.c(),i.m(e,null)))},i:ne,o:ne,d(a){a&&h(e),i.d(),r[10](null),n=!1,Ct(t)}}}function yi(){if(typeof window<"u"&&!window.twttr){const r=document.createElement("script");r.src="https://platform.twitter.com/widgets.js",r.async=!0,r.charset="utf-8",document.head.appendChild(r)}}function ki(r,e,n){let{url:t}=e,s=null,l=!0,i=!1,a,u=!1,f;function c(){if(s?.type==="twitter"&&s.html&&f){const I=oi.sanitize(s.html,{ALLOWED_TAGS:["blockquote","a","p","br","script"],ALLOWED_ATTR:["class","href","data-*"],FORCE_BODY:!1,KEEP_CONTENT:!0});if(n(5,f.innerHTML=I,f),typeof window<"u"){const R=window.twttr;R?.widgets?.load&&R.widgets.load(f)}}}Cr(()=>{s?.type==="twitter"&&s.html&&(yi(),c())}),Cn(()=>{const I=new IntersectionObserver(R=>{R.forEach(O=>{O.isIntersecting&&!u&&(u=!0,p())})},{rootMargin:"100px"});return I.observe(a),()=>{I.disconnect()}});async function p(){const I=pi(t);if(I){n(1,s=I),n(2,l=!1),n(3,i=I.error||!1);return}try{n(1,s=await fi(t)),n(3,i=s.error||!1)}catch(R){console.error("Failed to load preview:",R),n(3,i=!0),n(1,s={url:t,domain:Yn(t),favicon:Pl(t),error:!0})}finally{n(2,l=!1)}}function g(){window.open(t,"_blank","noopener,noreferrer")}function _(I){Gn.call(this,r,I)}function E(I){Gn.call(this,r,I)}function w(I){hn[I?"unshift":"push"](()=>{f=I,n(5,f)})}function k(I){hn[I?"unshift":"push"](()=>{a=I,n(4,a)})}const T=I=>(I.key==="Enter"||I.key===" ")&&(I.preventDefault(),g());return r.$$set=I=>{"url"in I&&n(0,t=I.url)},[t,s,l,i,a,f,g,_,E,w,k,T]}class Ei extends Rt{constructor(e){super(),Pt(this,e,ki,bi,Nt,{url:0})}}function wi(r){let e,n,t,s,l,i;function a(_,E){return _[8]?Ii:Mi}let u=a(r),f=u(r);function c(_,E){return _[6]?Li:Di}let p=c(r),g=p(r);return{c(){e=y("div"),f.c(),n=L(),t=y("button"),g.c(),this.h()},l(_){e=b(_,"DIV",{class:!0});var E=v(e);f.l(E),n=D(E),t=b(E,"BUTTON",{class:!0,title:!0});var w=v(t);g.l(w),w.forEach(h),E.forEach(h),this.h()},h(){o(t,"class","expand-button svelte-19422hk"),o(t,"title",s=r[6]?"Collapse":"Expand"),o(e,"class","youtube-container svelte-19422hk"),St(e,"expanded",r[6])},m(_,E){S(_,e,E),f.m(e,null),d(e,n),d(e,t),g.m(t,null),l||(i=ce(t,"click",r[11]),l=!0)},p(_,E){u===(u=a(_))&&f?f.p(_,E):(f.d(1),f=u(_),f&&(f.c(),f.m(e,n))),p!==(p=c(_))&&(g.d(1),g=p(_),g&&(g.c(),g.m(t,null))),E&64&&s!==(s=_[6]?"Collapse":"Expand")&&o(t,"title",s),E&64&&St(e,"expanded",_[6])},d(_){_&&h(e),f.d(),g.d(),l=!1,i()}}}function Ti(r){let e,n,t,s,l,i;function a(_,E){return _[1]?Ri:Ni}let u=a(r),f=u(r);function c(_,E){return _[6]?Oi:Pi}let p=c(r),g=p(r);return{c(){e=y("div"),f.c(),n=L(),t=y("button"),g.c(),this.h()},l(_){e=b(_,"DIV",{class:!0});var E=v(e);f.l(E),n=D(E),t=b(E,"BUTTON",{class:!0,title:!0});var w=v(t);g.l(w),w.forEach(h),E.forEach(h),this.h()},h(){o(t,"class","expand-button svelte-19422hk"),o(t,"title",s=r[6]?"Collapse":"Expand"),o(e,"class","video-container svelte-19422hk"),St(e,"expanded",r[6])},m(_,E){S(_,e,E),f.m(e,null),d(e,n),d(e,t),g.m(t,null),l||(i=ce(t,"click",r[11]),l=!0)},p(_,E){u===(u=a(_))&&f?f.p(_,E):(f.d(1),f=u(_),f&&(f.c(),f.m(e,n))),p!==(p=c(_))&&(g.d(1),g=p(_),g&&(g.c(),g.m(t,null))),E&64&&s!==(s=_[6]?"Collapse":"Expand")&&o(t,"title",s),E&64&&St(e,"expanded",_[6])},d(_){_&&h(e),f.d(),g.d(),l=!1,i()}}}function Ai(r){let e,n,t,s,l,i,a,u;function f(k,T){return k[1]?Bi:xi}let c=f(r),p=c(r);function g(k,T){return k[6]?Ki:Gi}let _=g(r),E=_(r),w=r[2]&&r[10]&&Hs(r);return{c(){e=y("div"),p.c(),n=L(),t=y("button"),E.c(),l=L(),w&&w.c(),i=Ue(),this.h()},l(k){e=b(k,"DIV",{class:!0});var T=v(e);p.l(T),n=D(T),t=b(T,"BUTTON",{class:!0,title:!0});var I=v(t);E.l(I),I.forEach(h),T.forEach(h),l=D(k),w&&w.l(k),i=Ue(),this.h()},h(){o(t,"class","expand-button svelte-19422hk"),o(t,"title",s=r[6]?"Collapse":"Expand"),o(e,"class","image-container svelte-19422hk"),St(e,"expanded",r[6])},m(k,T){S(k,e,T),p.m(e,null),d(e,n),d(e,t),E.m(t,null),S(k,l,T),w&&w.m(k,T),S(k,i,T),a||(u=ce(t,"click",r[11]),a=!0)},p(k,T){c===(c=f(k))&&p?p.p(k,T):(p.d(1),p=c(k),p&&(p.c(),p.m(e,n))),_!==(_=g(k))&&(E.d(1),E=_(k),E&&(E.c(),E.m(t,null))),T&64&&s!==(s=k[6]?"Collapse":"Expand")&&o(t,"title",s),T&64&&St(e,"expanded",k[6]),k[2]&&k[10]?w?w.p(k,T):(w=Hs(k),w.c(),w.m(i.parentNode,i)):w&&(w.d(1),w=null)},d(k){k&&(h(e),h(l),h(i)),p.d(),E.d(),w&&w.d(k),a=!1,u()}}}function Ii(r){let e,n;return{c(){e=y("iframe"),this.h()},l(t){e=b(t,"IFRAME",{src:!0,title:!0,frameborder:!0,allow:!0,class:!0}),v(e).forEach(h),this.h()},h(){Ke(e.src,n=`https://www.youtube-nocookie.com/embed/${r[0].youtubeId}?autoplay=1`)||o(e,"src",n),o(e,"title","YouTube video player"),o(e,"frameborder","0"),o(e,"allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"),e.allowFullscreen=!0,o(e,"class","youtube-iframe svelte-19422hk")},m(t,s){S(t,e,s)},p(t,s){s&1&&!Ke(e.src,n=`https://www.youtube-nocookie.com/embed/${t[0].youtubeId}?autoplay=1`)&&o(e,"src",n)},d(t){t&&h(e)}}}function Mi(r){let e,n,t,s='<svg viewBox="0 0 68 48" fill="currentColor"><path d="M66.52,7.74c-0.78-2.93-2.49-5.41-5.42-6.19C55.79,.13,34,0,34,0S12.21,.13,6.9,1.55 C3.97,2.33,2.27,4.81,1.48,7.74C0.06,13.05,0,24,0,24s0.06,10.95,1.48,16.26c0.78,2.93,2.49,5.41,5.42,6.19 C12.21,47.87,34,48,34,48s21.79-0.13,27.1-1.55c2.93-0.78,4.64-3.26,5.42-6.19C67.94,34.95,68,24,68,24S67.94,13.05,66.52,7.74z" fill="#f00"></path><path d="M 45,24 27,14 27,34" fill="#fff"></path></svg>',l,i;function a(c,p){return c[1]?Ci:Si}let u=a(r),f=u(r);return{c(){e=y("button"),f.c(),n=L(),t=y("div"),t.innerHTML=s,this.h()},l(c){e=b(c,"BUTTON",{class:!0});var p=v(e);f.l(p),n=D(p),t=b(p,"DIV",{class:!0,"data-svelte-h":!0}),le(t)!=="svelte-pjh3rm"&&(t.innerHTML=s),p.forEach(h),this.h()},h(){o(t,"class","youtube-play-button svelte-19422hk"),o(e,"class","youtube-preview svelte-19422hk")},m(c,p){S(c,e,p),f.m(e,null),d(e,n),d(e,t),l||(i=ce(e,"click",r[14]),l=!0)},p(c,p){u===(u=a(c))&&f?f.p(c,p):(f.d(1),f=u(c),f&&(f.c(),f.m(e,n)))},d(c){c&&h(e),f.d(),l=!1,i()}}}function Si(r){let e,n='<svg viewBox="0 0 24 24" fill="currentColor" class="svelte-19422hk"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"></path></svg>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-s8oytu"&&(e.innerHTML=n),this.h()},h(){o(e,"class","media-placeholder svelte-19422hk")},m(t,s){S(t,e,s)},p:ne,d(t){t&&h(e)}}}function Ci(r){let e,n;return{c(){e=y("img"),this.h()},l(t){e=b(t,"IMG",{src:!0,alt:!0,class:!0,loading:!0}),this.h()},h(){Ke(e.src,n=`https://i.ytimg.com/vi/${r[0].youtubeId}/hqdefault.jpg`)||o(e,"src",n),o(e,"alt","YouTube video thumbnail"),o(e,"class","youtube-thumbnail svelte-19422hk"),o(e,"loading","lazy")},m(t,s){S(t,e,s)},p(t,s){s&1&&!Ke(e.src,n=`https://i.ytimg.com/vi/${t[0].youtubeId}/hqdefault.jpg`)&&o(e,"src",n)},d(t){t&&h(e)}}}function Di(r){let e,n,t,s,l;return{c(){e=j("svg"),n=j("polyline"),t=j("polyline"),s=j("line"),l=j("line"),this.h()},l(i){e=K(i,"svg",{viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0});var a=v(e);n=K(a,"polyline",{points:!0}),v(n).forEach(h),t=K(a,"polyline",{points:!0}),v(t).forEach(h),s=K(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(s).forEach(h),l=K(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(l).forEach(h),a.forEach(h),this.h()},h(){o(n,"points","15 3 21 3 21 9"),o(t,"points","9 21 3 21 3 15"),o(s,"x1","21"),o(s,"y1","3"),o(s,"x2","14"),o(s,"y2","10"),o(l,"x1","3"),o(l,"y1","21"),o(l,"x2","10"),o(l,"y2","14"),o(e,"viewBox","0 0 24 24"),o(e,"fill","none"),o(e,"stroke","currentColor"),o(e,"stroke-width","2"),o(e,"class","svelte-19422hk")},m(i,a){S(i,e,a),d(e,n),d(e,t),d(e,s),d(e,l)},d(i){i&&h(e)}}}function Li(r){let e,n,t,s,l;return{c(){e=j("svg"),n=j("polyline"),t=j("polyline"),s=j("line"),l=j("line"),this.h()},l(i){e=K(i,"svg",{viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0});var a=v(e);n=K(a,"polyline",{points:!0}),v(n).forEach(h),t=K(a,"polyline",{points:!0}),v(t).forEach(h),s=K(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(s).forEach(h),l=K(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(l).forEach(h),a.forEach(h),this.h()},h(){o(n,"points","4 14 10 14 10 20"),o(t,"points","20 10 14 10 14 4"),o(s,"x1","14"),o(s,"y1","10"),o(s,"x2","21"),o(s,"y2","3"),o(l,"x1","3"),o(l,"y1","21"),o(l,"x2","10"),o(l,"y2","14"),o(e,"viewBox","0 0 24 24"),o(e,"fill","none"),o(e,"stroke","currentColor"),o(e,"stroke-width","2"),o(e,"class","svelte-19422hk")},m(i,a){S(i,e,a),d(e,n),d(e,t),d(e,s),d(e,l)},d(i){i&&h(e)}}}function Ni(r){let e,n='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-19422hk"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg> <span class="svelte-19422hk">Video</span>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-1eb7tkd"&&(e.innerHTML=n),this.h()},h(){o(e,"class","media-placeholder svelte-19422hk")},m(t,s){S(t,e,s)},p:ne,d(t){t&&h(e)}}}function Ri(r){let e,n,t,s,l,i;return{c(){e=y("video"),n=y("track"),t=Q(`
					Your browser does not support the video tag.`),this.h()},l(a){e=b(a,"VIDEO",{src:!0,preload:!0,class:!0});var u=v(e);n=b(u,"TRACK",{kind:!0}),t=Z(u,`
					Your browser does not support the video tag.`),u.forEach(h),this.h()},h(){o(n,"kind","captions"),Ke(e.src,s=r[0].url)||o(e,"src",s),e.controls=!0,o(e,"preload","metadata"),o(e,"class","embedded-video svelte-19422hk")},m(a,u){S(a,e,u),d(e,n),d(e,t),l||(i=[ce(e,"play",r[20]),ce(e,"pause",r[21])],l=!0)},p(a,u){u&1&&!Ke(e.src,s=a[0].url)&&o(e,"src",s)},d(a){a&&h(e),l=!1,Ct(i)}}}function Pi(r){let e,n,t,s,l;return{c(){e=j("svg"),n=j("polyline"),t=j("polyline"),s=j("line"),l=j("line"),this.h()},l(i){e=K(i,"svg",{viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0});var a=v(e);n=K(a,"polyline",{points:!0}),v(n).forEach(h),t=K(a,"polyline",{points:!0}),v(t).forEach(h),s=K(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(s).forEach(h),l=K(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(l).forEach(h),a.forEach(h),this.h()},h(){o(n,"points","15 3 21 3 21 9"),o(t,"points","9 21 3 21 3 15"),o(s,"x1","21"),o(s,"y1","3"),o(s,"x2","14"),o(s,"y2","10"),o(l,"x1","3"),o(l,"y1","21"),o(l,"x2","10"),o(l,"y2","14"),o(e,"viewBox","0 0 24 24"),o(e,"fill","none"),o(e,"stroke","currentColor"),o(e,"stroke-width","2"),o(e,"class","svelte-19422hk")},m(i,a){S(i,e,a),d(e,n),d(e,t),d(e,s),d(e,l)},d(i){i&&h(e)}}}function Oi(r){let e,n,t,s,l;return{c(){e=j("svg"),n=j("polyline"),t=j("polyline"),s=j("line"),l=j("line"),this.h()},l(i){e=K(i,"svg",{viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0});var a=v(e);n=K(a,"polyline",{points:!0}),v(n).forEach(h),t=K(a,"polyline",{points:!0}),v(t).forEach(h),s=K(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(s).forEach(h),l=K(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(l).forEach(h),a.forEach(h),this.h()},h(){o(n,"points","4 14 10 14 10 20"),o(t,"points","20 10 14 10 14 4"),o(s,"x1","14"),o(s,"y1","10"),o(s,"x2","21"),o(s,"y2","3"),o(l,"x1","3"),o(l,"y1","21"),o(l,"x2","10"),o(l,"y2","14"),o(e,"viewBox","0 0 24 24"),o(e,"fill","none"),o(e,"stroke","currentColor"),o(e,"stroke-width","2"),o(e,"class","svelte-19422hk")},m(i,a){S(i,e,a),d(e,n),d(e,t),d(e,s),d(e,l)},d(i){i&&h(e)}}}function xi(r){let e,n,t,s,l,i,a,u=r[4]?"Encrypted image":"Image",f;return{c(){e=y("div"),n=j("svg"),t=j("rect"),s=j("circle"),l=j("polyline"),i=L(),a=y("span"),f=Q(u),this.h()},l(c){e=b(c,"DIV",{class:!0});var p=v(e);n=K(p,"svg",{viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0});var g=v(n);t=K(g,"rect",{x:!0,y:!0,width:!0,height:!0,rx:!0,ry:!0}),v(t).forEach(h),s=K(g,"circle",{cx:!0,cy:!0,r:!0}),v(s).forEach(h),l=K(g,"polyline",{points:!0}),v(l).forEach(h),g.forEach(h),i=D(p),a=b(p,"SPAN",{class:!0});var _=v(a);f=Z(_,u),_.forEach(h),p.forEach(h),this.h()},h(){o(t,"x","3"),o(t,"y","3"),o(t,"width","18"),o(t,"height","18"),o(t,"rx","2"),o(t,"ry","2"),o(s,"cx","8.5"),o(s,"cy","8.5"),o(s,"r","1.5"),o(l,"points","21 15 16 10 5 21"),o(n,"viewBox","0 0 24 24"),o(n,"fill","none"),o(n,"stroke","currentColor"),o(n,"stroke-width","2"),o(n,"class","svelte-19422hk"),o(a,"class","svelte-19422hk"),o(e,"class","media-placeholder svelte-19422hk")},m(c,p){S(c,e,p),d(e,n),d(n,t),d(n,s),d(n,l),d(e,i),d(e,a),d(a,f)},p(c,p){p&16&&u!==(u=c[4]?"Encrypted image":"Image")&&ve(f,u)},d(c){c&&h(e)}}}function Bi(r){let e;function n(l,i){return l[4]&&l[3]?Fi:l[4]&&l[9]?zi:l[4]&&!l[10]?Vi:l[10]?Hi:Ui}let t=n(r),s=t(r);return{c(){s.c(),e=Ue()},l(l){s.l(l),e=Ue()},m(l,i){s.m(l,i),S(l,e,i)},p(l,i){t===(t=n(l))&&s?s.p(l,i):(s.d(1),s=t(l),s&&(s.c(),s.m(e.parentNode,e)))},d(l){l&&h(e),s.d(l)}}}function Ui(r){let e,n,t,s;return{c(){e=y("img"),this.h()},l(l){e=b(l,"IMG",{src:!0,alt:!0,class:!0,loading:!0,role:!0,tabindex:!0,"aria-label":!0}),this.h()},h(){Ke(e.src,n=r[0].url)||o(e,"src",n),o(e,"alt","Embedded image"),o(e,"class","embedded-image svelte-19422hk"),o(e,"loading","lazy"),o(e,"role","button"),o(e,"tabindex","0"),o(e,"aria-label","View image in lightbox")},m(l,i){S(l,e,i),t||(s=[ce(e,"click",r[12]),ce(e,"keydown",r[18])],t=!0)},p(l,i){i&1&&!Ke(e.src,n=l[0].url)&&o(e,"src",n)},d(l){l&&h(e),t=!1,Ct(s)}}}function Hi(r){let e,n,t,s,l,i,a=r[4]&&Us();return{c(){e=y("img"),t=L(),a&&a.c(),s=Ue(),this.h()},l(u){e=b(u,"IMG",{src:!0,alt:!0,class:!0,loading:!0,role:!0,tabindex:!0,"aria-label":!0}),t=D(u),a&&a.l(u),s=Ue(),this.h()},h(){Ke(e.src,n=r[10])||o(e,"src",n),o(e,"alt","Embedded image"),o(e,"class","embedded-image svelte-19422hk"),o(e,"loading","lazy"),o(e,"role","button"),o(e,"tabindex","0"),o(e,"aria-label","View image in lightbox")},m(u,f){S(u,e,f),S(u,t,f),a&&a.m(u,f),S(u,s,f),l||(i=[ce(e,"click",r[12]),ce(e,"keydown",r[17])],l=!0)},p(u,f){f&1024&&!Ke(e.src,n=u[10])&&o(e,"src",n),u[4]?a||(a=Us(),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null)},d(u){u&&(h(e),h(t),h(s)),a&&a.d(u),l=!1,Ct(i)}}}function Vi(r){let e,n='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-19422hk"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg> <span class="svelte-19422hk">Encrypted image</span>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-dtdjvy"&&(e.innerHTML=n),this.h()},h(){o(e,"class","media-placeholder encrypted svelte-19422hk")},m(t,s){S(t,e,s)},p:ne,d(t){t&&h(e)}}}function zi(r){let e,n,t,s,l,i,a,u="Cannot decrypt",f,c,p;return{c(){e=y("div"),n=j("svg"),t=j("rect"),s=j("path"),l=j("line"),i=L(),a=y("span"),a.textContent=u,f=L(),c=y("span"),p=Q(r[9]),this.h()},l(g){e=b(g,"DIV",{class:!0});var _=v(e);n=K(_,"svg",{viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0});var E=v(n);t=K(E,"rect",{x:!0,y:!0,width:!0,height:!0,rx:!0,ry:!0}),v(t).forEach(h),s=K(E,"path",{d:!0}),v(s).forEach(h),l=K(E,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(l).forEach(h),E.forEach(h),i=D(_),a=b(_,"SPAN",{class:!0,"data-svelte-h":!0}),le(a)!=="svelte-1c1d6ns"&&(a.textContent=u),f=D(_),c=b(_,"SPAN",{class:!0});var w=v(c);p=Z(w,r[9]),w.forEach(h),_.forEach(h),this.h()},h(){o(t,"x","3"),o(t,"y","11"),o(t,"width","18"),o(t,"height","11"),o(t,"rx","2"),o(t,"ry","2"),o(s,"d","M7 11V7a5 5 0 0 1 10 0v4"),o(l,"x1","12"),o(l,"y1","15"),o(l,"x2","12"),o(l,"y2","17"),o(n,"viewBox","0 0 24 24"),o(n,"fill","none"),o(n,"stroke","currentColor"),o(n,"stroke-width","2"),o(n,"class","svelte-19422hk"),o(a,"class","svelte-19422hk"),o(c,"class","error-detail svelte-19422hk"),o(e,"class","media-placeholder error svelte-19422hk")},m(g,_){S(g,e,_),d(e,n),d(n,t),d(n,s),d(n,l),d(e,i),d(e,a),d(e,f),d(e,c),d(c,p)},p(g,_){_&512&&ve(p,g[9])},d(g){g&&h(e)}}}function Fi(r){let e,n='<svg class="spinner svelte-19422hk" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10" opacity="0.25"></circle><path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round"></path></svg> <span class="svelte-19422hk">Decrypting...</span>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-anar6u"&&(e.innerHTML=n),this.h()},h(){o(e,"class","media-placeholder decrypting svelte-19422hk")},m(t,s){S(t,e,s)},p:ne,d(t){t&&h(e)}}}function Us(r){let e,n='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-19422hk"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,title:!0,"data-svelte-h":!0}),le(e)!=="svelte-1y7j6n3"&&(e.innerHTML=n),this.h()},h(){o(e,"class","encrypted-badge svelte-19422hk"),o(e,"title","End-to-end encrypted")},m(t,s){S(t,e,s)},d(t){t&&h(e)}}}function Gi(r){let e,n,t,s,l;return{c(){e=j("svg"),n=j("polyline"),t=j("polyline"),s=j("line"),l=j("line"),this.h()},l(i){e=K(i,"svg",{viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0});var a=v(e);n=K(a,"polyline",{points:!0}),v(n).forEach(h),t=K(a,"polyline",{points:!0}),v(t).forEach(h),s=K(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(s).forEach(h),l=K(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(l).forEach(h),a.forEach(h),this.h()},h(){o(n,"points","15 3 21 3 21 9"),o(t,"points","9 21 3 21 3 15"),o(s,"x1","21"),o(s,"y1","3"),o(s,"x2","14"),o(s,"y2","10"),o(l,"x1","3"),o(l,"y1","21"),o(l,"x2","10"),o(l,"y2","14"),o(e,"viewBox","0 0 24 24"),o(e,"fill","none"),o(e,"stroke","currentColor"),o(e,"stroke-width","2"),o(e,"class","svelte-19422hk")},m(i,a){S(i,e,a),d(e,n),d(e,t),d(e,s),d(e,l)},d(i){i&&h(e)}}}function Ki(r){let e,n,t,s,l;return{c(){e=j("svg"),n=j("polyline"),t=j("polyline"),s=j("line"),l=j("line"),this.h()},l(i){e=K(i,"svg",{viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0});var a=v(e);n=K(a,"polyline",{points:!0}),v(n).forEach(h),t=K(a,"polyline",{points:!0}),v(t).forEach(h),s=K(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(s).forEach(h),l=K(a,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),v(l).forEach(h),a.forEach(h),this.h()},h(){o(n,"points","4 14 10 14 10 20"),o(t,"points","20 10 14 10 14 4"),o(s,"x1","14"),o(s,"y1","10"),o(s,"x2","21"),o(s,"y2","3"),o(l,"x1","3"),o(l,"y1","21"),o(l,"x2","10"),o(l,"y2","14"),o(e,"viewBox","0 0 24 24"),o(e,"fill","none"),o(e,"stroke","currentColor"),o(e,"stroke-width","2"),o(e,"class","svelte-19422hk")},m(i,a){S(i,e,a),d(e,n),d(e,t),d(e,s),d(e,l)},d(i){i&&h(e)}}}function Hs(r){let e,n,t='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-19422hk"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',s,l,i,a,u,f,c=r[4]&&Vs();return{c(){e=y("div"),n=y("button"),n.innerHTML=t,s=L(),l=y("img"),a=L(),c&&c.c(),this.h()},l(p){e=b(p,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0});var g=v(e);n=b(g,"BUTTON",{class:!0,"data-svelte-h":!0}),le(n)!=="svelte-1kciqcd"&&(n.innerHTML=t),s=D(g),l=b(g,"IMG",{src:!0,alt:!0,class:!0}),a=D(g),c&&c.l(g),g.forEach(h),this.h()},h(){o(n,"class","lightbox-close svelte-19422hk"),Ke(l.src,i=r[10])||o(l,"src",i),o(l,"alt","Full size image"),o(l,"class","lightbox-image svelte-19422hk"),o(e,"class","lightbox svelte-19422hk"),o(e,"role","button"),o(e,"tabindex","0"),o(e,"aria-label","Close lightbox")},m(p,g){S(p,e,g),d(e,n),d(e,s),d(e,l),d(e,a),c&&c.m(e,null),u||(f=[ce(n,"click",r[13]),ce(l,"click",kn(r[16])),ce(e,"click",r[13]),ce(e,"keydown",r[19])],u=!0)},p(p,g){g&1024&&!Ke(l.src,i=p[10])&&o(l,"src",i),p[4]?c||(c=Vs(),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},d(p){p&&h(e),c&&c.d(),u=!1,Ct(f)}}}function Vs(r){let e,n='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-19422hk"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg> <span>End-to-end encrypted</span>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-hai5t4"&&(e.innerHTML=n),this.h()},h(){o(e,"class","lightbox-encrypted-badge svelte-19422hk")},m(t,s){S(t,e,s)},d(t){t&&h(e)}}}function ji(r){let e;function n(l,i){if(l[0].type==="image")return Ai;if(l[0].type==="video")return Ti;if(l[0].type==="youtube"&&l[0].youtubeId)return wi}let t=n(r),s=t&&t(r);return{c(){e=y("div"),s&&s.c(),this.h()},l(l){e=b(l,"DIV",{class:!0});var i=v(e);s&&s.l(i),i.forEach(h),this.h()},h(){o(e,"class","media-embed svelte-19422hk")},m(l,i){S(l,e,i),s&&s.m(e,null),r[22](e)},p(l,[i]){t===(t=n(l))&&s?s.p(l,i):(s&&s.d(1),s=t&&t(l),s&&(s.c(),s.m(e,null)))},i:ne,o:ne,d(l){l&&h(e),s&&s.d(),r[22](null)}}}function Yi(r,e,n){let t,s,l;Mt(r,Lt,U=>n(24,l=U));let{media:i}=e,a,u=!1,f=!1,c=!1,p=!1,g=!1,_=null,E=null,w=!1;async function k(){if(!(!t||_||w||!i.encryption)){if(!l.privateKey){n(9,E="Private key required for decryption");return}n(3,w=!0),n(9,E=null);try{const U=await fetch(i.url);if(!U.ok)throw new Error(`Failed to fetch encrypted image: ${U.status}`);const ie=await U.arrayBuffer(),ee=await nl(ie,i.encryption.encryptedKey,i.encryption.senderPubkey,l.privateKey);n(15,_=URL.createObjectURL(ee))}catch(U){console.error("Failed to decrypt image:",U),n(9,E=U instanceof Error?U.message:"Decryption failed")}finally{n(3,w=!1)}}}mr(()=>{_&&URL.revokeObjectURL(_)}),Cn(()=>{const U=new IntersectionObserver(ie=>{ie.forEach(ee=>{ee.isIntersecting&&!u&&n(1,u=!0)})},{rootMargin:"100px"});return U.observe(a),()=>{U.disconnect()}});function T(){n(6,f=!f)}let I="";function R(){i.type==="image"&&(n(2,c=!0),I=document.body.style.overflow,document.body.style.overflow="hidden")}function O(){n(2,c=!1),document.body.style.overflow=I}function Y(){n(8,g=!0)}function M(U){U.key==="Escape"&&c&&O()}function A(U){Gn.call(this,r,U)}const B=U=>(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),R()),x=U=>(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),R()),J=U=>(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),O()),G=()=>n(7,p=!0),V=()=>n(7,p=!1);function W(U){hn[U?"unshift":"push"](()=>{a=U,n(5,a)})}return r.$$set=U=>{"media"in U&&n(0,i=U.media)},r.$$.update=()=>{r.$$.dirty&1&&n(4,t=i.type==="image"&&i.encryption?.encrypted===!0),r.$$.dirty&32785&&n(10,s=t?_:i.url),r.$$.dirty&32794&&u&&t&&!_&&!w&&k(),r.$$.dirty&4&&(c?window.addEventListener("keydown",M):window.removeEventListener("keydown",M))},[i,u,c,w,t,a,f,p,g,E,s,T,R,O,Y,_,A,B,x,J,G,V,W]}class Wi extends Rt{constructor(e){super(),Pt(this,e,Yi,ji,Nt,{media:0})}}const tn={linkPreviewsEnabled:!0,mediaAutoPlay:!1,theme:"auto",notificationsEnabled:!0,soundEnabled:!0},Sr="Nostr-BBS-user-preferences";function Xi(){try{const r=localStorage.getItem(Sr);if(!r)return tn;const e=JSON.parse(r);return{...tn,...e}}catch{return tn}}function Ht(r){try{localStorage.setItem(Sr,JSON.stringify(r))}catch(e){console.warn("Failed to save preferences:",e)}}function qi(){const{subscribe:r,set:e,update:n}=pn(tn);return typeof window<"u"&&e(Xi()),{subscribe:r,update:t=>{n(s=>{const l=t(s);return Ht(l),l})},set:t=>{Ht(t),e(t)},toggleLinkPreviews:()=>{n(t=>{const s={...t,linkPreviewsEnabled:!t.linkPreviewsEnabled};return Ht(s),s})},toggleMediaAutoPlay:()=>{n(t=>{const s={...t,mediaAutoPlay:!t.mediaAutoPlay};return Ht(s),s})},setTheme:t=>{n(s=>{const l={...s,theme:t};return Ht(l),l})},toggleNotifications:()=>{n(t=>{const s={...t,notificationsEnabled:!t.notificationsEnabled};return Ht(s),s})},toggleSound:()=>{n(t=>{const s={...t,soundEnabled:!t.soundEnabled};return Ht(s),s})},reset:()=>{Ht(tn),e(tn)}}}const Ji=qi(),_t={LIKE:"+",DISLIKE:"-",LOVE:"❤️",LAUGH:"😂",SURPRISED:"😮",SAD:"😢",THUMBS_UP:"👍",FIRE:"🔥",PARTY:"🎉"};function Zi(r,e,n,t){const s=[["e",r]];t&&s.push(["p",t]);const l={kind:Tn.REACTION,created_at:Math.floor(Date.now()/1e3),tags:s,content:e},i=Kn.hexToBytes(n);return xr(l,i)}function zs(r){if(r.kind!==Tn.REACTION||!r.tags||!r.id)return null;const e=r.tags.find(t=>t[0]==="e");if(!e||!e[1])return null;const n=r.tags.find(t=>t[0]==="p");return{eventId:e[1],authorPubkey:n?.[1]||"",content:r.content,reactorPubkey:r.pubkey,timestamp:r.created_at,reactionEventId:r.id}}function Mn(r){const e=r.trim();return e==="+"||e==="👍"||e.toLowerCase()==="like"?_t.LIKE:e==="-"||e==="👎"||e.toLowerCase()==="dislike"?_t.DISLIKE:e}function Fs(r){const e=Mn(r);return{[_t.LIKE]:"👍",[_t.DISLIKE]:"👎"}[e]||e}function Qi(r){const e=new Map;for(const n of r){const t=Mn(n.content),s=e.get(t)||[];s.includes(n.reactorPubkey)||(s.push(n.reactorPubkey),e.set(t,s))}return e}function $i(r,e){return r.find(n=>n.reactorPubkey===e)||null}const Gs={reactionsByMessage:new Map,optimisticReactions:new Map,loading:!1,error:null,activeSubscriptions:new Map};function eo(){const{subscribe:r,set:e,update:n}=pn(Gs);function t(l){const i=Dn();if(!i)return console.debug("[Reactions] NDK not initialized, skipping event conversion"),null;if(!l.id||!l.tags)return console.debug("[Reactions] Event missing required id or tags"),null;const a=new Zn(i);return a.id=l.id,a.pubkey=l.pubkey,a.created_at=l.created_at,a.kind=l.kind,a.tags=l.tags,a.content=l.content,a.sig=l.sig,a}function s(l){return{id:l.id,pubkey:l.pubkey,created_at:l.created_at||Math.floor(Date.now()/1e3),kind:l.kind||0,tags:l.tags,content:l.content,sig:l.sig||""}}return{subscribe:r,async fetchReactions(l,i){if(l.length!==0){n(a=>({...a,loading:!0,error:null}));try{const a={kinds:[Tn.REACTION],"#e":l};rs(a,{closeOnEose:!1}).on("event",f=>{const c=s(f),p=zs(c);p&&n(g=>{const _=g.reactionsByMessage.get(p.eventId)||[];if(!_.some(w=>w.reactionEventId===p.reactionEventId)){const w=[..._,p],k=new Map(g.reactionsByMessage);return k.set(p.eventId,w),{...g,reactionsByMessage:k,loading:!1}}return{...g,loading:!1}})})}catch(a){const u=a instanceof Error?a.message:"Failed to fetch reactions";n(f=>({...f,error:u,loading:!1}))}}},async addReaction(l,i,a,u){const f=We(Lt);if(!f.privateKey)throw new Error("No private key available");const c=Mn(i),p=`optimistic-${Date.now()}`,g={eventId:l,authorPubkey:u||"",content:c,reactorPubkey:f.publicKey||"",timestamp:Math.floor(Date.now()/1e3),reactionEventId:p};n(_=>{const w=(_.reactionsByMessage.get(l)||[]).filter(I=>I.reactorPubkey!==g.reactorPubkey),k=new Map(_.reactionsByMessage);k.set(l,[...w,g]);const T=new Map(_.optimisticReactions);return T.set(p,g),{..._,reactionsByMessage:k,optimisticReactions:T}});try{const _=Zi(l,c,f.privateKey,u),E=t(_);if(!E)throw new Error("NDK not connected");await gr(E);const w={...g,reactionEventId:_.id||p};n(k=>{const I=(k.reactionsByMessage.get(l)||[]).filter(Y=>Y.reactionEventId!==p),R=new Map(k.reactionsByMessage);R.set(l,[...I,w]);const O=new Map(k.optimisticReactions);return O.delete(p),{...k,reactionsByMessage:R,optimisticReactions:O}})}catch(_){throw n(E=>{const k=(E.reactionsByMessage.get(l)||[]).filter(R=>R.reactionEventId!==p),T=new Map(E.reactionsByMessage);T.set(l,k);const I=new Map(E.optimisticReactions);return I.delete(p),{...E,reactionsByMessage:T,optimisticReactions:I,error:_ instanceof Error?_.message:"Failed to add reaction"}}),_}},async removeReaction(l,i){const a=We(Lt);if(!a.publicKey)throw new Error("Not authenticated");n(u=>{const c=(u.reactionsByMessage.get(l)||[]).filter(g=>g.reactorPubkey!==a.publicKey),p=new Map(u.reactionsByMessage);return p.set(l,c),{...u,reactionsByMessage:p}})},async subscribeToReactions(l,i){if(l.length===0)return;const a={kinds:[Tn.REACTION],"#e":l,since:Math.floor(Date.now()/1e3)},u=`reactions_${Date.now()}_${Math.random().toString(36).slice(2)}`,f=rs(a,{closeOnEose:!1,subId:u});f.on("event",c=>{const p=s(c),g=zs(p);g&&n(_=>{const E=_.reactionsByMessage.get(g.eventId)||[];if(!E.some(k=>k.reactionEventId===g.reactionEventId)){const k=[...E,g],T=new Map(_.reactionsByMessage);return T.set(g.eventId,k),{..._,reactionsByMessage:T}}return{..._}})}),n(c=>{const p=c.activeSubscriptions.get(i)||[],g=new Map(c.activeSubscriptions);return g.set(i,[...p,{subId:u,subscription:f}]),{...c,activeSubscriptions:g}})},unsubscribe(l){const a=We({subscribe:r}).activeSubscriptions.get(l);a&&(a.forEach(({subscription:u})=>{u.stop()}),n(u=>{const f=new Map(u.activeSubscriptions);return f.delete(l),{...u,activeSubscriptions:f}}))},getReactionSummary(l){const a=We({subscribe:r}).reactionsByMessage.get(l)||[],u=We(Lt),f=Qi(a),c=new Map;for(const[g,_]of f.entries())c.set(g,{content:g,count:_.length,reactors:_,userReacted:u.publicKey?_.includes(u.publicKey):!1});const p=u.publicKey&&$i(a,u.publicKey)?.content||null;return{messageId:l,reactions:c,totalCount:a.length,userReaction:p?Mn(p):null}},clearError(){n(l=>({...l,error:null}))},clear(){e(Gs)},disconnectAll(){We({subscribe:r}).activeSubscriptions.forEach(i=>{i.forEach(({subscription:a})=>{a.stop()})}),n(i=>({...i,activeSubscriptions:new Map}))}}}const Jt=eo();function to(r){return mn(Jt,e=>Jt.getReactionSummary(r))}typeof window<"u"&&window.addEventListener("beforeunload",()=>{Jt.disconnectAll()});function Ks(r,e,n){const t=r.slice();return t[11]=e[n],t}function js(r){let e,n=nt(Array.from(r[2].reactions.values())),t=[];for(let s=0;s<n.length;s+=1)t[s]=Ys(Ks(r,n,s));return{c(){e=y("div");for(let s=0;s<t.length;s+=1)t[s].c();this.h()},l(s){e=b(s,"DIV",{class:!0});var l=v(e);for(let i=0;i<t.length;i+=1)t[i].l(l);l.forEach(h),this.h()},h(){o(e,"class","flex flex-wrap gap-1 mt-2")},m(s,l){S(s,e,l);for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(e,null)},p(s,l){if(l&29){n=nt(Array.from(s[2].reactions.values()));let i;for(i=0;i<n.length;i+=1){const a=Ks(s,n,i);t[i]?t[i].p(a,l):(t[i]=Ys(a),t[i].c(),t[i].m(e,null))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}},d(s){s&&h(e),nn(t,s)}}}function Ys(r){let e,n,t=Fs(r[11].content)+"",s,l,i,a=r[11].count+"",u,f,c,p,g,_,E;function w(){return r[9](r[11])}return{c(){e=y("button"),n=y("span"),s=Q(t),l=L(),i=y("span"),u=Q(a),f=L(),this.h()},l(k){e=b(k,"BUTTON",{class:!0,title:!0});var T=v(e);n=b(T,"SPAN",{class:!0});var I=v(n);s=Z(I,t),I.forEach(h),l=D(T),i=b(T,"SPAN",{class:!0});var R=v(i);u=Z(R,a),R.forEach(h),f=D(T),T.forEach(h),this.h()},h(){o(n,"class","text-base leading-none"),o(i,"class","text-xs font-medium"),o(e,"class",c="btn btn-xs "+(r[11].userReacted?"btn-primary":"btn-ghost")+" gap-1 hover:scale-105 transition-transform svelte-gm3cxn"),e.disabled=p=!r[0],o(e,"title",g=r[4](r[11].reactors))},m(k,T){S(k,e,T),d(e,n),d(n,s),d(e,l),d(e,i),d(i,u),d(e,f),_||(E=ce(e,"click",w),_=!0)},p(k,T){r=k,T&4&&t!==(t=Fs(r[11].content)+"")&&ve(s,t),T&4&&a!==(a=r[11].count+"")&&ve(u,a),T&4&&c!==(c="btn btn-xs "+(r[11].userReacted?"btn-primary":"btn-ghost")+" gap-1 hover:scale-105 transition-transform svelte-gm3cxn")&&o(e,"class",c),T&1&&p!==(p=!r[0])&&(e.disabled=p),T&4&&g!==(g=r[4](r[11].reactors))&&o(e,"title",g)},d(k){k&&h(e),_=!1,E()}}}function no(r){let e,n=r[2].totalCount>0&&js(r);return{c(){n&&n.c(),e=Ue()},l(t){n&&n.l(t),e=Ue()},m(t,s){n&&n.m(t,s),S(t,e,s)},p(t,[s]){t[2].totalCount>0?n?n.p(t,s):(n=js(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ne,o:ne,d(t){t&&h(e),n&&n.d(t)}}}function so(r,e,n){let t,s,l,i,a=ne,u=()=>(a(),a=yn(t,k=>n(2,i=k)),t);Mt(r,Lt,k=>n(8,l=k)),r.$$.on_destroy.push(()=>a());let{messageId:f}=e,{relayUrl:c=""}=e,{authorPubkey:p=""}=e;const g=Sn();async function _(k){if(s)try{Jt.getReactionSummary(f).userReaction===k?(await Jt.removeReaction(f,c),g("unreact")):(await Jt.addReaction(f,k,c,p),g("react",{emoji:k}))}catch(T){console.error("Failed to toggle reaction:",T)}}function E(k){const T=l.publicKey,I=k.map(R=>R===T?"You":Zt.getCachedSync(R)?.displayName||`${R.slice(0,8)}...${R.slice(-4)}`);return I.length===0?"":I.length===1?I[0]:I.length===2?`${I[0]} and ${I[1]}`:`${I[0]}, ${I[1]} and ${I.length-2} other${I.length-2>1?"s":""}`}Cn(()=>{const k=Array.from(i.reactions.values()).flatMap(T=>T.reactors).filter(T=>T!==l.publicKey);k.length>0&&Zt.prefetchProfiles(k)});const w=k=>_(k.content);return r.$$set=k=>{"messageId"in k&&n(5,f=k.messageId),"relayUrl"in k&&n(6,c=k.relayUrl),"authorPubkey"in k&&n(7,p=k.authorPubkey)},r.$$.update=()=>{r.$$.dirty&32&&u(n(1,t=to(f))),r.$$.dirty&256&&n(0,s=l.isAuthenticated)},[s,t,i,_,E,f,c,p,l,w]}class ro extends Rt{constructor(e){super(),Pt(this,e,so,no,Nt,{messageId:5,relayUrl:6,authorPubkey:7})}}function Ws(r,e,n){const t=r.slice();return t[7]=e[n].emoji,t[8]=e[n].label,t}function Xs(r){let e,n,t,s,l,i,a,u=nt(r[1]),f=[];for(let c=0;c<u.length;c+=1)f[c]=qs(Ws(r,u,c));return{c(){e=y("div"),n=y("div"),t=y("div");for(let c=0;c<f.length;c+=1)f[c].c();s=L(),l=y("div"),this.h()},l(c){e=b(c,"DIV",{class:!0,role:!0,"aria-label":!0});var p=v(e);n=b(p,"DIV",{class:!0});var g=v(n);t=b(g,"DIV",{class:!0});var _=v(t);for(let E=0;E<f.length;E+=1)f[E].l(_);_.forEach(h),g.forEach(h),p.forEach(h),s=D(c),l=b(c,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0}),v(l).forEach(h),this.h()},h(){o(t,"class","grid grid-cols-4 gap-1"),o(n,"class","bg-base-100 rounded-lg shadow-lg border border-base-300 p-2"),o(e,"class","reaction-picker absolute bottom-full left-0 mb-2 z-50 svelte-17d5r88"),o(e,"role","dialog"),o(e,"aria-label","Reaction picker"),o(l,"class","fixed inset-0 z-40 lg:hidden"),o(l,"role","button"),o(l,"tabindex","-1"),o(l,"aria-label","Close reaction picker")},m(c,p){S(c,e,p),d(e,n),d(n,t);for(let g=0;g<f.length;g+=1)f[g]&&f[g].m(t,null);S(c,s,p),S(c,l,p),i||(a=[ce(l,"click",r[3]),ce(l,"keydown",r[4])],i=!0)},p(c,p){if(p&6){u=nt(c[1]);let g;for(g=0;g<u.length;g+=1){const _=Ws(c,u,g);f[g]?f[g].p(_,p):(f[g]=qs(_),f[g].c(),f[g].m(t,null))}for(;g<f.length;g+=1)f[g].d(1);f.length=u.length}},d(c){c&&(h(e),h(s),h(l)),nn(f,c),i=!1,Ct(a)}}}function qs(r){let e,n,t=r[7]+"",s,l,i,a;function u(){return r[5](r[7])}return{c(){e=y("button"),n=y("span"),s=Q(t),l=L(),this.h()},l(f){e=b(f,"BUTTON",{class:!0,title:!0,"aria-label":!0});var c=v(e);n=b(c,"SPAN",{class:!0});var p=v(n);s=Z(p,t),p.forEach(h),l=D(c),c.forEach(h),this.h()},h(){o(n,"class","text-2xl leading-none"),o(e,"class","btn btn-ghost btn-sm hover:btn-primary aspect-square p-2 flex items-center justify-center svelte-17d5r88"),o(e,"title",r[8]),o(e,"aria-label",r[8])},m(f,c){S(f,e,c),d(e,n),d(n,s),d(e,l),i||(a=ce(e,"click",u),i=!0)},p(f,c){r=f},d(f){f&&h(e),i=!1,a()}}}function lo(r){let e,n=r[0]&&Xs(r);return{c(){n&&n.c(),e=Ue()},l(t){n&&n.l(t),e=Ue()},m(t,s){n&&n.m(t,s),S(t,e,s)},p(t,[s]){t[0]?n?n.p(t,s):(n=Xs(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ne,o:ne,d(t){t&&h(e),n&&n.d(t)}}}function io(r,e,n){let{show:t=!1}=e;const s=Sn(),l=[{emoji:_t.LIKE,label:"Like"},{emoji:_t.LOVE,label:"Love"},{emoji:_t.LAUGH,label:"Laugh"},{emoji:_t.SURPRISED,label:"Surprised"},{emoji:_t.SAD,label:"Sad"},{emoji:_t.FIRE,label:"Fire"},{emoji:_t.PARTY,label:"Party"},{emoji:_t.THUMBS_UP,label:"Thumbs Up"}];function i(c){s("select",{emoji:c}),n(0,t=!1)}function a(c){c.target.closest(".reaction-picker")||(s("close"),n(0,t=!1))}function u(c){c.key==="Escape"&&(s("close"),n(0,t=!1))}const f=c=>i(c);return r.$$set=c=>{"show"in c&&n(0,t=c.show)},[t,l,i,a,u,f]}class oo extends Rt{constructor(e){super(),Pt(this,e,io,lo,Nt,{show:0})}}const Js=/@(npub1[a-z0-9]{58}|[a-f0-9]{64}|[\w-]{1,30})/gi;function ao(r){return/^(npub1[a-z0-9]{58}|[a-f0-9]{64})$/i.test(r)}function co(r,e){const n=[];let t;for(Js.lastIndex=0;(t=Js.exec(r))!==null;){const s=t[1];let l;if(ao(s))l=s.startsWith("npub1")?uo(s):s;else if(e){const i=e(s);if(!i)continue;l=i}else continue;n.push({pubkey:l,startIndex:t.index,endIndex:t.index+t[0].length,originalText:s})}return n}function Jn(r){return r?r.startsWith("npub1")?r.slice(0,12)+"..."+r.slice(-4):r.slice(0,8)+"..."+r.slice(-4):""}function uo(r){if(!r.startsWith("npub1"))return r;try{const e=Br.decode(r);return e.type==="npub"?e.data:r}catch(e){return console.error("Failed to decode npub to hex:",e),r}}function Zs(r,e,n){const t=r.slice();return t[4]=e[n],t}function fo(r){let e=r[4].content+"",n;return{c(){n=Q(e)},l(t){n=Z(t,e)},m(t,s){S(t,n,s)},p(t,s){s&1&&e!==(e=t[4].content+"")&&ve(n,e)},d(t){t&&h(n)}}}function ho(r){let e,n,t=r[4].displayName+"",s,l;return{c(){e=y("span"),n=Q("@"),s=Q(t),this.h()},l(i){e=b(i,"SPAN",{class:!0,title:!0});var a=v(e);n=Z(a,"@"),s=Z(a,t),a.forEach(h),this.h()},h(){o(e,"class","mention-tag svelte-1i5qaz1"),o(e,"title",l=r[4].pubkey?`Pubkey: ${Jn(r[4].pubkey)}`:"")},m(i,a){S(i,e,a),d(e,n),d(e,s)},p(i,a){a&1&&t!==(t=i[4].displayName+"")&&ve(s,t),a&1&&l!==(l=i[4].pubkey?`Pubkey: ${Jn(i[4].pubkey)}`:"")&&o(e,"title",l)},d(i){i&&h(e)}}}function Qs(r){let e;function n(l,i){return l[4].type==="mention"?ho:fo}let t=n(r),s=t(r);return{c(){s.c(),e=Ue()},l(l){s.l(l),e=Ue()},m(l,i){s.m(l,i),S(l,e,i)},p(l,i){t===(t=n(l))&&s?s.p(l,i):(s.d(1),s=t(l),s&&(s.c(),s.m(e.parentNode,e)))},d(l){l&&h(e),s.d(l)}}}function po(r){let e,n=nt(r[0]),t=[];for(let s=0;s<n.length;s+=1)t[s]=Qs(Zs(r,n,s));return{c(){for(let s=0;s<t.length;s+=1)t[s].c();e=Ue()},l(s){for(let l=0;l<t.length;l+=1)t[l].l(s);e=Ue()},m(s,l){for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(s,l);S(s,e,l)},p(s,[l]){if(l&1){n=nt(s[0]);let i;for(i=0;i<n.length;i+=1){const a=Zs(s,n,i);t[i]?t[i].p(a,l):(t[i]=Qs(a),t[i].c(),t[i].m(e.parentNode,e))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}},i:ne,o:ne,d(s){s&&h(e),nn(t,s)}}}function mo(r,e,n){let t,{content:s}=e,{resolver:l=void 0}=e;function i(a){const u=co(a,l);if(u.length===0)return[{type:"text",content:a}];const f=[];let c=0;for(const p of u){p.startIndex>c&&f.push({type:"text",content:a.slice(c,p.startIndex)});let g=p.originalText||Jn(p.pubkey);const _=Zt.getCachedSync(p.pubkey);_&&(g=_.displayName||g),f.push({type:"mention",content:a.slice(p.startIndex,p.endIndex),pubkey:p.pubkey,displayName:g}),c=p.endIndex}return c<a.length&&f.push({type:"text",content:a.slice(c)}),f}return r.$$set=a=>{"content"in a&&n(1,s=a.content),"resolver"in a&&n(2,l=a.resolver)},r.$$.update=()=>{r.$$.dirty&2&&n(0,t=i(s))},[t,s,l]}class vo extends Rt{constructor(e){super(),Pt(this,e,mo,po,Nt,{content:1,resolver:2})}}function $s(r,e,n){const t=r.slice();return t[32]=e[n],t}function er(r){let e,n,t;return n=new br({props:{pubkey:r[1].authorPubkey,showAvatar:!0,showName:!1,avatarSize:"sm",clickable:!1}}),{c(){e=y("div"),ht(n.$$.fragment),this.h()},l(s){e=b(s,"DIV",{class:!0});var l=v(e);dt(n.$$.fragment,l),l.forEach(h),this.h()},h(){o(e,"class","flex-shrink-0")},m(s,l){S(s,e,l),ft(n,e,null),t=!0},p(s,l){const i={};l[0]&2&&(i.pubkey=s[1].authorPubkey),n.$set(i)},i(s){t||(ae(n.$$.fragment,s),t=!0)},o(s){_e(n.$$.fragment,s),t=!1},d(s){s&&h(e),ut(n)}}}function go(r){let e,n;return e=new br({props:{pubkey:r[1].authorPubkey,showAvatar:!1,showName:!0,showFullName:!0,clickable:!1,maxNameLength:20}}),{c(){ht(e.$$.fragment)},l(t){dt(e.$$.fragment,t)},m(t,s){ft(e,t,s),n=!0},p(t,s){const l={};s[0]&2&&(l.pubkey=t[1].authorPubkey),e.$set(l)},i(t){n||(ae(e.$$.fragment,t),n=!0)},o(t){_e(e.$$.fragment,t),n=!1},d(t){ut(e,t)}}}function _o(r){let e,n="You";return{c(){e=y("span"),e.textContent=n,this.h()},l(t){e=b(t,"SPAN",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-ubs0rj"&&(e.textContent=n),this.h()},h(){o(e,"class","font-semibold text-sm truncate")},m(t,s){S(t,e,s)},p:ne,i:ne,o:ne,d(t){t&&h(e)}}}function tr(r){let e,n='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-warning" viewBox="0 0 20 20" fill="currentColor"><path d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z"></path></svg>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-tip":!0,"data-svelte-h":!0}),le(e)!=="svelte-17i1c2g"&&(e.innerHTML=n),this.h()},h(){o(e,"class","tooltip tooltip-top"),o(e,"data-tip","Pinned message")},m(t,s){S(t,e,s)},d(t){t&&h(e)}}}function nr(r){let e,n;function t(i,a){if(i[1].sendStatus==="sending")return ko;if(i[1].sendStatus==="sent")return yo;if(i[1].sendStatus==="delivered")return bo}let s=t(r),l=s&&s(r);return{c(){e=y("span"),l&&l.c(),this.h()},l(i){e=b(i,"SPAN",{class:!0,title:!0});var a=v(e);l&&l.l(a),a.forEach(h),this.h()},h(){o(e,"class","send-status"),o(e,"title",n=r[1].sendStatus==="sent"?"Sent to relay":r[1].sendStatus==="delivered"?"Delivered":"Sending...")},m(i,a){S(i,e,a),l&&l.m(e,null)},p(i,a){s!==(s=t(i))&&(l&&l.d(1),l=s&&s(i),l&&(l.c(),l.m(e,null))),a[0]&2&&n!==(n=i[1].sendStatus==="sent"?"Sent to relay":i[1].sendStatus==="delivered"?"Delivered":"Sending...")&&o(e,"title",n)},d(i){i&&h(e),l&&l.d()}}}function bo(r){let e,n;return{c(){e=j("svg"),n=j("path"),this.h()},l(t){e=K(t,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var s=v(e);n=K(s,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),v(n).forEach(h),s.forEach(h),this.h()},h(){o(n,"fill-rule","evenodd"),o(n,"d","M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"),o(n,"clip-rule","evenodd"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"class","h-3 w-3 text-success"),o(e,"viewBox","0 0 20 20"),o(e,"fill","currentColor")},m(t,s){S(t,e,s),d(e,n)},d(t){t&&h(e)}}}function yo(r){let e,n;return{c(){e=j("svg"),n=j("path"),this.h()},l(t){e=K(t,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var s=v(e);n=K(s,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),v(n).forEach(h),s.forEach(h),this.h()},h(){o(n,"fill-rule","evenodd"),o(n,"d","M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"),o(n,"clip-rule","evenodd"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"class","h-3 w-3 text-success"),o(e,"viewBox","0 0 20 20"),o(e,"fill","currentColor")},m(t,s){S(t,e,s),d(e,n)},d(t){t&&h(e)}}}function ko(r){let e,n;return{c(){e=j("svg"),n=j("circle"),this.h()},l(t){e=K(t,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var s=v(e);n=K(s,"circle",{cx:!0,cy:!0,r:!0}),v(n).forEach(h),s.forEach(h),this.h()},h(){o(n,"cx","10"),o(n,"cy","10"),o(n,"r","3"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"class","h-3 w-3 animate-pulse text-base-content/40"),o(e,"viewBox","0 0 20 20"),o(e,"fill","currentColor")},m(t,s){S(t,e,s),d(e,n)},d(t){t&&h(e)}}}function Eo(r){let e,n,t;return n=new vo({props:{content:r[3]}}),{c(){e=y("p"),ht(n.$$.fragment),this.h()},l(s){e=b(s,"P",{class:!0});var l=v(e);dt(n.$$.fragment,l),l.forEach(h),this.h()},h(){o(e,"class","whitespace-pre-wrap")},m(s,l){S(s,e,l),ft(n,e,null),t=!0},p(s,l){const i={};l[0]&8&&(i.content=s[3]),n.$set(i)},i(s){t||(ae(n.$$.fragment,s),t=!0)},o(s){_e(n.$$.fragment,s),t=!1},d(s){s&&h(e),ut(n)}}}function wo(r){let e,n='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path></svg> <span class="italic">Encrypted message</span>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-1c33he"&&(e.innerHTML=n),this.h()},h(){o(e,"class","flex items-center gap-2 text-sm opacity-70")},m(t,s){S(t,e,s)},p:ne,i:ne,o:ne,d(t){t&&h(e)}}}function sr(r){let e,n='<svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path></svg> <span>Encrypted</span>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-1gjsd08"&&(e.innerHTML=n),this.h()},h(){o(e,"class","flex items-center gap-1 mt-1 text-xs opacity-60")},m(t,s){S(t,e,s)},d(t){t&&h(e)}}}function rr(r){let e,n,t=nt(r[4]),s=[];for(let i=0;i<t.length;i+=1)s[i]=lr($s(r,t,i));const l=i=>_e(s[i],1,1,()=>{s[i]=null});return{c(){e=y("div");for(let i=0;i<s.length;i+=1)s[i].c();this.h()},l(i){e=b(i,"DIV",{class:!0});var a=v(e);for(let u=0;u<s.length;u+=1)s[u].l(a);a.forEach(h),this.h()},h(){o(e,"class","media-container mt-2")},m(i,a){S(i,e,a);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(e,null);n=!0},p(i,a){if(a[0]&16){t=nt(i[4]);let u;for(u=0;u<t.length;u+=1){const f=$s(i,t,u);s[u]?(s[u].p(f,a),ae(s[u],1)):(s[u]=lr(f),s[u].c(),ae(s[u],1),s[u].m(e,null))}for(bt(),u=t.length;u<s.length;u+=1)l(u);yt()}},i(i){if(!n){for(let a=0;a<t.length;a+=1)ae(s[a]);n=!0}},o(i){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)_e(s[a]);n=!1},d(i){i&&h(e),nn(s,i)}}}function To(r){let e,n;return e=new Wi({props:{media:r[32]}}),{c(){ht(e.$$.fragment)},l(t){dt(e.$$.fragment,t)},m(t,s){ft(e,t,s),n=!0},p(t,s){const l={};s[0]&16&&(l.media=t[32]),e.$set(l)},i(t){n||(ae(e.$$.fragment,t),n=!0)},o(t){_e(e.$$.fragment,t),n=!1},d(t){ut(e,t)}}}function Ao(r){let e,n;return e=new Ei({props:{url:r[32].url}}),{c(){ht(e.$$.fragment)},l(t){dt(e.$$.fragment,t)},m(t,s){ft(e,t,s),n=!0},p(t,s){const l={};s[0]&16&&(l.url=t[32].url),e.$set(l)},i(t){n||(ae(e.$$.fragment,t),n=!0)},o(t){_e(e.$$.fragment,t),n=!1},d(t){ut(e,t)}}}function lr(r){let e,n,t,s;const l=[Ao,To],i=[];function a(u,f){return u[32].type==="link"?0:1}return e=a(r),n=i[e]=l[e](r),{c(){n.c(),t=Ue()},l(u){n.l(u),t=Ue()},m(u,f){i[e].m(u,f),S(u,t,f),s=!0},p(u,f){let c=e;e=a(u),e===c?i[e].p(u,f):(bt(),_e(i[c],1,1,()=>{i[c]=null}),yt(),n=i[e],n?n.p(u,f):(n=i[e]=l[e](u),n.c()),ae(n,1),n.m(t.parentNode,t))},i(u){s||(ae(n),s=!0)},o(u){_e(n),s=!1},d(u){u&&h(t),i[e].d(u)}}}function ir(r){let e,n,t,s,l,i=r[13]?"Unpin":"Pin",a,u,f,c,p,g;return{c(){e=y("button"),n=j("svg"),t=j("path"),l=L(),a=Q(i),this.h()},l(_){e=b(_,"BUTTON",{class:!0,"aria-label":!0,title:!0});var E=v(e);n=K(E,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var w=v(n);t=K(w,"path",{d:!0}),v(t).forEach(h),w.forEach(h),l=D(E),a=Z(E,i),E.forEach(h),this.h()},h(){o(t,"d","M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z"),o(n,"xmlns","http://www.w3.org/2000/svg"),o(n,"class",s="h-4 w-4 "+(r[13]?"text-warning":"")),o(n,"viewBox","0 0 20 20"),o(n,"fill","currentColor"),o(e,"class",u="btn btn-ghost btn-xs "+(r[13]?"opacity-100":"opacity-30 group-hover:opacity-100")+" transition-opacity"),o(e,"aria-label",f=r[13]?"Unpin message":"Pin message"),o(e,"title",c=r[13]?"Unpin message":"Pin message")},m(_,E){S(_,e,E),d(e,n),d(n,t),d(e,l),d(e,a),p||(g=ce(e,"click",r[18]),p=!0)},p(_,E){E[0]&8192&&s!==(s="h-4 w-4 "+(_[13]?"text-warning":""))&&o(n,"class",s),E[0]&8192&&i!==(i=_[13]?"Unpin":"Pin")&&ve(a,i),E[0]&8192&&u!==(u="btn btn-ghost btn-xs "+(_[13]?"opacity-100":"opacity-30 group-hover:opacity-100")+" transition-opacity")&&o(e,"class",u),E[0]&8192&&f!==(f=_[13]?"Unpin message":"Pin message")&&o(e,"aria-label",f),E[0]&8192&&c!==(c=_[13]?"Unpin message":"Pin message")&&o(e,"title",c)},d(_){_&&h(e),p=!1,g()}}}function Io(r){let e,n;return{c(){e=j("svg"),n=j("path"),this.h()},l(t){e=K(t,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var s=v(e);n=K(s,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(n).forEach(h),s.forEach(h),this.h()},h(){o(n,"stroke-linecap","round"),o(n,"stroke-linejoin","round"),o(n,"stroke-width","2"),o(n,"d","M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"class","h-4 w-4"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24"),o(e,"stroke","currentColor")},m(t,s){S(t,e,s),d(e,n)},d(t){t&&h(e)}}}function Mo(r){let e,n;return{c(){e=j("svg"),n=j("path"),this.h()},l(t){e=K(t,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var s=v(e);n=K(s,"path",{d:!0}),v(n).forEach(h),s.forEach(h),this.h()},h(){o(n,"d","M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"class","h-4 w-4"),o(e,"viewBox","0 0 20 20"),o(e,"fill","currentColor")},m(t,s){S(t,e,s),d(e,n)},d(t){t&&h(e)}}}function or(r){let e,n=`<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
          Delete`,t,s;return{c(){e=y("button"),e.innerHTML=n,this.h()},l(l){e=b(l,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),le(e)!=="svelte-yzsrym"&&(e.innerHTML=n),this.h()},h(){o(e,"class","btn btn-ghost btn-xs opacity-30 group-hover:opacity-100 transition-opacity"),o(e,"aria-label","Delete message")},m(l,i){S(l,e,i),t||(s=ce(e,"click",r[16]),t=!0)},p:ne,d(l){l&&h(e),t=!1,s()}}}function So(r){let e,n,t,s,l,i,a,u,f,c=ar(r[1].createdAt)+"",p,g,_,E,w,k,T,I,R,O,Y,M,A,B,x,J,G,V,W,U,ie,ee,Re='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',ue,be,$,z,he,N,te,fe,Ze,re=!r[8]&&er(r);const Ve=[_o,go],Pe=[];function Ce(P,se){return P[8]?0:1}l=Ce(r),i=Pe[l]=Ve[l](r);let Me=r[13]&&tr(),we=r[6]&&r[1].sendStatus&&nr(r);const je=[wo,Eo],Le=[];function He(P,se){return P[1].isEncrypted&&!P[5]?0:1}k=He(r),T=Le[k]=je[k](r);let pe=r[1].isEncrypted&&r[5]&&sr(),ye=r[9]&&rr(r),Se=r[14]&&ir(r);function Te(P,se){return P[15]?Mo:Io}let De=Te(r),ke=De(r),Ae=r[12]&&or(r);return be=new oo({props:{show:r[7]}}),be.$on("select",r[19]),be.$on("close",r[28]),z=new ro({props:{messageId:r[1].id,relayUrl:r[2],authorPubkey:r[1].authorPubkey}}),z.$on("react",r[20]),z.$on("unreact",r[21]),{c(){e=y("div"),re&&re.c(),n=L(),t=y("div"),s=y("div"),i.c(),a=L(),Me&&Me.c(),u=L(),f=y("span"),p=Q(c),g=L(),we&&we.c(),E=L(),w=y("div"),T.c(),I=L(),pe&&pe.c(),Y=L(),ye&&ye.c(),M=L(),A=y("div"),Se&&Se.c(),B=L(),x=y("button"),ke.c(),J=Q(`
        Bookmark`),W=L(),Ae&&Ae.c(),U=L(),ie=y("div"),ee=y("button"),ee.innerHTML=Re,ue=L(),ht(be.$$.fragment),$=L(),ht(z.$$.fragment),this.h()},l(P){e=b(P,"DIV",{class:!0,id:!0});var se=v(e);re&&re.l(se),n=D(se),t=b(se,"DIV",{class:!0});var oe=v(t);s=b(oe,"DIV",{class:!0});var H=v(s);i.l(H),a=D(H),Me&&Me.l(H),u=D(H),f=b(H,"SPAN",{class:!0});var q=v(f);p=Z(q,c),g=D(q),we&&we.l(q),q.forEach(h),H.forEach(h),E=D(oe),w=b(oe,"DIV",{class:!0,style:!0});var Oe=v(w);T.l(Oe),I=D(Oe),pe&&pe.l(Oe),Oe.forEach(h),Y=D(oe),ye&&ye.l(oe),M=D(oe),A=b(oe,"DIV",{class:!0});var Ee=v(A);Se&&Se.l(Ee),B=D(Ee),x=b(Ee,"BUTTON",{class:!0,"aria-label":!0});var ze=v(x);ke.l(ze),J=Z(ze,`
        Bookmark`),ze.forEach(h),W=D(Ee),Ae&&Ae.l(Ee),U=D(Ee),ie=b(Ee,"DIV",{class:!0});var Xe=v(ie);ee=b(Xe,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),le(ee)!=="svelte-lcpuro"&&(ee.innerHTML=Re),ue=D(Xe),dt(be.$$.fragment,Xe),Xe.forEach(h),Ee.forEach(h),$=D(oe),dt(z.$$.fragment,oe),oe.forEach(h),se.forEach(h),this.h()},h(){o(f,"class","text-xs text-base-content/60 flex-shrink-0 flex items-center gap-1"),o(s,"class",_="flex items-baseline gap-2 mb-1 "+(r[6]?"flex-row-reverse":"")),o(w,"class",R="rounded-2xl px-4 py-2 break-words "+(r[13]?"ring-1 ring-warning/30":"")),o(w,"style",O=r[6]?"background-color: oklch(var(--p)); color: oklch(var(--pc));":"background-color: oklch(var(--b2)); color: oklch(var(--bc));"),o(x,"class",G="btn btn-ghost btn-xs "+(r[15]?"opacity-100":"opacity-30 group-hover:opacity-100")+" transition-opacity"),o(x,"aria-label",V=r[15]?"Remove bookmark":"Add bookmark"),o(ee,"class","btn btn-ghost btn-xs opacity-30 group-hover:opacity-100 transition-opacity"),o(ee,"aria-label","Add reaction"),o(ie,"class","relative"),o(A,"class","flex gap-2 mt-1"),o(t,"class","flex-1 min-w-0 max-w-md"),o(e,"class",he="flex gap-3 group "+(r[6]?"flex-row-reverse":"")+" "+(r[13]?"bg-warning/5 -mx-2 px-2 py-1 rounded-lg":"")),o(e,"id",N="message-"+r[1].id)},m(P,se){S(P,e,se),re&&re.m(e,null),d(e,n),d(e,t),d(t,s),Pe[l].m(s,null),d(s,a),Me&&Me.m(s,null),d(s,u),d(s,f),d(f,p),d(f,g),we&&we.m(f,null),d(t,E),d(t,w),Le[k].m(w,null),d(w,I),pe&&pe.m(w,null),d(t,Y),ye&&ye.m(t,null),d(t,M),d(t,A),Se&&Se.m(A,null),d(A,B),d(A,x),ke.m(x,null),d(x,J),d(A,W),Ae&&Ae.m(A,null),d(A,U),d(A,ie),d(ie,ee),d(ie,ue),ft(be,ie,null),d(t,$),ft(z,t,null),r[29](e),te=!0,fe||(Ze=[ce(x,"click",r[17]),ce(ee,"click",r[27])],fe=!0)},p(P,se){P[8]?re&&(bt(),_e(re,1,1,()=>{re=null}),yt()):re?(re.p(P,se),se[0]&256&&ae(re,1)):(re=er(P),re.c(),ae(re,1),re.m(e,n));let oe=l;l=Ce(P),l===oe?Pe[l].p(P,se):(bt(),_e(Pe[oe],1,1,()=>{Pe[oe]=null}),yt(),i=Pe[l],i?i.p(P,se):(i=Pe[l]=Ve[l](P),i.c()),ae(i,1),i.m(s,a)),P[13]?Me||(Me=tr(),Me.c(),Me.m(s,u)):Me&&(Me.d(1),Me=null),(!te||se[0]&2)&&c!==(c=ar(P[1].createdAt)+"")&&ve(p,c),P[6]&&P[1].sendStatus?we?we.p(P,se):(we=nr(P),we.c(),we.m(f,null)):we&&(we.d(1),we=null),(!te||se[0]&64&&_!==(_="flex items-baseline gap-2 mb-1 "+(P[6]?"flex-row-reverse":"")))&&o(s,"class",_);let H=k;k=He(P),k===H?Le[k].p(P,se):(bt(),_e(Le[H],1,1,()=>{Le[H]=null}),yt(),T=Le[k],T?T.p(P,se):(T=Le[k]=je[k](P),T.c()),ae(T,1),T.m(w,I)),P[1].isEncrypted&&P[5]?pe||(pe=sr(),pe.c(),pe.m(w,null)):pe&&(pe.d(1),pe=null),(!te||se[0]&8192&&R!==(R="rounded-2xl px-4 py-2 break-words "+(P[13]?"ring-1 ring-warning/30":"")))&&o(w,"class",R),(!te||se[0]&64&&O!==(O=P[6]?"background-color: oklch(var(--p)); color: oklch(var(--pc));":"background-color: oklch(var(--b2)); color: oklch(var(--bc));"))&&o(w,"style",O),P[9]?ye?(ye.p(P,se),se[0]&512&&ae(ye,1)):(ye=rr(P),ye.c(),ae(ye,1),ye.m(t,M)):ye&&(bt(),_e(ye,1,1,()=>{ye=null}),yt()),P[14]?Se?Se.p(P,se):(Se=ir(P),Se.c(),Se.m(A,B)):Se&&(Se.d(1),Se=null),De!==(De=Te(P))&&(ke.d(1),ke=De(P),ke&&(ke.c(),ke.m(x,J))),(!te||se[0]&32768&&G!==(G="btn btn-ghost btn-xs "+(P[15]?"opacity-100":"opacity-30 group-hover:opacity-100")+" transition-opacity"))&&o(x,"class",G),(!te||se[0]&32768&&V!==(V=P[15]?"Remove bookmark":"Add bookmark"))&&o(x,"aria-label",V),P[12]?Ae?Ae.p(P,se):(Ae=or(P),Ae.c(),Ae.m(A,U)):Ae&&(Ae.d(1),Ae=null);const q={};se[0]&128&&(q.show=P[7]),be.$set(q);const Oe={};se[0]&2&&(Oe.messageId=P[1].id),se[0]&4&&(Oe.relayUrl=P[2]),se[0]&2&&(Oe.authorPubkey=P[1].authorPubkey),z.$set(Oe),(!te||se[0]&8256&&he!==(he="flex gap-3 group "+(P[6]?"flex-row-reverse":"")+" "+(P[13]?"bg-warning/5 -mx-2 px-2 py-1 rounded-lg":"")))&&o(e,"class",he),(!te||se[0]&2&&N!==(N="message-"+P[1].id))&&o(e,"id",N)},i(P){te||(ae(re),ae(i),ae(T),ae(ye),ae(be.$$.fragment,P),ae(z.$$.fragment,P),te=!0)},o(P){_e(re),_e(i),_e(T),_e(ye),_e(be.$$.fragment,P),_e(z.$$.fragment,P),te=!1},d(P){P&&h(e),re&&re.d(),Pe[l].d(),Me&&Me.d(),we&&we.d(),Le[k].d(),pe&&pe.d(),ye&&ye.d(),Se&&Se.d(),ke.d(),Ae&&Ae.d(),ut(be),ut(z),r[29](null),fe=!1,Ct(Ze)}}}function ar(r){const e=new Date(r),t=(new Date().getTime()-e.getTime())/(1e3*60*60);return t<24?e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):t<168?e.toLocaleDateString("en-US",{weekday:"short",hour:"numeric",minute:"2-digit",hour12:!0}):e.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function Co(r,e,n){let t,s,l,i,a,u,f,c,p,g,_,E=ne,w=()=>(E(),E=yn(l,N=>n(13,_=N)),l),k,T,I,R,O,Y=ne,M=()=>(Y(),Y=yn(f,N=>n(15,O=N)),f);Mt(r,Lt,N=>n(24,k=N)),Mt(r,Ji,N=>n(25,T=N)),Mt(r,Yr,N=>n(26,I=N)),Mt(r,wn,N=>n(14,R=N)),r.$$.on_destroy.push(()=>E()),r.$$.on_destroy.push(()=>Y());let{message:A}=e,{channelName:B=void 0}=e,{messageElement:x=void 0}=e,{relayUrl:J=""}=e,{searchQuery:G=""}=e;const V=Sn();let W=!1;async function U(){if(confirm("Are you sure you want to delete this message?"))try{if(!dn())throw new Error("Not connected to relay");const N=Dn();if(!N)throw new Error("NDK not initialized");const te=new Zn(N);if(te.kind=qr,te.content="Deleted by user",te.tags=[["h",A.channelId],["e",A.id]],!await gr(te))throw new Error("Failed to publish deletion to relay");Wr.deleteMessage(A.channelId,A.id),V("deleted",{messageId:A.id}),Yt.success("Message deleted")}catch(N){console.error("Failed to delete message:",N),Yt.error("Failed to delete message",5e3,{label:"Retry",callback:async()=>{await U()}})}}function ie(){jn.toggleBookmark(A.id,A.channelId,a,A.authorPubkey,A.createdAt,B)}async function ee(){if(_)await qt.unpinMessage(A.channelId,A.id)?(V("unpinned",{messageId:A.id}),Yt.success("Message unpinned")):Yt.error("Failed to unpin message");else{if(!i){Yt.warning("Maximum of 5 messages can be pinned per channel");return}await qt.pinMessage(A.channelId,A.id)?(V("pinned",{messageId:A.id}),Yt.success("Message pinned")):Yt.error("Failed to pin message")}}async function Re(N){n(7,W=!1);try{await Jt.addReaction(A.id,N.detail.emoji,J,A.authorPubkey),V("react",{messageId:A.id,emoji:N.detail.emoji})}catch(te){console.error("Failed to add reaction:",te)}}function ue(N){V("react",{messageId:A.id,emoji:N.detail.emoji})}function be(){V("unreact",{messageId:A.id})}const $=()=>n(7,W=!W),z=()=>n(7,W=!1);function he(N){hn[N?"unshift":"push"](()=>{x=N,n(0,x)})}return r.$$set=N=>{"message"in N&&n(1,A=N.message),"channelName"in N&&n(22,B=N.channelName),"messageElement"in N&&n(0,x=N.messageElement),"relayUrl"in N&&n(2,J=N.relayUrl),"searchQuery"in N&&n(23,G=N.searchQuery)},r.$$.update=()=>{r.$$.dirty[0]&16777218&&n(6,t=k.publicKey===A.authorPubkey),r.$$.dirty[0]&67108928&&n(12,s=t||I==="admin"),r.$$.dirty[0]&2&&w(n(11,l=al(A.channelId,A.id))),r.$$.dirty[0]&2&&(i=qt.canPinMore(A.channelId)),r.$$.dirty[0]&2&&n(3,a=A.isEncrypted&&A.decryptedContent?A.decryptedContent:A.content),r.$$.dirty[0]&2&&n(5,u=!A.isEncrypted||!!A.decryptedContent),r.$$.dirty[0]&2&&M(n(10,f=Al(A.id))),r.$$.dirty[0]&50331690&&n(4,c=T.linkPreviewsEnabled&&u?Hl(a,A.tags||[],k.publicKey??void 0,Dl,Ol).slice(0,3):[]),r.$$.dirty[0]&16&&n(9,p=c.length>0),r.$$.dirty[0]&16777218&&n(8,g=k.publicKey===A.authorPubkey)},[x,A,J,a,c,u,t,W,g,p,f,l,s,_,R,O,U,ie,ee,Re,ue,be,B,G,k,T,I,$,z,he]}class Do extends Rt{constructor(e){super(),Pt(this,e,Co,So,Nt,{message:1,channelName:22,messageElement:0,relayUrl:2,searchQuery:23},null,[-1,-1])}}const{document:Fn}=Nr;function cr(r,e,n){const t=r.slice();return t[35]=e[n],t}function Lo(r){let e,n,t,s,l,i,a,u=r[0].name+"",f,c,p,g,_,E=r[0].visibility+"",w,k,T,I,R,O,Y,M,A,B,x,J,G,V=r[10]?"Hide":"Show",W,U,ie,ee,Re,ue,be,$,z,he,N,te,fe,Ze,re,Ve,Pe,Ce,Me,we,je=r[5]?"Sending...":"Send",Le,He,pe,ye,Se;l=new Jr({props:{items:r[11]}});let Te=r[0].description&&ur(r),De=r[0].encrypted&&fr();ee=new El({props:{channelId:r[2],isExpanded:r[10]}}),ue=new pl({props:{channelId:r[2],messages:r[12]}}),ue.$on("scrollTo",Bo);let ke=r[6]&&dr(r);const Ae=[Oo,Po],P=[];function se(H,q){return H[1].length===0?0:1}N=se(r),te=P[N]=Ae[N](r);let oe=r[8]&&pr(r);return{c(){e=y("div"),n=y("div"),t=y("div"),s=y("div"),ht(l.$$.fragment),i=L(),a=y("h1"),f=Q(u),c=L(),Te&&Te.c(),p=L(),g=y("div"),_=y("span"),w=Q(E),k=L(),De&&De.c(),T=L(),I=y("span"),R=Q(r[9]),O=Q(" messages"),Y=L(),M=y("button"),A=j("svg"),B=j("path"),x=j("path"),J=j("path"),G=L(),W=Q(V),U=Q(" Stats"),ie=L(),ht(ee.$$.fragment),Re=L(),ht(ue.$$.fragment),be=L(),ke&&ke.c(),$=L(),z=y("div"),he=y("div"),te.c(),fe=L(),oe&&oe.c(),Ze=L(),re=y("div"),Ve=y("div"),Pe=y("form"),Ce=y("input"),Me=L(),we=y("button"),Le=Q(je),this.h()},l(H){e=b(H,"DIV",{class:!0});var q=v(e);n=b(q,"DIV",{class:!0});var Oe=v(n);t=b(Oe,"DIV",{class:!0});var Ee=v(t);s=b(Ee,"DIV",{class:!0});var ze=v(s);dt(l.$$.fragment,ze),ze.forEach(h),i=D(Ee),a=b(Ee,"H1",{class:!0});var Xe=v(a);f=Z(Xe,u),Xe.forEach(h),c=D(Ee),Te&&Te.l(Ee),p=D(Ee),g=b(Ee,"DIV",{class:!0});var st=v(g);_=b(st,"SPAN",{class:!0});var rt=v(_);w=Z(rt,E),rt.forEach(h),k=D(st),De&&De.l(st),T=D(st),I=b(st,"SPAN",{class:!0});var pt=v(I);R=Z(pt,r[9]),O=Z(pt," messages"),pt.forEach(h),Y=D(st),M=b(st,"BUTTON",{class:!0});var Fe=v(M);A=K(Fe,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var qe=v(A);B=K(qe,"path",{d:!0}),v(B).forEach(h),x=K(qe,"path",{d:!0}),v(x).forEach(h),J=K(qe,"path",{d:!0}),v(J).forEach(h),qe.forEach(h),G=D(Fe),W=Z(Fe,V),U=Z(Fe," Stats"),Fe.forEach(h),st.forEach(h),Ee.forEach(h),Oe.forEach(h),ie=D(q),dt(ee.$$.fragment,q),Re=D(q),dt(ue.$$.fragment,q),be=D(q),ke&&ke.l(q),$=D(q),z=b(q,"DIV",{class:!0});var $e=v(z);he=b($e,"DIV",{class:!0});var wt=v(he);te.l(wt),wt.forEach(h),fe=D($e),oe&&oe.l($e),$e.forEach(h),Ze=D(q),re=b(q,"DIV",{class:!0});var Tt=v(re);Ve=b(Tt,"DIV",{class:!0});var mt=v(Ve);Pe=b(mt,"FORM",{class:!0});var Ye=v(Pe);Ce=b(Ye,"INPUT",{type:!0,class:!0,placeholder:!0}),Me=D(Ye),we=b(Ye,"BUTTON",{type:!0,class:!0});var Ot=v(we);Le=Z(Ot,je),Ot.forEach(h),Ye.forEach(h),mt.forEach(h),Tt.forEach(h),q.forEach(h),this.h()},h(){o(s,"class","mb-2"),o(a,"class","text-2xl font-bold"),o(_,"class","badge badge-sm badge-ghost"),o(I,"class","badge badge-sm badge-outline"),o(B,"d","M18 20V10"),o(x,"d","M12 20V4"),o(J,"d","M6 20v-6"),o(A,"width","16"),o(A,"height","16"),o(A,"viewBox","0 0 24 24"),o(A,"fill","none"),o(A,"stroke","currentColor"),o(A,"stroke-width","2"),o(M,"class","btn btn-ghost btn-sm"),o(g,"class","flex items-center gap-2 mt-1"),o(t,"class","container mx-auto max-w-4xl"),o(n,"class","bg-base-200 border-b border-base-300 p-4"),o(he,"class","container mx-auto max-w-4xl"),o(z,"class","flex-1 overflow-y-auto p-4 bg-base-100 relative"),o(Ce,"type","text"),o(Ce,"class","input input-bordered flex-1 text-base-content"),o(Ce,"placeholder","Type a message..."),Ce.disabled=r[5],o(we,"type","submit"),o(we,"class","btn btn-primary"),we.disabled=He=r[5]||!r[3].trim(),o(Pe,"class","flex gap-2"),o(Ve,"class","container mx-auto max-w-4xl"),o(re,"class","bg-base-200 border-t border-base-300 p-4"),o(e,"class","flex flex-col h-[calc(100vh-64px)]")},m(H,q){S(H,e,q),d(e,n),d(n,t),d(t,s),ft(l,s,null),d(t,i),d(t,a),d(a,f),d(t,c),Te&&Te.m(t,null),d(t,p),d(t,g),d(g,_),d(_,w),d(g,k),De&&De.m(g,null),d(g,T),d(g,I),d(I,R),d(I,O),d(g,Y),d(g,M),d(M,A),d(A,B),d(A,x),d(A,J),d(M,G),d(M,W),d(M,U),d(e,ie),ft(ee,e,null),d(e,Re),ft(ue,e,null),d(e,be),ke&&ke.m(e,null),d(e,$),d(e,z),d(z,he),P[N].m(he,null),d(z,fe),oe&&oe.m(z,null),r[23](z),d(e,Ze),d(e,re),d(re,Ve),d(Ve,Pe),d(Pe,Ce),es(Ce,r[3]),d(Pe,Me),d(Pe,we),d(we,Le),pe=!0,ye||(Se=[ce(M,"click",r[21]),ce(z,"scroll",r[17]),ce(Ce,"input",r[24]),ce(Ce,"input",r[18]),ce(Pe,"submit",Lr(r[15]))],ye=!0)},p(H,q){const Oe={};q[0]&2048&&(Oe.items=H[11]),l.$set(Oe),(!pe||q[0]&1)&&u!==(u=H[0].name+"")&&ve(f,u),H[0].description?Te?Te.p(H,q):(Te=ur(H),Te.c(),Te.m(t,p)):Te&&(Te.d(1),Te=null),(!pe||q[0]&1)&&E!==(E=H[0].visibility+"")&&ve(w,E),H[0].encrypted?De||(De=fr(),De.c(),De.m(g,T)):De&&(De.d(1),De=null),(!pe||q[0]&512)&&ve(R,H[9]),(!pe||q[0]&1024)&&V!==(V=H[10]?"Hide":"Show")&&ve(W,V);const Ee={};q[0]&4&&(Ee.channelId=H[2]),q[0]&1024&&(Ee.isExpanded=H[10]),ee.$set(Ee);const ze={};q[0]&4&&(ze.channelId=H[2]),q[0]&4096&&(ze.messages=H[12]),ue.$set(ze),H[6]?ke?ke.p(H,q):(ke=dr(H),ke.c(),ke.m(e,$)):ke&&(ke.d(1),ke=null);let Xe=N;N=se(H),N===Xe?P[N].p(H,q):(bt(),_e(P[Xe],1,1,()=>{P[Xe]=null}),yt(),te=P[N],te?te.p(H,q):(te=P[N]=Ae[N](H),te.c()),ae(te,1),te.m(he,null)),H[8]?oe?oe.p(H,q):(oe=pr(H),oe.c(),oe.m(z,null)):oe&&(oe.d(1),oe=null),(!pe||q[0]&32)&&(Ce.disabled=H[5]),q[0]&8&&Ce.value!==H[3]&&es(Ce,H[3]),(!pe||q[0]&32)&&je!==(je=H[5]?"Sending...":"Send")&&ve(Le,je),(!pe||q[0]&40&&He!==(He=H[5]||!H[3].trim()))&&(we.disabled=He)},i(H){pe||(ae(l.$$.fragment,H),ae(ee.$$.fragment,H),ae(ue.$$.fragment,H),ae(te),pe=!0)},o(H){_e(l.$$.fragment,H),_e(ee.$$.fragment,H),_e(ue.$$.fragment,H),_e(te),pe=!1},d(H){H&&h(e),ut(l),Te&&Te.d(),De&&De.d(),ut(ee),ut(ue),ke&&ke.d(),P[N].d(),oe&&oe.d(),r[23](null),ye=!1,Ct(Se)}}}function No(r){let e,n,t="← Back to Channels",s,l,i,a,u,f;return{c(){e=y("div"),n=y("button"),n.textContent=t,s=L(),l=y("div"),i=y("span"),a=Q(r[6]),this.h()},l(c){e=b(c,"DIV",{class:!0});var p=v(e);n=b(p,"BUTTON",{class:!0,"data-svelte-h":!0}),le(n)!=="svelte-1lc3dpi"&&(n.textContent=t),s=D(p),l=b(p,"DIV",{class:!0});var g=v(l);i=b(g,"SPAN",{});var _=v(i);a=Z(_,r[6]),_.forEach(h),g.forEach(h),p.forEach(h),this.h()},h(){o(n,"class","btn btn-ghost btn-sm mb-4"),o(l,"class","alert alert-error"),o(e,"class","container mx-auto p-4 max-w-4xl")},m(c,p){S(c,e,p),d(e,n),d(e,s),d(e,l),d(l,i),d(i,a),u||(f=ce(n,"click",r[20]),u=!0)},p(c,p){p[0]&64&&ve(a,c[6])},i:ne,o:ne,d(c){c&&h(e),u=!1,f()}}}function Ro(r){let e,n='<div class="loading loading-spinner loading-lg text-primary"></div>';return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-mo2ait"&&(e.innerHTML=n),this.h()},h(){o(e,"class","flex justify-center items-center h-[calc(100vh-64px)]")},m(t,s){S(t,e,s)},p:ne,i:ne,o:ne,d(t){t&&h(e)}}}function ur(r){let e,n=r[0].description+"",t;return{c(){e=y("p"),t=Q(n),this.h()},l(s){e=b(s,"P",{class:!0});var l=v(e);t=Z(l,n),l.forEach(h),this.h()},h(){o(e,"class","text-base-content/70 text-sm")},m(s,l){S(s,e,l),d(e,t)},p(s,l){l[0]&1&&n!==(n=s[0].description+"")&&ve(t,n)},d(s){s&&h(e)}}}function fr(r){let e,n="Encrypted";return{c(){e=y("span"),e.textContent=n,this.h()},l(t){e=b(t,"SPAN",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-17lvcyk"&&(e.textContent=n),this.h()},h(){o(e,"class","badge badge-sm badge-primary")},m(t,s){S(t,e,s)},d(t){t&&h(e)}}}function dr(r){let e,n,t,s,l,i,a="✕",u,f;return{c(){e=y("div"),n=y("div"),t=y("span"),s=Q(r[6]),l=L(),i=y("button"),i.textContent=a,this.h()},l(c){e=b(c,"DIV",{class:!0});var p=v(e);n=b(p,"DIV",{class:!0});var g=v(n);t=b(g,"SPAN",{});var _=v(t);s=Z(_,r[6]),_.forEach(h),l=D(g),i=b(g,"BUTTON",{class:!0,"data-svelte-h":!0}),le(i)!=="svelte-1hwd9n8"&&(i.textContent=a),g.forEach(h),p.forEach(h),this.h()},h(){o(i,"class","btn btn-ghost btn-xs"),o(n,"class","alert alert-warning alert-sm"),o(e,"class","container mx-auto max-w-4xl p-2")},m(c,p){S(c,e,p),d(e,n),d(n,t),d(t,s),d(n,l),d(n,i),u||(f=ce(i,"click",r[22]),u=!0)},p(c,p){p[0]&64&&ve(s,c[6])},d(c){c&&h(e),u=!1,f()}}}function Po(r){let e,n=[],t=new Map,s,l=nt(r[12]);const i=a=>a[35].id;for(let a=0;a<l.length;a+=1){let u=cr(r,l,a),f=i(u);t.set(f,n[a]=hr(f,u))}return{c(){e=y("div");for(let a=0;a<n.length;a+=1)n[a].c();this.h()},l(a){e=b(a,"DIV",{class:!0});var u=v(e);for(let f=0;f<n.length;f+=1)n[f].l(u);u.forEach(h),this.h()},h(){o(e,"class","space-y-4")},m(a,u){S(a,e,u);for(let f=0;f<n.length;f+=1)n[f]&&n[f].m(e,null);s=!0},p(a,u){u[0]&12289&&(l=nt(a[12]),bt(),n=vr(n,u,i,1,a,l,t,e,Pr,hr,null,cr),yt())},i(a){if(!s){for(let u=0;u<l.length;u+=1)ae(n[u]);s=!0}},o(a){for(let u=0;u<n.length;u+=1)_e(n[u]);s=!1},d(a){a&&h(e);for(let u=0;u<n.length;u+=1)n[u].d()}}}function Oo(r){let e,n="<p>No messages yet. Start the conversation!</p>";return{c(){e=y("div"),e.innerHTML=n,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-jcsddy"&&(e.innerHTML=n),this.h()},h(){o(e,"class","flex items-center justify-center h-full text-base-content/50")},m(t,s){S(t,e,s)},p:ne,i:ne,o:ne,d(t){t&&h(e)}}}function hr(r,e){let n,t,s;return t=new Do({props:{message:e[35],channelName:e[0]?.name,relayUrl:e[13]}}),{key:r,first:null,c(){n=Ue(),ht(t.$$.fragment),this.h()},l(l){n=Ue(),dt(t.$$.fragment,l),this.h()},h(){this.first=n},m(l,i){S(l,n,i),ft(t,l,i),s=!0},p(l,i){e=l;const a={};i[0]&4096&&(a.message=e[35]),i[0]&1&&(a.channelName=e[0]?.name),i[0]&8192&&(a.relayUrl=e[13]),t.$set(a)},i(l){s||(ae(t.$$.fragment,l),s=!0)},o(l){_e(t.$$.fragment,l),s=!1},d(l){l&&h(n),ut(t,l)}}}function pr(r){let e,n='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>',t,s;return{c(){e=y("button"),e.innerHTML=n,this.h()},l(l){e=b(l,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),le(e)!=="svelte-ta14zf"&&(e.innerHTML=n),this.h()},h(){o(e,"class","absolute bottom-4 right-4 btn btn-circle btn-primary shadow-lg"),o(e,"aria-label","Scroll to bottom")},m(l,i){S(l,e,i),t||(s=ce(e,"click",r[16]),t=!0)},p:ne,d(l){l&&h(e),t=!1,s()}}}function xo(r){let e,n,t,s,l,i;Fn.title=e=(r[0]?.name||"Channel")+" - "+r[14].name;const a=[Ro,No,Lo],u=[];function f(c,p){return c[4]?0:c[6]&&!c[0]?1:c[0]?2:-1}return~(t=f(r))&&(s=u[t]=a[t](r)),{c(){n=L(),s&&s.c(),l=Ue()},l(c){Dr("svelte-w1m9lo",Fn.head).forEach(h),n=D(c),s&&s.l(c),l=Ue()},m(c,p){S(c,n,p),~t&&u[t].m(c,p),S(c,l,p),i=!0},p(c,p){(!i||p[0]&16385)&&e!==(e=(c[0]?.name||"Channel")+" - "+c[14].name)&&(Fn.title=e);let g=t;t=f(c),t===g?~t&&u[t].p(c,p):(s&&(bt(),_e(u[g],1,1,()=>{u[g]=null}),yt()),~t?(s=u[t],s?s.p(c,p):(s=u[t]=a[t](c),s.c()),ae(s,1),s.m(l.parentNode,l)):s=null)},i(c){i||(ae(s),i=!0)},o(c){_e(s),i=!1},d(c){c&&(h(n),h(l)),~t&&u[t].d(c)}}}function Bo(r){const e=document.getElementById(`message-${r.detail.messageId}`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("highlight-flash"),setTimeout(()=>{e.classList.remove("highlight-flash")},2e3))}function Uo(r,e,n){let t,s,l,i,a,u;Mt(r,Lt,$=>n(31,a=$)),Mt(r,Or,$=>n(19,u=$));const f=Ur();let c=null,p=[],g="",_=!0,E=!1,w=null,k,T=null,I=!1,R=null,O=0,Y=null,M=null,A=!0,B=!1;async function x($=1e4){if(dn())return!0;if(!dn())try{return await zr(a),!0}catch{}const z=Date.now();return new Promise(he=>{const N=()=>{dn()?he(!0):Date.now()-z>=$?he(!1):setTimeout(N,200)};N()})}Cn(async()=>{if(await Lt.waitForReady(),!a.isAuthenticated||!a.publicKey){ts(`${ns}/`);return}try{if(!await x()){n(6,w="Could not connect to relay. Please try again."),n(4,_=!1);return}const z=We(ls),he=z?.cohorts??[],N=z?.isAdmin??!1,te=await Fr(t);if(!te){n(6,w="Channel not found"),n(4,_=!1);return}n(0,c=te);const fe={userCohorts:he,userPubkey:a.publicKey??"",isAdmin:N};n(1,p=await Gr(t,50,fe)),n(9,O=p.length),T=(await Kr(t,re=>{p.find(Ve=>Ve.id===re.id)||(n(1,p=[...p,re]),n(9,O=p.length),A&&(G(),W()))},fe)).unsubscribe,W(),Y=setInterval(()=>{n(1,p=[...p])},6e4)}catch($){console.error("Error loading channel:",$),n(6,w=$ instanceof Error?$.message:"Failed to load channel")}finally{n(4,_=!1)}}),mr(()=>{if(p.length>0){const $=Math.max(...p.map(z=>z.createdAt));is.setLastRead(t,$)}T&&T(),R&&clearTimeout(R),Y&&clearInterval(Y),M&&clearTimeout(M)});async function J(){if(!g.trim()||E||!c)return;n(5,E=!0);const $=g;n(3,g="");try{const z=We(ls),he={userCohorts:z?.cohorts??[],userPubkey:a.publicKey??"",isAdmin:z?.isAdmin??!1};await jr(t,$,void 0,he),G()}catch(z){console.error("Error sending message:",z),n(3,g=$),n(6,w=z instanceof Error?z.message:"Failed to send message")}finally{n(5,E=!1)}}function G(){k&&setTimeout(()=>{n(7,k.scrollTop=k.scrollHeight,k)},100)}function V(){if(k){const{scrollTop:$,scrollHeight:z,clientHeight:he}=k,N=z-$-he;n(8,I=N>100),A=N<50,A&&W()}}function W(){M&&clearTimeout(M),M=setTimeout(()=>{if(p.length>0){const $=Math.max(...p.map(z=>z.createdAt));is.setLastRead(t,$)}},1e3)}function U(){R&&clearTimeout(R),R=setTimeout(()=>{},2e3)}const ie=()=>ts(`${ns}/chat`),ee=()=>n(10,B=!B),Re=()=>n(6,w=null);function ue($){hn[$?"unshift":"push"](()=>{k=$,n(7,k)})}function be(){g=this.value,n(3,g)}return r.$$.update=()=>{r.$$.dirty[0]&524288&&n(2,t=u.params.channelId),r.$$.dirty[0]&6&&n(12,l=p.map($=>({id:$.id,channelId:t,authorPubkey:$.pubkey,content:$.content,createdAt:$.createdAt*1e3,isEncrypted:!1,decryptedContent:void 0,replyTo:$.replyTo}))),r.$$.dirty[0]&1&&n(11,i=(()=>{if(!c)return[];const $=Hr(c.section);if($){const{section:z,category:he}=$,N=Vr(he.id,z.id);return N.push({label:c.name,path:`/chat/${c.id}`}),N}return[{label:"Channels",path:"/chat"},{label:c.name,path:`/chat/${c.id}`}]})())},n(13,s=Xr()[0]||""),[c,p,t,g,_,E,w,k,I,O,B,i,l,s,f,J,G,V,U,u,ie,ee,Re,ue,be]}class sa extends Rt{constructor(e){super(),Pt(this,e,Uo,xo,Nt,{},null,[-1,-1])}}export{sa as component,na as universal};
