import{s as Be,n as ae,d as f,i as j,x as _e,k as ue,C as qe,r as Fe,P as le,A as ce,b as r,q as Q,l as a,c as m,e as D,o as q,g as I,f as W,h as v,j as x,t as X,a as $,u as de,v as fe,w as be,K as Ke,L as Re,m as Ge,p as Ye,E as Je}from"../chunks/0ZVSoAEn.js";import{S as je,i as Ue,f as Qe,d as We,t as Xe,a as Ze,m as $e,b as et,e as tt}from"../chunks/DKVmOqaf.js";import{e as he,u as Ae,d as Oe}from"../chunks/m0NROLOn.js";import{g as pe}from"../chunks/CTVLmyHZ.js";import{b as me}from"../chunks/xKPZ-4ZK.js";import{g as st,a as ge,u as lt}from"../chunks/DxD0Wn3l.js";import{s as ze,d as ee}from"../chunks/C_g2GIfz.js";import{t as ke}from"../chunks/C5DPgcI1.js";const nt=!0,at=async()=>({conversations:[]}),Tt=Object.freeze(Object.defineProperty({__proto__:null,load:at,prerender:nt},Symbol.toStringTag,{value:"Module"}));function we(n,e,t){const s=n.slice();return s[17]=e[t],s}function ye(n){let e,t,s,l,i="New Message",o,c,b='<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',w,y,_,u,T='<span class="label-text">User ID</span>',V,d,p,k,h,L,g='<span class="label-text">Display Name (optional)</span>',N,S,P,C,M,E,Y="Cancel",B,F,G,O,Z,J,te,ne,z=n[3].length>0&&Ce(n),U=n[1].length>0&&!n[6]&&Me(),A=!n[1]&&n[3].length===0&&Ie();return{c(){e=v("div"),t=v("div"),s=v("div"),l=v("h3"),l.textContent=i,o=x(),c=v("button"),c.innerHTML=b,w=x(),z&&z.c(),y=x(),_=v("div"),u=v("label"),u.innerHTML=T,V=x(),d=v("input"),p=x(),U&&U.c(),k=x(),h=v("div"),L=v("label"),L.innerHTML=g,N=x(),S=v("input"),P=x(),A&&A.c(),C=x(),M=v("div"),E=v("button"),E.textContent=Y,B=x(),F=v("button"),G=X("Start Conversation"),Z=x(),J=v("div"),this.h()},l(H){e=m(H,"DIV",{class:!0});var K=D(e);t=m(K,"DIV",{class:!0});var R=D(t);s=m(R,"DIV",{class:!0});var re=D(s);l=m(re,"H3",{class:!0,"data-svelte-h":!0}),q(l)!=="svelte-1mtmwa"&&(l.textContent=i),o=I(re),c=m(re,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),q(c)!=="svelte-14nvpfq"&&(c.innerHTML=b),re.forEach(f),w=I(R),z&&z.l(R),y=I(R),_=m(R,"DIV",{class:!0});var se=D(_);u=m(se,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),q(u)!=="svelte-1ll7962"&&(u.innerHTML=T),V=I(se),d=m(se,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),p=I(se),U&&U.l(se),se.forEach(f),k=I(R),h=m(R,"DIV",{class:!0});var oe=D(h);L=m(oe,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),q(L)!=="svelte-phea9m"&&(L.innerHTML=g),N=I(oe),S=m(oe,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),oe.forEach(f),P=I(R),A&&A.l(R),C=I(R),M=m(R,"DIV",{class:!0});var ie=D(M);E=m(ie,"BUTTON",{class:!0,"data-svelte-h":!0}),q(E)!=="svelte-11ofien"&&(E.textContent=Y),B=I(ie),F=m(ie,"BUTTON",{class:!0});var ve=D(F);G=W(ve,"Start Conversation"),ve.forEach(f),ie.forEach(f),R.forEach(f),Z=I(K),J=m(K,"DIV",{class:!0}),D(J).forEach(f),K.forEach(f),this.h()},h(){a(l,"class","font-bold text-lg"),a(c,"class","btn btn-sm btn-circle btn-ghost"),a(c,"aria-label","Close"),a(s,"class","flex items-center justify-between mb-4"),a(u,"class","label"),a(u,"for","dm-pubkey-input"),a(d,"id","dm-pubkey-input"),a(d,"type","text"),a(d,"placeholder","Paste a user ID to start a conversation..."),a(d,"class","input input-bordered w-full font-mono text-sm"),ce(d,"input-success",n[6]),ce(d,"input-error",n[1].length>0&&!n[6]),a(_,"class","form-control mb-4"),a(L,"class","label"),a(L,"for","dm-display-name-input"),a(S,"id","dm-display-name-input"),a(S,"type","text"),a(S,"placeholder","Give this contact a friendly name..."),a(S,"class","input input-bordered w-full"),a(h,"class","form-control mb-6"),a(E,"class","btn btn-ghost"),a(F,"class","btn btn-primary"),F.disabled=O=!n[6]&&!n[4],a(M,"class","modal-action"),a(t,"class","modal-box max-w-2xl"),a(J,"class","modal-backdrop svelte-1jk7n69"),a(e,"class","modal modal-open")},m(H,K){j(H,e,K),r(e,t),r(t,s),r(s,l),r(s,o),r(s,c),r(t,w),z&&z.m(t,null),r(t,y),r(t,_),r(_,u),r(_,V),r(_,d),le(d,n[1]),r(_,p),U&&U.m(_,null),r(t,k),r(t,h),r(h,L),r(h,N),r(h,S),le(S,n[5]),r(t,P),A&&A.m(t,null),r(t,C),r(t,M),r(M,E),r(M,B),r(M,F),r(F,G),r(e,Z),r(e,J),te||(ne=[Q(c,"click",n[10]),Q(d,"input",n[14]),Q(S,"input",n[15]),Q(E,"click",n[10]),Q(F,"click",n[8]),Q(J,"click",n[10])],te=!0)},p(H,K){H[3].length>0?z?z.p(H,K):(z=Ce(H),z.c(),z.m(t,y)):z&&(z.d(1),z=null),K&2&&d.value!==H[1]&&le(d,H[1]),K&64&&ce(d,"input-success",H[6]),K&66&&ce(d,"input-error",H[1].length>0&&!H[6]),H[1].length>0&&!H[6]?U||(U=Me(),U.c(),U.m(_,null)):U&&(U.d(1),U=null),K&32&&S.value!==H[5]&&le(S,H[5]),!H[1]&&H[3].length===0?A||(A=Ie(),A.c(),A.m(t,C)):A&&(A.d(1),A=null),K&80&&O!==(O=!H[6]&&!H[4])&&(F.disabled=O)},d(H){H&&f(e),z&&z.d(),U&&U.d(),A&&A.d(),te=!1,Fe(ne)}}}function Ce(n){let e,t,s="Recent Contacts",l,i,o,c=[],b=new Map,w,y,_="or enter a user ID manually",u=n[3].length>3&&De(n),T=he(n[7]);const V=p=>p[17].pubkey;for(let p=0;p<T.length;p+=1){let k=we(n,T,p),h=V(k);b.set(h,c[p]=Ee(h,k))}let d=null;return T.length||(d=Te()),{c(){e=v("div"),t=v("h4"),t.textContent=s,l=x(),u&&u.c(),i=x(),o=v("div");for(let p=0;p<c.length;p+=1)c[p].c();d&&d.c(),w=x(),y=v("div"),y.textContent=_,this.h()},l(p){e=m(p,"DIV",{class:!0});var k=D(e);t=m(k,"H4",{class:!0,"data-svelte-h":!0}),q(t)!=="svelte-kfh6g"&&(t.textContent=s),l=I(k),u&&u.l(k),i=I(k),o=m(k,"DIV",{class:!0});var h=D(o);for(let L=0;L<c.length;L+=1)c[L].l(h);d&&d.l(h),h.forEach(f),k.forEach(f),w=I(p),y=m(p,"DIV",{class:!0,"data-svelte-h":!0}),q(y)!=="svelte-4y71nf"&&(y.textContent=_),this.h()},h(){a(t,"class","text-sm font-semibold mb-3 text-base-content/70"),a(o,"class","space-y-1 max-h-48 overflow-y-auto"),a(e,"class","mb-6"),a(y,"class","divider text-xs text-base-content/40 my-2")},m(p,k){j(p,e,k),r(e,t),r(e,l),u&&u.m(e,null),r(e,i),r(e,o);for(let h=0;h<c.length;h+=1)c[h]&&c[h].m(o,null);d&&d.m(o,null),j(p,w,k),j(p,y,k)},p(p,k){p[3].length>3?u?u.p(p,k):(u=De(p),u.c(),u.m(e,i)):u&&(u.d(1),u=null),k&656&&(T=he(p[7]),c=Ae(c,k,V,1,p,T,b,o,Oe,Ee,null,we),!T.length&&d?d.p(p,k):T.length?d&&(d.d(1),d=null):(d=Te(),d.c(),d.m(o,null)))},d(p){p&&(f(e),f(w),f(y)),u&&u.d();for(let k=0;k<c.length;k+=1)c[k].d();d&&d.d()}}}function De(n){let e,t,s,l;return{c(){e=v("div"),t=v("input"),this.h()},l(i){e=m(i,"DIV",{class:!0});var o=D(e);t=m(o,"INPUT",{type:!0,placeholder:!0,class:!0}),o.forEach(f),this.h()},h(){a(t,"type","text"),a(t,"placeholder","Filter contacts by name..."),a(t,"class","input input-bordered input-sm w-full"),a(e,"class","form-control mb-3")},m(i,o){j(i,e,o),r(e,t),le(t,n[2]),s||(l=Q(t,"input",n[12]),s=!0)},p(i,o){o&4&&t.value!==i[2]&&le(t,i[2])},d(i){i&&f(e),s=!1,l()}}}function Te(n){let e,t="No matching contacts";return{c(){e=v("p"),e.textContent=t,this.h()},l(s){e=m(s,"P",{class:!0,"data-svelte-h":!0}),q(e)!=="svelte-157mbhc"&&(e.textContent=t),this.h()},h(){a(e,"class","text-sm text-base-content/50 text-center py-2")},m(s,l){j(s,e,l)},p:ae,d(s){s&&f(e)}}}function rt(n){let e,t=Le(n[17].name)+"",s;return{c(){e=v("span"),s=X(t),this.h()},l(l){e=m(l,"SPAN",{class:!0});var i=D(e);s=W(i,t),i.forEach(f),this.h()},h(){a(e,"class","text-xs font-semibold")},m(l,i){j(l,e,i),r(e,s)},p(l,i){i&128&&t!==(t=Le(l[17].name)+"")&&$(s,t)},d(l){l&&f(e)}}}function ot(n){let e,t,s;return{c(){e=v("img"),this.h()},l(l){e=m(l,"IMG",{src:!0,alt:!0}),this.h()},h(){be(e.src,t=n[17].avatar)||a(e,"src",t),a(e,"alt",s=n[17].name)},m(l,i){j(l,e,i)},p(l,i){i&128&&!be(e.src,t=l[17].avatar)&&a(e,"src",t),i&128&&s!==(s=l[17].name)&&a(e,"alt",s)},d(l){l&&f(e)}}}function Ee(n,e){let t,s,l,i,o,c,b=e[17].name+"",w,y,_,u=xe(e[17].pubkey)+"",T,V,d,p,k,h,L,g;function N(M,E){return M[17].avatar?ot:rt}let S=N(e),P=S(e);function C(){return e[13](e[17])}return{key:n,first:null,c(){t=v("button"),s=v("div"),l=v("div"),P.c(),i=x(),o=v("div"),c=v("p"),w=X(b),y=x(),_=v("p"),T=X(u),V=x(),d=fe("svg"),p=fe("path"),k=x(),this.h()},l(M){t=m(M,"BUTTON",{class:!0});var E=D(t);s=m(E,"DIV",{class:!0});var Y=D(s);l=m(Y,"DIV",{class:!0});var B=D(l);P.l(B),B.forEach(f),Y.forEach(f),i=I(E),o=m(E,"DIV",{class:!0});var F=D(o);c=m(F,"P",{class:!0});var G=D(c);w=W(G,b),G.forEach(f),y=I(F),_=m(F,"P",{class:!0});var O=D(_);T=W(O,u),O.forEach(f),F.forEach(f),V=I(E),d=de(E,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var Z=D(d);p=de(Z,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),D(p).forEach(f),Z.forEach(f),k=I(E),E.forEach(f),this.h()},h(){a(l,"class","w-10 h-10 rounded-full bg-primary text-primary-content"),a(s,"class","avatar placeholder"),a(c,"class","font-semibold text-base-content truncate"),a(_,"class","text-xs text-base-content/60 font-mono truncate"),a(o,"class","flex-1 min-w-0"),a(p,"stroke-linecap","round"),a(p,"stroke-linejoin","round"),a(p,"stroke-width","2"),a(p,"d","M9 5l7 7-7 7"),a(d,"xmlns","http://www.w3.org/2000/svg"),a(d,"class","w-5 h-5 text-base-content/40"),a(d,"fill","none"),a(d,"viewBox","0 0 24 24"),a(d,"stroke","currentColor"),a(t,"class",h="w-full p-3 rounded-lg hover:bg-base-200 active:bg-base-300 transition-colors flex items-center gap-3 text-left "+(e[4]===e[17].pubkey?"bg-primary/10 ring-1 ring-primary":"")),this.first=t},m(M,E){j(M,t,E),r(t,s),r(s,l),P.m(l,null),r(t,i),r(t,o),r(o,c),r(c,w),r(o,y),r(o,_),r(_,T),r(t,V),r(t,d),r(d,p),r(t,k),L||(g=Q(t,"click",C),L=!0)},p(M,E){e=M,S===(S=N(e))&&P?P.p(e,E):(P.d(1),P=S(e),P&&(P.c(),P.m(l,null))),E&128&&b!==(b=e[17].name+"")&&$(w,b),E&128&&u!==(u=xe(e[17].pubkey)+"")&&$(T,u),E&144&&h!==(h="w-full p-3 rounded-lg hover:bg-base-200 active:bg-base-300 transition-colors flex items-center gap-3 text-left "+(e[4]===e[17].pubkey?"bg-primary/10 ring-1 ring-primary":""))&&a(t,"class",h)},d(M){M&&f(t),P.d(),L=!1,g()}}}function Me(n){let e,t='<span class="label-text-alt text-error">Invalid format. User ID must be 64 hex characters.</span>';return{c(){e=v("span"),e.innerHTML=t,this.h()},l(s){e=m(s,"SPAN",{class:!0,role:!0,"data-svelte-h":!0}),q(e)!=="svelte-1ajza0r"&&(e.innerHTML=t),this.h()},h(){a(e,"class","label"),a(e,"role","alert")},m(s,l){j(s,e,l)},d(s){s&&f(e)}}}function Ie(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div class="text-sm"><p>Start a private conversation with another community member.</p> <p class="mt-1">You can select from your recent contacts above or paste a user ID to message someone new.</p></div>';return{c(){e=v("div"),e.innerHTML=t,this.h()},l(s){e=m(s,"DIV",{class:!0,"data-svelte-h":!0}),q(e)!=="svelte-1iairbc"&&(e.innerHTML=t),this.h()},h(){a(e,"class","alert alert-info mb-6")},m(s,l){j(s,e,l)},d(s){s&&f(e)}}}function it(n){let e,t=n[0]&&ye(n);return{c(){t&&t.c(),e=_e()},l(s){t&&t.l(s),e=_e()},m(s,l){t&&t.m(s,l),j(s,e,l)},p(s,[l]){s[0]?t?t.p(s,l):(t=ye(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ae,o:ae,d(s){s&&f(e),t&&t.d(s)}}}function xe(n){return n.length<=16?n:`${n.substring(0,8)}...${n.substring(n.length-8)}`}function Le(n){return n.split(" ").map(t=>t[0]).join("").substring(0,2).toUpperCase()||n.substring(0,2).toUpperCase()}function ct(n,e,t){let s,l,i,o;ue(n,ze,g=>t(11,o=g));let{open:c=!1}=e;const b=qe();let w="",y="",_="",u="";function T(){const g=y||w.trim();if(g){if(!/^[0-9a-f]{64}$/i.test(g)){ke.error("Invalid user ID format. Please check and try again.");return}ee.startConversation(g,_||void 0),b("start",{pubkey:g,name:_||void 0}),ke.success("Conversation started"),d()}}function V(g,N){t(4,y=g),t(1,w=g),t(5,_=N)}function d(){t(0,c=!1),t(1,w=""),t(4,y=""),t(5,_=""),t(2,u=""),b("close")}function p(){u=this.value,t(2,u)}const k=g=>V(g.pubkey,g.name);function h(){w=this.value,t(1,w)}function L(){_=this.value,t(5,_)}return n.$$set=g=>{"open"in g&&t(0,c=g.open)},n.$$.update=()=>{n.$$.dirty&2048&&t(3,s=o.slice(0,10)),n.$$.dirty&12&&t(7,l=u?s.filter(g=>g.name.toLowerCase().includes(u.toLowerCase())):s),n.$$.dirty&2&&t(6,i=/^[0-9a-f]{64}$/i.test(w.trim()))},[c,w,u,s,y,_,i,l,T,V,d,o,p,k,h,L]}class ut extends je{constructor(e){super(),Ue(this,e,ct,it,Be,{open:0})}}function Ve(n,e,t){const s=n.slice();return s[17]=e[t],s}function Ne(n){let e,t,s,l,i,o="Dismiss",c,b;return{c(){e=v("div"),t=v("span"),s=X(n[1]),l=x(),i=v("button"),i.textContent=o,this.h()},l(w){e=m(w,"DIV",{class:!0});var y=D(e);t=m(y,"SPAN",{});var _=D(t);s=W(_,n[1]),_.forEach(f),l=I(y),i=m(y,"BUTTON",{class:!0,"data-svelte-h":!0}),q(i)!=="svelte-1t1ajzw"&&(i.textContent=o),y.forEach(f),this.h()},h(){a(i,"class","btn btn-sm"),a(e,"class","alert alert-error mb-4")},m(w,y){j(w,e,y),r(e,t),r(t,s),r(e,l),r(e,i),c||(b=Q(i,"click",n[10]),c=!0)},p(w,y){y&2&&$(s,w[1])},d(w){w&&f(e),c=!1,b()}}}function dt(n){let e,t=[],s=new Map,l=he(n[3]);const i=o=>o[17].pubkey;for(let o=0;o<l.length;o+=1){let c=Ve(n,l,o),b=i(c);s.set(b,t[o]=Se(b,c))}return{c(){e=v("div");for(let o=0;o<t.length;o+=1)t[o].c();this.h()},l(o){e=m(o,"DIV",{class:!0});var c=D(e);for(let b=0;b<t.length;b+=1)t[b].l(c);c.forEach(f),this.h()},h(){a(e,"class","space-y-2")},m(o,c){j(o,e,c);for(let b=0;b<t.length;b+=1)t[b]&&t[b].m(e,null)},p(o,c){c&72&&(l=he(o[3]),t=Ae(t,c,i,1,o,l,s,e,Oe,Se,null,Ve))},d(o){o&&f(e);for(let c=0;c<t.length;c+=1)t[c].d()}}}function ft(n){let e,t,s,l,i,o,c="No conversations yet",b,w,y="Start a private, encrypted conversation by sending a message to someone using their public ID.",_,u,T=`<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
          Start a Conversation`,V,d;return{c(){e=v("div"),t=v("div"),s=fe("svg"),l=fe("path"),i=x(),o=v("h3"),o.textContent=c,b=x(),w=v("p"),w.textContent=y,_=x(),u=v("button"),u.innerHTML=T,this.h()},l(p){e=m(p,"DIV",{class:!0});var k=D(e);t=m(k,"DIV",{class:!0});var h=D(t);s=de(h,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var L=D(s);l=de(L,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),D(l).forEach(f),L.forEach(f),i=I(h),o=m(h,"H3",{class:!0,"data-svelte-h":!0}),q(o)!=="svelte-tt0o7v"&&(o.textContent=c),b=I(h),w=m(h,"P",{class:!0,"data-svelte-h":!0}),q(w)!=="svelte-cb6hed"&&(w.textContent=y),_=I(h),u=m(h,"BUTTON",{class:!0,"data-svelte-h":!0}),q(u)!=="svelte-1dybkue"&&(u.innerHTML=T),h.forEach(f),k.forEach(f),this.h()},h(){a(l,"stroke-linecap","round"),a(l,"stroke-linejoin","round"),a(l,"stroke-width","1.5"),a(l,"d","M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"),a(s,"xmlns","http://www.w3.org/2000/svg"),a(s,"class","w-16 h-16 text-base-content/20 mb-4"),a(s,"fill","none"),a(s,"viewBox","0 0 24 24"),a(s,"stroke","currentColor"),a(o,"class","text-lg font-semibold text-base-content mb-2"),a(w,"class","text-base-content/60 mb-6 max-w-sm"),a(u,"class","btn btn-primary gap-2"),a(t,"class","card-body items-center text-center py-16"),a(e,"class","card bg-base-200")},m(p,k){j(p,e,k),r(e,t),r(t,s),r(s,l),r(t,i),r(t,o),r(t,b),r(t,w),r(t,_),r(t,u),V||(d=Q(u,"click",n[11]),V=!0)},p:ae,d(p){p&&f(e),V=!1,d()}}}function ht(n){let e,t='<div class="loading loading-spinner loading-lg text-primary"></div> <p class="text-sm text-base-content/50">Loading conversations...</p>';return{c(){e=v("div"),e.innerHTML=t,this.h()},l(s){e=m(s,"DIV",{class:!0,"data-svelte-h":!0}),q(e)!=="svelte-pu7tdn"&&(e.innerHTML=t),this.h()},h(){a(e,"class","flex flex-col justify-center items-center min-h-[400px] gap-3")},m(s,l){j(s,e,l)},p:ae,d(s){s&&f(e)}}}function He(n){let e,t=n[17].unreadCount+"",s;return{c(){e=v("div"),s=X(t),this.h()},l(l){e=m(l,"DIV",{class:!0});var i=D(e);s=W(i,t),i.forEach(f),this.h()},h(){a(e,"class","badge badge-primary badge-sm")},m(l,i){j(l,e,i),r(e,s)},p(l,i){i&8&&t!==(t=l[17].unreadCount+"")&&$(s,t)},d(l){l&&f(e)}}}function Se(n,e){let t,s,l,i,o,c,b=e[17].name.charAt(0).toUpperCase()+"",w,y,_,u,T,V=e[17].name+"",d,p,k,h=Pe(e[17].lastMessageTimestamp)+"",L,g,N,S=e[17].lastMessage+"",P,C,M,E,Y,B=e[17].unreadCount>0&&He(e);function F(){return e[12](e[17])}return{key:n,first:null,c(){t=v("button"),s=v("div"),l=v("div"),i=v("div"),o=v("div"),c=v("span"),w=X(b),y=x(),_=v("div"),u=v("div"),T=v("h3"),d=X(V),p=x(),k=v("span"),L=X(h),g=x(),N=v("p"),P=X(S),C=x(),B&&B.c(),M=x(),this.h()},l(G){t=m(G,"BUTTON",{class:!0});var O=D(t);s=m(O,"DIV",{class:!0});var Z=D(s);l=m(Z,"DIV",{class:!0});var J=D(l);i=m(J,"DIV",{class:!0});var te=D(i);o=m(te,"DIV",{class:!0});var ne=D(o);c=m(ne,"SPAN",{class:!0});var z=D(c);w=W(z,b),z.forEach(f),ne.forEach(f),te.forEach(f),y=I(J),_=m(J,"DIV",{class:!0});var U=D(_);u=m(U,"DIV",{class:!0});var A=D(u);T=m(A,"H3",{class:!0});var H=D(T);d=W(H,V),H.forEach(f),p=I(A),k=m(A,"SPAN",{class:!0});var K=D(k);L=W(K,h),K.forEach(f),A.forEach(f),g=I(U),N=m(U,"P",{class:!0});var R=D(N);P=W(R,S),R.forEach(f),U.forEach(f),C=I(J),B&&B.l(J),J.forEach(f),Z.forEach(f),M=I(O),O.forEach(f),this.h()},h(){a(c,"class","text-xl"),a(o,"class","bg-primary text-primary-content rounded-full w-12"),a(i,"class","avatar placeholder"),a(T,"class","font-semibold"),a(k,"class","text-xs text-base-content/60"),a(u,"class","flex justify-between items-start mb-1"),a(N,"class","text-sm text-base-content/70 truncate"),a(_,"class","flex-1 min-w-0"),a(l,"class","flex items-center gap-3"),a(s,"class","card-body p-4"),a(t,"class","card bg-base-200 hover:bg-base-300 transition-base cursor-pointer w-full text-left"),this.first=t},m(G,O){j(G,t,O),r(t,s),r(s,l),r(l,i),r(i,o),r(o,c),r(c,w),r(l,y),r(l,_),r(_,u),r(u,T),r(T,d),r(u,p),r(u,k),r(k,L),r(_,g),r(_,N),r(N,P),r(l,C),B&&B.m(l,null),r(t,M),E||(Y=Q(t,"click",F),E=!0)},p(G,O){e=G,O&8&&b!==(b=e[17].name.charAt(0).toUpperCase()+"")&&$(w,b),O&8&&V!==(V=e[17].name+"")&&$(d,V),O&8&&h!==(h=Pe(e[17].lastMessageTimestamp)+"")&&$(L,h),O&8&&S!==(S=e[17].lastMessage+"")&&$(P,S),e[17].unreadCount>0?B?B.p(e,O):(B=He(e),B.c(),B.m(l,null)):B&&(B.d(1),B=null)},d(G){G&&f(t),B&&B.d(),E=!1,Y()}}}function pt(n){let e,t,s,l,i,o='<h1 class="text-4xl font-bold gradient-text mb-2">Direct Messages</h1> <p class="text-base-content/70">Private encrypted conversations</p>',c,b,w=`<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
      New Message`,y,_,u,T,V,d,p,k;document.title=e="Direct Messages - "+n[4].name;let h=n[1]&&Ne(n);function L(C,M){return C[2]?ht:C[3].length===0?ft:dt}let g=L(n),N=g(n);function S(C){n[13](C)}let P={};return n[0]!==void 0&&(P.open=n[0]),T=new ut({props:P}),Ke.push(()=>Qe(T,"open",S)),T.$on("start",n[5]),{c(){t=x(),s=v("div"),l=v("div"),i=v("div"),i.innerHTML=o,c=x(),b=v("button"),b.innerHTML=w,y=x(),h&&h.c(),_=x(),N.c(),u=x(),tt(T.$$.fragment),this.h()},l(C){Ge("svelte-91guuv",document.head).forEach(f),t=I(C),s=m(C,"DIV",{class:!0});var E=D(s);l=m(E,"DIV",{class:!0});var Y=D(l);i=m(Y,"DIV",{"data-svelte-h":!0}),q(i)!=="svelte-16e5nxk"&&(i.innerHTML=o),c=I(Y),b=m(Y,"BUTTON",{class:!0,"data-svelte-h":!0}),q(b)!=="svelte-c155ib"&&(b.innerHTML=w),Y.forEach(f),y=I(E),h&&h.l(E),_=I(E),N.l(E),E.forEach(f),u=I(C),et(T.$$.fragment,C),this.h()},h(){a(b,"class","btn btn-primary gap-2"),a(l,"class","flex items-start justify-between mb-6"),a(s,"class","container mx-auto p-4 max-w-2xl")},m(C,M){j(C,t,M),j(C,s,M),r(s,l),r(l,i),r(l,c),r(l,b),r(s,y),h&&h.m(s,null),r(s,_),N.m(s,null),j(C,u,M),$e(T,C,M),d=!0,p||(k=Q(b,"click",n[9]),p=!0)},p(C,[M]){(!d||M&16)&&e!==(e="Direct Messages - "+C[4].name)&&(document.title=e),C[1]?h?h.p(C,M):(h=Ne(C),h.c(),h.m(s,_)):h&&(h.d(1),h=null),g===(g=L(C))&&N?N.p(C,M):(N.d(1),N=g(C),N&&(N.c(),N.m(s,null)));const E={};!V&&M&1&&(V=!0,E.open=C[0],Re(()=>V=!1)),T.$set(E)},i(C){d||(Ze(T.$$.fragment,C),d=!0)},o(C){Xe(T.$$.fragment,C),d=!1},d(C){C&&(f(t),f(s),f(u)),h&&h.d(),N.d(),We(T,C),p=!1,k()}}}const mt=8e3;function Pe(n){const e=new Date(n*1e3),l=(new Date().getTime()-e.getTime())/(1e3*60*60);return l<24?e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):l<48?"Yesterday":e.toLocaleDateString()}function vt(n,e,t){let s,l,i,o,c,b;ue(n,ge,g=>t(16,o=g)),ue(n,ee,g=>t(7,c=g)),ue(n,ze,g=>t(8,b=g));const w=st();let y=null,_=null,u=!1;Ye(async()=>{if(await ge.waitForReady(),!o.isAuthenticated||!o.privateKey){pe(`${me}/`);return}_=setTimeout(()=>{c.isLoading&&(ee.clearError(),ee.forceLoadingComplete())},mt);try{const g=lt.hexToBytes(o.privateKey),N={publish:async()=>{}};await ee.fetchConversations(N,g),y=await ee.subscribeToIncoming(g)}catch(g){console.error("Failed to load conversations:",g)}finally{_&&(clearTimeout(_),_=null)}}),Je(()=>{y&&y(),_&&clearTimeout(_)});function T(g){pe(`${me}/dm/${g.detail.pubkey}`)}function V(g){pe(`${me}/dm/${g}`)}const d=()=>t(0,u=!0),p=()=>ee.clearError(),k=()=>t(0,u=!0),h=g=>V(g.pubkey);function L(g){u=g,t(0,u)}return n.$$.update=()=>{n.$$.dirty&256&&t(3,s=b),n.$$.dirty&128&&t(2,l=c.isLoading),n.$$.dirty&128&&t(1,i=c.error)},[u,i,l,s,w,T,V,c,b,d,p,k,h,L]}class Et extends je{constructor(e){super(),Ue(this,e,vt,pt,Be,{})}}export{Et as component,Tt as universal};
