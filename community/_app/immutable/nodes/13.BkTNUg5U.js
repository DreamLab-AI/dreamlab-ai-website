import{s as Se,n as $,d as u,a as G,l as d,i as N,b as f,q as se,c as _,e as w,f as j,g as L,h as m,t as x,j as F,p as xe,o as Z,x as Ve,w as $e,G as Oe,R as ve,H as Ue,I as He,J as ze,C as Vt,k as be,E as Nt,y as Ne,ad as jt,ae as xt,u as Le,v as Fe,r as Ot,P as et,z as Ut,m as Ht,B as zt}from"../chunks/0ZVSoAEn.js";import{S as Ie,i as De,t as z,a as U,h as ge,g as he,c as _e,d as re,m as ae,b as oe,e as ie}from"../chunks/DKVmOqaf.js";import{e as Be,u as qt,o as Yt}from"../chunks/m0NROLOn.js";import{g as Ye}from"../chunks/CTVLmyHZ.js";import{b as ke}from"../chunks/xKPZ-4ZK.js";import{p as Kt}from"../chunks/BdMR7A5I.js";import{h as Gt,n as Jt,g as Qt,a as tt,f as Wt,E as nt,e as Xt,F as Zt,m as $t}from"../chunks/DxD0Wn3l.js";import{u as en}from"../chunks/Cufo8aq4.js";import{whitelistStatusStore as st}from"../chunks/CF3XGpNG.js";import{f as tn}from"../chunks/BqFahvin.js";import{c as nn}from"../chunks/D31DSQKd.js";import{W as sn,B as ln,T as rn,a as an,M as on}from"../chunks/CsHxksVb.js";import{g as cn}from"../chunks/9tEgXtNp.js";import{l as fn}from"../chunks/CVI4yqfx.js";import{profileCache as Ke}from"../chunks/D7m-JnSU.js";import{S as un}from"../chunks/B4zVO3xS.js";/* empty css                *//* empty css                *//* empty css                */import"../chunks/C5DPgcI1.js";import{f as Qe,a as dn,s as Lt,b as Ft}from"../chunks/Cvz7PzGQ.js";import{s as hn}from"../chunks/BFKgAPxM.js";import{d as Ge}from"../chunks/6Pu-XtiL.js";import{s as _n}from"../chunks/aZ5XzadJ.js";function lt(l){return l===0?"":l>99?"99+":l.toString()}function mn(l){const e=l.slice(),t=Ke.getCachedSync(e[2].authorPubkey);e[9]=t;const n=e[9]?.displayName||e[2].authorPubkey.substring(0,8)+"...";e[10]=n;const s=e[9]?.avatar||cn(e[2].authorPubkey,32);return e[11]=s,e}function rt(l){let e,t="Open";return{c(){e=m("span"),e.textContent=t,this.h()},l(n){e=_(n,"SPAN",{class:!0,title:!0,"data-svelte-h":!0}),Z(e)!=="svelte-st15ms"&&(e.textContent=t),this.h()},h(){d(e,"class","badge badge-success badge-xs"),d(e,"title","Open - anyone can post")},m(n,s){N(n,e,s)},d(n){n&&u(e)}}}function at(l){let e,t=lt(l[4])+"",n;return{c(){e=m("span"),n=x(t),this.h()},l(s){e=_(s,"SPAN",{class:!0});var r=w(e);n=j(r,t),r.forEach(u),this.h()},h(){d(e,"class","badge badge-primary badge-sm rounded-full")},m(s,r){N(s,e,r),f(e,n)},p(s,r){r&16&&t!==(t=lt(s[4])+"")&&G(n,t)},d(s){s&&u(e)}}}function ot(l){let e,t=l[0].description+"",n;return{c(){e=m("p"),n=x(t),this.h()},l(s){e=_(s,"P",{class:!0});var r=w(e);n=j(r,t),r.forEach(u),this.h()},h(){d(e,"class","text-sm text-base-content/70 line-clamp-1 mt-0.5")},m(s,r){N(s,e,r),f(e,n)},p(s,r){r&1&&t!==(t=s[0].description+"")&&G(n,t)},d(s){s&&u(e)}}}function pn(l){let e,t,n,s,r,i=l[0].encrypted&&it();return{c(){e=m("div"),t=x(l[1]),n=x(" posts"),s=F(),i&&i.c(),r=Ve(),this.h()},l(a){e=_(a,"DIV",{class:!0});var o=w(e);t=j(o,l[1]),n=j(o," posts"),o.forEach(u),s=L(a),i&&i.l(a),r=Ve(),this.h()},h(){d(e,"class","badge badge-primary badge-sm")},m(a,o){N(a,e,o),f(e,t),f(e,n),N(a,s,o),i&&i.m(a,o),N(a,r,o)},p(a,o){o&2&&G(t,a[1]),a[0].encrypted?i||(i=it(),i.c(),i.m(r.parentNode,r)):i&&(i.d(1),i=null)},d(a){a&&(u(e),u(s),u(r)),i&&i.d(a)}}}function bn(l){let e;return{c(){e=m("span"),this.h()},l(t){e=_(t,"SPAN",{class:!0}),w(e).forEach(u),this.h()},h(){d(e,"class","loading loading-spinner loading-xs")},m(t,n){N(t,e,n)},p:$,d(t){t&&u(e)}}}function it(l){let e,t="üîí Encrypted";return{c(){e=m("div"),e.textContent=t,this.h()},l(n){e=_(n,"DIV",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-85okh"&&(e.textContent=t),this.h()},h(){d(e,"class","badge badge-secondary badge-sm")},m(n,s){N(n,e,s)},d(n){n&&u(e)}}}function vn(l){let e,t="No messages yet - be the first to post!";return{c(){e=m("div"),e.textContent=t,this.h()},l(n){e=_(n,"DIV",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-14axbvc"&&(e.textContent=t),this.h()},h(){d(e,"class","mt-2 pt-2 border-t border-base-300 text-xs text-base-content/60 italic")},m(n,s){N(n,e,s)},p:$,d(n){n&&u(e)}}}function ct(l){let e,t,n,s,r,i,a,o=l[10]+"",c,h,S,g,E=l[2].content+"",C,v,p,A=ft(l[2].timestamp)+"",I;return{c(){e=m("div"),t=m("div"),n=m("img"),i=F(),a=m("span"),c=x(o),h=x(":"),S=F(),g=m("span"),C=x(E),v=F(),p=m("span"),I=x(A),this.h()},l(k){e=_(k,"DIV",{class:!0});var b=w(e);t=_(b,"DIV",{class:!0});var M=w(t);n=_(M,"IMG",{src:!0,alt:!0,class:!0}),i=L(M),a=_(M,"SPAN",{class:!0});var y=w(a);c=j(y,o),h=j(y,":"),y.forEach(u),S=L(M),g=_(M,"SPAN",{class:!0});var D=w(g);C=j(D,E),D.forEach(u),v=L(M),p=_(M,"SPAN",{class:!0});var P=w(p);I=j(P,A),P.forEach(u),M.forEach(u),b.forEach(u),this.h()},h(){$e(n.src,s=l[11])||d(n,"src",s),d(n,"alt",r=l[10]),d(n,"class","w-4 h-4 rounded-full"),d(a,"class","font-medium"),d(g,"class","truncate flex-1"),d(p,"class","flex-shrink-0"),d(t,"class","flex items-center gap-2"),d(e,"class","mt-2 pt-2 border-t border-base-300 text-xs text-base-content/60")},m(k,b){N(k,e,b),f(e,t),f(t,n),f(t,i),f(t,a),f(a,c),f(a,h),f(t,S),f(t,g),f(g,C),f(t,v),f(t,p),f(p,I)},p(k,b){b&4&&!$e(n.src,s=k[11])&&d(n,"src",s),b&4&&r!==(r=k[10])&&d(n,"alt",r),b&4&&o!==(o=k[10]+"")&&G(c,o),b&4&&E!==(E=k[2].content+"")&&G(C,E),b&4&&A!==(A=ft(k[2].timestamp)+"")&&G(I,A)},d(k){k&&u(e)}}}function gn(l){let e,t,n,s,r,i=l[5](l[0].name)+"",a,o,c,h,S,g,E,C=l[0].name+"",v,p,A,I,k,b,M,y,D,P,T=l[0].accessType==="open"&&rt(),V=!l[3]&&l[4]>0&&at(l),O=l[0].description&&ot(l);function J(R,Y){return R[3]?bn:pn}let ee=J(l),Q=ee(l);function ne(R,Y){if(R[2])return ct;if(!R[3])return vn}function H(R,Y){return Y===ct?mn(R):R}let q=ne(l),W=q&&q(H(l,q));return{c(){e=m("button"),t=m("div"),n=m("div"),s=m("div"),r=m("div"),a=x(i),o=F(),c=m("div"),h=m("div"),S=m("div"),g=m("div"),E=m("h3"),v=x(C),p=F(),T&&T.c(),A=F(),V&&V.c(),I=F(),O&&O.c(),k=F(),b=m("div"),Q.c(),M=F(),W&&W.c(),this.h()},l(R){e=_(R,"BUTTON",{class:!0,"aria-label":!0});var Y=w(e);t=_(Y,"DIV",{class:!0});var me=w(t);n=_(me,"DIV",{class:!0});var ue=w(n);s=_(ue,"DIV",{class:!0});var K=w(s);r=_(K,"DIV",{class:!0});var ye=w(r);a=j(ye,i),ye.forEach(u),K.forEach(u),o=L(ue),c=_(ue,"DIV",{class:!0});var te=w(c);h=_(te,"DIV",{class:!0});var de=w(h);S=_(de,"DIV",{class:!0});var B=w(S);g=_(B,"DIV",{class:!0});var X=w(g);E=_(X,"H3",{class:!0});var le=w(E);v=j(le,C),le.forEach(u),p=L(X),T&&T.l(X),A=L(X),V&&V.l(X),X.forEach(u),I=L(B),O&&O.l(B),B.forEach(u),k=L(de),b=_(de,"DIV",{class:!0});var we=w(b);Q.l(we),we.forEach(u),de.forEach(u),M=L(te),W&&W.l(te),te.forEach(u),ue.forEach(u),me.forEach(u),Y.forEach(u),this.h()},h(){d(r,"class","w-12 h-12 rounded-lg bg-primary/20 flex items-center justify-center text-2xl"),d(s,"class","flex-shrink-0"),d(E,"class","font-bold text-base truncate"),d(g,"class","flex items-center gap-2 flex-wrap"),d(S,"class","flex-1"),d(b,"class","flex flex-col items-end gap-1 flex-shrink-0"),d(h,"class","flex items-start justify-between gap-2"),d(c,"class","flex-1 min-w-0"),d(n,"class","flex gap-4"),d(t,"class","card-body p-4"),d(e,"class","card bg-base-200 hover:bg-base-300 transition-all cursor-pointer text-left w-full border border-transparent hover:border-primary/30"),d(e,"aria-label",y="Open channel: "+l[0].name)},m(R,Y){N(R,e,Y),f(e,t),f(t,n),f(n,s),f(s,r),f(r,a),f(n,o),f(n,c),f(c,h),f(h,S),f(S,g),f(g,E),f(E,v),f(g,p),T&&T.m(g,null),f(g,A),V&&V.m(g,null),f(S,I),O&&O.m(S,null),f(h,k),f(h,b),Q.m(b,null),f(c,M),W&&W.m(c,null),D||(P=se(e,"click",l[6]),D=!0)},p(R,[Y]){Y&1&&i!==(i=R[5](R[0].name)+"")&&G(a,i),Y&1&&C!==(C=R[0].name+"")&&G(v,C),R[0].accessType==="open"?T||(T=rt(),T.c(),T.m(g,A)):T&&(T.d(1),T=null),!R[3]&&R[4]>0?V?V.p(R,Y):(V=at(R),V.c(),V.m(g,null)):V&&(V.d(1),V=null),R[0].description?O?O.p(R,Y):(O=ot(R),O.c(),O.m(S,null)):O&&(O.d(1),O=null),ee===(ee=J(R))&&Q?Q.p(R,Y):(Q.d(1),Q=ee(R),Q&&(Q.c(),Q.m(b,null))),q===(q=ne(R))&&W?W.p(H(R,q),Y):(W&&W.d(1),W=q&&q(H(R,q)),W&&(W.c(),W.m(c,null))),Y&1&&y!==(y="Open channel: "+R[0].name)&&d(e,"aria-label",y)},i:$,o:$,d(R){R&&u(e),T&&T.d(),V&&V.d(),O&&O.d(),Q.d(),W&&W.d(),D=!1,P()}}}function ft(l){const t=Math.floor(Date.now()/1e3)-l;return t<60?"just now":t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:t<604800?`${Math.floor(t/86400)}d ago`:new Date(l*1e3).toLocaleDateString()}function kn(l,e,t){let{channel:n}=e,s=0,r=null,i=!0,a=[],o=0;const c={general:"üí¨",music:"üéµ",tuneage:"üéµ",events:"üìÖ",calendar:"üìÖ",help:"‚ùì",support:"üÜò",announcements:"üì¢",news:"üì∞",random:"üé≤",offtopic:"üí≠",tech:"üíª",gaming:"üéÆ",art:"üé®",photos:"üì∑",video:"üé¨",food:"üçï",sports:"‚öΩ",fitness:"üí™",books:"üìö",movies:"üé¨",pets:"üêï",travel:"‚úàÔ∏è",memes:"üòÇ",default:"üí≠"};function h(g){const E=g.toLowerCase();for(const[C,v]of Object.entries(c))if(E.includes(C))return v;return c.default}xe(async()=>{try{if(!Gt()){console.warn("NDK not connected"),t(3,i=!1);return}const g=Jt();if(!g){console.warn("NDK instance not available"),t(3,i=!1);return}const E=await g.fetchEvents({kinds:[42],"#e":[n.id],limit:100});t(1,s=E.size),a=Array.from(E).map(v=>({id:v.id,channelId:n.id,authorPubkey:v.pubkey,content:v.content,createdAt:v.created_at||0,isEncrypted:!1})),t(4,o=fn.getUnreadCount(n.id,a));let C=null;for(const v of E)(!C||(v.created_at||0)>C.created_at)&&(C={content:v.content,pubkey:v.pubkey,created_at:v.created_at||0});if(C){Ke.getProfile(C.pubkey);const v=Ke.getCachedSync(C.pubkey);t(2,r={content:C.content.substring(0,60)+(C.content.length>60?"...":""),author:v?.displayName||C.pubkey.substring(0,8)+"...",authorPubkey:C.pubkey,timestamp:C.created_at})}}catch(g){console.error("Failed to fetch channel stats:",g)}finally{t(3,i=!1)}});function S(){Ye(`${ke}/chat/${n.id}`)}return l.$$set=g=>{"channel"in g&&t(0,n=g.channel)},[n,s,r,i,o,h,S]}class yn extends Ie{constructor(e){super(),De(this,e,kn,gn,Se,{channel:0})}}const wn=l=>({}),ut=l=>({}),Cn=l=>({}),dt=l=>({}),En=l=>({}),ht=l=>({});function Sn(l){let e;const t=l[11].illustration,n=Oe(t,l,l[10],ht);return{c(){n&&n.c()},l(s){n&&n.l(s)},m(s,r){n&&n.m(s,r),e=!0},p(s,r){n&&n.p&&(!e||r&1024)&&Ue(n,t,s,s[10],e?ze(t,s[10],r,En):He(s[10]),ht)},i(s){e||(U(n,s),e=!0)},o(s){z(n,s),e=!1},d(s){n&&n.d(s)}}}function In(l){let e,t,n;return{c(){e=m("div"),t=x(l[0]),this.h()},l(s){e=_(s,"DIV",{class:!0,style:!0,"aria-hidden":!0});var r=w(e);t=j(r,l[0]),r.forEach(u),this.h()},h(){d(e,"class","text-6xl mb-6 opacity-60"),Ne(e,"transform","translateY("+l[6]+"px)"),d(e,"aria-hidden","true")},m(s,r){N(s,e,r),f(e,t)},p(s,r){r&1&&G(t,s[0]),r&64&&Ne(e,"transform","translateY("+s[6]+"px)")},i(s){s&&(n||ve(()=>{n=ge(e,Lt,{duration:400,delay:100,start:.8}),n.start()}))},o:$,d(s){s&&u(e)}}}function Dn(l){let e,t,n=l[9][l[5]]+"",s;return{c(){e=m("div"),t=new xt(!1),this.h()},l(r){e=_(r,"DIV",{class:!0,style:!0,"aria-hidden":!0});var i=w(e);t=jt(i,!1),i.forEach(u),this.h()},h(){t.a=null,d(e,"class","mb-6 opacity-80"),Ne(e,"transform","translateY("+l[6]+"px)"),d(e,"aria-hidden","true")},m(r,i){N(r,e,i),t.m(n,e)},p(r,i){i&32&&n!==(n=r[9][r[5]]+"")&&t.p(n),i&64&&Ne(e,"transform","translateY("+r[6]+"px)")},i(r){r&&(s||ve(()=>{s=ge(e,Lt,{duration:400,delay:100,start:.8}),s.start()}))},o:$,d(r){r&&u(e)}}}function _t(l){let e,t,n;return{c(){e=m("p"),t=x(l[2]),this.h()},l(s){e=_(s,"P",{class:!0});var r=w(e);t=j(r,l[2]),r.forEach(u),this.h()},h(){d(e,"class","text-base-content/60 mb-8 max-w-md leading-relaxed")},m(s,r){N(s,e,r),f(e,t)},p(s,r){r&4&&G(t,s[2])},i(s){s&&(n||ve(()=>{n=ge(e,Qe,{y:10,duration:300,delay:200}),n.start()}))},o:$,d(s){s&&u(e)}}}function mt(l){let e,t,n,s,r=l[3]&&pt(l),i=l[4]&&bt(l);return{c(){e=m("div"),r&&r.c(),t=F(),i&&i.c(),this.h()},l(a){e=_(a,"DIV",{class:!0});var o=w(e);r&&r.l(o),t=L(o),i&&i.l(o),o.forEach(u),this.h()},h(){d(e,"class","flex flex-wrap gap-3 justify-center")},m(a,o){N(a,e,o),r&&r.m(e,null),f(e,t),i&&i.m(e,null),s=!0},p(a,o){a[3]?r?(r.p(a,o),o&8&&U(r,1)):(r=pt(a),r.c(),U(r,1),r.m(e,t)):r&&(he(),z(r,1,1,()=>{r=null}),_e()),a[4]?i?(i.p(a,o),o&16&&U(i,1)):(i=bt(a),i.c(),U(i,1),i.m(e,null)):i&&(he(),z(i,1,1,()=>{i=null}),_e())},i(a){s||(U(r),U(i),a&&(n||ve(()=>{n=ge(e,Qe,{y:10,duration:300,delay:250}),n.start()})),s=!0)},o(a){z(r),z(i),s=!1},d(a){a&&u(e),r&&r.d(),i&&i.d()}}}function pt(l){let e,t,n,s,r,i;const a=l[11]["action-icon"],o=Oe(a,l,l[10],dt);return{c(){e=m("button"),o&&o.c(),t=F(),n=x(l[3]),this.h()},l(c){e=_(c,"BUTTON",{class:!0});var h=w(e);o&&o.l(h),t=L(h),n=j(h,l[3]),h.forEach(u),this.h()},h(){d(e,"class","btn btn-primary gap-2 focus-ring")},m(c,h){N(c,e,h),o&&o.m(e,null),f(e,t),f(e,n),s=!0,r||(i=se(e,"click",l[12]),r=!0)},p(c,h){o&&o.p&&(!s||h&1024)&&Ue(o,a,c,c[10],s?ze(a,c[10],h,Cn):He(c[10]),dt),(!s||h&8)&&G(n,c[3])},i(c){s||(U(o,c),s=!0)},o(c){z(o,c),s=!1},d(c){c&&u(e),o&&o.d(c),r=!1,i()}}}function bt(l){let e,t,n,s,r,i;const a=l[11]["secondary-icon"],o=Oe(a,l,l[10],ut);return{c(){e=m("button"),o&&o.c(),t=F(),n=x(l[4]),this.h()},l(c){e=_(c,"BUTTON",{class:!0});var h=w(e);o&&o.l(h),t=L(h),n=j(h,l[4]),h.forEach(u),this.h()},h(){d(e,"class","btn btn-ghost gap-2 focus-ring")},m(c,h){N(c,e,h),o&&o.m(e,null),f(e,t),f(e,n),s=!0,r||(i=se(e,"click",l[13]),r=!0)},p(c,h){o&&o.p&&(!s||h&1024)&&Ue(o,a,c,c[10],s?ze(a,c[10],h,wn):He(c[10]),ut),(!s||h&16)&&G(n,c[4])},i(c){s||(U(o,c),s=!0)},o(c){z(o,c),s=!1},d(c){c&&u(e),o&&o.d(c),r=!1,i()}}}function An(l){let e,t,n,s,r,i,a,o,c,h,S,g;const E=[Dn,In,Sn],C=[];function v(b,M){return b[5]!=="none"&&b[5]!=="custom"?0:b[0]?1:2}t=v(l),n=C[t]=E[t](l);let p=l[2]&&_t(l),A=(l[3]||l[4])&&mt(l);const I=l[11].default,k=Oe(I,l,l[10],null);return{c(){e=m("div"),n.c(),s=F(),r=m("h3"),i=x(l[1]),o=F(),p&&p.c(),c=F(),A&&A.c(),h=F(),k&&k.c(),this.h()},l(b){e=_(b,"DIV",{class:!0,role:!0,"aria-live":!0});var M=w(e);n.l(M),s=L(M),r=_(M,"H3",{class:!0});var y=w(r);i=j(y,l[1]),y.forEach(u),o=L(M),p&&p.l(M),c=L(M),A&&A.l(M),h=L(M),k&&k.l(M),M.forEach(u),this.h()},h(){d(r,"class","text-xl font-semibold text-base-content mb-3"),d(e,"class","flex flex-col items-center justify-center py-16 px-6 text-center"),d(e,"role","status"),d(e,"aria-live","polite")},m(b,M){N(b,e,M),C[t].m(e,null),f(e,s),f(e,r),f(r,i),f(e,o),p&&p.m(e,null),f(e,c),A&&A.m(e,null),f(e,h),k&&k.m(e,null),g=!0},p(b,[M]){let y=t;t=v(b),t===y?C[t].p(b,M):(he(),z(C[y],1,1,()=>{C[y]=null}),_e(),n=C[t],n?n.p(b,M):(n=C[t]=E[t](b),n.c()),U(n,1),n.m(e,s)),(!g||M&2)&&G(i,b[1]),b[2]?p?(p.p(b,M),M&4&&U(p,1)):(p=_t(b),p.c(),U(p,1),p.m(e,c)):p&&(p.d(1),p=null),b[3]||b[4]?A?(A.p(b,M),M&24&&U(A,1)):(A=mt(b),A.c(),U(A,1),A.m(e,h)):A&&(he(),z(A,1,1,()=>{A=null}),_e()),k&&k.p&&(!g||M&1024)&&Ue(k,I,b,b[10],g?ze(I,b[10],M,null):He(b[10]),null)},i(b){g||(U(n),b&&(a||ve(()=>{a=ge(r,Qe,{y:10,duration:300,delay:150}),a.start()})),U(p),U(A),U(k,b),b&&(S||ve(()=>{S=ge(e,dn,{duration:300}),S.start()})),g=!0)},o(b){z(n),z(A),z(k,b),g=!1},d(b){b&&u(e),C[t].d(),p&&p.d(),A&&A.d(),k&&k.d(b)}}}function Tn(l,e,t){let n,{$$slots:s={},$$scope:r}=e,{icon:i=""}=e,{title:a="Nothing here yet"}=e,{description:o=""}=e,{actionLabel:c=""}=e,{secondaryActionLabel:h=""}=e,{illustration:S="none"}=e;const g=Vt(),E=hn(0,{stiffness:.02,damping:.3});be(l,E,I=>t(6,n=I));let C=null;xe(()=>{C=setInterval(()=>{E.set(Math.sin(Date.now()/1e3)*4)},50)}),Nt(()=>{C&&clearInterval(C)});const v={"empty-inbox":`<svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-32 h-32 text-base-content/20">
      <rect x="40" y="60" width="120" height="100" rx="8" stroke="currentColor" stroke-width="2" fill="none"/>
      <path d="M40 80 L100 120 L160 80" stroke="currentColor" stroke-width="2" fill="none"/>
      <circle cx="100" cy="50" r="20" stroke="currentColor" stroke-width="2" stroke-dasharray="4 4"/>
    </svg>`,"no-results":`<svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-32 h-32 text-base-content/20">
      <circle cx="85" cy="85" r="45" stroke="currentColor" stroke-width="2" fill="none"/>
      <line x1="120" y1="120" x2="160" y2="160" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
      <line x1="70" y1="85" x2="100" y2="85" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>`,error:`<svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-32 h-32 text-error/40">
      <circle cx="100" cy="100" r="60" stroke="currentColor" stroke-width="2" fill="none"/>
      <line x1="75" y1="75" x2="125" y2="125" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
      <line x1="125" y1="75" x2="75" y2="125" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
    </svg>`,offline:`<svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-32 h-32 text-warning/40">
      <path d="M50 120 Q100 80 150 120" stroke="currentColor" stroke-width="2" fill="none"/>
      <path d="M65 135 Q100 105 135 135" stroke="currentColor" stroke-width="2" fill="none"/>
      <path d="M80 150 Q100 130 120 150" stroke="currentColor" stroke-width="2" fill="none"/>
      <line x1="60" y1="60" x2="140" y2="140" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
    </svg>`,custom:"",none:""},p=()=>g("action"),A=()=>g("secondaryAction");return l.$$set=I=>{"icon"in I&&t(0,i=I.icon),"title"in I&&t(1,a=I.title),"description"in I&&t(2,o=I.description),"actionLabel"in I&&t(3,c=I.actionLabel),"secondaryActionLabel"in I&&t(4,h=I.secondaryActionLabel),"illustration"in I&&t(5,S=I.illustration),"$$scope"in I&&t(10,r=I.$$scope)},[i,a,o,c,h,S,n,g,E,v,r,s,p,A]}class Pn extends Ie{constructor(e){super(),De(this,e,Tn,An,Se,{icon:0,title:1,description:2,actionLabel:3,secondaryActionLabel:4,illustration:5})}}const Mn=!0,Vn=async()=>({channels:[]}),Hs=Object.freeze(Object.defineProperty({__proto__:null,load:Vn,prerender:Mn},Symbol.toStringTag,{value:"Module"}));function Nn(l){let e,t,n;return{c(){e=Fe("svg"),t=Fe("path"),n=x(`
    Mark All as Read`),this.h()},l(s){e=Le(s,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var r=w(e);t=Le(r,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),w(t).forEach(u),r.forEach(u),n=j(s,`
    Mark All as Read`),this.h()},h(){d(t,"stroke-linecap","round"),d(t,"stroke-linejoin","round"),d(t,"stroke-width","2"),d(t,"d","M5 13l4 4L19 7"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"class","h-4 w-4"),d(e,"fill","none"),d(e,"viewBox","0 0 24 24"),d(e,"stroke","currentColor")},m(s,r){N(s,e,r),f(e,t),N(s,n,r)},d(s){s&&(u(e),u(n))}}}function Ln(l){let e,t,n;return{c(){e=Fe("svg"),t=Fe("path"),n=x(`
    Marked!`),this.h()},l(s){e=Le(s,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var r=w(e);t=Le(r,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),w(t).forEach(u),r.forEach(u),n=j(s,`
    Marked!`),this.h()},h(){d(t,"stroke-linecap","round"),d(t,"stroke-linejoin","round"),d(t,"stroke-width","2"),d(t,"d","M5 13l4 4L19 7"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"class","h-4 w-4"),d(e,"fill","none"),d(e,"viewBox","0 0 24 24"),d(e,"stroke","currentColor")},m(s,r){N(s,e,r),f(e,t),N(s,n,r)},d(s){s&&(u(e),u(n))}}}function Fn(l){let e;return{c(){e=m("span"),this.h()},l(t){e=_(t,"SPAN",{class:!0}),w(e).forEach(u),this.h()},h(){d(e,"class","loading loading-spinner loading-xs")},m(t,n){N(t,e,n)},d(t){t&&u(e)}}}function Bn(l){let e,t,n,s;function r(o,c){return o[0]?Fn:o[1]?Ln:Nn}let i=r(l),a=i(l);return{c(){e=m("button"),a.c(),this.h()},l(o){e=_(o,"BUTTON",{class:!0});var c=w(e);a.l(c),c.forEach(u),this.h()},h(){d(e,"class",t="btn btn-sm "+(l[1]?"btn-success":"btn-ghost")+" gap-2"),e.disabled=l[0]},m(o,c){N(o,e,c),a.m(e,null),n||(s=se(e,"click",l[2]),n=!0)},p(o,[c]){i!==(i=r(o))&&(a.d(1),a=i(o),a&&(a.c(),a.m(e,null))),c&2&&t!==(t="btn btn-sm "+(o[1]?"btn-success":"btn-ghost")+" gap-2")&&d(e,"class",t),c&1&&(e.disabled=o[0])},i:$,o:$,d(o){o&&u(e),a.d(),n=!1,s()}}}const vt="nostr_bbs_read_posts";function Rn(l,e,t){const n=Vt();let s=!1,r=!1;function i(){t(0,s=!0);const c=Math.floor(Date.now()/1e3);localStorage.setItem(vt,c.toString()),setTimeout(()=>{t(0,s=!1),t(1,r=!0),n("marked"),setTimeout(()=>{t(1,r=!1)},2e3)},500)}function a(){const c=localStorage.getItem(vt);return c?parseInt(c):0}function o(c){return c<=a()}return[s,r,i,a,o]}class jn extends Ie{constructor(e){super(),De(this,e,Rn,Bn,Se,{getLastReadTime:3,isPostRead:4})}get getLastReadTime(){return this.$$.ctx[3]}get isPostRead(){return this.$$.ctx[4]}}const Bt="https://search.dreamlab-ai.com",xn="https://embedding-api-uc.a.run.app",Je=384;let ce=new Map,Ee=!1,Re=0;const Ce=new Map,On=100;function Un(l,e){if(l.length!==e.length)return 0;let t=0,n=0,s=0;for(let i=0;i<l.length;i++)t+=l[i]*e[i],n+=l[i]*l[i],s+=e[i]*e[i];const r=Math.sqrt(n)*Math.sqrt(s);return r>0?t/r:0}async function Hn(l){const e=Ce.get(l);if(e)return e;try{const t=await fetch(`${xn}/embed`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:l})});if(!t.ok)throw new Error(`Embedding API error: ${t.status}`);const n=await t.json();if(!n.embeddings?.length)throw new Error("No embedding returned");const s=n.embeddings[0];if(Ce.size>=On){const r=Ce.keys().next().value;r&&Ce.delete(r)}return Ce.set(l,s),s}catch(t){return console.error("Embedding API failed:",t),zn(l)}}function zn(l){const e=new Array(Je).fill(0);for(let n=0;n<l.length;n++){const s=l.charCodeAt(n);e[s*(n+1)%Je]+=s/255}const t=Math.sqrt(e.reduce((n,s)=>n+s*s,0))||1;return e.map(n=>n/t)}async function qn(l,e,t,n){const s=await fetch(`${Bt}/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({embedding:l,k:e,minScore:t,channel:n})});if(!s.ok)throw new Error(`Search API error: ${s.status}`);return(await s.json()).results.map(i=>({noteId:i.id,score:i.score,distance:i.distance}))}function Yn(l,e,t){if(!Ee||ce.size===0)throw new Error("Local cache not loaded");const n=[];for(const[s,r]of ce){const i=Un(l,r.embedding);i>=t&&n.push({noteId:s,score:i,distance:1-i})}return n.sort((s,r)=>r.score-s.score),n.slice(0,e)}async function Kn(l,e=10,t=.5,n){const s=await Hn(l);try{const r=await qn(s,e,t,n);if(r.length>0)return r}catch{console.log("Server search unavailable, using local cache")}return Yn(s,e,t)}async function Rt(){try{const l=await fetch(`${Bt}/status`);if(!l.ok)return console.warn("Search API not available, trying IndexedDB"),qe();const e=await l.json();return e.totalVectors===0?qe():(Ee=!0,Re=Date.now(),console.log(`Search API available: ${e.totalVectors} vectors`),!0)}catch{return qe()}}async function qe(){try{const l=await Ge.table("embeddings").get("ruvector_cache");if(!l?.data)return!1;const e=JSON.parse(l.data);ce.clear();for(const t of e)ce.set(t.noteId,t);return Ee=ce.size>0,Re=l.timestamp||Date.now(),console.log(`Loaded ${ce.size} embeddings from IndexedDB`),Ee}catch{return!1}}function gt(){return Ee?{vectorCount:ce.size,dimensions:Je,lastUpdated:Re?new Date(Re).toISOString():null,searchMode:navigator.onLine?"hybrid":"cached"}:null}async function Gn(l=!1){return!navigator.onLine&&!l?{synced:!1,count:ce.size}:{synced:await Rt(),count:ce.size}}const Jn=Rt;function kt(l,e,t){const n=l.slice();return n[19]=e[t],n}function yt(l){let e,t="...";return{c(){e=m("span"),e.textContent=t,this.h()},l(n){e=_(n,"SPAN",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-1nvyc9z"&&(e.textContent=t),this.h()},h(){d(e,"class","loading-indicator svelte-8oktfb")},m(n,s){N(n,e,s)},d(n){n&&u(e)}}}function wt(l){let e,t;return{c(){e=m("div"),t=x(l[4]),this.h()},l(n){e=_(n,"DIV",{class:!0});var s=w(e);t=j(s,l[4]),s.forEach(u),this.h()},h(){d(e,"class","error-message svelte-8oktfb")},m(n,s){N(n,e,s),f(e,t)},p(n,s){s&16&&G(t,n[4])},d(n){n&&u(e)}}}function Qn(l){let e,t,n=l[5].vectorCount.toLocaleString()+"",s,r,i,a,o=St(l[7])+"",c,h,S=Et(l[5].lastUpdated)+"",g;return{c(){e=m("div"),t=m("span"),s=x(n),r=x(" messages indexed"),i=F(),a=m("span"),c=x(o),h=x(" ‚Ä¢ "),g=x(S),this.h()},l(E){e=_(E,"DIV",{class:!0});var C=w(e);t=_(C,"SPAN",{});var v=w(t);s=j(v,n),r=j(v," messages indexed"),v.forEach(u),i=L(C),a=_(C,"SPAN",{});var p=w(a);c=j(p,o),h=j(p," ‚Ä¢ "),g=j(p,S),p.forEach(u),C.forEach(u),this.h()},h(){d(e,"class","stats svelte-8oktfb")},m(E,C){N(E,e,C),f(e,t),f(t,s),f(t,r),f(e,i),f(e,a),f(a,c),f(a,h),f(a,g)},p(E,C){C&32&&n!==(n=E[5].vectorCount.toLocaleString()+"")&&G(s,n),C&128&&o!==(o=St(E[7])+"")&&G(c,o),C&32&&S!==(S=Et(E[5].lastUpdated)+"")&&G(g,S)},d(E){E&&u(e)}}}function Wn(l){let e,t,n="Semantic search requires downloading the search index.",s;function r(o,c){return Ft()?Zn:Xn}let a=r()(l);return{c(){e=m("div"),t=m("p"),t.textContent=n,s=F(),a.c(),this.h()},l(o){e=_(o,"DIV",{class:!0});var c=w(e);t=_(c,"P",{class:!0,"data-svelte-h":!0}),Z(t)!=="svelte-y7h9br"&&(t.textContent=n),s=L(c),a.l(c),c.forEach(u),this.h()},h(){d(t,"class","svelte-8oktfb"),d(e,"class","info-message svelte-8oktfb")},m(o,c){N(o,e,c),f(e,t),f(e,s),a.m(e,null)},p(o,c){a.p(o,c)},d(o){o&&u(e),a.d()}}}function Xn(l){let e,t="Connect to WiFi to download.";return{c(){e=m("p"),e.textContent=t,this.h()},l(n){e=_(n,"P",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-1vvgh80"&&(e.textContent=t),this.h()},h(){d(e,"class","wifi-notice svelte-8oktfb")},m(n,s){N(n,e,s)},p:$,d(n){n&&u(e)}}}function Zn(l){let e,t,n,s;return{c(){e=m("button"),t=x("Download Index"),this.h()},l(r){e=_(r,"BUTTON",{class:!0});var i=w(e);t=j(i,"Download Index"),i.forEach(u),this.h()},h(){e.disabled=l[3],d(e,"class","svelte-8oktfb")},m(r,i){N(r,e,i),f(e,t),n||(s=se(e,"click",l[9]),n=!0)},p(r,i){i&8&&(e.disabled=r[3])},d(r){r&&u(e),n=!1,s()}}}function $n(l){let e,t="No matching messages found";return{c(){e=m("div"),e.textContent=t,this.h()},l(n){e=_(n,"DIV",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-ig5svh"&&(e.textContent=t),this.h()},h(){d(e,"class","no-results svelte-8oktfb")},m(n,s){N(n,e,s)},p:$,d(n){n&&u(e)}}}function es(l){let e,t=Be(l[2]),n=[];for(let s=0;s<t.length;s+=1)n[s]=Ct(kt(l,t,s));return{c(){e=m("div");for(let s=0;s<n.length;s+=1)n[s].c();this.h()},l(s){e=_(s,"DIV",{class:!0});var r=w(e);for(let i=0;i<n.length;i+=1)n[i].l(r);r.forEach(u),this.h()},h(){d(e,"class","results svelte-8oktfb")},m(s,r){N(s,e,r);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(s,r){if(r&1028){t=Be(s[2]);let i;for(i=0;i<t.length;i+=1){const a=kt(s,t,i);n[i]?n[i].p(a,r):(n[i]=Ct(a),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(s){s&&u(e),Ut(n,s)}}}function Ct(l){let e,t,n=l[19].noteId.slice(0,8)+"",s,r,i,a,o=(l[19].score*100).toFixed(0)+"",c,h,S,g,E;function C(){return l[13](l[19])}return{c(){e=m("button"),t=m("span"),s=x(n),r=x("..."),i=F(),a=m("span"),c=x(o),h=x("% match"),S=F(),this.h()},l(v){e=_(v,"BUTTON",{class:!0});var p=w(e);t=_(p,"SPAN",{class:!0});var A=w(t);s=j(A,n),r=j(A,"..."),A.forEach(u),i=L(p),a=_(p,"SPAN",{class:!0});var I=w(a);c=j(I,o),h=j(I,"% match"),I.forEach(u),S=L(p),p.forEach(u),this.h()},h(){d(t,"class","note-id svelte-8oktfb"),d(a,"class","score svelte-8oktfb"),d(e,"class","result-item svelte-8oktfb")},m(v,p){N(v,e,p),f(e,t),f(t,s),f(t,r),f(e,i),f(e,a),f(a,c),f(a,h),f(e,S),g||(E=se(e,"click",C),g=!0)},p(v,p){l=v,p&4&&n!==(n=l[19].noteId.slice(0,8)+"")&&G(s,n),p&4&&o!==(o=(l[19].score*100).toFixed(0)+"")&&G(c,o)},d(v){v&&u(e),g=!1,E()}}}function ts(l){let e,t,n,s,r,i,a,o,c,h,S,g,E,C,v=l[3]&&yt(),p=l[4]&&wt(l);function A(D,P){if(!D[6])return Wn;if(D[5])return Qn}let I=A(l),k=I&&I(l);function b(D,P){if(D[2].length>0)return es;if(D[1]&&!D[3]&&D[6])return $n}let M=b(l),y=M&&M(l);return{c(){e=m("div"),t=m("div"),n=m("div"),s=m("input"),i=F(),v&&v.c(),a=F(),o=m("button"),c=x("‚Üª"),h=F(),p&&p.c(),S=F(),k&&k.c(),g=F(),y&&y.c(),this.h()},l(D){e=_(D,"DIV",{class:!0});var P=w(e);t=_(P,"DIV",{class:!0});var T=w(t);n=_(T,"DIV",{class:!0});var V=w(n);s=_(V,"INPUT",{type:!0,placeholder:!0,class:!0}),i=L(V),v&&v.l(V),V.forEach(u),a=L(T),o=_(T,"BUTTON",{class:!0,title:!0});var O=w(o);c=j(O,"‚Üª"),O.forEach(u),T.forEach(u),h=L(P),p&&p.l(P),S=L(P),k&&k.l(P),g=L(P),y&&y.l(P),P.forEach(u),this.h()},h(){d(s,"type","text"),d(s,"placeholder",l[0]),d(s,"class","search-input svelte-8oktfb"),s.disabled=r=!l[6],d(n,"class","search-input-wrapper svelte-8oktfb"),d(o,"class","sync-btn svelte-8oktfb"),o.disabled=l[3],d(o,"title","Sync embeddings"),d(t,"class","search-header svelte-8oktfb"),d(e,"class","semantic-search svelte-8oktfb")},m(D,P){N(D,e,P),f(e,t),f(t,n),f(n,s),et(s,l[1]),f(n,i),v&&v.m(n,null),f(t,a),f(t,o),f(o,c),f(e,h),p&&p.m(e,null),f(e,S),k&&k.m(e,null),f(e,g),y&&y.m(e,null),E||(C=[se(s,"input",l[12]),se(s,"input",l[8]),se(o,"click",l[9])],E=!0)},p(D,[P]){P&1&&d(s,"placeholder",D[0]),P&64&&r!==(r=!D[6])&&(s.disabled=r),P&2&&s.value!==D[1]&&et(s,D[1]),D[3]?v||(v=yt(),v.c(),v.m(n,null)):v&&(v.d(1),v=null),P&8&&(o.disabled=D[3]),D[4]?p?p.p(D,P):(p=wt(D),p.c(),p.m(e,S)):p&&(p.d(1),p=null),I===(I=A(D))&&k?k.p(D,P):(k&&k.d(1),k=I&&I(D),k&&(k.c(),k.m(e,g))),M===(M=b(D))&&y?y.p(D,P):(y&&y.d(1),y=M&&M(D),y&&(y.c(),y.m(e,null)))},i:$,o:$,d(D){D&&u(e),v&&v.d(),p&&p.d(),k&&k.d(),y&&y.d(),E=!1,Ot(C)}}}function Et(l){return l?new Date(l).toLocaleDateString():"Never"}function St(l){switch(l){case"server":return"RuVector (server)";case"cached":return"Offline cache";case"hybrid":return"RuVector + cache";default:return l}}function ns(l,e,t){let{onSelect:n=()=>{}}=e,{placeholder:s="Search by meaning..."}=e,r="",i=[],a=!1,o=null,c=null,h=!1,S="hybrid",g=new Map,E;async function C(y){if(g.has(y))return g.get(y);try{const D=await Ge.channels.get(y);if(D){const T=D.tags?.find(V=>V[0]==="section")?.[1]||"public-lobby";return g.set(y,T),T}}catch(D){console.warn("Failed to get channel section:",D)}return null}async function v(y){const D=[];for(const P of y)try{const T=await Ge.messages.get(P.noteId);if(!T)continue;const V=await C(T.channelId);if(!V)continue;_n.canAccessSection(V)&&D.push(P)}catch{console.warn("Failed to check authorization for result:",P.noteId)}return D}xe(async()=>{try{t(6,h=await Jn()),h&&(t(5,c=gt()),t(7,S=c?.searchMode||"hybrid"))}catch(y){console.warn("Failed to load search index:",y)}});async function p(){if(!r.trim()){t(2,i=[]);return}if(!h){t(4,o="Search index not loaded. Sync embeddings first.");return}t(3,a=!0),t(4,o=null);try{const y=await Kn(r,30,.3),D=await v(y);t(2,i=D.slice(0,10))}catch(y){t(4,o=y instanceof Error?y.message:"Search failed"),t(2,i=[])}finally{t(3,a=!1)}}function A(){clearTimeout(E),E=setTimeout(p,300)}async function I(){if(!Ft()&&!navigator.onLine){t(4,o="Please connect to sync embeddings");return}t(3,a=!0),t(4,o=null);try{(await Gn(!0)).synced&&(t(6,h=!0),t(5,c=gt()),t(7,S=c?.searchMode||"hybrid"))}catch(y){t(4,o=y instanceof Error?y.message:"Sync failed")}finally{t(3,a=!1)}}function k(y){n(y)}function b(){r=this.value,t(1,r)}const M=y=>k(y.noteId);return l.$$set=y=>{"onSelect"in y&&t(11,n=y.onSelect),"placeholder"in y&&t(0,s=y.placeholder)},[s,r,i,a,o,c,h,S,A,I,k,n,b,M]}class ss extends Ie{constructor(e){super(),De(this,e,ns,ts,Se,{onSelect:11,placeholder:0})}}function It(l,e,t){const n=l.slice();return n[30]=e[t],n}function Dt(l){let e,t,n,s,r="Semantic Search",i,a,o='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',c,h,S="Search by meaning, not just keywords. Find messages that are semantically similar to your query.",g,E,C,v,p;return E=new ss({props:{onSelect:l[11],placeholder:"Search messages by meaning..."}}),{c(){e=m("div"),t=m("div"),n=m("div"),s=m("h3"),s.textContent=r,i=F(),a=m("button"),a.innerHTML=o,c=F(),h=m("p"),h.textContent=S,g=F(),ie(E.$$.fragment),this.h()},l(A){e=_(A,"DIV",{class:!0});var I=w(e);t=_(I,"DIV",{class:!0});var k=w(t);n=_(k,"DIV",{class:!0});var b=w(n);s=_(b,"H3",{class:!0,"data-svelte-h":!0}),Z(s)!=="svelte-kr88ev"&&(s.textContent=r),i=L(b),a=_(b,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(a)!=="svelte-v6flfe"&&(a.innerHTML=o),b.forEach(u),c=L(k),h=_(k,"P",{class:!0,"data-svelte-h":!0}),Z(h)!=="svelte-1qiiq15"&&(h.textContent=S),g=L(k),oe(E.$$.fragment,k),k.forEach(u),I.forEach(u),this.h()},h(){d(s,"class","text-lg font-semibold"),d(a,"class","btn btn-ghost btn-sm btn-circle"),d(n,"class","flex items-center justify-between mb-2"),d(h,"class","text-sm text-base-content/70 mb-3"),d(t,"class","card-body p-4"),d(e,"class","card bg-base-200 shadow-lg mb-6")},m(A,I){N(A,e,I),f(e,t),f(t,n),f(n,s),f(n,i),f(n,a),f(t,c),f(t,h),f(t,g),ae(E,t,null),C=!0,v||(p=se(a,"click",l[23]),v=!0)},p:$,i(A){C||(U(E.$$.fragment,A),C=!0)},o(A){z(E.$$.fragment,A),C=!1},d(A){A&&u(e),re(E),v=!1,p()}}}function ls(l){let e,t=[],n=new Map,s,r=Be(l[6]);const i=a=>a[30].id;for(let a=0;a<r.length;a+=1){let o=It(l,r,a),c=i(o);n.set(c,t[a]=At(c,o))}return{c(){e=m("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=_(a,"DIV",{class:!0});var o=w(e);for(let c=0;c<t.length;c+=1)t[c].l(o);o.forEach(u),this.h()},h(){d(e,"class","space-y-3")},m(a,o){N(a,e,o);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);s=!0},p(a,o){o[0]&64&&(r=Be(a[6]),he(),t=qt(t,o,i,1,a,r,n,e,Yt,At,null,It),_e())},i(a){if(!s){for(let o=0;o<r.length;o+=1)U(t[o]);s=!0}},o(a){for(let o=0;o<t.length;o+=1)z(t[o]);s=!1},d(a){a&&u(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function rs(l){let e,t,n,s,r,i;t=new Pn({props:{icon:"üí¨",title:l[0]?`No channels in ${l[9]}`:"No channels yet",description:l[0]?"This section doesn't have any channels yet. Check back later or browse all channels.":"Channels are where conversations happen. Browse existing channels or ask an admin to create one."}});let a=l[0]&&Tt(),o=l[7]&&Pt();return{c(){e=m("div"),ie(t.$$.fragment),n=F(),s=m("div"),a&&a.c(),r=F(),o&&o.c(),this.h()},l(c){e=_(c,"DIV",{class:!0});var h=w(e);oe(t.$$.fragment,h),n=L(h),s=_(h,"DIV",{class:!0});var S=w(s);a&&a.l(S),r=L(S),o&&o.l(S),S.forEach(u),h.forEach(u),this.h()},h(){d(s,"class","flex flex-wrap gap-2 justify-center mt-2"),d(e,"class","text-center")},m(c,h){N(c,e,h),ae(t,e,null),f(e,n),f(e,s),a&&a.m(s,null),f(s,r),o&&o.m(s,null),i=!0},p(c,h){const S={};h[0]&513&&(S.title=c[0]?`No channels in ${c[9]}`:"No channels yet"),h[0]&1&&(S.description=c[0]?"This section doesn't have any channels yet. Check back later or browse all channels.":"Channels are where conversations happen. Browse existing channels or ask an admin to create one."),t.$set(S),c[0]?a||(a=Tt(),a.c(),a.m(s,r)):a&&(a.d(1),a=null),c[7]?o||(o=Pt(),o.c(),o.m(s,null)):o&&(o.d(1),o=null)},i(c){i||(U(t.$$.fragment,c),i=!0)},o(c){z(t.$$.fragment,c),i=!1},d(c){c&&u(e),re(t),a&&a.d(),o&&o.d()}}}function as(l){let e,t,n,s,r,i,a,o="Connection Issue",c,h,S,g,E,C,v,p="Back to Home",A;function I(T,V){return V[0]&4&&(s=null),V[0]&4&&(r=null),s==null&&(s=!!(T[2].includes("timed out")||T[2].includes("unavailable"))),s?fs:(r==null&&(r=!!T[2].includes("Authentication")),r?cs:is)}let k=I(l,[-1,-1]),b=k(l);function M(T,V){return T[4]<je?ds:us}let y=M(l),D=y(l),P=l[4]>0&&Mt(l);return{c(){e=m("div"),t=m("div"),n=m("div"),b.c(),i=F(),a=m("h3"),a.textContent=o,c=F(),h=m("p"),S=x(l[2]),g=F(),E=m("div"),D.c(),C=F(),v=m("a"),v.textContent=p,A=F(),P&&P.c(),this.h()},l(T){e=_(T,"DIV",{class:!0});var V=w(e);t=_(V,"DIV",{class:!0});var O=w(t);n=_(O,"DIV",{class:!0});var J=w(n);b.l(J),J.forEach(u),i=L(O),a=_(O,"H3",{class:!0,"data-svelte-h":!0}),Z(a)!=="svelte-x29mwq"&&(a.textContent=o),c=L(O),h=_(O,"P",{class:!0});var ee=w(h);S=j(ee,l[2]),ee.forEach(u),g=L(O),E=_(O,"DIV",{class:!0});var Q=w(E);D.l(Q),C=L(Q),v=_(Q,"A",{href:!0,class:!0,"data-svelte-h":!0}),Z(v)!=="svelte-5104hx"&&(v.textContent=p),Q.forEach(u),A=L(O),P&&P.l(O),O.forEach(u),V.forEach(u),this.h()},h(){d(n,"class","text-6xl mb-4"),d(a,"class","text-lg font-semibold text-error mb-2"),d(h,"class","text-base-content/70 mb-4 max-w-md mx-auto"),d(v,"href",ke+"/"),d(v,"class","btn btn-ghost btn-sm"),d(E,"class","flex flex-col sm:flex-row gap-2 justify-center"),d(t,"class","card-body text-center py-8"),d(e,"class","card bg-base-200 shadow-lg")},m(T,V){N(T,e,V),f(e,t),f(t,n),b.m(n,null),f(t,i),f(t,a),f(t,c),f(t,h),f(h,S),f(t,g),f(t,E),D.m(E,null),f(E,C),f(E,v),f(t,A),P&&P.m(t,null)},p(T,V){k!==(k=I(T,V))&&(b.d(1),b=k(T),b&&(b.c(),b.m(n,null))),V[0]&4&&G(S,T[2]),y===(y=M(T))&&D?D.p(T,V):(D.d(1),D=y(T),D&&(D.c(),D.m(E,C))),T[4]>0?P?P.p(T,V):(P=Mt(T),P.c(),P.m(t,null)):P&&(P.d(1),P=null)},i:$,o:$,d(T){T&&u(e),b.d(),D.d(),P&&P.d()}}}function os(l){let e,t,n;return t=new un({props:{variant:"channel",count:5}}),{c(){e=m("div"),ie(t.$$.fragment),this.h()},l(s){e=_(s,"DIV",{class:!0});var r=w(e);oe(t.$$.fragment,r),r.forEach(u),this.h()},h(){d(e,"class","space-y-3")},m(s,r){N(s,e,r),ae(t,e,null),n=!0},p:$,i(s){n||(U(t.$$.fragment,s),n=!0)},o(s){z(t.$$.fragment,s),n=!1},d(s){s&&u(e),re(t)}}}function At(l,e){let t,n,s;return n=new yn({props:{channel:e[30]}}),{key:l,first:null,c(){t=Ve(),ie(n.$$.fragment),this.h()},l(r){t=Ve(),oe(n.$$.fragment,r),this.h()},h(){this.first=t},m(r,i){N(r,t,i),ae(n,r,i),s=!0},p(r,i){e=r;const a={};i[0]&64&&(a.channel=e[30]),n.$set(a)},i(r){s||(U(n.$$.fragment,r),s=!0)},o(r){z(n.$$.fragment,r),s=!1},d(r){r&&u(t),re(n,r)}}}function Tt(l){let e,t="View All Channels";return{c(){e=m("a"),e.textContent=t,this.h()},l(n){e=_(n,"A",{href:!0,class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-10n5lvv"&&(e.textContent=t),this.h()},h(){d(e,"href",ke+"/chat"),d(e,"class","btn btn-primary btn-sm")},m(n,s){N(n,e,s)},d(n){n&&u(e)}}}function Pt(l){let e,t=`<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                Create Channel`;return{c(){e=m("a"),e.innerHTML=t,this.h()},l(n){e=_(n,"A",{href:!0,class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-1f9kknd"&&(e.innerHTML=t),this.h()},h(){d(e,"href",ke+"/admin"),d(e,"class","btn btn-primary btn-sm gap-2")},m(n,s){N(n,e,s)},d(n){n&&u(e)}}}function is(l){let e,t="‚ö†Ô∏è";return{c(){e=m("span"),e.textContent=t,this.h()},l(n){e=_(n,"SPAN",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-1e9k516"&&(e.textContent=t),this.h()},h(){d(e,"class","opacity-50")},m(n,s){N(n,e,s)},d(n){n&&u(e)}}}function cs(l){let e,t="üîí";return{c(){e=m("span"),e.textContent=t,this.h()},l(n){e=_(n,"SPAN",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-czshv4"&&(e.textContent=t),this.h()},h(){d(e,"class","opacity-50")},m(n,s){N(n,e,s)},d(n){n&&u(e)}}}function fs(l){let e,t="üîå";return{c(){e=m("span"),e.textContent=t,this.h()},l(n){e=_(n,"SPAN",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-812b27"&&(e.textContent=t),this.h()},h(){d(e,"class","opacity-50")},m(n,s){N(n,e,s)},d(n){n&&u(e)}}}function us(l){let e,t="Max retries reached. Please refresh the page.";return{c(){e=m("p"),e.textContent=t,this.h()},l(n){e=_(n,"P",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-1d1i2pt"&&(e.textContent=t),this.h()},h(){d(e,"class","text-sm text-base-content/65")},m(n,s){N(n,e,s)},p:$,d(n){n&&u(e)}}}function ds(l){let e,t,n;function s(a,o){return a[5]?_s:hs}let r=s(l),i=r(l);return{c(){e=m("button"),i.c(),this.h()},l(a){e=_(a,"BUTTON",{class:!0});var o=w(e);i.l(o),o.forEach(u),this.h()},h(){d(e,"class","btn btn-primary btn-sm"),e.disabled=l[5]},m(a,o){N(a,e,o),i.m(e,null),t||(n=se(e,"click",l[12]),t=!0)},p(a,o){r!==(r=s(a))&&(i.d(1),i=r(a),i&&(i.c(),i.m(e,null))),o[0]&32&&(e.disabled=a[5])},d(a){a&&u(e),i.d(),t=!1,n()}}}function hs(l){let e;return{c(){e=x("Retry Connection")},l(t){e=j(t,"Retry Connection")},m(t,n){N(t,e,n)},d(t){t&&u(e)}}}function _s(l){let e,t;return{c(){e=m("span"),t=x(`
                    Retrying...`),this.h()},l(n){e=_(n,"SPAN",{class:!0}),w(e).forEach(u),t=j(n,`
                    Retrying...`),this.h()},h(){d(e,"class","loading loading-spinner loading-xs")},m(n,s){N(n,e,s),N(n,t,s)},d(n){n&&(u(e),u(t))}}}function Mt(l){let e,t,n,s,r;return{c(){e=m("p"),t=x("Retry attempt "),n=x(l[4]),s=x(" of "),r=x(je),this.h()},l(i){e=_(i,"P",{class:!0});var a=w(e);t=j(a,"Retry attempt "),n=j(a,l[4]),s=j(a," of "),r=j(a,je),a.forEach(u),this.h()},h(){d(e,"class","text-xs text-base-content/60 mt-2")},m(i,a){N(i,e,a),f(e,t),f(e,n),f(e,s),f(e,r)},p(i,a){a[0]&16&&G(n,i[4])},d(i){i&&u(e)}}}function ms(l){let e,t,n,s,r,i,a,o,c,h,S,g,E,C,v,p,A,I,k,b='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <span class="hidden sm:inline">Search</span>',M,y,D,P,T,V,O,J,ee,Q,ne,H,q,W,R,Y,me,ue;document.title=e=l[9]+" - "+l[10].name,r=new sn({}),y=new jn({});let K=l[3]&&Dt(l);const ye=[os,as,rs,ls],te=[];function de(B,X){return B[1]?0:B[2]?1:B[6].length===0?2:3}return T=de(l),V=te[T]=ye[T](l),ee=new ln({}),ne=new rn({}),q=new an({}),R=new on({}),{c(){t=F(),n=m("div"),s=m("div"),ie(r.$$.fragment),i=F(),a=m("div"),o=m("div"),c=m("div"),h=m("div"),S=m("div"),g=m("h1"),E=x(l[9]),C=F(),v=m("p"),p=x(l[8]),A=F(),I=m("div"),k=m("button"),k.innerHTML=b,M=F(),ie(y.$$.fragment),D=F(),K&&K.c(),P=F(),V.c(),O=F(),J=m("div"),ie(ee.$$.fragment),Q=F(),ie(ne.$$.fragment),H=F(),ie(q.$$.fragment),W=F(),ie(R.$$.fragment),this.h()},l(B){Ht("svelte-4a1mv3",document.head).forEach(u),t=L(B),n=_(B,"DIV",{class:!0});var le=w(n);s=_(le,"DIV",{class:!0});var we=w(s);oe(r.$$.fragment,we),we.forEach(u),i=L(le),a=_(le,"DIV",{class:!0});var Ae=w(a);o=_(Ae,"DIV",{class:!0});var pe=w(o);c=_(pe,"DIV",{class:!0});var We=w(c);h=_(We,"DIV",{class:!0});var Te=w(h);S=_(Te,"DIV",{});var Pe=w(S);g=_(Pe,"H1",{class:!0});var Xe=w(g);E=j(Xe,l[9]),Xe.forEach(u),C=L(Pe),v=_(Pe,"P",{class:!0});var Ze=w(v);p=j(Ze,l[8]),Ze.forEach(u),Pe.forEach(u),A=L(Te),I=_(Te,"DIV",{class:!0});var Me=w(I);k=_(Me,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),Z(k)!=="svelte-1oclgr5"&&(k.innerHTML=b),M=L(Me),oe(y.$$.fragment,Me),Me.forEach(u),Te.forEach(u),We.forEach(u),D=L(pe),K&&K.l(pe),P=L(pe),V.l(pe),pe.forEach(u),O=L(Ae),J=_(Ae,"DIV",{class:!0});var fe=w(J);oe(ee.$$.fragment,fe),Q=L(fe),oe(ne.$$.fragment,fe),H=L(fe),oe(q.$$.fragment,fe),W=L(fe),oe(R.$$.fragment,fe),fe.forEach(u),Ae.forEach(u),le.forEach(u),this.h()},h(){d(s,"class","mb-4"),d(g,"class","text-4xl font-bold gradient-text mb-2"),d(v,"class","text-base-content/70"),d(k,"class","btn btn-ghost btn-sm"),d(k,"title","Semantic Search"),d(I,"class","flex items-center gap-2"),d(h,"class","flex items-start justify-between gap-4"),d(c,"class","mb-6"),d(o,"class","flex-1"),d(J,"class","hidden lg:block lg:w-80 space-y-4"),d(a,"class","flex flex-col lg:flex-row gap-6"),d(n,"class","container mx-auto p-4 max-w-6xl")},m(B,X){N(B,t,X),N(B,n,X),f(n,s),ae(r,s,null),f(n,i),f(n,a),f(a,o),f(o,c),f(c,h),f(h,S),f(S,g),f(g,E),f(S,C),f(S,v),f(v,p),f(h,A),f(h,I),f(I,k),f(I,M),ae(y,I,null),f(o,D),K&&K.m(o,null),f(o,P),te[T].m(o,null),f(a,O),f(a,J),ae(ee,J,null),f(J,Q),ae(ne,J,null),f(J,H),ae(q,J,null),f(J,W),ae(R,J,null),Y=!0,me||(ue=se(k,"click",l[22]),me=!0)},p(B,X){(!Y||X[0]&1536)&&e!==(e=B[9]+" - "+B[10].name)&&(document.title=e),(!Y||X[0]&512)&&G(E,B[9]),(!Y||X[0]&256)&&G(p,B[8]),B[3]?K?(K.p(B,X),X[0]&8&&U(K,1)):(K=Dt(B),K.c(),U(K,1),K.m(o,P)):K&&(he(),z(K,1,1,()=>{K=null}),_e());let le=T;T=de(B),T===le?te[T].p(B,X):(he(),z(te[le],1,1,()=>{te[le]=null}),_e(),V=te[T],V?V.p(B,X):(V=te[T]=ye[T](B),V.c()),U(V,1),V.m(o,null))},i(B){Y||(U(r.$$.fragment,B),U(y.$$.fragment,B),U(K),U(V),U(ee.$$.fragment,B),U(ne.$$.fragment,B),U(q.$$.fragment,B),U(R.$$.fragment,B),Y=!0)},o(B){z(r.$$.fragment,B),z(y.$$.fragment,B),z(K),z(V),z(ee.$$.fragment,B),z(ne.$$.fragment,B),z(q.$$.fragment,B),z(R.$$.fragment,B),Y=!1},d(B){B&&(u(t),u(n)),re(r),re(y),K&&K.d(),te[T].d(),re(ee),re(ne),re(q),re(R),me=!1,ue()}}}const je=3,ps=6e3;function bs(l,e,t){let n,s,r,i,a,o,c,h,S,g,E,C;be(l,tt,H=>t(26,h=H)),be(l,st,H=>t(18,S=H)),be(l,Zt,H=>t(19,g=H)),be(l,en,H=>t(20,E=H)),be(l,Kt,H=>t(21,C=H));const v=Qt();let p=[],A=!0,I=null,k=!1,b=0,M=!1,y=!1,D=!1,P=null;async function T(H){t(3,k=!1);for(const q of r)if(q.id){Ye(`${ke}/chat/${q.id}?highlight=${H}`);return}console.warn("Message not found in loaded channels:",H)}async function V(){if(!D){t(15,D=!0);try{await Xt(h);const H=zt(st),q=H?.cohorts??[],W=H?.isAdmin??!1;t(13,p=await tn({userCohorts:q,userPubkey:h.publicKey??void 0,isAdmin:W})),t(2,I=null),t(4,b=0)}catch(H){console.error("Failed to load channels:",H),t(2,I=H instanceof Error?H.message:"Failed to load channels"),I.includes("timeout")||I.includes("Timeout")?t(2,I="Connection timed out. The server may be temporarily unavailable."):I.includes("Invalid private key")&&t(2,I="Authentication failed. Please try logging out and back in.")}finally{t(1,A=!1),t(15,D=!1),J()}}}function O(){J(),P=setTimeout(()=>{A&&t(1,A=!1)},ps)}function J(){P&&(clearTimeout(P),P=null)}async function ee(){if(!(M||b>=je)){t(5,M=!0),t(4,b++,b),t(2,I=null);try{await V()}finally{t(5,M=!1)}}}xe(async()=>{if(await tt.waitForReady(),!h.isAuthenticated||!h.publicKey){Ye(`${ke}/`);return}O(),await V(),t(14,y=!0)}),Nt(()=>{J()});const Q=()=>t(3,k=!k),ne=()=>t(3,k=!1);return l.$$.update=()=>{l.$$.dirty[0]&2097152&&t(0,n=C.url.searchParams.get("section")),l.$$.dirty[0]&1&&t(17,s=n?Wt(n):null),l.$$.dirty[0]&8193&&t(6,r=n?p.filter(H=>H.section===n):p),l.$$.dirty[0]&131072&&t(9,i=s?s.name:"Channels"),l.$$.dirty[0]&131072&&t(8,a=s?s.description:"Join conversations in public channels"),l.$$.dirty[0]&1048576&&t(7,o=(()=>{const H=E;return H?$t().some(q=>nn(H,q.id)):!1})()),l.$$.dirty[0]&524288&&t(16,c=g),l.$$.dirty[0]&65536&&(c.state===nt.Error||(c.state,nt.AuthFailed)),l.$$.dirty[0]&311296&&S&&y&&!D&&V()},[n,A,I,k,b,M,r,o,a,i,v,T,ee,p,y,D,c,s,S,g,E,C,Q,ne]}class zs extends Ie{constructor(e){super(),De(this,e,bs,ms,Se,{},null,[-1,-1])}}export{zs as component,Hs as universal};
